<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Node 14 Mongodb | SimFantasy</title><meta name=author content="Simz"><meta name=description content="MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的 NoSql 数据库。他支持的数据结构非常松散，是类似 json 的 bson 语法，因此可以存储比较复杂的数据类型。Mongodb 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高性能、易部署、易使用，存储数据非常方便。"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Node 14 Mongodb"><meta name=twitter:description content="MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的 NoSql 数据库。他支持的数据结构非常松散，是类似 json 的 bson 语法，因此可以存储比较复杂的数据类型。Mongodb 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高性能、易部署、易使用，存储数据非常方便。"><meta property="og:title" content="Node 14 Mongodb"><meta property="og:description" content="MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的 NoSql 数据库。他支持的数据结构非常松散，是类似 json 的 bson 语法，因此可以存储比较复杂的数据类型。Mongodb 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高性能、易部署、易使用，存储数据非常方便。"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost/posts/node-mongodb/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-08T23:36:15+08:00"><meta property="article:modified_time" content="2023-10-08T23:36:15+08:00"><meta property="og:see_also" content="http://localhost/posts/node-egg/"><meta property="og:see_also" content="http://localhost/posts/node-mongoose/"><meta property="og:see_also" content="http://localhost/posts/node-log/"><meta property="og:see_also" content="http://localhost/posts/node-validator/"><meta property="og:see_also" content="http://localhost/posts/node-prisma/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=http://localhost>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Node 14 Mongodb</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2023-10-08</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/node/ title=node>node</a>
<a href=/tags/mongoddb/ title=mongoddb>mongoddb</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p><code>MongoDB</code> 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的 <code>NoSql</code> 数据库。他支持的数据结构非常松散，是类似 <code>json</code> 的 <code>bson</code> 语法，因此可以存储比较复杂的数据类型。<code>Mongodb</code> 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高性能、易部署、易使用，存储数据非常方便。</p><h3 id=在docker中安装>在Docker中安装<a class=anchorjs-link href=#%e5%9c%a8docker%e4%b8%ad%e5%ae%89%e8%a3%85></a></h3><p>找一个合适的镜像直接拉取镜像后，执行命令</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>docker run --name sim-mongo -p 27017:27017 -v /o/studylang/Docker/MongoDb/mongo-data:/data/db -d mongo:6.0.9-rc1
</span></span></code></pre></div><p><code>--name sim-mongo</code>：表示数据服务的名称</p><p><code>-p 27017:27017</code>：映射的端口号</p><p><code>-v /o/studylang/Docker/MongoDb/mongo-data:/data/db</code>：volume映射到本地磁盘上的位置。将<code>docker</code>中<code>data/db</code>数据目录映射到<code>o:/studylang/Docker/MongDb/mongo-data</code>目录上。</p><p><code>mongo:6.0.9-rc1</code>的版本号</p><h4 id=在终端操作mongodb>在终端操作MongoDB<a class=anchorjs-link href=#%e5%9c%a8%e7%bb%88%e7%ab%af%e6%93%8d%e4%bd%9cmongodb></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>docker <span style=color:#04a5e5>exec</span> -it <span style=color:#04a5e5;font-weight:700>[</span>dockerId<span style=color:#04a5e5;font-weight:700>]</span> /bin/mongosh
</span></span></code></pre></div><h3 id=数据库操作>数据库操作<a class=anchorjs-link href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c></a></h3><p><code>MongoDB</code>数据库中，没有表和数据行的概念，分别对应的是集合<code>collection</code>、数据行 <code>document</code></p><h4 id=查看所有的数据库>查看所有的数据库<a class=anchorjs-link href=#%e6%9f%a5%e7%9c%8b%e6%89%80%e6%9c%89%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>show dbs
</span></span></code></pre></div><h4 id=查看当前使用的数据库>查看当前使用的数据库<a class=anchorjs-link href=#%e6%9f%a5%e7%9c%8b%e5%bd%93%e5%89%8d%e4%bd%bf%e7%94%a8%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db
</span></span></code></pre></div><h4 id=创建数据库>创建数据库<a class=anchorjs-link href=#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>use <span style=color:#04a5e5;font-weight:700>[</span>数据库名<span style=color:#04a5e5;font-weight:700>]</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>use shop
</span></span></code></pre></div><p><code>MongoDB</code>默认在创建数据库后不会直接创建成功，只是切换到了这个数据库，并没有实际的进行操作。如果需要创建成功，需要往数据库下的表（集合）中插入数据，才能创建成功。</p><h4 id=删除数据库>删除数据库<a class=anchorjs-link href=#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae%e5%ba%93></a></h4><p>删除数据库之前现需要使用<code>use</code>切换到对应的数据库</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.dropDatabase<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><h3 id=集合操作>集合操作<a class=anchorjs-link href=#%e9%9b%86%e5%90%88%e6%93%8d%e4%bd%9c></a></h3><h4 id=查看数据库中的所有集合>查看数据库中的所有集合<a class=anchorjs-link href=#%e6%9f%a5%e7%9c%8b%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%ad%e7%9a%84%e6%89%80%e6%9c%89%e9%9b%86%e5%90%88></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>show collections
</span></span></code></pre></div><h4 id=删除集合>删除集合<a class=anchorjs-link href=#%e5%88%a0%e9%99%a4%e9%9b%86%e5%90%88></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.drop<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.drop<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><h3 id=文档操作-crud>文档操作 CRUD<a class=anchorjs-link href=#%e6%96%87%e6%a1%a3%e6%93%8d%e4%bd%9c-crud></a></h3><h4 id=创建-create>创建 Create<a class=anchorjs-link href=#%e5%88%9b%e5%bb%ba-create></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.insert() 		<span style=color:#9ca0b0;font-style:italic>// 将一个或多个文档插入到集合中。 此方法在 中 mongosh 已弃用。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.insertOne() <span style=color:#9ca0b0;font-style:italic>// 将单个文档插入到集合中。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.insertMany()<span style=color:#9ca0b0;font-style:italic>// 将多个文档插入到集合中。
</span></span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>db.user.insert<span style=color:#04a5e5;font-weight:700>({</span>username: <span style=color:#40a02b>&#34;jacky&#34;</span>, age:18<span style=color:#04a5e5;font-weight:700>})</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>db.user.insert<span style=color:#04a5e5;font-weight:700>([</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>	<span style=color:#04a5e5;font-weight:700>{</span>username: <span style=color:#40a02b>&#34;tom&#34;</span>, age: 21<span style=color:#04a5e5;font-weight:700>}</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#04a5e5;font-weight:700>{</span>username: <span style=color:#40a02b>&#34;tim&#34;</span>, age: 20<span style=color:#04a5e5;font-weight:700>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#04a5e5;font-weight:700>])</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>db.user.insertOne<span style=color:#04a5e5;font-weight:700>({</span>username: <span style=color:#40a02b>&#34;tome&#34;</span>, age: 20<span style=color:#04a5e5;font-weight:700>})</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>db.user.insertMany<span style=color:#04a5e5;font-weight:700>([</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#04a5e5;font-weight:700>{</span>username: <span style=color:#40a02b>&#34;lucy&#34;</span>, age: 19<span style=color:#04a5e5;font-weight:700>}</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#04a5e5;font-weight:700>{</span>username: <span style=color:#40a02b>&#34;lily&#34;</span>, age: 18<span style=color:#04a5e5;font-weight:700>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#04a5e5;font-weight:700>])</span>
</span></span></code></pre></div><h4 id=查询-read>查询 Read<a class=anchorjs-link href=#%e6%9f%a5%e8%af%a2-read></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find() <span style=color:#9ca0b0;font-style:italic>// 检索集合中的所有文档
</span></span></span></code></pre></div><p>查询返回的是一个游标对象，它类似于迭代器，可以在查询结果中进行迭代。</p><p><figure><a class=paragraph-image><img data-src=http://mdrs.yuanjin.tech/img/image-20200601154340434.png data-action=zoom alt=image-20200601154340434 class=lazyload></a></figure></p><p><code>cursor</code>的成员：</p><ul><li><code>next()</code>：游标向后移动，并返回下一个结果，如果没有结果则报错</li><li><code>hasNext()</code>：判断游标是否还能向后移动，返回<code>boolean</code></li><li><code>skip(n)</code>：去前面的<code>n</code>条数据，<strong>返回<code>cursor</code></strong></li><li><code>limit(n)</code>：取当前结果的<code>n</code>条数据，<strong>返回<code>cursor</code></strong></li><li><code>sort(sortObj)</code>：按照指定的条件排序，<strong>返回<code>cursor</code></strong></li><li><code>count()</code>：得到符合<code>filter</code>的结果数量，返回<code>Number</code></li><li><code>size()</code>：得到最终结果的数量，返回<code>Number</code></li></ul><p>由于某些函数会继续返回<code>cursor</code>，因此可以对其进行链式编程，返回<code>cursor</code>的函数成为了链中的一环，无论它们的调用顺序如何，始终按照下面的顺序执行：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>sort <span style=color:#04a5e5;font-weight:700>-&gt;</span> skip <span style=color:#04a5e5;font-weight:700>-&gt;</span> limit
</span></span></code></pre></div><h5 id=使用查询条件>使用查询条件<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e6%9f%a5%e8%af%a2%e6%9d%a1%e4%bb%b6></a></h5><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>({</span>条件<span style=color:#04a5e5;font-weight:700>})</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>}) <span style=color:#9ca0b0;font-style:italic>// 查询用户名为tom的用户
</span></span></span></code></pre></div><h5 id=使用比较运算符查询>使用比较运算符查询<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e6%af%94%e8%be%83%e8%bf%90%e7%ae%97%e7%ac%a6%e6%9f%a5%e8%af%a2></a></h5><p>注意：查询符<code>$lt</code>与后面的查询条件中间不要空格。在某些场景下会失效。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>16</span>}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄大于16的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$lte<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄小于等于18的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$ne<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄不等于18的用户
</span></span></span></code></pre></div><ul><li><code>$gt</code>：大于<code>></code></li><li><code>$gte</code>：大于等于 <code>>=</code></li><li><code>$lt</code>：小于<code>&lt;</code></li><li><code>lte</code>：小于等于<code>&lt;=</code></li><li><code>ne</code>：不等于<code>!==</code></li></ul><h5 id=使用逻辑运算符查询>使用逻辑运算符查询<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e9%80%bb%e8%be%91%e8%bf%90%e7%ae%97%e7%ac%a6%e6%9f%a5%e8%af%a2></a></h5><p><strong>And</strong></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$gte<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>16</span>, $lte<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>19</span>}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄大于等于16并且小于等于19的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>, age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>22</span>}) <span style=color:#9ca0b0;font-style:italic>// 查询用户名为tom并且年龄为22的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({$and<span style=color:#04a5e5;font-weight:700>:</span> [{age<span style=color:#04a5e5;font-weight:700>:</span>{$gte<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>16</span>}},{age<span style=color:#04a5e5;font-weight:700>:</span>{lte<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>19</span>}}]}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄大于等于16并且小于等于19的用户
</span></span></span></code></pre></div><p><strong>Or</strong></p><p>可以使用<code>$in</code>或<code>$or</code></p><p>在相同字段的查询中推荐使用<code>$in</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$in<span style=color:#04a5e5;font-weight:700>:</span>[<span style=color:#fe640b>20</span>, <span style=color:#fe640b>21</span>]}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄为20或者21的
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({$or<span style=color:#04a5e5;font-weight:700>:</span>[{age<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>16</span>},{username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#40a02b>&#34;tom&#34;</span>}]}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄为16，用户名为tom的用户
</span></span></span></code></pre></div><p><strong>Not</strong></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$nin<span style=color:#04a5e5;font-weight:700>:</span>[<span style=color:#fe640b>20</span>, <span style=color:#fe640b>21</span>]}}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄不为20或者21的用户
</span></span></span></code></pre></div><p><strong>组合</strong></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  $or<span style=color:#04a5e5;font-weight:700>:</span> [{username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#40a02b>&#34;jacky&#34;</span>},{username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#179299>/t/</span>}]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>}) <span style=color:#9ca0b0;font-style:italic>// 查询年龄大于18,并且用户名为jacky或者含有t字母的用户
</span></span></span></code></pre></div><h5 id=使用正则表达式查询>使用正则表达式查询<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f%e6%9f%a5%e8%af%a2></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#179299>/i/</span>}) <span style=color:#9ca0b0;font-style:italic>// 查询用户名中含有i的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#179299>/^t/</span>}) <span style=color:#9ca0b0;font-style:italic>// 查询用户名中使用t开头的用户
</span></span></span></code></pre></div><h5 id=使用函数查询>使用函数查询<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e5%87%bd%e6%95%b0%e6%9f%a5%e8%af%a2></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({$where<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#d20f39>function</span>(){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>	<span style=color:#8839ef>return</span> <span style=color:#8839ef>this</span>.username <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#34;tom&#34;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> <span style=color:#8839ef>this</span>.age <span style=color:#04a5e5;font-weight:700>&gt;=</span> <span style=color:#fe640b>18</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>}}) <span style=color:#9ca0b0;font-style:italic>// 查询用户名不为tom，并且年龄大于等于18的用户
</span></span></span></code></pre></div><h5 id=特殊的查询说明>特殊的查询说明<a class=anchorjs-link href=#%e7%89%b9%e6%ae%8a%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%b4%e6%98%8e></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>//数据结构：
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  <span style=color:#40a02b>&#34;_id&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983476&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#40a02b>&#34;hobby&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> [ 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>      <span style=color:#40a02b>&#34;其他&#34;</span>, 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>      <span style=color:#40a02b>&#34;体育&#34;</span>, 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      <span style=color:#40a02b>&#34;阅读&#34;</span>, 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>      <span style=color:#40a02b>&#34;电影&#34;</span>, 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      <span style=color:#40a02b>&#34;音乐&#34;</span>, 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>      <span style=color:#40a02b>&#34;编程&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#40a02b>&#34;account&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;user2&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#40a02b>&#34;password&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;4297f44b13955235245b2497399d7a93&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#40a02b>&#34;name&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;赖磊&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  <span style=color:#40a02b>&#34;address&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      <span style=color:#40a02b>&#34;_id&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983477&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      <span style=color:#40a02b>&#34;province&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;广西壮族自治区&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      <span style=color:#40a02b>&#34;city&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;重庆市&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#40a02b>&#34;__v&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>0</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  <span style=color:#40a02b>&#34;age&#34;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>39</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#9ca0b0;font-style:italic>// 数组的查询
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#9ca0b0;font-style:italic>// 完全匹配爱好的内容
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  hobby<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#34;音乐&#34;</span>, <span style=color:#40a02b>&#34;绘画&#34;</span>, <span style=color:#40a02b>&#34;编程&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span><span style=color:#9ca0b0;font-style:italic>// 爱好只需要包含音乐的
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>  hobby<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;音乐&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span><span style=color:#9ca0b0;font-style:italic>// 爱好包含音乐或体育
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>  hobby<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>    $in<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#34;音乐&#34;</span>, <span style=color:#40a02b>&#34;体育&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span><span style=color:#9ca0b0;font-style:italic>// 爱好包含音乐和体育
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>  $and<span style=color:#04a5e5;font-weight:700>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>    {hobby<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;音乐&#34;</span>},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>    {hobby<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;体育&#34;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>  ]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span><span style=color:#9ca0b0;font-style:italic>// 爱好第一条内容是音乐，类似数组索引的方式查询
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>  <span style=color:#40a02b>&#34;hobby.0&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;体育&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span><span style=color:#9ca0b0;font-style:italic>// 查询address对象中city为重庆市
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>  <span style=color:#40a02b>&#34;address.city&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;重庆市&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span><span style=color:#9ca0b0;font-style:italic>// 按Id来查询，需要使用ObjectId方法包裹id数据
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.find({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>  <span style=color:#40a02b>&#34;_id&#34;</span><span style=color:#04a5e5;font-weight:700>:</span>ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983476&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>})
</span></span></code></pre></div><h5 id=投影>投影<a class=anchorjs-link href=#%e6%8a%95%e5%bd%b1></a></h5><p>过滤掉不想要的字段，只保留想要展示的字段。</p><p>默认情况下，<code>user</code>集合中查询会显示<code>_id</code>、<code>username</code>、<code>age</code>三个字段。可以在<code>find({查询条件},{投影})</code>第二个对象设置投影内容。</p><ul><li>设置投影，默认都会显示<code>_id</code>，除非明确设置<code>_id:0</code>。</li><li>不能同时设置<code>username:1</code>和<code>age: 0</code>会报错。不能同时设置只包含或排除的。</li></ul><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find({age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>}},{username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, _id<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>0</span>}) <span style=color:#9ca0b0;font-style:italic>// 只显示username，不显示_id和age
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.findOne({age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>}},{username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, _id<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>0</span>}) <span style=color:#9ca0b0;font-style:italic>// 只显示满足条件的一条数据
</span></span></span></code></pre></div><h5 id=统计数量>统计数量<a class=anchorjs-link href=#%e7%bb%9f%e8%ae%a1%e6%95%b0%e9%87%8f></a></h5><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>()</span>.count<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find().count() <span style=color:#9ca0b0;font-style:italic>// 查询用户集合中文档的数量
</span></span></span></code></pre></div><h5 id=数量限制和偏移量>数量限制和偏移量<a class=anchorjs-link href=#%e6%95%b0%e9%87%8f%e9%99%90%e5%88%b6%e5%92%8c%e5%81%8f%e7%a7%bb%e9%87%8f></a></h5><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>()</span>.skip<span style=color:#04a5e5;font-weight:700>(</span>Number<span style=color:#04a5e5;font-weight:700>)</span>.limit<span style=color:#04a5e5;font-weight:700>(</span>Number<span style=color:#04a5e5;font-weight:700>)</span>
</span></span></code></pre></div><ul><li><code>skip</code>：偏移量</li><li><code>limit</code>：查询数量</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find().skip(<span style=color:#fe640b>2</span>).limit(<span style=color:#fe640b>2</span>) <span style=color:#9ca0b0;font-style:italic>// 查询user集合中从第3条开始，共查询2条
</span></span></span></code></pre></div><h5 id=排序>排序<a class=anchorjs-link href=#%e6%8e%92%e5%ba%8f></a></h5><p>语法</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>()</span>.sort<span style=color:#04a5e5;font-weight:700>({</span>field: 排序值<span style=color:#04a5e5;font-weight:700>})</span>
</span></span></code></pre></div><ul><li>field：需要排序的字段</li><li>排序值：1为正序，-1为倒序</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.find().sort({age<span style=color:#04a5e5;font-weight:700>:-</span><span style=color:#fe640b>1</span>}) <span style=color:#9ca0b0;font-style:italic>// 按age倒序显示
</span></span></span></code></pre></div><h4 id=更新-update>更新 Update<a class=anchorjs-link href=#%e6%9b%b4%e6%96%b0-update></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// 更新集合中的一个或多个现有文档。此方法在 中 mongosh 已弃用。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.update(filter, update, [options]) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic>// 根据查询条件，更新结果中的第一篇文档，更新的内容由update参数决定，options决定更新的一些细节
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#9ca0b0;font-style:italic></span>db.<span style=color:#04a5e5;font-weight:700>&lt;</span>collection<span style=color:#04a5e5;font-weight:700>&gt;</span>.updateOne(filter, update, [options])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span><span style=color:#9ca0b0;font-style:italic>// 根据查询条件，更新所有结果，更新的内容由update参数决定，options决定更新的一些细节
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span><span style=color:#9ca0b0;font-style:italic></span>db.<span style=color:#04a5e5;font-weight:700>&lt;</span>collection<span style=color:#04a5e5;font-weight:700>&gt;</span>.updateMany(filter, update, [options]); 
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// 更新用户名为jacky的用户年龄为22岁，默认只影响一条
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.updateOne({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;jacky&#34;</span>}, {$set<span style=color:#04a5e5;font-weight:700>:</span> {age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>22</span>}}) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic>// 更新多个用户名为tom的用户年龄为18岁，影响多条
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.updateMany({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>}, {$set<span style=color:#04a5e5;font-weight:700>:</span> {age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>18</span>}}) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span> <span style=color:#9ca0b0;font-style:italic>// 更新多个用户名为tom的用户年龄为18岁，影响多条，等同于上面updateMany
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.update({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>}, {$set<span style=color:#04a5e5;font-weight:700>:</span> {age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>20</span>}}, {multi<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>})
</span></span></code></pre></div><p>注意：如果将更新写成<code>db.user.updateOne({username: "jacky"}, {age: 22})</code>，则会更新该文档，所有数据，当只有<code>age：22</code>时，则会移除<code>username</code></p><h5 id=字段更新运算符>字段更新运算符<a class=anchorjs-link href=#%e5%ad%97%e6%ae%b5%e6%9b%b4%e6%96%b0%e8%bf%90%e7%ae%97%e7%ac%a6></a></h5><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><code>$currentDate</code></td><td>将字段的值设置为当前日期，即日期或时间戳。</td></tr><tr><td><code>$inc</code></td><td>将字段的值增加指定的数量。</td></tr><tr><td><code>$min</code></td><td>仅当指定值小于现有字段值时才更新该字段。</td></tr><tr><td><code>$max</code></td><td>仅当指定值大于现有字段值时才更新该字段。</td></tr><tr><td><code>$mul</code></td><td>酱紫的值乘以指定的数值。</td></tr><tr><td><code>$rename</code></td><td>重命名该字段。</td></tr><tr><td><code>$set</code></td><td>设置文档中的字段值。</td></tr><tr><td><code>$setOnInsert</code></td><td>如果更新导致插入文档，则设置字段的值。对修改现有文档的更新操作没有影响。</td></tr><tr><td><code>$unset</code></td><td>冲文档中删除指定的字段。</td></tr></tbody></table><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// 常规直接修改内容
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  $set<span style=color:#04a5e5;font-weight:700>:</span> { name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>, <span style=color:#40a02b>&#34;address.city&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;北京&#34;</span>}    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic>// 修改name为jacky， 并且修改年龄+2， 减则为 -2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  $set<span style=color:#04a5e5;font-weight:700>:</span> { name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;jacky&#34;</span>},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  $inc<span style=color:#04a5e5;font-weight:700>:</span> { age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>2</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// 修改name为jeams，并修改年龄 x2，除则 x 0.5
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  $set<span style=color:#04a5e5;font-weight:700>:</span> { name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;jacky&#34;</span>},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  $mul<span style=color:#04a5e5;font-weight:700>:</span> { age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>2</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic>// 将name的字段名称修改为username
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  $rename<span style=color:#04a5e5;font-weight:700>:</span> { name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;username&#34;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic>// 删除文档中的age字段、address.province字段
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  $unset<span style=color:#04a5e5;font-weight:700>:</span> { age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;&#34;</span>, <span style=color:#40a02b>&#34;address.province&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;&#34;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>});
</span></span></code></pre></div><h5 id=数组更新运算符>数组更新运算符<a class=anchorjs-link href=#%e6%95%b0%e7%bb%84%e6%9b%b4%e6%96%b0%e8%bf%90%e7%ae%97%e7%ac%a6></a></h5><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><code>$</code></td><td>充当占位符，以更新与查询条件匹配的第一个元素。</td></tr><tr><td><code>$[]</code></td><td>充当占位符，以更新匹配查询条件的文档的数组中的所有元素。</td></tr><tr><td><code>$[&lt;identifier>]</code></td><td>充当占位符，以更新arrayFilters与查询条件匹配的文档中所有与条件匹配的元素。</td></tr><tr><td><code>$addToSet</code></td><td>仅当元素不存在于集合中时才将它们添加到数组中。</td></tr><tr><td><code>$pop</code></td><td>删除数组的第一项或最后一项。</td></tr><tr><td><code>$pull</code></td><td>删除与指定查询匹配的所有数组元素。</td></tr><tr><td><code>$push</code></td><td>将项目添加到数组。</td></tr><tr><td><code>$pullAll</code></td><td>从数组中删除所有匹配的值。</td></tr></tbody></table><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// 向hobby 中添加一项： 阅读
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic>// 若数组中不存在则进行添加 若存在则不进行任何操作
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  $addToSet<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    hobby<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;阅读&#34;</span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic>// 向hobby中添加一项：电影
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic>// 无论数组中是否存在，都会添加
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  $push<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    hobby<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;电影&#34;</span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#9ca0b0;font-style:italic>// 向hobby中添加多项： 阅读、电影
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  $push<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    hobby<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      $each<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#34;阅读&#34;</span>, <span style=color:#40a02b>&#34;电影&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    }    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#9ca0b0;font-style:italic>// 删除 hobby中满足条件的内容：阅读或电影
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  $pull<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    hobby<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>      $in<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#34;阅读&#34;</span>, <span style=color:#40a02b>&#34;电影&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>    }    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span><span style=color:#9ca0b0;font-style:italic>// 将hobby中的体育修改为sport
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span><span style=color:#9ca0b0;font-style:italic>// 该操作需配合查询条件使用
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983478&#34;</span>), loves<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;体育&#34;</span>},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  $set<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>    <span style=color:#40a02b>&#34;hobby.$&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;sport&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>});
</span></span></code></pre></div><h5 id=其他配置>其他配置<a class=anchorjs-link href=#%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae></a></h5><p>更新方法中的第三个参数配置</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// upsert 默认为false， 如果没有找到匹配项，则进行添加
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.users.updateOne({_id<span style=color:#04a5e5;font-weight:700>:</span> ObjectId(<span style=color:#40a02b>&#34;5ed093872e3da2b654983474&#34;</span>)},{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  $set<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>    name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tom&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>    age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>21</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>}, {upsert<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>});
</span></span></code></pre></div><h4 id=删除-delete>删除 Delete<a class=anchorjs-link href=#%e5%88%a0%e9%99%a4-delete></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.remove() <span style=color:#9ca0b0;font-style:italic>// 从集合中删除文档。 此方法在 中 mongosh 已弃用。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.deleteOne() <span style=color:#9ca0b0;font-style:italic>// 从集合中删除单个文档
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.deleteMany() <span style=color:#9ca0b0;font-style:italic>//从集合中删除与 匹配 filter 的所有文档
</span></span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.remove({age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>20</span>}}) <span style=color:#9ca0b0;font-style:italic>// 删除年龄大于20岁的用户，影响多条
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.remove({age<span style=color:#04a5e5;font-weight:700>:</span> {$gt<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>20</span>}}, {justOne<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>}) <span style=color:#9ca0b0;font-style:italic>// 删除年龄大于20的用户，只影响一条，同deleteOne效果
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.deleteOne({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;tim&#34;</span>}) <span style=color:#9ca0b0;font-style:italic>// 删除一条用户名为tim的用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.deleteMany({age<span style=color:#04a5e5;font-weight:700>:</span> {$lt<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>18</span>}}) <span style=color:#9ca0b0;font-style:italic>// 删除年龄小于18的用户，影响多条
</span></span></span></code></pre></div><h3 id=索引>索引<a class=anchorjs-link href=#%e7%b4%a2%e5%bc%95></a></h3><p>索引是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得更快。<code>MongoDB</code> 的索引几乎与传统的关系型数据库一模一样，这其中也包括一些基本的查询优化技巧。</p><h4 id=索引优点>索引优点<a class=anchorjs-link href=#%e7%b4%a2%e5%bc%95%e4%bc%98%e7%82%b9></a></h4><ul><li>提高数据查询的效率，降低数据库的IO成本。</li><li>通过索引对数据进行排序，降低数据排序的成本，降低CPU的消耗。</li></ul><p>缺点：</p><ul><li>占用磁盘空间</li><li>大量索引影响SQL语句效率，因为每次插入和修改数据都需要更新索引</li></ul><h4 id=创建单字段索引>创建单字段索引<a class=anchorjs-link href=#%e5%88%9b%e5%bb%ba%e5%8d%95%e5%ad%97%e6%ae%b5%e7%b4%a2%e5%bc%95></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.createIndex<span style=color:#04a5e5;font-weight:700>(</span>待创建索引的列<span style=color:#04a5e5;font-weight:700>[</span>,额外选项<span style=color:#04a5e5;font-weight:700>])</span>
</span></span></code></pre></div><ul><li><p>待创建索引的列：{键:1,…,键:-1}</p><ul><li>说明：1升序 -1降序 例如：<code>{age:1}</code>表示创建<code>age</code>索引并按照升序的方式存储</li></ul></li><li><p>额外选项：设置索引的名称或者唯一索引等</p></li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.createIndex({<span style=color:#40a02b>&#34;username&#34;</span><span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>}) <span style=color:#9ca0b0;font-style:italic>// 设置username为索引，正序
</span></span></span></code></pre></div><h4 id=查询索引>查询索引<a class=anchorjs-link href=#%e6%9f%a5%e8%af%a2%e7%b4%a2%e5%bc%95></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.getIndexes<span style=color:#04a5e5;font-weight:700>()</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.getIndexes()
</span></span></code></pre></div><h5 id=查询集合执行时间>查询集合执行时间<a class=anchorjs-link href=#%e6%9f%a5%e8%af%a2%e9%9b%86%e5%90%88%e6%89%a7%e8%a1%8c%e6%97%b6%e9%97%b4></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.find<span style=color:#04a5e5;font-weight:700>()</span>.explain<span style=color:#04a5e5;font-weight:700>(</span><span style=color:#40a02b>&#34;executionStats&#34;</span><span style=color:#04a5e5;font-weight:700>)</span>
</span></span></code></pre></div><p>在返回的<code>executionStats { executionTimeMillis: 0}</code>，中为查询执行时间。</p><h4 id=删除索引>删除索引<a class=anchorjs-link href=#%e5%88%a0%e9%99%a4%e7%b4%a2%e5%bc%95></a></h4><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.dropIndexes() <span style=color:#9ca0b0;font-style:italic>// 删除全部索引
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.collection.dropIndex(索引名) <span style=color:#9ca0b0;font-style:italic>// 删除指定索引
</span></span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.dropIndex({username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>}) <span style=color:#9ca0b0;font-style:italic>// 删除user集合中username的索引
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>db.user.dropIndexes() <span style=color:#9ca0b0;font-style:italic>// 删除user集合中的所有索引
</span></span></span></code></pre></div><h4 id=创建复合索引>创建复合索引<a class=anchorjs-link href=#%e5%88%9b%e5%bb%ba%e5%a4%8d%e5%90%88%e7%b4%a2%e5%bc%95></a></h4><p><code>MongoDB</code>支持复合索引，其中单个索引结构持有对集合文档中多个字段的引用。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.createIndex( { <span style=color:#04a5e5;font-weight:700>&lt;</span>field1<span style=color:#04a5e5;font-weight:700>&gt;:</span> <span style=color:#04a5e5;font-weight:700>&lt;</span>type<span style=color:#04a5e5;font-weight:700>&gt;</span>, <span style=color:#04a5e5;font-weight:700>&lt;</span>field2<span style=color:#04a5e5;font-weight:700>&gt;:</span> <span style=color:#04a5e5;font-weight:700>&lt;</span>type2<span style=color:#04a5e5;font-weight:700>&gt;</span>, ... } )
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.createIndex({username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>1</span>, age<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>})
</span></span></code></pre></div><blockquote><p>该索引被创建后，基于 <code>username</code> 和 <code>age</code> 的查询将会用到该索引，或者是基于 <code>username</code>的查询也会用到该索引，但是只是基于 <code>age</code> 的查询将不会用到该复合索引。因此可以说，如果想用到复合索引，<mark>必须在查询条件中包含复合索引中的前 N 个索引列</mark>。</p></blockquote><h5 id=刪除复合索引>刪除复合索引<a class=anchorjs-link href=#%e5%88%aa%e9%99%a4%e5%a4%8d%e5%90%88%e7%b4%a2%e5%bc%95></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.dropIndex({username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, age<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>})
</span></span></code></pre></div><h4 id=创建唯一索引>创建唯一索引<a class=anchorjs-link href=#%e5%88%9b%e5%bb%ba%e5%94%af%e4%b8%80%e7%b4%a2%e5%bc%95></a></h4><p>索引的<code>unique</code>属性使<code>MongoDB</code>拒绝索引字段的重复值。除了唯一性约束，唯一索引和<code>MongoDB</code>其他索引功能上是一致的。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.collection.createdIndex({<span style=color:#04a5e5;font-weight:700>&lt;</span>field1<span style=color:#04a5e5;font-weight:700>&gt;:</span> <span style=color:#04a5e5;font-weight:700>&lt;</span>type<span style=color:#04a5e5;font-weight:700>&gt;</span>}, {unique<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>})
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.user.createIndex({username<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>},{unique<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>})
</span></span></code></pre></div><h3 id=聚合管道>聚合管道<a class=anchorjs-link href=#%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93></a></h3><p>聚合操作处理数据记录和 <code>return</code> 计算结果。聚合操作将来自多个文档的值组合在一起，并且可以对分组数据执行各种操作以返回单个结果。</p><p>聚合管道是用于数据聚合的框架，其模型基于数据处理管道的概念。文档进入多阶段管道，将文档转换为聚合结果。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.orders.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>    { $match<span style=color:#04a5e5;font-weight:700>:</span> { status<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;A&#34;</span> } },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>    { $group<span style=color:#04a5e5;font-weight:700>:</span> { _id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;$cust_id&#34;</span>, total<span style=color:#04a5e5;font-weight:700>:</span> { $sum<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;$amount&#34;</span> } } }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>])
</span></span></code></pre></div><p>第一阶段：<code>$match</code>阶段按<code>status</code>字段过滤文档，并将<code>status</code>等于<code>A</code>的文档传递到下一阶段。
第二阶段：<code>$group</code>阶段按<code>cust_id</code>字段将文档分组，以计算每个<code>cust_id</code>唯一值的金额总和。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.COLLECTION_NAME.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  {<span style=color:#04a5e5;font-weight:700>&lt;</span>stage<span style=color:#04a5e5;font-weight:700>&gt;</span>},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>]) 
</span></span></code></pre></div><h4 id=常用管道操作符>常用管道操作符<a class=anchorjs-link href=#%e5%b8%b8%e7%94%a8%e7%ae%a1%e9%81%93%e6%93%8d%e4%bd%9c%e7%ac%a6></a></h4><table><thead><tr><th>管道操作符</th><th>说明</th><th>与关系型数据库查询语句对比</th></tr></thead><tbody><tr><td><code>$project</code></td><td>过滤字段，增加、删除、重命名字段</td><td><code>select</code></td></tr><tr><td><code>$match</code></td><td>匹配条件，只有满足条件的文档才能进入下一阶段</td><td><code>where</code></td></tr><tr><td><code>$group</code></td><td>条件组合结果</td><td><code>group by</code></td></tr><tr><td><code>$limit</code></td><td>限制结果文档数量</td><td><code>limit</code></td></tr><tr><td><code>$skip</code></td><td>跳过文档的数量</td><td><code>offset</code></td></tr><tr><td><code>$sort</code></td><td>对结果进行排序</td><td><code>order by</code></td></tr><tr><td><code>$lookup</code></td><td>引用其他集合的数据（关联查询）</td><td><code>join</code></td></tr></tbody></table><h4 id=管道符表达式>管道符表达式<a class=anchorjs-link href=#%e7%ae%a1%e9%81%93%e7%ac%a6%e8%a1%a8%e8%be%be%e5%bc%8f></a></h4><p><code>管道操作符</code>作为<strong>键</strong>，所对应的<strong>值</strong>叫做<code>管道表达式</code>。每个管道表达式是一个文档结构，它是由字段名、字段值、和一些表达式操作符组成的。</p><p>例如：<code>{$match:{status:"A"}}</code>，<code>$match</code> 称为管道操作符，而 <code>status:"A"</code>称为管道表达式。</p><table><thead><tr><th>管道符表达式</th><th>说明</th></tr></thead><tbody><tr><td><code>$addToSet</code></td><td>将文档指定字段的值去重</td></tr><tr><td><code>$max</code></td><td>文档指定字段的最大值</td></tr><tr><td><code>$min</code></td><td>文档指定字段的最小值</td></tr><tr><td><code>$sum</code></td><td>文档指定字段求和</td></tr><tr><td><code>$avg</code></td><td>文档指定字段求平均</td></tr><tr><td><code>$gt</code></td><td>大于给定值</td></tr><tr><td><code>$lt</code></td><td>小于给定值</td></tr><tr><td><code>$eq</code></td><td>等于给定值</td></tr></tbody></table><h4 id=match>$match<a class=anchorjs-link href=#match></a></h4><p>用于过滤文档，用法类似于<code>find()</code>方法中的参数。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.order.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>		$project<span style=color:#04a5e5;font-weight:700>:</span> {trade_no<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>1</span>, total_price<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>		$match<span style=color:#04a5e5;font-weight:700>:</span> { total_price<span style=color:#04a5e5;font-weight:700>:</span> {$gte<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>90</span>}}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>])
</span></span></code></pre></div><p>查询<code>order</code>集合中，<code>total_price</code>字段数据大于等于90的订单数据， 显示<code>_id</code>、<code>trade_no</code>、<code>total_price</code>字段。</p><h4 id=group>$group<a class=anchorjs-link href=#group></a></h4><p>将集合中的文档进行分组。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>db.order_item.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>		$group<span style=color:#04a5e5;font-weight:700>:</span> {_id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;$order_id&#34;</span>, total<span style=color:#04a5e5;font-weight:700>:</span> {$sum<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;$num&#34;</span>}}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>])
</span></span></code></pre></div><p>按<code>order_id</code>进行分组进行分组查询<code>order_item</code>集合中，对应的<code>num</code>数量之和</p><h4 id=sort>$sort<a class=anchorjs-link href=#sort></a></h4><p>将集合中的文档进行排序</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>db.order.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>	{ 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>		$project<span style=color:#04a5e5;font-weight:700>:</span> {trade_no<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, total_price<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	{ 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>		$match<span style=color:#04a5e5;font-weight:700>:</span> {total_price<span style=color:#04a5e5;font-weight:700>:</span> {$gte<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>90</span>}}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	{ 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		$sort<span style=color:#04a5e5;font-weight:700>:</span> {total_price<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>])
</span></span></code></pre></div><p>查询<code>order</code>集合中，<code>total_price</code>字段数据大于等于90的订单数据， 显示<code>_id</code>、<code>trade_no</code>、<code>total_price</code>字段，并将结果按total_price的倒序排序。</p><h4 id=lookup>$lookup<a class=anchorjs-link href=#lookup></a></h4><p>关联集合</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>db.order.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>		$lookup<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>			from<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_item&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>			localField<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_id&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>			foreignField<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_id&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>			as<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;items&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>]) 
</span></span></code></pre></div><p>查询<code>order</code>集合，通过order集合中的<code>order_id</code>与<code>order_item</code>集合中的<code>order_id</code>字段进行关联，并将<code>order_item</code>集合查询到的结果，放到<code>order</code>集合查询结果的<code>items</code>字段中。</p><p><code>from</code>：关联集合</p><p><code>localField</code>：当前集合中关联字段</p><p><code>foreignField</code>：关联集合中关联字段</p><p><code>as</code>：关联集合中查询结果，在当前集合结果中显示的字段名称。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>db.order.aggregate([
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>		$lookup<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>			from<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_item&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>			localField<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_id&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>			foreignField<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;order_id&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>			as<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;items&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		$project<span style=color:#04a5e5;font-weight:700>:</span> {trad_no<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, total_price<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>, items<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#fe640b>1</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>		$match<span style=color:#04a5e5;font-weight:700>:</span> { total_price<span style=color:#04a5e5;font-weight:700>:</span> {$gte<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>90</span>}}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>		$sort<span style=color:#04a5e5;font-weight:700>:</span> {total_price<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		$limit<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>		$skip<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>])
</span></span></code></pre></div><h3 id=备份与恢复>备份与恢复<a class=anchorjs-link href=#%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d></a></h3><p>在项目目录下，启用终端输入如下命令</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic># 备份</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>mongodump -d &lt;dbname&gt; -o &lt;backupDir&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic># 恢复</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>mongorestore -d &lt;dbname&gt; &lt;backupDir&gt;
</span></span></code></pre></div><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/node-log/ data-toggle=tooltip data-placement=top title="Node 13 日志记录">Previous<br><span>Node 13 日志记录</span></a></li><li class=next><a href=/posts/node-mongoose/ data-toggle=tooltip data-placement=top title="Node 15 Mongoose">Next<br><span>Node 15 Mongoose</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>api</a>
<a href=/tags/auth0/>auth0</a>
<a href=/tags/chakraui/>chakraui</a>
<a href=/tags/css/>css</a>
<a href=/tags/egg/>egg</a>
<a href=/tags/electron/>electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>elementui</a>
<a href=/tags/elint/>elint</a>
<a href=/tags/eslint/>eslint</a>
<a href=/tags/express/>express</a>
<a href=/tags/firebase/>firebase</a>
<a href=/tags/formik/>formik</a>
<a href=/tags/git/>git</a>
<a href=/tags/graphql/>graphQL</a>
<a href=/tags/hexo/>hexo</a>
<a href=/tags/icon/>icon</a>
<a href=/tags/javascript/>javascript</a>
<a href=/tags/koa/>koa</a>
<a href=/tags/mongoddb/>mongoddb</a>
<a href=/tags/nextjs/>nextjs</a>
<a href=/tags/node/>node</a>
<a href=/tags/pinia/>pinia</a>
<a href=/tags/prettier/>prettier</a>
<a href=/tags/prisma/>prisma</a>
<a href=/tags/react/>react</a>
<a href=/tags/react-query/>react-query</a>
<a href=/tags/react-router/>react-router</a>
<a href=/tags/redux-toolkit/>redux-toolkit</a>
<a href=/tags/sequelize/>sequelize</a>
<a href=/tags/strapi/>strapi</a>
<a href=/tags/styled-components/>styled-components</a>
<a href=/tags/typescript/>typescript</a>
<a href=/tags/valtio/>valtio</a>
<a href=/tags/vite/>vite</a>
<a href=/tags/vscode/>vscode</a>
<a href=/tags/vue/>vue</a>
<a href=/tags/vuex/>vuex</a>
<a href=/tags/zustand/>zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2023<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin=anonymous></script>
<script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script>
<script src=/js/simple-jekyll-search.min.js></script>
<script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script>
<script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script>
<script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>