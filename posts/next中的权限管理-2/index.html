<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Next中的权限管理(二) | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="上一篇讲了使用比较传统的session进行权限管理的iron-session，这篇我们来说下通常情况下会用到比较多的第三方的权限管理工具Clerk，之前也有类似的比如：Auth0等，可以看下我之前的文章。"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Next中的权限管理(二)"><meta name=twitter:description content="上一篇讲了使用比较传统的session进行权限管理的iron-session，这篇我们来说下通常情况下会用到比较多的第三方的权限管理工具Clerk，之前也有类似的比如：Auth0等，可以看下我之前的文章。"><meta property="og:url" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-2/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="Next中的权限管理(二)"><meta property="og:description" content="上一篇讲了使用比较传统的session进行权限管理的iron-session，这篇我们来说下通常情况下会用到比较多的第三方的权限管理工具Clerk，之前也有类似的比如：Auth0等，可以看下我之前的文章。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-08T10:17:29+08:00"><meta property="article:modified_time" content="2024-08-08T10:17:29+08:00"><meta property="article:tag" content="React"><meta property="article:tag" content="Nextjs"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-6/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-5/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-4/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-3/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-1/"><meta property="og:see_also" content="http://localhost/posts/nextjs%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%B8%89/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Next中的权限管理(二)</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2024-08-08</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=React>React</a>
<a href=/tags/nextjs/ title=Nextjs>Nextjs</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>上一篇讲了使用比较传统的<code>session</code>进行权限管理的<code>iron-session</code>，这篇我们来说下通常情况下会用到比较多的第三方的权限管理工具<code>Clerk</code>，之前也有类似的比如：<code>Auth0</code>等，可以看下我之前的文章。</p><p>很多在<code>Youtube</code>上的大佬，写项目都用了<code>Clerk</code>，可能有些是给了推广，但<code>Clerk</code>之所以流行起来，我认为是以下几个方面：</p><ul><li>仅需几步就可以搭建出比较复杂的登录、注册、路由管理等权限系统。</li><li>需要使用的代码较少，粘贴个<code>sign-up</code>和<code>sign-in</code>，粘贴下对应的<code>token</code>基本上就能开始使用。</li><li>详尽的文档，几乎所有步骤都有代码示例和文本说明，上手会比较快。</li></ul><p>下面我们还是通过Task这个项目来看下<code>Clerk</code>如何使用。</p><h3 id=项目二clerkprisma实现task项目的权限管理>项目二：clerk+prisma实现Task项目的权限管理<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e4%ba%8cclerkprisma%e5%ae%9e%e7%8e%b0task%e9%a1%b9%e7%9b%ae%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86></a></h3><h4 id=项目初始化>项目初始化<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%88%9d%e5%a7%8b%e5%8c%96></a></h4><p>就把之前的<code>iron-session</code>的内容替换成<code>@clerk/nextjs</code>就可以了，因为不需要管理<code>User</code>的密码，所以也不需要<code>bcryptjs</code>了，因为只在登录注册使用了<code>form</code>组件，所以也可以不要相关的<code>form</code>、<code>react-hook-form</code>、<code>@hookform/resolvers</code>的包了。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic># 使用pnpm，初始化Next.js项目</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>pnpm create next-app@latest next-clerk-prisma-demo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic># 安装shadcn-ui作为UI库</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>pnpm dlx shadcn-ui@latest init
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>pnpm dlx shadcn-ui@latest add alert avatar button card dialog input separator sonner
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic># 安装其他第三方库</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>pnpm add zod @clerk/nextjs @prisma/client
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>pnpm add -D prisma
</span></span></code></pre></div><h4 id=项目结构和权限说明>项目结构和权限说明<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84%e5%92%8c%e6%9d%83%e9%99%90%e8%af%b4%e6%98%8e></a></h4><p>这块和之前一样不再赘诉。</p><h4 id=项目准备>项目准备<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87></a></h4><p>大部分还是和之前一样，下面仅对不一样的地方进行说明</p><p>在配置<code>schema.prisma</code>时，我们需要对<code>User</code>模型中的字段进行调整。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>// This is your Prisma schema file,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>// learn more about it in the docs: https://pris.ly/d/prisma-schema
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>generator client {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  provider = &#34;prisma-client-js&#34;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>datasource db {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  provider = &#34;sqlite&#34;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  url      = env(&#34;DATABASE_URL&#34;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>model User {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  id       String @id
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  email    String @unique
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  username String
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  avatar   String
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  tasks Task[]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>model Task {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  id          String   @id @default(uuid())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  content     String
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  isCompleted Boolean  @default(false)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  createdAt   DateTime @default(now())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  updatedAt   DateTime @updatedAt
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  authorId String
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  author   User   @relation(fields: [authorId], references: [id])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>}
</span></span></code></pre></div><p>可以看到<code>User</code>模型这块更简单了，需要使用<code>Clerk</code>来提供这些信息。但是这块的东西我认为是<code>Clerk</code>中最麻烦的地方了。</p><p>通常情况下如果不需要使用到用户信息，只需要一个纯粹的用户，就可以不需要User这个model，完全使用Clerk提供的方法和hooks就可以了。如果需要本地的用户，这里势必需要和<code>Clerk</code>的用户信息进行同步，所以这里就需要配置一些额外的东西了，下面我们看下官方的说明 <a href=https://clerk.com/docs/integrations/webhooks/sync-data target=_blank>使用webhooks将Clerk数据同步到您的应用程序</a>。</p><p>文档中比较详细说明了为什么需要使用<code>webhooks</code>，以及为何使用<code>ngrok</code>做转发以及绑定到<code>Clerk</code>中的每个步骤。然后还需要安装下<code>svix</code>。最后给了一个本地<code>/src/app/api/webhooks/route.ts</code>的示例。我们可以在此基础上进行修改下。</p><p>注意：这里需要使用到<code>prisma</code>来创建和更新用户，所以先添加好<code>prisma</code>的客户端和连接方法，步骤之前的项目中有。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// /src/app/api/webooks/route.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> { Webhook } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;svix&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { headers } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/headers&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { WebhookEvent } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@clerk/nextjs/server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { db } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/db&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>async</span> <span style=color:#d20f39>function</span> POST(req: <span style=color:#d20f39>Request</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#8839ef>const</span> WEBHOOK_SECRET <span style=color:#04a5e5;font-weight:700>=</span> process.env.WEBHOOK_SECRET
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>WEBHOOK_SECRET) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		<span style=color:#8839ef>throw</span> <span style=color:#8839ef>new</span> <span style=color:#04a5e5>Error</span>(<span style=color:#40a02b>&#39;Please add WEBHOOK_SECRET from Clerk Dashboard to .env or .env.local&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	<span style=color:#9ca0b0;font-style:italic>// Get the headers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> headerPayload <span style=color:#04a5e5;font-weight:700>=</span> headers()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>const</span> svix_id <span style=color:#04a5e5;font-weight:700>=</span> headerPayload.<span style=color:#8839ef>get</span>(<span style=color:#40a02b>&#39;svix-id&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	<span style=color:#8839ef>const</span> svix_timestamp <span style=color:#04a5e5;font-weight:700>=</span> headerPayload.<span style=color:#8839ef>get</span>(<span style=color:#40a02b>&#39;svix-timestamp&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	<span style=color:#8839ef>const</span> svix_signature <span style=color:#04a5e5;font-weight:700>=</span> headerPayload.<span style=color:#8839ef>get</span>(<span style=color:#40a02b>&#39;svix-signature&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	<span style=color:#9ca0b0;font-style:italic>// If there are no headers, error out
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>svix_id <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#04a5e5;font-weight:700>!</span>svix_timestamp <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#04a5e5;font-weight:700>!</span>svix_signature) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>		<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;Error occured -- no svix headers&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			status: <span style=color:#d20f39>400</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	<span style=color:#9ca0b0;font-style:italic>// Get the body
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> payload <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> req.json()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>const</span> body <span style=color:#04a5e5;font-weight:700>=</span> JSON.stringify(payload)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	<span style=color:#9ca0b0;font-style:italic>// Create a new Svix instance with your secret.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> wh <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Webhook(WEBHOOK_SECRET)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>	<span style=color:#d20f39>let</span> evt: <span style=color:#d20f39>WebhookEvent</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	<span style=color:#9ca0b0;font-style:italic>// Verify the payload with the headers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>		evt <span style=color:#04a5e5;font-weight:700>=</span> wh.verify(body, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>			<span style=color:#40a02b>&#39;svix-id&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> svix_id,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			<span style=color:#40a02b>&#39;svix-timestamp&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> svix_timestamp,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>			<span style=color:#40a02b>&#39;svix-signature&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> svix_signature
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>		}) <span style=color:#8839ef>as</span> WebhookEvent
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>	} <span style=color:#8839ef>catch</span> (err) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		console.error(<span style=color:#40a02b>&#39;Error verifying webhook:&#39;</span>, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>		<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;Error occured&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>			status: <span style=color:#d20f39>400</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>	<span style=color:#8839ef>const</span> { id } <span style=color:#04a5e5;font-weight:700>=</span> evt.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>	<span style=color:#8839ef>const</span> eventType <span style=color:#04a5e5;font-weight:700>=</span> evt.<span style=color:#8839ef>type</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>	<span style=color:#9ca0b0;font-style:italic>// 当事件类型为 user.created 时，创建用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>if</span> (eventType <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;user.created&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>		<span style=color:#8839ef>const</span> { id, image_url, email_addresses, username } <span style=color:#04a5e5;font-weight:700>=</span> evt<span style=color:#04a5e5;font-weight:700>?</span>.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>			<span style=color:#8839ef>await</span> db.user.create({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>				data<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>					id,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>					username: <span style=color:#d20f39>username</span> <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>					avatar: <span style=color:#d20f39>image_url</span> <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;/images/defatul-avatar.png&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>					email: <span style=color:#d20f39>email_addresses</span>[<span style=color:#fe640b>0</span>].email_address
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>				}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>			<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;User created successfully!&#39;</span>, { status: <span style=color:#d20f39>200</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>		} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>			console.log(<span style=color:#40a02b>&#39;Error creating user:&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>			<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;Failed to create user&#39;</span>, { status: <span style=color:#d20f39>500</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">74</span><span>	<span style=color:#9ca0b0;font-style:italic>// 当事件类型为 user.updated 时，更新用户信息
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">75</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>if</span> (eventType <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;user.updated&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">76</span><span>		<span style=color:#8839ef>const</span> { id, image_url, email_addresses, username } <span style=color:#04a5e5;font-weight:700>=</span> evt<span style=color:#04a5e5;font-weight:700>?</span>.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">77</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">78</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">79</span><span>			<span style=color:#8839ef>await</span> db.user.update({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">80</span><span>				where<span style=color:#04a5e5;font-weight:700>:</span> { id },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">81</span><span>				data<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">82</span><span>					username: <span style=color:#d20f39>username</span> <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">83</span><span>					avatar: <span style=color:#d20f39>image_url</span> <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;/images/defatul-avatar.png&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">84</span><span>					email: <span style=color:#d20f39>email_addresses</span>[<span style=color:#fe640b>0</span>].email_address
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">85</span><span>				}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">86</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">87</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">88</span><span>			<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;User updated successfully!&#39;</span>, { status: <span style=color:#d20f39>200</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">89</span><span>		} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">90</span><span>			console.log(<span style=color:#40a02b>&#39;Error updating user:&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">91</span><span>			<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;Failed to update user&#39;</span>, { status: <span style=color:#d20f39>500</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">92</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">93</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">94</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">95</span><span>	<span style=color:#8839ef>return</span> <span style=color:#8839ef>new</span> Response(<span style=color:#40a02b>&#39;&#39;</span>, { status: <span style=color:#d20f39>200</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">96</span><span>}
</span></span></code></pre></div><p>主要通过<code>Clerk</code>给出两个生命周期事件添加对应的代码，需要注意的是给出的<code>evt.data</code>里的<code>email_addresses</code>是一个数组，因为一个账户可以绑定多个邮箱，所以需要注意取值。如果需要查看<code>Clerk</code>的<code>evt.data</code>中会返回那些内容可以查看 <a href="https://clerk.com/docs/integrations/webhooks/overview?_gl=1*av9jgs*_gcl_au*NjA5NjU2NDY0LjE3MTkyMzExMTMuMzAzMjYzMDI1LjE3MTk0MTc1NzguMTcxOTQxNzU3Nw.." target=_blank>Webhooks overview</a></p><p>当然最后还需要将官方说明中的几个环境变量的值添加到<code>.env</code>中，<code>Clerk key</code>在添加完<code>Clerk</code>项目就可以看到。<code>Clerk webhooks secret</code>这个在<code>Clerk Dashboard</code>的左侧<code>webhooks</code>导航中，添加完<code>Endpoint</code>就可以在右侧看到<code>Signing Secret</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic># clerk key</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#dc8a78>NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY</span><span style=color:#04a5e5;font-weight:700>=</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#dc8a78>CLERK_SECRET_KEY</span><span style=color:#04a5e5;font-weight:700>=</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic># clerk webhooks secret</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#dc8a78>WEBHOOK_SECRET</span><span style=color:#04a5e5;font-weight:700>=</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#dc8a78>NEXT_PUBLIC_CLERK_SIGN_IN_URL</span><span style=color:#04a5e5;font-weight:700>=</span>/sign-in
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#dc8a78>NEXT_PUBLIC_CLERK_SIGN_UP_URL</span><span style=color:#04a5e5;font-weight:700>=</span>/sign-up
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#dc8a78>CLERK_SIGN_IN_FORCE_REDIRECT_URL</span><span style=color:#04a5e5;font-weight:700>=</span>/
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#dc8a78>CLERK_SIGN_UP_FORCE_REDIRECT_URL</span><span style=color:#04a5e5;font-weight:700>=</span>/
</span></span></code></pre></div><p>至此，<code>Clerk</code>中最麻烦的部分已经完成，接下来享受<code>Clerk</code>带来的便利把。</p><p>最后按照官方的步骤来操作下，<a href=https://clerk.com/docs/quickstarts/nextjs target=_blank>Next.js Quickstart</a>，有些内容我们在上一步已经完成了，接下来看下还需要添加些什么内容</p><p>添加<code>middleware.ts</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { clerkMiddleware, createRouteMatcher } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@clerk/nextjs/server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic>// 创建一个路由匹配器，用于判断请求的路径是否在受保护的路由列表中
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> isProtectedRoute <span style=color:#04a5e5;font-weight:700>=</span> createRouteMatcher([<span style=color:#40a02b>&#39;/&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic>// 导出默认的 Clerk 中间件函数，用于处理认证逻辑
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> clerkMiddleware((auth, req) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#9ca0b0;font-style:italic>// 如果请求的路径是受保护的路由，则调用 auth().protect() 方法进行保护
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>if</span> (isProtectedRoute(req)) auth().protect()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// 导出配置对象，定义中间件的匹配规则
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> config <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	matcher<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;/((?!.*\\..*|_next).*)&#39;</span>, <span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;/(api|trpc)(.*)&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>}
</span></span></code></pre></div><p>只需要几行代码，就可以完成之前的项目需求。关于<code>middleware.ts</code>中的<code>clerkMiddleware</code>这块的内容，可以查看官方文档：<a href=https://clerk.com/docs/references/nextjs/clerk-middleware target=_blank><code>clerkMiddleware()</code></a></p><p>在<code>layout.tsx</code>上添加上<code>Clerk</code>的<code>provider</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> <span style=color:#8839ef>type</span> { Metadata } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { Inter } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/font/google&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { ClerkProvider } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@clerk/nextjs&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> <span style=color:#40a02b>&#39;./globals.css&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>const</span> inter <span style=color:#04a5e5;font-weight:700>=</span> Inter({ subsets<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;latin&#39;</span>] })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> metadata: <span style=color:#d20f39>Metadata</span> <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	title<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Create Next App&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	description<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Generated by create next app&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> <span style=color:#d20f39>function</span> RootLayout({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	children
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>}<span style=color:#04a5e5;font-weight:700>:</span> Readonly<span style=color:#04a5e5;font-weight:700>&lt;</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	children: <span style=color:#d20f39>React.ReactNode</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>}<span style=color:#04a5e5;font-weight:700>&gt;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>		&lt;<span style=color:#8839ef>ClerkProvider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			&lt;<span style=color:#8839ef>html</span> <span style=color:#1e66f5>lang</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;en&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>				&lt;<span style=color:#8839ef>body</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{inter.className}&gt;{children}&lt;/<span style=color:#8839ef>body</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			&lt;/<span style=color:#8839ef>html</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>		&lt;/<span style=color:#8839ef>ClerkProvider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span></code></pre></div><p>添加<code>sign-up</code>和<code>sign-in</code>页面，直接使用官方的示例模板就可以了。 <a href=https://clerk.com/docs/references/nextjs/custom-signup-signin-pages target=_blank>Build your own sign-in and sign-up pages for your Next.js app with Clerk</a></p><p>这里的需要放到一个路由组中，使用单独的<code>layout</code>包裹下这两个页面，让登录注册的表单居中。</p><p>注册：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#8839ef>import</span> { SignUp } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#34;@clerk/nextjs&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> <span style=color:#d20f39>function</span> Page() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>  <span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>SignUp</span> /&gt;;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>}
</span></span></code></pre></div><p>登录：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> { SignIn } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#34;@clerk/nextjs&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> <span style=color:#d20f39>function</span> Page() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>  <span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>SignIn</span> /&gt;;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>}
</span></span></code></pre></div><p><code>layout.tsx</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> AuthLayout <span style=color:#04a5e5;font-weight:700>=</span> ({ children }<span style=color:#04a5e5;font-weight:700>:</span> { children: <span style=color:#d20f39>React.ReactNode</span> }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-center items-center w-full h-screen bg-neutral-100&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>			{children}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> AuthLayout
</span></span></code></pre></div><p>至此，登录、注册、路由保护都完成了，实际需要写的代码地方非常少，基本上都可以从官方的示例模板中复制粘贴即可。接下来，会使用<code>Clerk</code>给的一些服务端方法和客户端方法来实现项目中内容。</p><h4 id=项目实现>项目实现<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%ae%9e%e7%8e%b0></a></h4><p>因为<code>Clerk</code>有在服务端和客户端的方法，我们这里可以使用服务端<code>actions</code>来实现数据处理。关于<code>Clerk</code>如何获取用户数据和权限，可以查看官方说明 <a href=https://clerk.com/docs/references/nextjs/read-session-data target=_blank>Read session and user data in your Next.js app with Clerk</a></p><p>花了些时间，我搬运修改下之前的UI，看下修改比较大的。</p><p><code>task-header.tsx</code>因为可以使用<code>Clerk</code>的组件<code>UserButton</code>，可以不用从父级组件来传递用户信息和是否登录的信息了，代码少了很多。获取用户和权限信息页很方便。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/components/tasks/task-header.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#40a02b>&#39;use client&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { UserButton, useAuth } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@clerk/nextjs&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>import</span> { Plus } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;lucide-react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>import</span> { Button } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/button&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>import</span> { TabsList, TabsTrigger } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/tabs&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#8839ef>import</span> { useTaskModal } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/hooks/use-task-modal&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> TaskHeader <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>const</span> { userId } <span style=color:#04a5e5;font-weight:700>=</span> useAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>const</span> onOpen <span style=color:#04a5e5;font-weight:700>=</span> useTaskModal(state <span style=color:#04a5e5;font-weight:700>=&gt;</span> state.onOpen)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-between items-center gap-x-4&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			{userId <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>				&lt;<span style=color:#8839ef>Button</span> <span style=color:#1e66f5>variant</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;outline&#39;</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex items-center gap-x-2&#39;</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{onOpen}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>					&lt;<span style=color:#8839ef>Plus</span> <span style=color:#1e66f5>size</span><span style=color:#04a5e5;font-weight:700>=</span>{<span style=color:#fe640b>16</span>} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>					&lt;<span style=color:#8839ef>span</span>&gt;Add Task&lt;/<span style=color:#8839ef>span</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>				&lt;/<span style=color:#8839ef>Button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>			&lt;<span style=color:#8839ef>TabsList</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex items-center gap-x-4&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>				&lt;<span style=color:#8839ef>TabsTrigger</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;all&#39;</span>&gt;All&lt;/<span style=color:#8839ef>TabsTrigger</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>				&lt;<span style=color:#8839ef>TabsTrigger</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;active&#39;</span>&gt;Active&lt;/<span style=color:#8839ef>TabsTrigger</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>				&lt;<span style=color:#8839ef>TabsTrigger</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;completed&#39;</span>&gt;Completed&lt;/<span style=color:#8839ef>TabsTrigger</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>			&lt;/<span style=color:#8839ef>TabsList</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>			&lt;<span style=color:#8839ef>UserButton</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>}
</span></span></code></pre></div><p>接下来是弹层，添加<code>Task</code>的<code>task-modal.tsx</code>组件。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/components/tasks/task-modal.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#40a02b>&#39;use client&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { useState, useTransition } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> { useRouter } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/navigation&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>import</span> { toast } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;sonner&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>import</span> { Button } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/button&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>import</span> { Input } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/input&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#8839ef>import</span> { Switch } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/switch&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#8839ef>import</span> { Modal } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/modal&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>import</span> { useTaskModal } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/hooks/use-task-modal&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#8839ef>import</span> { createTask } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/actions/task&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> TaskModal <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	<span style=color:#8839ef>const</span> router <span style=color:#04a5e5;font-weight:700>=</span> useRouter()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	<span style=color:#8839ef>const</span> taskModal <span style=color:#04a5e5;font-weight:700>=</span> useTaskModal()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	<span style=color:#8839ef>const</span> [content, setContent] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	<span style=color:#8839ef>const</span> [isCompleted, setIsCompleted] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>	<span style=color:#8839ef>const</span> [error, setError] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	<span style=color:#8839ef>const</span> [isPending, startTransition] <span style=color:#04a5e5;font-weight:700>=</span> useTransition()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	<span style=color:#8839ef>const</span> handleSubmit <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>			setError(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>			startTransition(() <span style=color:#04a5e5;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>				createTask({ content, isCompleted }).then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>					<span style=color:#8839ef>if</span> (res.success) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>						setError(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>						toast.success(<span style=color:#40a02b>&#39;Task created successfully&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>						taskModal.onClose()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>						setContent(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>						setIsCompleted(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>						router.refresh()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>					}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>					<span style=color:#8839ef>if</span> (res.error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>						setError(res.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>						<span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>					}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>				})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>			)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>		} <span style=color:#8839ef>catch</span> (error: <span style=color:#d20f39>any</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>			console.log(<span style=color:#40a02b>&#39;Create task error:&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>			setError(error.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>		&lt;<span style=color:#8839ef>Modal</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>			<span style=color:#1e66f5>title</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;Add Task&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>			<span style=color:#1e66f5>description</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;Add a new task to your list&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>			<span style=color:#1e66f5>isOpen</span><span style=color:#04a5e5;font-weight:700>=</span>{taskModal.open}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>			<span style=color:#1e66f5>onClose</span><span style=color:#04a5e5;font-weight:700>=</span>{taskModal.onClose}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>		&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col gap-y-4&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>				{error <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> error <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>					&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;px-2 py-1 text-sm text-red-500 bg-red-500/10 border border-red-200 rounded-md&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>						{error}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>					&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>				)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>				&lt;<span style=color:#8839ef>Input</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>					<span style=color:#1e66f5>placeholder</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;Enter task content&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>					<span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{isPending}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>					<span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{content}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>					<span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{e <span style=color:#04a5e5;font-weight:700>=&gt;</span> setContent(e.target.value)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>				/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex items-center gap-x-2&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span>					&lt;<span style=color:#8839ef>span</span>&gt;Mark <span style=color:#8839ef>as</span> completed<span style=color:#04a5e5;font-weight:700>:</span>&lt;/<span style=color:#8839ef>span</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">74</span><span>					&lt;<span style=color:#8839ef>Switch</span> <span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{isPending} <span style=color:#1e66f5>checked</span><span style=color:#04a5e5;font-weight:700>=</span>{isCompleted} <span style=color:#1e66f5>onCheckedChange</span><span style=color:#04a5e5;font-weight:700>=</span>{setIsCompleted} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">75</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">76</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">77</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-end gap-x-4&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">78</span><span>					&lt;<span style=color:#8839ef>Button</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;button&#39;</span> <span style=color:#1e66f5>variant</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;outline&#39;</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{taskModal.onClose} <span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{isPending}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">79</span><span>						Cancel
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">80</span><span>					&lt;/<span style=color:#8839ef>Button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">81</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">82</span><span>					&lt;<span style=color:#8839ef>Button</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;submit&#39;</span> <span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{isPending} <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleSubmit}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">83</span><span>						{isPending <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;Submitting...&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Submit&#39;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">84</span><span>					&lt;/<span style=color:#8839ef>Button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">85</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">86</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">87</span><span>		&lt;/<span style=color:#8839ef>Modal</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">88</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">89</span><span>}
</span></span></code></pre></div><p>没啥好说的，直接使用<code>createTask</code>的<code>action</code>。其他的代码和之前基本一样。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#9ca0b0;font-style:italic>// src/components/tasks/task-item.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span><span style=color:#40a02b>&#39;use client&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span><span style=color:#8839ef>import</span> { useTransition } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span><span style=color:#8839ef>import</span> { useRouter } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/navigation&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span><span style=color:#8839ef>import</span> { Task } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@prisma/client&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span><span style=color:#8839ef>import</span> { toast } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;sonner&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span><span style=color:#8839ef>import</span> { Trash } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;lucide-react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span><span style=color:#8839ef>import</span> { Button } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/button&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span><span style=color:#8839ef>import</span> { Badge } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/badge&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span><span style=color:#8839ef>import</span> { Switch } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/ui/switch&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span><span style=color:#8839ef>import</span> { cn } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/utils&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span><span style=color:#8839ef>import</span> { updateTask, deleteTask } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/actions/task&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> TaskItem <span style=color:#04a5e5;font-weight:700>=</span> ({ task, isAuth }<span style=color:#04a5e5;font-weight:700>:</span> { task: <span style=color:#d20f39>Task</span>; isAuth: <span style=color:#d20f39>boolean</span> <span style=color:#04a5e5;font-weight:700>|</span> <span style=color:#fe640b>undefined</span> }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>	<span style=color:#8839ef>const</span> router <span style=color:#04a5e5;font-weight:700>=</span> useRouter()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span>	<span style=color:#8839ef>const</span> [isPending, startTransition] <span style=color:#04a5e5;font-weight:700>=</span> useTransition()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>	<span style=color:#8839ef>const</span> handleTaskUpdate <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span>			startTransition(() <span style=color:#04a5e5;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span>				updateTask({ id: <span style=color:#d20f39>task.id</span>, isCompleted<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5;font-weight:700>!</span>task.isCompleted, content: <span style=color:#d20f39>task.content</span> }).then(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span>					res <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span>						<span style=color:#8839ef>if</span> (res.success) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>							toast.success(res.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>							router.refresh()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>						}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span>						<span style=color:#8839ef>if</span> (res.error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span>							toast.error(res.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>							<span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span>						}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>					}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>				)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span>			)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>		} <span style=color:#8839ef>catch</span> (error: <span style=color:#d20f39>any</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>			console.log(<span style=color:#40a02b>&#39;Error updating task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span>	<span style=color:#8839ef>const</span> handleTaskDelete <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span>			startTransition(() <span style=color:#04a5e5;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>				deleteTask({ id: <span style=color:#d20f39>task.id</span> }).then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span>					<span style=color:#8839ef>if</span> (res.success) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>						toast.success(res.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>						router.refresh()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>					}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span>					<span style=color:#8839ef>if</span> (res.error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>						toast.error(res.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span>						<span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>					}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>				})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span>			)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>		} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>			console.log(<span style=color:#40a02b>&#39;Error deleting task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;group/item flex justify-between items-center px-4 h-14 border rounded-md hover:bg-gray-50&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex-1 flex items-center gap-x-2&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex-1 flex items-center gap-x-2&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>					&lt;<span style=color:#8839ef>Badge</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>						<span style=color:#1e66f5>variant</span><span style=color:#04a5e5;font-weight:700>=</span>{task.isCompleted <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;secondary&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;default&#39;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span>						<span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text-xs font-normal uppercase&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span>					&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span>						{task.isCompleted <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;Completed&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Pending&#39;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span>					&lt;/<span style=color:#8839ef>Badge</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span>					&lt;<span style=color:#8839ef>span</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{cn(<span style=color:#40a02b>&#39;text-sm&#39;</span>, { <span style=color:#40a02b>&#39;text-gray-400&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> task.isCompleted })}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>						{task.content}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>					&lt;/<span style=color:#8839ef>span</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span>			{isAuth <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;hidden group-hover/item:flex justify-end items-center gap-x-2&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>					&lt;<span style=color:#8839ef>Button</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>						<span style=color:#1e66f5>variant</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;outline&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span>						<span style=color:#1e66f5>size</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;icon&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span>						<span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;!w-auto !h-auto p-1.5&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>						<span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleTaskDelete}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>					&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>						&lt;<span style=color:#8839ef>Trash</span> <span style=color:#1e66f5>size</span><span style=color:#04a5e5;font-weight:700>=</span>{<span style=color:#fe640b>12</span>} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>					&lt;/<span style=color:#8839ef>Button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>					&lt;<span style=color:#8839ef>Switch</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>						<span style=color:#1e66f5>checked</span><span style=color:#04a5e5;font-weight:700>=</span>{task.isCompleted}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span>						<span style=color:#1e66f5>onCheckedChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleTaskUpdate}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>						<span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{isPending}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span>					/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>			)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>}
</span></span></code></pre></div><p>这个页面算是修改比较多的地方了，主要是修改了<code>handleTaskUpdate</code>和<code>handleTaskDelete</code>这两个方法，改用了<code>action</code>。</p><p>最后来看下<code>action</code>，这个是这个项目里重新写的了，也不是很多。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#9ca0b0;font-style:italic>// src/actions/task.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span><span style=color:#40a02b>&#39;use server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span><span style=color:#8839ef>import</span> { revalidatePath } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/cache&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span><span style=color:#8839ef>import</span> { db } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/db&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span><span style=color:#8839ef>import</span> { auth } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@clerk/nextjs/server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span><span style=color:#8839ef>import</span> { IResponseBase } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/types&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span><span style=color:#8839ef>import</span> { getUserById } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/services&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> createTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span>	content,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span>	isCompleted <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span>}<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>	content: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span>	isCompleted: <span style=color:#d20f39>boolean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span>})<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span>		<span style=color:#8839ef>const</span> { userId } <span style=color:#04a5e5;font-weight:700>=</span> auth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>userId) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Unauthorized&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>		<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getUserById(userId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>user) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;User not found&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span>		<span style=color:#8839ef>const</span> task <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.task.create({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>			data<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>				content,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>				isCompleted,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>				authorId: <span style=color:#d20f39>user.id</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span>		revalidatePath(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;layout&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>		<span style=color:#8839ef>return</span> { success: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task created successfully&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>		console.log(<span style=color:#40a02b>&#39;Error creating task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>		<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Error creating task, please try again later&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> updateTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>	id,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span>	isCompleted
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>}<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span>	id: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>	content: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>	isCompleted: <span style=color:#d20f39>boolean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>})<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span>		<span style=color:#8839ef>const</span> { userId } <span style=color:#04a5e5;font-weight:700>=</span> auth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>userId) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Unauthorized&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>		<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getUserById(userId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>user) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;User not found&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>		<span style=color:#8839ef>const</span> existingTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.task.findUnique({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>			where<span style=color:#04a5e5;font-weight:700>:</span> { id }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>existingTask) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task not found&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span>		<span style=color:#8839ef>await</span> db.task.update({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span>			where<span style=color:#04a5e5;font-weight:700>:</span> { id },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span>			data<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span>				isCompleted
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>		revalidatePath(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;layout&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>		<span style=color:#8839ef>return</span> { success: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task updated successfully&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span>		console.log(<span style=color:#40a02b>&#39;Error updating task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>		<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Error updating task, please try again later&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> deleteTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> ({ id }<span style=color:#04a5e5;font-weight:700>:</span> { id: <span style=color:#d20f39>string</span> })<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>		<span style=color:#8839ef>const</span> { userId } <span style=color:#04a5e5;font-weight:700>=</span> auth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>userId) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Unauthorized&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>		<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getUserById(userId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>user) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;User not found&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span>		<span style=color:#8839ef>const</span> existingTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.task.findUnique({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>			where<span style=color:#04a5e5;font-weight:700>:</span> { id }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>existingTask) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>			<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task not found&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">102</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">103</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">104</span><span>		<span style=color:#8839ef>await</span> db.task.<span style=color:#8839ef>delete</span>({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">105</span><span>			where<span style=color:#04a5e5;font-weight:700>:</span> { id }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">106</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">107</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">108</span><span>		revalidatePath(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;layout&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">109</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">110</span><span>		<span style=color:#8839ef>return</span> { success: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task deleted successfully&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">111</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">112</span><span>		console.log(<span style=color:#40a02b>&#39;Error deleting task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">113</span><span>		<span style=color:#8839ef>return</span> { error: <span style=color:#d20f39>true</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Error deleting task, please try again later&#39;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">114</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">115</span><span>}
</span></span></code></pre></div><p>写<code>action</code>的好处太多，不用像<code>api</code>中的<code>route</code>考虑<code>method</code>和要写到哪个层级哪里会需要<code>params</code>的参数传过来。</p><p>最后，其实作为一个远程用户权限的管理，页面势必会有闪烁，做法和之前一样这里我就没做了。</p><h4 id=项目总结>项目总结<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e6%80%bb%e7%bb%93></a></h4><p><code>Clerk</code>的优点：</p><ul><li>快速实现用户、权限的管理</li><li>丰富的组件和实现方法，省去了很多麻烦</li><li>文档是我见过之中，从结构到内容都是比较完善和详细的，提供了很多模板代码和代码说明</li></ul><p>缺点：</p><ul><li>毕竟是第三方的<code>saas</code>系统，提供的可定制的地方会比较少，或者需要付费，样式可修改的程度比较低。</li><li>本地调试同步用户信息需要使用<code>webhooks</code>和隧道的方式</li></ul><p>总结：</p><p>如果是一个小项目，需要快速实现业务功能，不太考虑用户系统，可以直接使用<code>Clerk</code>。如果需要使用用户相关信息来做处理，比如：需要有用户基本信息和关注、收藏等信息的，可以使用<code>Clerk</code>的进行用户数据同步，可以使用<code>webhook</code>和隧道的方式，也可以直接部署到线上查看效果。方便是真的方便，UI改是改不动。</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-1/ data-toggle=tooltip data-placement=top title=Next中的权限管理(一)>Previous<br><span>Next中的权限管理(一)</span></a></li><li class=next><a href=/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-3/ data-toggle=tooltip data-placement=top title=Next中的权限管理(三)>Next<br><span>Next中的权限管理(三)</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>