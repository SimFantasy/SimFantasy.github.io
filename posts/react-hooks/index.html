<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>React Hooks | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="React使用了多年，但有些hooks用得很少，一直想来一次总结将常见的一些hooks弄明白。笔记内容 基于B站up主刘龙彬的 React hooks 基础入门系列：视频地址"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="React Hooks"><meta name=twitter:description content="React使用了多年，但有些hooks用得很少，一直想来一次总结将常见的一些hooks弄明白。笔记内容 基于B站up主刘龙彬的 React hooks 基础入门系列：视频地址"><meta property="og:title" content="React Hooks"><meta property="og:description" content="React使用了多年，但有些hooks用得很少，一直想来一次总结将常见的一些hooks弄明白。笔记内容 基于B站up主刘龙彬的 React hooks 基础入门系列：视频地址"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost/posts/react-hooks/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-13T09:59:29+08:00"><meta property="article:modified_time" content="2024-03-13T09:59:29+08:00"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>React Hooks</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2024-03-13</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=React>React</a>
<a href=/tags/hooks/ title=Hooks>Hooks</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>React使用了多年，但有些hooks用得很少，一直想来一次总结将常见的一些hooks弄明白。笔记内容 基于B站up主刘龙彬的 <code>React hooks 基础入门系列</code>：<a href="https://www.bilibili.com/video/BV1sV411c7u9/?spm_id_from=333.337.search-card.all.click&amp;vd_source=7f4a6e354904b6c7b077241f94bcec23" target=_blank>视频地址</a></p><h3 id=usestate>useState<a class=anchorjs-link href=#usestate></a></h3><h4 id=基本用法>基本用法<a class=anchorjs-link href=#%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95></a></h4><p><code>useState</code>能让组件拥有自己的状态，是一个管理状态的hooks api。通过<code>useState</code>可以实现状态的初始化、读取、更新。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> [state, setState] <span style=color:#04a5e5;font-weight:700>=</span> useState(initialValue)
</span></span></code></pre></div><ul><li><code>state</code>：状态值</li><li><code>setState</code>：修改状态值的函数</li><li><code>initialValue</code>：状态的初始值</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Count: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Count组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span></code></pre></div><p>上述代码中，使用<code>setState</code>定义了一个计数值<code>count</code>，<code>count</code>的初始值为0，可以使用<code>setCount</code>对<code>count</code>进行修改，在<code>setCount</code>中传入修改表达式或函数。</p><h4 id=状态发生变化时会触发函数组件的重新执行>状态发生变化时，会触发函数组件的重新执行<a class=anchorjs-link href=#%e7%8a%b6%e6%80%81%e5%8f%91%e7%94%9f%e5%8f%98%e5%8c%96%e6%97%b6%e4%bc%9a%e8%a7%a6%e5%8f%91%e5%87%bd%e6%95%b0%e7%bb%84%e4%bb%b6%e7%9a%84%e9%87%8d%e6%96%b0%e6%89%a7%e8%a1%8c></a></h4><p>在函数组件中，<code>setState</code>定义状态之后，每次当状态发生变化，都会触发函数组件的重新执行，从而根据最新的数据更新渲染DOM。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Count: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#9ca0b0;font-style:italic>// 当handleAdd中的setCount修改状态，组件会重新渲染
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>  console.log(<span style=color:#40a02b>&#39;组件渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Count组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>}
</span></span></code></pre></div><p>上述代码，在每次点击按钮后会执行<code>handleAdd</code>函数，函数会执行<code>setCount</code>来修改<code>count</code>的值。每次修改后，都会触发函数组件重新渲染新的<code>count</code>值。</p><p>注：</p><ul><li>组件的渲染就是执行<code>Count</code>函数的过程。</li><li>当函数组件只有在首次执行时使用<code>useState</code>的初始值，在后续的更新执行时，不会重复的调用<code>useState</code>的初始值，而是会复用上的<code>state</code>的值。</li></ul><h4 id=以函数的形式给状态赋初始值>以函数的形式给状态赋初始值<a class=anchorjs-link href=#%e4%bb%a5%e5%87%bd%e6%95%b0%e7%9a%84%e5%bd%a2%e5%bc%8f%e7%bb%99%e7%8a%b6%e6%80%81%e8%b5%8b%e5%88%9d%e5%a7%8b%e5%80%bc></a></h4><p>在使用<code>useState</code>定义状态时，除了可以使用基础类型给定初始值，还可以通过函数返回值的形式为初始状态赋值。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> DateComponent: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [date] <span style=color:#04a5e5;font-weight:700>=</span> useState(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    <span style=color:#8839ef>const</span> dt <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> <span style=color:#04a5e5>Date</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      year: <span style=color:#d20f39>dt.getFullYear</span>(),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>      month: <span style=color:#d20f39>dt.getMonth</span>() <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      day: <span style=color:#d20f39>dt.getDate</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Date组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>        <span style=color:#04a5e5>Date</span><span style=color:#04a5e5;font-weight:700>:</span> {date.year}<span style=color:#04a5e5;font-weight:700>/</span>{date.month}<span style=color:#04a5e5;font-weight:700>/</span>{date.day}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>}
</span></span></code></pre></div><p>上述代码，在定义<code>date</code>状态时，通过给<code>useState</code>定义一个函数，使用<code>new Date()</code>获取到年月日的值，然后以对象的形式返回给<code>date</code>。</p><h4 id=usestate中的set函数是异步更新状态的>useState中的set函数是异步更新状态的<a class=anchorjs-link href=#usestate%e4%b8%ad%e7%9a%84set%e5%87%bd%e6%95%b0%e6%98%af%e5%bc%82%e6%ad%a5%e6%9b%b4%e6%96%b0%e7%8a%b6%e6%80%81%e7%9a%84></a></h4><p>调用<code>useState</code>函数会返回一个更新状态的<code>set</code>函数，这个函数的内部是以异步的形式修改状态值的，所以修改后无法立即获取到最新的状态值。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [counter, setCounter] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#9ca0b0;font-style:italic>// setCounter函数是异步更新的
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>    setCounter(counter <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    <span style=color:#9ca0b0;font-style:italic>// 当前的counter的值是旧值，无法获取到更新后的新值
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>    console.log(<span style=color:#40a02b>&#39;counter&#39;</span>, counter) <span style=color:#9ca0b0;font-style:italic>// 0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Counter<span style=color:#04a5e5;font-weight:700>:</span> {counter}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span></code></pre></div><p>上述代码，在点击按钮，修改<code>counter</code>时，<code>setCounter</code>是一个异步函数，在其后面的打印<code>counter</code>并不能获取到<code>setCounter</code>修改后的<code>counter</code>值。只能打印出上一次的值。</p><p>注意：</p><ul><li>set函数是异步执行的</li><li>多个set函数之间是同步执行的</li></ul><h4 id=结合useeffect监听状态的变化>结合useEffect监听状态的变化<a class=anchorjs-link href=#%e7%bb%93%e5%90%88useeffect%e7%9b%91%e5%90%ac%e7%8a%b6%e6%80%81%e7%9a%84%e5%8f%98%e5%8c%96></a></h4><p>为了更好的监听状态的变化，可以使用react提供的<code>useEffect</code>函数。他<strong>可以通过监听依赖项的状态变化，执行对应的回调函数。</strong></p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [counter, setCounter] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#9ca0b0;font-style:italic>// setCounter函数是异步更新的
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>    setCounter(counter <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    <span style=color:#9ca0b0;font-style:italic>// 当前的counter的值是旧值，无法获取到更新后的新值
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>    console.log(<span style=color:#40a02b>&#39;counter&#39;</span>, counter) <span style=color:#9ca0b0;font-style:italic>// 0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    console.log(<span style=color:#40a02b>&#39;counter1&#39;</span>, counter) <span style=color:#9ca0b0;font-style:italic>// 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span>  }, [counter])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  console.log(<span style=color:#40a02b>&#39;counter2&#39;</span>, counter) <span style=color:#9ca0b0;font-style:italic>// 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Counter<span style=color:#04a5e5;font-weight:700>:</span> {counter}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>}
</span></span></code></pre></div><p>上述代码，通过<code>useEffect</code>的依赖项<code>counter</code>来监听<code>counter</code>状态变化的情况，如果<code>counter</code>发生了变化，就会触发回调函数中的打印结果<code>counter1</code>。</p><p>注意：</p><p>为什么直接在函数组件中打印<code>counter</code>的<code>counter2</code>也会打印出1？</p><p>因为，<code>handleAdd</code>与<code>console.log()</code>函数是同步执行的，当执行完<code>handleAdd</code>函数时，已经执行完成了内部的<code>setCounter</code>函数，将<code>counter</code>修改为了1。所以执行后面函数组件中的打印时，也能打印出1。</p><h4 id=注意事项>注意事项<a class=anchorjs-link href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9></a></h4><h5 id=解决状态值更新不及时的问题>解决状态值更新不及时的问题<a class=anchorjs-link href=#%e8%a7%a3%e5%86%b3%e7%8a%b6%e6%80%81%e5%80%bc%e6%9b%b4%e6%96%b0%e4%b8%8d%e5%8f%8a%e6%97%b6%e7%9a%84%e9%97%ae%e9%a2%98></a></h5><p>当连续多次以相同的操作更新状态值时，React内部会对传递过来的新值进行比较，如果值相同，则会屏蔽后续的更新行为，从而防止频繁的重复渲染问题。但这样就会造成使用的误区</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [counter, setCounter] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#9ca0b0;font-style:italic>// 当连续使用setCounter时，因为React会比较counter的值的变化，如果counter的值与之前相同，就会屏蔽后续的修改操作。所以后两次的setCounter不会被执行
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// setCounter(counter + 1)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// setCounter(counter + 1)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// setCounter(counter + 1)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// 需要使用回调函数的方式在setCounter中传入一个函数，从参数中获取到counter的上一次变化的值，计算后返回一个新值
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>    setCounter(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    setCounter(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    setCounter(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Counter<span style=color:#04a5e5;font-weight:700>:</span> {counter}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span></code></pre></div><p>上述代码</p><ol><li>在执行第一次<code>setCounter</code>时，获取到的<code>prev</code>值是初始值0，执行函数返回<code>0+1 = 1</code>，此时<code>counter</code>为1。</li><li>在执行第二次<code>setCounter</code>时，获取到的<code>prev</code>值是变化后的<code>counter</code>值<code>1</code>，所以在执行函数时返回<code>2</code>。</li><li>在后续的执行中，都会从上一次变化后获取到变化后的值在进行计算，这样React就不会屏蔽值变化的函数，得到我们想要的结果。</li></ol><h5 id=更新对象类型的值>更新对象类型的值<a class=anchorjs-link href=#%e6%9b%b4%e6%96%b0%e5%af%b9%e8%b1%a1%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%80%bc></a></h5><p>更新对象类型的值，需要使用ES6的展开符后用新的对象覆盖旧对象，才能触发组件的重新渲染。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> UserInfo: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [user, setUser] <span style=color:#04a5e5;font-weight:700>=</span> useState({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Jease Pinkman&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    age: <span style=color:#d20f39>18</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>const</span> handleUpdate <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#9ca0b0;font-style:italic>// user.username = &#39;walter White&#39;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// setUser(user)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// 不能上述方式更新对象，因为set函数内部会对更新前后的值进行比较，如果原值和引用的值相同，那么就不会更新，因为对象是值引用，所以会比较两个对象的地址，如果地址相同，那么就不会更新
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#9ca0b0;font-style:italic>// 下面的更新方式，是返回一个新的对象，然后修改新对象中的username，然后再将新对象赋值给user
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#9ca0b0;font-style:italic></span>    setUser({ ...user, username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;walter White&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;User组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Username<span style=color:#04a5e5;font-weight:700>:</span> {user.username}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {user.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleUpdate}&gt;<span style=color:#d20f39>修改</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>}
</span></span></code></pre></div><h3 id=useref>useRef<a class=anchorjs-link href=#useref></a></h3><h4 id=获取dom元素或子组件的实例对象>获取DOM元素或子组件的实例对象<a class=anchorjs-link href=#%e8%8e%b7%e5%8f%96dom%e5%85%83%e7%b4%a0%e6%88%96%e5%ad%90%e7%bb%84%e4%bb%b6%e7%9a%84%e5%ae%9e%e4%be%8b%e5%af%b9%e8%b1%a1></a></h4><p>示例：</p><p>获取<code>input</code>元素实例并调用DOM API</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useRef } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> BaseRef <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> inputRef <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> focusInput <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    inputRef<span style=color:#04a5e5;font-weight:700>?</span>.current<span style=color:#04a5e5;font-weight:700>?</span>.focus()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{inputRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{focusInput}&gt;<span style=color:#d20f39>获取焦点</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span></code></pre></div><p>上述代码，使用<code>useRef</code>绑定了<code>input</code>元素，通过点击点击按钮，获取<code>input</code>元素的实例，并执行<code>focus()</code>方法</p><h4 id=存储渲染周期之间的共享数据>存储渲染周期之间的共享数据<a class=anchorjs-link href=#%e5%ad%98%e5%82%a8%e6%b8%b2%e6%9f%93%e5%91%a8%e6%9c%9f%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b1%e4%ba%ab%e6%95%b0%e6%8d%ae></a></h4><p><code>useRef</code>函数可以返回一个可变的<code>ref</code>对象，该对象只有一个<code>current</code>属性。可以在调用<code>useRef</code>函数时为期指定初始值。并且这个返回的<code>ref</code>对象在组件的整个生命周期内保持不变。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useRef, useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> prevCount <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    prevCount.current <span style=color:#04a5e5;font-weight:700>=</span> count
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count新值<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count旧值<span style=color:#04a5e5;font-weight:700>:</span> {prevCount.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span></code></pre></div><p>上述代码，使用<code>useRef</code>创建了一个<code>prevCount</code>的数据对象，用来存储上一次的旧<code>count</code>值。每次当点击按钮触发<code>count</code>自增是，都会把旧值赋值给<code>prevCount.current</code>。</p><h4 id=注意事项-1>注意事项<a class=anchorjs-link href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9-1></a></h4><h5 id=组件重新渲染时useref不会被重复初始化>组件重新渲染时<code>useRef</code>不会被重复初始化<a class=anchorjs-link href=#%e7%bb%84%e4%bb%b6%e9%87%8d%e6%96%b0%e6%b8%b2%e6%9f%93%e6%97%b6useref%e4%b8%8d%e4%bc%9a%e8%a2%ab%e9%87%8d%e5%a4%8d%e5%88%9d%e5%a7%8b%e5%8c%96></a></h5><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useRef, useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> refValue <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;(<span style=color:#04a5e5>Math</span>.random())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count新值<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;refValue<span style=color:#04a5e5;font-weight:700>:</span> {refValue.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>}
</span></span></code></pre></div><p>上述代码，每次点击按钮都会触发<code>count</code>自增，从而触发组件函数重新渲染。但是在<code>refValue</code>中的随机数保持不变，这说明组件每次渲染，不会重复调用<code>useRef</code>函数进行初始化。</p><h5 id=refcurrent变化时不会造成组件的重新渲染>ref.current变化时不会造成组件的重新渲染<a class=anchorjs-link href=#refcurrent%e5%8f%98%e5%8c%96%e6%97%b6%e4%b8%8d%e4%bc%9a%e9%80%a0%e6%88%90%e7%bb%84%e4%bb%b6%e7%9a%84%e9%87%8d%e6%96%b0%e6%b8%b2%e6%9f%93></a></h5><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useRef, useState, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> prevCount <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> refValue <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;(<span style=color:#04a5e5>Math</span>.random())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    prevCount.current <span style=color:#04a5e5;font-weight:700>=</span> count
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#8839ef>const</span> handleUpdate <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    refValue.current <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Math</span>.random()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    console.log(<span style=color:#40a02b>&#39;refValue: &#39;</span>, refValue.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  console.log(<span style=color:#40a02b>&#39;组件渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count新值<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count旧值<span style=color:#04a5e5;font-weight:700>:</span> {prevCount.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;refValue<span style=color:#04a5e5;font-weight:700>:</span> {refValue.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleUpdate}&gt;<span style=color:#d20f39>更新随机数</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>}
</span></span></code></pre></div><p>上述代码，点击更新随机数按钮，将获取到的新随机数赋值给<code>refValue.current</code>，并随后打印<code>refValue.current</code>，结果页面上的值没有变化，打印值会随着点击按钮打印变化。</p><h5 id=refcurrent不能作为其他hooks的依赖项>ref.current不能作为其他hooks的依赖项<a class=anchorjs-link href=#refcurrent%e4%b8%8d%e8%83%bd%e4%bd%9c%e4%b8%ba%e5%85%b6%e4%bb%96hooks%e7%9a%84%e4%be%9d%e8%b5%96%e9%a1%b9></a></h5><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useRef, useState, useEffect, FC } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> prevCount <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> refValue <span style=color:#04a5e5;font-weight:700>=</span> useRef&lt;<span style=color:#8839ef>number</span>&gt;(<span style=color:#04a5e5>Math</span>.random())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    prevCount.current <span style=color:#04a5e5;font-weight:700>=</span> count
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#8839ef>const</span> handleUpdate <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    refValue.current <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Math</span>.random()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    console.log(<span style=color:#40a02b>&#39;refValue: &#39;</span>, refValue.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	<span style=color:#9ca0b0;font-style:italic>// useEffect会在函数组件首次加载时，执行回调函数中的打印
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>// useEffect会在重新渲染时执行回调，如果有依赖项，则会查看依赖项是否变化来确定是否执行回调函数。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span><span style=color:#9ca0b0;font-style:italic></span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    console.log(<span style=color:#40a02b>&#39;refValue的值变化了！&#39;</span>, refValue.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  }, [refValue.current])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  console.log(<span style=color:#40a02b>&#39;组件渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count新值<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count旧值<span style=color:#04a5e5;font-weight:700>:</span> {prevCount.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;refValue<span style=color:#04a5e5;font-weight:700>:</span> {refValue.current}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleUpdate}&gt;<span style=color:#d20f39>更新随机数</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>      &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>}
</span></span></code></pre></div><p>上述代码，<code>useEffect</code>中的打印只会在首次加载时打印，后续点击更新随机数按钮，并不会根据依赖项打印。</p><p>因为<code>ref.current</code>并不会造成组件函数的重新渲染，所以<code>useEffect</code>也不会在重现渲染时执行，也就不会去查看依赖项的变化。</p><h3 id=forwardref>forwardRef<a class=anchorjs-link href=#forwardref></a></h3><p><code>ref</code>的作用是获取示例，但是由于函数组件不存实例，所以无法通过<code>ref</code>获取函数组件的实例引用。这时就可以使用<code>forwardRef</code>来处理，<code>forwardRef</code>会创建一个React组件，这个组件能够接收到<code>ref</code>属性转发到自己的组件树。</p><h4 id=无法直接使用ref引用组件函数>无法直接使用ref引用组件函数<a class=anchorjs-link href=#%e6%97%a0%e6%b3%95%e7%9b%b4%e6%8e%a5%e4%bd%bf%e7%94%a8ref%e5%bc%95%e7%94%a8%e7%bb%84%e4%bb%b6%e5%87%bd%e6%95%b0></a></h4><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleFocus <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.focus()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleFocus}&gt;<span style=color:#d20f39>获取焦点</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      {<span style=color:#9ca0b0;font-style:italic>/* 正常情况下ref会报错 */</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>name</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;username&#39;</span> <span style=color:#1e66f5>placeholder</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;请输入用户名&#39;</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{ref} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>})
</span></span></code></pre></div><p>上述代码会报错，提示是否使用<code>React.forwardRef()</code>。</p><p>基本使用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleFocus <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.focus()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleFocus}&gt;<span style=color:#d20f39>获取焦点</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>name</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;username&#39;</span> <span style=color:#1e66f5>placeholder</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;请输入用户名&#39;</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{ref} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>})
</span></span></code></pre></div><p>上述代码，使用<code>forwardRef</code>包裹原函数组件，会返回一个新的函数组件，此时可以在组件的参数中会传入<code>props</code>和<code>ref</code>，此<code>ref</code>就是转发的之前父组件中的<code>ref</code>。示例中使用该<code>ref</code>获取了子组件中的<code>input</code>元素，并调用实例上的<code>focus()</code>方法获取焦点。</p><h3 id=useimperativehandle>useImperativeHandle<a class=anchorjs-link href=#useimperativehandle></a></h3><p>直接使用<code>ref</code>获取DOM实例，会全面暴露DOM实例上的API，从而导致外部使用<code>ref</code>时过于自由。在实际开发中，需要控制调用的自由度，向外暴露需要的功能函数，其他的功能函数不向外暴露。</p><p><code>useImperativeHandle</code>的目录就是在使用<code>ref</code>时可以自定义暴露的功函数和属性。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>useImperativeHandle(<span style=color:#d20f39>通过</span>forwardRef接收到的父组件的ref对象, () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#d20f39>自定义</span>ref对象, [<span style=color:#d20f39>依赖项数组</span>]) 
</span></span></code></pre></div><ul><li>依赖项数组：可选</li></ul><h5 id=使用useimperatiovehandle按需向外暴露成员>使用useImperatioveHandle按需向外暴露成员<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8useimperatiovehandle%e6%8c%89%e9%9c%80%e5%90%91%e5%a4%96%e6%9a%b4%e9%9c%b2%e6%88%90%e5%91%98></a></h5><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef, useState, useImperativeHandle } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef<span style=color:#04a5e5;font-weight:700>&lt;</span>{ count: <span style=color:#d20f39>number</span>; setCount<span style=color:#04a5e5;font-weight:700>:</span> (count: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span>(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleReset <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.setCount(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleReset}&gt;<span style=color:#d20f39>重置</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  useImperativeHandle(ref, () <span style=color:#04a5e5;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    count,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    setCount
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  }))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#8839ef>const</span> handleClick <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> num)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>})
</span></span></code></pre></div><p>上述代码，使用<code>useImperativeHandle</code>向外暴露了<code>count</code>和<code>setCount</code>。所以父组件可以通过<code>sonRef.current.setCount()</code>来重置子组件的计数。</p><h5 id=控制成员暴露的粒度>控制成员暴露的粒度<a class=anchorjs-link href=#%e6%8e%a7%e5%88%b6%e6%88%90%e5%91%98%e6%9a%b4%e9%9c%b2%e7%9a%84%e7%b2%92%e5%ba%a6></a></h5><p>在上面的代码中，可以将暴露出去的<code>setCount</code>赋其他值而不是重置为0。所以在向外暴露时可以使用<code>useImperativeHandle</code>来向外提供一个<code>reset()</code>方法，而不是直接将<code>setCount</code>暴露出去。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef, useState, useImperativeHandle } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef<span style=color:#04a5e5;font-weight:700>&lt;</span>{ count: <span style=color:#d20f39>number</span>; reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span>(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleReset <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.reset()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleReset}&gt;<span style=color:#d20f39>重置</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  useImperativeHandle(ref, () <span style=color:#04a5e5;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    count,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  }))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#8839ef>const</span> handleClick <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> num)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>})
</span></span></code></pre></div><p>上述代码，直接通过暴露出去的<code>reset()</code>方法，将子组件的计数重置。</p><h4 id=useimperativehandle的第三个参数>useImperativeHandle的第三个参数<a class=anchorjs-link href=#useimperativehandle%e7%9a%84%e7%ac%ac%e4%b8%89%e4%b8%aa%e5%8f%82%e6%95%b0></a></h4><p><code>useImperativeHandle</code>的参数项</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>useImperativeHandle(ref, createHandle, [deps])
</span></span></code></pre></div><ul><li><code>ref</code>：父组件传递的<code>ref</code></li><li><code>createHandle</code>：回调函数，返回的对象会自动绑定到<code>ref</code>上。</li><li><code>deps</code>：函数依赖项，可选值。如<code>createHandle</code>函数中使用到了子组件内部定义的变量，则还需要将该变量作为依赖变量。</li></ul><p>第三个参数的三种用法</p><h5 id=空数组>空数组<a class=anchorjs-link href=#%e7%a9%ba%e6%95%b0%e7%bb%84></a></h5><p>只在子组件被渲染时，执行<code>useImperativeHandle</code>中的回调函数，从而把返回的对象作为父组件接收到的<code>ref</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef, useState, useImperativeHandle } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef<span style=color:#04a5e5;font-weight:700>&lt;</span>{ count: <span style=color:#d20f39>number</span>; reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span>(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleReset <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.reset()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> handleShowRef <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    console.log(sonRef.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleReset}&gt;<span style=color:#d20f39>重置</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleShowRef}&gt;<span style=color:#d20f39>显示</span>Ref&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  useImperativeHandle(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    ref,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      console.log(<span style=color:#40a02b>&#39;useImperativeHandle的回调执行了~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>      <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>        count,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>        reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>    },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>    []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>  <span style=color:#8839ef>const</span> handleClick <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> num)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>})
</span></span></code></pre></div><p>上述代码，<code>useImperativeHandle</code>中回调函数中的打印内容，只会在函数组件首次加载时打印，后续增加、减少、重置<code>count</code>并不会再次打印。</p><h5 id=依赖项数组>依赖项数组<a class=anchorjs-link href=#%e4%be%9d%e8%b5%96%e9%a1%b9%e6%95%b0%e7%bb%84></a></h5><p>子组件首次被渲染时，当依赖项改变时，会执行<code>useImperativeHandle</code>中的回调函数，宠儿让父组件通过<code>ref</code>能拿到依赖项的新值。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef, useState, useImperativeHandle } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef<span style=color:#04a5e5;font-weight:700>&lt;</span>{ count: <span style=color:#d20f39>number</span>; reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span>(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleReset <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.reset()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> handleShowRef <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    console.log(sonRef.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleReset}&gt;<span style=color:#d20f39>重置</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleShowRef}&gt;<span style=color:#d20f39>显示</span>Ref&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  useImperativeHandle(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    ref,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      console.log(<span style=color:#40a02b>&#39;useImperativeHandle的回调执行了~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>      <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>        count,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>        reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>    },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>    [count]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>  <span style=color:#8839ef>const</span> handleClick <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> num)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>})
</span></span></code></pre></div><p>上述代码中，给<code>useImperativeHandle</code>增加了依赖项<code>count</code>，所以每当<code>count</code>值变化时，都会调用<code>useImperativeHandle</code>中的回调函数，执行打印。</p><h5 id=省略依赖项数组>省略依赖项数组<a class=anchorjs-link href=#%e7%9c%81%e7%95%a5%e4%be%9d%e8%b5%96%e9%a1%b9%e6%95%b0%e7%bb%84></a></h5><p>此时组件内任何<code>state</code>的变化都会导致<code>useImperativeHandle</code>中的回调重新执行。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { forwardRef, useState, useImperativeHandle } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> sonRef <span style=color:#04a5e5;font-weight:700>=</span> React.useRef<span style=color:#04a5e5;font-weight:700>&lt;</span>{ count: <span style=color:#d20f39>number</span>; reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span>(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleReset <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    sonRef.current<span style=color:#04a5e5;font-weight:700>?</span>.reset()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> handleShowRef <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    console.log(sonRef.current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Father Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleReset}&gt;<span style=color:#d20f39>重置</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleShowRef}&gt;<span style=color:#d20f39>显示</span>Ref&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>ref</span><span style=color:#04a5e5;font-weight:700>=</span>{sonRef} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> forwardRef((_, ref) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  useImperativeHandle(ref, () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    console.log(<span style=color:#40a02b>&#39;useImperativeHandle的回调执行了~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>    <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>      count,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>      reset<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  <span style=color:#8839ef>const</span> handleClick <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>=&gt;</span> count <span style=color:#04a5e5;font-weight:700>+</span> num)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>  <span style=color:#8839ef>const</span> handleFlag <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>    setFlag(<span style=color:#04a5e5;font-weight:700>!</span>flag)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son Components&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleClick(<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>-</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Flag<span style=color:#04a5e5;font-weight:700>:</span> {<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleFlag}&gt;Change Flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>})
</span></span></code></pre></div><p>上述代码，因为没有给<code>imperativeHandle</code>设置依赖项数组，所以当点击<code>Change Flag</code>按钮时，也会触发<code>imperativeHandle</code>中的回调函数打印，但是并没有向父级暴露<code>flag</code>相关的函数和状态。导致了多次重复调用。</p><h3 id=useeffect>useEffect<a class=anchorjs-link href=#useeffect></a></h3><h4 id=函数的副作用>函数的副作用<a class=anchorjs-link href=#%e5%87%bd%e6%95%b0%e7%9a%84%e5%89%af%e4%bd%9c%e7%94%a8></a></h4><p>函数的副作用就是函数除了返回值外对外界环境造成的其他影响，即与组件渲染无关的操作。如：获取数据、修改全局变量、更新DOM等。</p><p><code>useEffect</code>是React中的hooks API。通过<code>useEffect</code>可以执行一些副作用操作，如：请求数据、事件监听。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>useEffect(fn, deps<span style=color:#04a5e5;font-weight:700>?</span>)
</span></span></code></pre></div><ul><li><code>fn</code>：副作用函数，该函数会在每次渲染完成之后被调用</li><li><code>deps</code>：可选的依赖项数组，这个数组中的每项内容都会用来进行渲染前后的对比<ul><li>当依赖项发生变化时，会重新执行<code>fn</code>副作用函数</li><li>当依赖项没有发生任何变化时，则不会执行<code>fn</code>副作用函数</li></ul></li></ul><h4 id=useeffec的执行时机>useEffec的执行时机<a class=anchorjs-link href=#useeffec%e7%9a%84%e6%89%a7%e8%a1%8c%e6%97%b6%e6%9c%ba></a></h4><p>如果没有为<code>useEffect</code>指定依赖项数组，则**<code>useEffect</code>中的副作用函数，会在组件每次渲染完成后执行**。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#9ca0b0;font-style:italic>// 直接获取count 的dom结构，获取到的count不是最新值，只能拿到新值渲染之前的值
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>  console.log(<span style=color:#40a02b>&#39;count dom :&#39;</span>, <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;#count&#39;</span>)<span style=color:#04a5e5;font-weight:700>?</span>.innerHTML)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#9ca0b0;font-style:italic>// 通过useEffect可以在函数组件每次渲染完成后执行副作用函数，拿到最新的count
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    console.log(<span style=color:#40a02b>&#39;useEffect count dom :&#39;</span>, <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;#count&#39;</span>)<span style=color:#04a5e5;font-weight:700>?</span>.innerHTML)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>id</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;count&#39;</span>&gt;count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>}
</span></span></code></pre></div><p>上述代码，直接在函数组件中使用<code>console.log</code>打印的<code>count</code>，不是最新值，因为打印的是当前count为变更的值，当<code>count</code>更新，函数组件会重新渲染，此时直接打印的函数已经执行完成，所以每次都会打印出旧值。使用<code>useEffect</code>中的打印，省略了后面的依赖项数组，所以在函数组件每次重新渲染完成后，会执行一次，实现对新值的打印。</p><h4 id=deps依赖项数组>deps依赖项数组<a class=anchorjs-link href=#deps%e4%be%9d%e8%b5%96%e9%a1%b9%e6%95%b0%e7%bb%84></a></h4><p>如果需要根据条件触发副作用函数的执行，则需要通过<code>deps</code>数组指定依赖项。</p><p>React会在组件每次渲染完成后，对比渲染前后的每一个依赖项是否发生了变化，只要任何一个依赖项发生了变化，都会触发副作用函数的重新执行。如果所有依赖项在渲染前后都没有发生变化，则不会触发副作用函数的执行。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>const</span> handleFlag <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  <span style=color:#9ca0b0;font-style:italic>// 通过useEffect可以在函数组件每次渲染完成后执行副作用函数，拿到最新的count
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    console.log(<span style=color:#40a02b>&#39;副作用函数执行了~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  }, [count])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;{<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleFlag}&gt;change flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>}
</span></span></code></pre></div><p>上述代码，指定了<code>useEffect</code>的依赖项是<code>count</code>，所以在点击<code>+1</code>的按钮时，会执行<code>useEffect</code>中的打印。但是，点击<code>change flag</code>按钮，则不会执行<code>useEffect</code>中的副作用函数打印。</p><h4 id=deps依赖项为空数组>deps依赖项为空数组<a class=anchorjs-link href=#deps%e4%be%9d%e8%b5%96%e9%a1%b9%e4%b8%ba%e7%a9%ba%e6%95%b0%e7%bb%84></a></h4><p>如果<code>useEffect</code>指定了一个空数组<code>[]</code>作为<code>deps</code>依赖项，则副作用函数只会在组件首次渲染完成后执行唯一的一次。组件重新渲染时不会再次出发副作用函数的重新执行。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Counter <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> handleAdd <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>const</span> handleFlag <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  <span style=color:#9ca0b0;font-style:italic>// 通过useEffect可以在函数组件每次渲染完成后执行副作用函数，拿到最新的count
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    console.log(<span style=color:#40a02b>&#39;副作用函数执行了~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Counter&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;{<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAdd}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleFlag}&gt;change flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>}
</span></span></code></pre></div><p>上述代码中，<code>useEffect</code>指定了一个空数组作为依赖项，所以只在组件初次渲染时，执行了副作用函数中的打印。点击<code>+1</code>和<code>change flag</code>按钮，修改<code>count</code>和<code>flag</code>的状态，造成的组件重新渲染，并不会执行<code>useEffect</code>中的副作用函数。</p><h4 id=useeffect使用注意事项>useEffect使用注意事项<a class=anchorjs-link href=#useeffect%e4%bd%bf%e7%94%a8%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9></a></h4><ol><li><p>不要在<code>useEffect</code>中改变依赖项的值，会造成死循环</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Count <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#9ca0b0;font-style:italic>// 函数组件重新渲染后，比较依赖项数组中的count变化后，计数+1，造成组件再次渲染，再次计数，进入死循环
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  }, [count])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Count组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span></code></pre></div></li><li><p>多个不同功能的副作用尽量分开声明，不要写到一个<code>useEffect</code>中</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Count <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    <span style=color:#8839ef>const</span> countElem <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;p&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    console.log(<span style=color:#40a02b>&#39;count dom元素：&#39;</span>, countElem)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  }, [count])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    <span style=color:#8839ef>const</span> flagElem <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;span&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    console.log(<span style=color:#40a02b>&#39;flag dom元素：&#39;</span>, flagElem)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  }, [flag])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Count组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;<span style=color:#04a5e5;font-weight:700>+</span><span style=color:#fe640b>1</span>&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>span</span>&gt;Flag<span style=color:#04a5e5;font-weight:700>:</span> {<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>span</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)}&gt;change flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span></code></pre></div></li></ol><p>​ 上述代码，不要将<code>count</code>和<code>flag</code>写到同一个<code>useEffect</code>中，会造成不必要的渲染，最好分开，根据各自的依赖项单独进行副作用处理。</p><h4 id=清理副作用>清理副作用<a class=anchorjs-link href=#%e6%b8%85%e7%90%86%e5%89%af%e4%bd%9c%e7%94%a8></a></h4><p><code>useEffect</code>可以返回一个函数，用于清除副作用的回调。</p><p><code>useEffect</code>副作用清理函数触发的时机：</p><ul><li>当函数组件首次渲染后，<code>useEffect</code>执行之前，React会自动检查是否有清理的回调，如果有则执行清理函数</li><li>当组件被卸载时，也会检查是否有清理函数，如果有也会调用</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>interface</span> User {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>  name: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  phone: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> UserInfo <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> [user, setUser] <span style=color:#04a5e5;font-weight:700>=</span> useState&lt;<span style=color:#8839ef>User</span>&gt;({ name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;&#39;</span>, phone<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#8839ef>const</span> controller <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> AbortController()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    fetch(<span style=color:#40a02b>&#39;https://jsonplaceholder.typicode.com/users/1&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      signal: <span style=color:#d20f39>controller.signal</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      .then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> res.json())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      .then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>        setUser({ name: <span style=color:#d20f39>res.name</span>, phone: <span style=color:#d20f39>res.phone</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      .<span style=color:#8839ef>catch</span>(err <span style=color:#04a5e5;font-weight:700>=&gt;</span> console.log(<span style=color:#40a02b>&#39;error: &#39;</span>, err))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> controller.abort()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;User组件&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Username<span style=color:#04a5e5;font-weight:700>:</span> {user<span style=color:#04a5e5;font-weight:700>?</span>.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {user<span style=color:#04a5e5;font-weight:700>?</span>.phone}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>}
</span></span></code></pre></div><p>上述代码，在组件<code>Us二Info</code>被移除后，会自动执行清理函数，终止副作用函数中的数据请求。</p><p>练习：</p><p>获取鼠标在网页中移动时的位置，在移除组件时同时移除鼠标位置监听</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MousePosition <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [position, setPosition] <span style=color:#04a5e5;font-weight:700>=</span> useState({ x: <span style=color:#d20f39>0</span>, y: <span style=color:#d20f39>0</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#8839ef>const</span> handleMouseMove <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>MouseEvent</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>      setPosition({ x: <span style=color:#d20f39>e.clientX</span>, y: <span style=color:#d20f39>e.clientY</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    addEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      removeEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  console.log(<span style=color:#40a02b>&#39;mouse position: &#39;</span>, position)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;<span style=color:#d20f39>鼠标位置</span>&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;x<span style=color:#04a5e5;font-weight:700>:</span> {position.x}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;y<span style=color:#04a5e5;font-weight:700>:</span> {position.y}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MouseWrap <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)}&gt;toggle&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>      {flag <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>MousePosition</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>}
</span></span></code></pre></div><p>上述代码，在加载后在网页中移动鼠标可以在页面中打印鼠标的坐标位置，当点击<code>toggle</code>按钮后，销毁了<code>MousePosition</code>组件，同时也移除了对鼠标的监听。</p><p>给打印鼠标做节流效果</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MousePosition <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [position, setPosition] <span style=color:#04a5e5;font-weight:700>=</span> useState({ x: <span style=color:#d20f39>0</span>, y: <span style=color:#d20f39>0</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#d20f39>let</span> timeId: <span style=color:#d20f39>null</span> <span style=color:#04a5e5;font-weight:700>|</span> NodeJS.Timeout <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    <span style=color:#8839ef>const</span> handleMouseMove <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>MouseEvent</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      <span style=color:#8839ef>if</span> (timeId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>null</span>) <span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>      timeId <span style=color:#04a5e5;font-weight:700>=</span> setTimeout(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>        setPosition({ x: <span style=color:#d20f39>e.clientX</span>, y: <span style=color:#d20f39>e.clientY</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>        timeId <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      }, <span style=color:#fe640b>500</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    addEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      removeEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  console.log(<span style=color:#40a02b>&#39;mouse position: &#39;</span>, position)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;<span style=color:#d20f39>鼠标位置</span>&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;x<span style=color:#04a5e5;font-weight:700>:</span> {position.x}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;y<span style=color:#04a5e5;font-weight:700>:</span> {position.y}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MouseWrap <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)}&gt;toggle&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>      {flag <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>MousePosition</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>}
</span></span></code></pre></div><p>上述代码中，在<code>useEffect</code>中，定义了一个<code>timeId</code>作为执行的标识。设置<code>handleMouseMove</code>函数中，如果遇到了<code>timeId</code>不为<code>null</code>的情况就不执行该函数。然后将<code>setTimeout</code>的返回值传递给<code>timeId</code>，一旦<code>setTimeout</code>执行，就会返回一个值给<code>timeId</code>。这样就可以阻止在<code>timeout</code>设置的时间内继续执行该函数。如果执行了该函数，则在函数内将<code>timeId</code>设置为<code>null</code>。以便下次重新检测函数是否为<code>null</code>是否继续执行。</p><h4 id=自定义hooks封装打印鼠标位置函数>自定义hooks封装打印鼠标位置函数<a class=anchorjs-link href=#%e8%87%aa%e5%ae%9a%e4%b9%89hooks%e5%b0%81%e8%a3%85%e6%89%93%e5%8d%b0%e9%bc%a0%e6%a0%87%e4%bd%8d%e7%bd%ae%e5%87%bd%e6%95%b0></a></h4><p>自定义hooks需要遵循React的hooks规则：</p><ol><li>只在最顶层使用hook。不要在循环、条件或嵌套函数中调用hook。</li><li>只在函数组件中使用hook。</li><li>自定义hook，需要使用<code>use</code>作为开头，使用大写首字母跟在<code>use</code>之后。</li></ol><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> useMousePosition <span style=color:#04a5e5;font-weight:700>=</span> (delay: <span style=color:#d20f39>number</span> <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>0</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [position, setPosition] <span style=color:#04a5e5;font-weight:700>=</span> useState({ x: <span style=color:#d20f39>0</span>, y: <span style=color:#d20f39>0</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    <span style=color:#d20f39>let</span> timeId: <span style=color:#d20f39>null</span> <span style=color:#04a5e5;font-weight:700>|</span> NodeJS.Timeout <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    <span style=color:#8839ef>const</span> handleMouseMove <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>MouseEvent</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      <span style=color:#8839ef>if</span> (timeId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>null</span>) <span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>      timeId <span style=color:#04a5e5;font-weight:700>=</span> setTimeout(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>        setPosition({ x: <span style=color:#d20f39>e.clientX</span>, y: <span style=color:#d20f39>e.clientY</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>        timeId <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      }, delay)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    addEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      removeEventListener(<span style=color:#40a02b>&#39;mousemove&#39;</span>, handleMouseMove)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  }, [delay])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  console.log(<span style=color:#40a02b>&#39;mouse position: &#39;</span>, position)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  <span style=color:#8839ef>return</span> position
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>}
</span></span></code></pre></div><p>然后再到组件页面调用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { useMousePosition } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/hooks&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MousePosition <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>const</span> position <span style=color:#04a5e5;font-weight:700>=</span> useMousePosition(<span style=color:#fe640b>200</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;<span style=color:#d20f39>鼠标位置</span>&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;x<span style=color:#04a5e5;font-weight:700>:</span> {position.x}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;y<span style=color:#04a5e5;font-weight:700>:</span> {position.y}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MouseWrap <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  <span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#04a5e5;font-weight:700>!</span>prev)}&gt;toggle&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      {flag <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>MousePosition</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>}
</span></span></code></pre></div><p>使用效果，同定义在组件内一样，但灵活性更好。</p><h4 id=自定义封装秒数倒计时hook>自定义封装秒数倒计时hook<a class=anchorjs-link href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%b0%81%e8%a3%85%e7%a7%92%e6%95%b0%e5%80%92%e8%ae%a1%e6%97%b6hook></a></h4><p>要求：</p><ol><li>调用<code>useCountDown(3)</code>的<code>hook</code>，可以传递倒计时的秒数，如未指定秒数则默认为10秒</li><li>在<code>useCountDown()</code>中，需要对用户传入的数字进行非法值的判断和处理（负数、小数、零）</li><li>每隔1秒让秒数-1，并使用布尔值记录按钮是否禁用</li><li>以数组的形式向外返回每次的秒数和当前的禁用状态</li></ol><p>示例：</p><p>先定义hooks，然后在组件中调用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic>// 定义hooks类型，导出数组中的类型
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>type</span> useCountDownType <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> [<span style=color:#d20f39>number</span>, <span style=color:#8839ef>boolean</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> useCountDown: <span style=color:#d20f39>useCountDownType</span> <span style=color:#04a5e5;font-weight:700>=</span> (num: <span style=color:#d20f39>number</span> <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>10</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#9ca0b0;font-style:italic>// 对用户传入的数组进行处理，round四舍五入 abs绝对值 为0则默认为10秒
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#8839ef>const</span> seconds <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Math</span>.round(<span style=color:#04a5e5>Math</span>.abs(num)) <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#fe640b>10</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(seconds)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> [disabled, setDisabled] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    <span style=color:#8839ef>const</span> timer <span style=color:#04a5e5;font-weight:700>=</span> setTimeout(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      <span style=color:#9ca0b0;font-style:italic>// 判断如果计数大于1则减1，否则结束计算并设置disabled为false
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span>      <span style=color:#8839ef>if</span> (count <span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#fe640b>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>        setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>-</span> <span style=color:#fe640b>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>        clearTimeout(timer)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>        setDisabled(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    }, <span style=color:#fe640b>1000</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>		<span style=color:#9ca0b0;font-style:italic>// 如果结束则销毁计数
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#8839ef>return</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> clearTimeout(timer)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  }, [count])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  <span style=color:#8839ef>return</span> [count, disabled]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span></code></pre></div><p>在组件中使用该hooks</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useCountDown } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/hooks&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> CountDown <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [count, disabled] <span style=color:#04a5e5;font-weight:700>=</span> useCountDown(<span style=color:#fe640b>5</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>disabled</span><span style=color:#04a5e5;font-weight:700>=</span>{disabled} <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> console.log(<span style=color:#40a02b>&#39;确认协议&#39;</span>)}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>        {disabled <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>`请阅读本协议（</span><span style=color:#40a02b>${</span>count<span style=color:#40a02b>}</span><span style=color:#40a02b>秒）`</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;请确认协议&#39;</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      &lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> CountDown
</span></span></code></pre></div><h3 id=uselayouteffect>useLayoutEffect<a class=anchorjs-link href=#uselayouteffect></a></h3><p><code>useLayoutEffect</code>和<code>useEffect</code>用法相似：</p><ul><li><code>useLayoutEffect</code>接收一个函数和一个依赖项数组作为参数</li><li>只有依赖项书中发生变化时才会再次执行副作用函数</li><li><code>useLayoutEffect</code>也可以返回一个清理函数</li></ul><p><code>useLayoutEffect</code>和<code>useEffect</code>的区别：</p><ul><li>执行时机不同：<ul><li><code>useEffect</code>中的回调函数在浏览器重新渲染<strong>之后</strong>触发</li><li><code>useLayoutEffect</code>中的回调函数在浏览器重新渲染<strong>之前</strong>触发</li></ul></li><li>执行过程不同：<ul><li><code>useEffect</code>中的回调函数异步执行，不阻塞浏览器重新渲染</li><li><code>useLayoutEffect</code>中的回调函数同步执行，阻塞浏览器重新渲染</li></ul></li></ul><p>示例：</p><p>设置一个随机数<code>num</code>，当点击按钮时设置<code>num</code>为0。通过副作用判断当<code>num</code>为0时，生成一个新的随机数。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, useEffect, useLayoutEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> LayoutEffect <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  <span style=color:#8839ef>const</span> [num, setNum] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#04a5e5>Math</span>.random() <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>200</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#9ca0b0;font-style:italic>// 使用useEffect会先执行按钮点击将num设置为0，然后在执行useEffect的判断将num设置为新的随机数，造成页面闪烁
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>// useEffect(() =&gt; {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>//   if (num === 0) {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>//     setNum(Math.random() + 300)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>//   }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#9ca0b0;font-style:italic>// }, [num])
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#9ca0b0;font-style:italic>// 使用useLayoutEffect会在渲染之前进行判断，如果num为0则将num设置为新的随机数，然后在渲染所以不会造成页面闪烁
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>  useLayoutEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    <span style=color:#8839ef>if</span> (num <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      setNum(<span style=color:#04a5e5>Math</span>.random() <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>400</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  }, [num])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;useEffect和useLayoutEffect的区别&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Num<span style=color:#04a5e5;font-weight:700>:</span> {num}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setNum(<span style=color:#fe640b>0</span>)}&gt;setNum&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> LayoutEffect
</span></span></code></pre></div><p>上述代码，使用<code>useEffect</code>会先渲染出0，然后在根据副作用渲染出新的随机数。而使用<code>useLayoutEffect</code>则会在渲染之前就进行判断是否为0，在进行渲染，会比<code>useEffect</code>提前判断，并少一次重新渲染。</p><h3 id=usereducer>useReducer<a class=anchorjs-link href=#usereducer></a></h3><p>当状态更新逻辑比较复杂时，可以使用<code>useReducer</code>。<code>useReducer</code>可以同时更新多个状态，并且能把状态的修改从组件中独立出来。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> [state, dispatch] <span style=color:#04a5e5;font-weight:700>=</span> useReducer(reducer, initState, initAction<span style=color:#04a5e5;font-weight:700>?</span>)
</span></span></code></pre></div><ul><li><code>reducer</code>：是一个函数，用来处理状态，结构类似于<code>(prevState, action) => newState</code>。形参<code>prevState</code>表示旧状态，形参<code>action</code>表示的本次的行为，返回值<code>newState</code>，表示处理完成后的新状态。</li><li><code>initState</code>：表示初始状态，也就是默认值</li><li><code>initAction</code>：表示初始状态的处理函数，可选。相当于对初始函数做个预处理，处理后的初始状态会当做新的初始状态传递给<code>state</code>。</li><li><code>state</code>：状态值。默认如果有<code>initAction</code>，则为<code>initAction</code>处理后的状态值，否则为默认的<code>initState</code>状态值。</li><li><code>dispatch</code>：更新<code>state</code>的方法，接收<code>action</code>作为参数，<code>useReducer</code>只需要调用<code>dispatch(action)</code>方法传入的<code>action</code>即可更新<code>state</code></li></ul><p>理解<code>useReducer</code>：</p><ul><li><code>useReducer</code>的<code>reducer</code>可以通过<code>action</code>中的<code>type</code>来识别需要通过什么类型来实现什么动作。如：通过<code>type: 'UPDATE'</code>这个类型，来执行更新函数。</li><li>可以通过<code>action</code>中的<code>payload</code>来传递<code>UPDATE</code>类型函数的参数。并且会根据类型传递对应的参数。如：<code>UPDATE</code>是修改名称，那么<code>payload</code>就可以传递字符串修改的名称。如果<code>UPDATE</code>是修改年龄，那么<code>payload</code>就可以传递数值修改年龄。</li><li>所有操作<code>state</code>的动作<code>action</code>都放在<code>reducer</code>中。</li><li><code>initState</code>是初始值，<code>initAction</code>是用来预处理初始值的函数，主要用来处理一些边际问题，如：需要设置初始的年龄，但是不能小于1，不能是负数、小数等，就可以通过这个函数来处理，<code>initAction</code>是可选的，如果没有这个函数，那么默认的<code>state</code>就是<code>initState</code>。</li><li><code>dispatch</code>是一个触发器，通过<code>action.type</code>来触发对应的动作。以及通过<code>action.payload</code>传递对应的参数。</li></ul><p>示例：</p><ul><li>通过<code>Father</code>组件，修改用户的名称</li><li>通过<code>Son1</code>组件，增加用户的年龄</li><li>通过<code>Son2</code>组件，减少用户的年龄</li><li>通过<code>GrandSon</code>组件，重置用户的年龄</li></ul><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#8839ef>import</span> React, { useReducer } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span><span style=color:#8839ef>const</span> defaultState <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span>  name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;jacky&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span>  age: <span style=color:#d20f39>0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span><span style=color:#9ca0b0;font-style:italic>// initState的初始用户值类型
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>type</span> UserType <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>typeof</span> defaultState
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span><span style=color:#9ca0b0;font-style:italic>// initAction的初始动作类型，如果不需要传递参数，可以不用payload
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>type</span> ActionType <span style=color:#04a5e5;font-weight:700>=</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span>  <span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span>      <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span>      payload: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>  <span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span>      <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span>      payload: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span>  <span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>      <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span>      payload: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>  <span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>      <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;RESET&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span><span style=color:#9ca0b0;font-style:italic>// 状态处理函数，参数接收状态值和动作，可以根据动作类型匹配对应的操作返回结果
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> reducer <span style=color:#04a5e5;font-weight:700>=</span> (state: <span style=color:#d20f39>UserType</span>, action: <span style=color:#d20f39>ActionType</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>  <span style=color:#8839ef>switch</span> (action.<span style=color:#8839ef>type</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>      <span style=color:#8839ef>return</span> { ...state, name: <span style=color:#d20f39>action.payload</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span>      <span style=color:#8839ef>return</span> { ...state, age: <span style=color:#d20f39>state.age</span> <span style=color:#04a5e5;font-weight:700>+</span> action.payload }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>      <span style=color:#8839ef>return</span> { ...state, age: <span style=color:#d20f39>state.age</span> <span style=color:#04a5e5;font-weight:700>-</span> action.payload }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;RESET&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span>      <span style=color:#8839ef>return</span> { ...defaultState, age: <span style=color:#d20f39>defaultState.age</span> <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>0</span> <span style=color:#04a5e5;font-weight:700>?</span> 18 : <span style=color:#d20f39>defaultState.age</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>    <span style=color:#8839ef>default</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>      <span style=color:#8839ef>return</span> state
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span><span style=color:#9ca0b0;font-style:italic>// 初始值的初始处理函数，将年龄限制为不能为负数、不能为小数、不能为0，如为0，则表示为false使用或为18
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> initAction <span style=color:#04a5e5;font-weight:700>=</span> (initState: <span style=color:#d20f39>UserType</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>  <span style=color:#8839ef>return</span> { ...initState, age: <span style=color:#d20f39>Math.round</span>(<span style=color:#04a5e5>Math</span>.abs(initState.age)) <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#fe640b>18</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>  <span style=color:#8839ef>const</span> [state, dispatch] <span style=color:#04a5e5;font-weight:700>=</span> useReducer(reducer, defaultState, initAction)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>  <span style=color:#8839ef>const</span> handleUpdateUser <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span>    dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span>, payload<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;sim&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;useReducer&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {state.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {state.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleUpdateUser}&gt;Change name&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>      &lt;<span style=color:#8839ef>Son1</span> {<span style=color:#1e66f5>...state</span>} <span style=color:#1e66f5>dispatch</span><span style=color:#04a5e5;font-weight:700>=</span>{dispatch} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span>      &lt;<span style=color:#8839ef>Son2</span> {<span style=color:#1e66f5>...state</span>} <span style=color:#1e66f5>dispatch</span><span style=color:#04a5e5;font-weight:700>=</span>{dispatch} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span><span style=color:#9ca0b0;font-style:italic>// 通过props接收父级传递的state和dispatch，所以需要通过泛型传递一个交叉类型
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son1: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>UserType</span> <span style=color:#d20f39>&amp;</span> { <span style=color:#1e66f5>dispatch</span><span style=color:#d20f39>:</span> <span style=color:#1e66f5>React.Dispatch</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>ActionType</span>&gt; }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span>  <span style=color:#8839ef>const</span> handleAddAge <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span>    props.dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span>, payload: <span style=color:#d20f39>2</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son1&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {props.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {props.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAddAge}&gt;Add age&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son2: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>UserType</span> <span style=color:#d20f39>&amp;</span> { <span style=color:#1e66f5>dispatch</span><span style=color:#d20f39>:</span> <span style=color:#1e66f5>React.Dispatch</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>ActionType</span>&gt; }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span>  <span style=color:#8839ef>const</span> handleSubAge <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>    props.dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span>, payload: <span style=color:#d20f39>2</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Son2&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {props.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {props.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleSubAge}&gt;Sub age&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span>      &lt;<span style=color:#8839ef>GrandSon</span> <span style=color:#1e66f5>dispatch</span><span style=color:#04a5e5;font-weight:700>=</span>{props.dispatch} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">102</span><span><span style=color:#9ca0b0;font-style:italic>// 因为GrandSon只从Son2组件中接收一个dispatch，所以只有一个props类型
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">103</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> GrandSon: <span style=color:#d20f39>React.FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ dispatch: <span style=color:#d20f39>React.Dispatch</span>&lt;<span style=color:#8839ef>ActionType</span>&gt; }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">104</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">105</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">106</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Grand Son&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">107</span><span>      &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> props.dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;RESET&#39;</span> })}&gt;Reset&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">108</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">109</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">110</span><span>}
</span></span></code></pre></div><h4 id=使用immer处理让usereducer更简洁>使用immer处理让useReducer更简洁<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8immer%e5%a4%84%e7%90%86%e8%ae%a9usereducer%e6%9b%b4%e7%ae%80%e6%b4%81></a></h4><p>安装：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add immer use-immer
</span></span></code></pre></div><ol><li>从<code>use-immer</code>中导入<code>useImmerReducer</code>替换React中的<code>useReducer</code></li><li>修改原来的<code>reducer</code>函数</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { useImmerReducer } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;use-immer&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> reducer <span style=color:#04a5e5;font-weight:700>=</span> (state: <span style=color:#d20f39>UserType</span>, action: <span style=color:#d20f39>ActionType</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>switch</span> (action.<span style=color:#8839ef>type</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      <span style=color:#9ca0b0;font-style:italic>// return { ...state, name: action.payload }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>      state.name <span style=color:#04a5e5;font-weight:700>=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      <span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>      <span style=color:#9ca0b0;font-style:italic>// return { ...state, age: state.age + action.payload }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>      state.age <span style=color:#04a5e5;font-weight:700>+=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      <span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      <span style=color:#9ca0b0;font-style:italic>// return { ...state, age: state.age - action.payload }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>      state.age <span style=color:#04a5e5;font-weight:700>-=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      <span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    <span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;RESET&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      <span style=color:#9ca0b0;font-style:italic>// return { ...defaultState, age: defaultState.age === 0 ? 18 : defaultState.age }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      <span style=color:#8839ef>return</span> initAction(defaultState)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    <span style=color:#8839ef>default</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      <span style=color:#8839ef>return</span> state
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>}
</span></span></code></pre></div><p>上述代码修改后，实现的功能与之前一致，并在处理的action函数中更简洁。在<code>case</code>代码块中，不需要在<code>return</code>不可变的新对象，只需要在<code>state</code>的基础上进行修改，<code>immer</code>内部会复制并返回新对象。</p><h3 id=usecontext>useContext<a class=anchorjs-link href=#usecontext></a></h3><p>在React函数组件中，如果组件嵌套层级很深，当父组件想把共享给最深层的子组件时，传统的办法是使用<code>props</code>一层层把数据向下传递，但使用<code>props</code>层层传递维护性差，可以使用<code>useContext</code>来实现多层组件的数据传递。</p><h4 id=usecontext步骤和结构>useContext步骤和结构<a class=anchorjs-link href=#usecontext%e6%ad%a5%e9%aa%a4%e5%92%8c%e7%bb%93%e6%9e%84></a></h4><p>步骤：</p><ul><li>在全局创建<code>Context</code>对象</li><li>在父组件使用<code>Context.Provider</code>提供数据</li><li>在子组件中使用<code>useContext</code>使用数据</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useContext } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> UserType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  name: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  age: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> MyContext <span style=color:#04a5e5;font-weight:700>=</span> React.createContext&lt;<span style=color:#8839ef>UserType</span>&gt;({} <span style=color:#8839ef>as</span> UserType)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    &lt;<span style=color:#8839ef>MyContext.Provider</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{{ name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;jacky&#39;</span>, age: <span style=color:#d20f39>12</span> }}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      &lt;<span style=color:#8839ef>Son</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    &lt;/<span style=color:#8839ef>MyContext.Provider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>const</span> ctx <span style=color:#04a5e5;font-weight:700>=</span> useContext(MyContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;{ctx.name}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;{ctx.age}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span></code></pre></div><p>示例：</p><p>使用<code>useContext</code>传递<code>count</code>和<code>setCount</code>到孙组件中使用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useContext } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> LevelContextType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  count: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  setCount: <span style=color:#d20f39>React.Dispatch</span>&lt;<span style=color:#8839ef>React.SetStateAction</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>number</span>&gt;<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> AppContext <span style=color:#04a5e5;font-weight:700>=</span> React.createContext&lt;<span style=color:#8839ef>LevelContextType</span>&gt;({} <span style=color:#8839ef>as</span> LevelContextType)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelA <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Level A&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Level A Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      &lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      &lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      &lt;<span style=color:#8839ef>AppContext.Provider</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{{ count, setCount }}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>        &lt;<span style=color:#8839ef>LevelB</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;/<span style=color:#8839ef>AppContext.Provider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelB <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Level B&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      &lt;<span style=color:#8839ef>LevelC</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelC <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  <span style=color:#8839ef>const</span> ctx <span style=color:#04a5e5;font-weight:700>=</span> useContext(AppContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>    &lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>      &lt;<span style=color:#8839ef>h1</span>&gt;Level C&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>      &lt;<span style=color:#8839ef>div</span>&gt;Level C Count<span style=color:#04a5e5;font-weight:700>:</span> {ctx.count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>      &lt;<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>        &lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> ctx.setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>      &lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>    &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>}
</span></span></code></pre></div><p>上述代码，通过<code>React.createContext</code>定义好<code>AppContext</code>，在<code>LevelA</code>中包裹子组件<code>LevelB</code>，将<code>count</code>和<code>setCount</code>向下级传递，并在<code>LevelC</code>中使用<code>useContext</code>调用。</p><h4 id=使用非侵入方式使用contextprovider>使用非侵入方式使用Context.Provider<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e9%9d%9e%e4%be%b5%e5%85%a5%e6%96%b9%e5%bc%8f%e4%bd%bf%e7%94%a8contextprovider></a></h4><p>问题：</p><p>上述代码中父组件<code>LevelA</code>为了向下共享数据，在代码中侵入了<code>&lt;AppContext.Provider></code>这样的组件代码。为了保证组件代码中的单一性，也为了提高<code>Provider</code>的通用性，需要把<code>Context.Provider</code>封装到一个独立的函数组件中</p><p>修改：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useContext } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> LevelContextType <span style=color:#04a5e5;font-weight:700>=</span> { count: <span style=color:#d20f39>number</span>; setCount: <span style=color:#d20f39>React.Dispatch</span>&lt;<span style=color:#8839ef>React.SetStateAction</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>number</span>&gt;<span style=color:#04a5e5;font-weight:700>&gt;</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> LevelContext <span style=color:#04a5e5;font-weight:700>=</span> React.createContext&lt;<span style=color:#8839ef>LevelContextType</span>&gt;({} <span style=color:#8839ef>as</span> LevelContextType)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelContextWrapper: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>React.PropsWithChildren</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>LevelContext.Provider</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{{ count, setCount }}&gt;{props.children}&lt;/<span style=color:#8839ef>LevelContext.Provider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelA <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	<span style=color:#8839ef>const</span> ctx <span style=color:#04a5e5;font-weight:700>=</span> useContext(LevelContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Level A&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Level A Count<span style=color:#04a5e5;font-weight:700>:</span> {ctx.count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> ctx.setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			&lt;<span style=color:#8839ef>LevelB</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelB <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Level B&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>			&lt;<span style=color:#8839ef>LevelC</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> LevelC <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>	<span style=color:#8839ef>const</span> ctx <span style=color:#04a5e5;font-weight:700>=</span> useContext(LevelContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>		&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Level C&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Level C Count<span style=color:#04a5e5;font-weight:700>:</span> {ctx.count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> ctx.setCount(prev <span style=color:#04a5e5;font-weight:700>=&gt;</span> prev <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>}
</span></span></code></pre></div><p>上述代码中，单独封装了一个<code>LevelContextWrapper</code>的函数组件并和<code>LevelA</code>一起导出，在<code>App.tsx</code>中使用<code>&lt;LevelContextWrapper>&lt;LevelA />&lt;/LevelContextWrapper></code>进行包裹。在<code>LevelContextWrapper</code>中定义需要传递的<code>count</code>和<code>setCount</code>。通过<code>useContext</code>在需要的组件中调用。</p><p>如果后续还有需要使用<code>count</code>和<code>setCount</code>的组件，只需要将组件放到<code>&lt;LevelContextWrapper>需要包裹的组件&lt;/LevelContextWrapper></code>中进行包裹，就可以通过<code>useContext</code>拿到对应的变量和方法。</p><h4 id=使用usecontext重构usereducer中的案例>使用useContext重构useReducer中的案例<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8usecontext%e9%87%8d%e6%9e%84usereducer%e4%b8%ad%e7%9a%84%e6%a1%88%e4%be%8b></a></h4><p>之前<code>useReducer</code>的案例中需要通过父组件层层向下传递<code>state</code>和<code>dispatch</code>非常的麻烦。通过<code>context</code>和<code>reducer</code>可以当做一个简单的<code>store</code>来管理需要共享的数据了。</p><p>之前所有代码都写到了一个页面上，为了更符合实际开发情况，将<code>useReducer</code>和<code>wrapper</code>的部分拆分到一个独立的<code>Store</code>页面。界面业务部分还是保持多个组件嵌套。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/components/use-context/Store.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> React <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { useImmerReducer } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;use-immer&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>type</span> UserType <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>typeof</span> defaultState
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>type</span> ActionType <span style=color:#04a5e5;font-weight:700>=</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>			<span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>			payload: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>			<span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			payload: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			<span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			payload: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	<span style=color:#04a5e5;font-weight:700>|</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			<span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;RESET&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic>// 添加需要通过Provider导出的数据类型
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>type</span> UserContextType <span style=color:#04a5e5;font-weight:700>=</span> { user: <span style=color:#d20f39>UserType</span>; dispatch: <span style=color:#d20f39>React.Dispatch</span>&lt;<span style=color:#8839ef>ActionType</span>&gt; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#8839ef>const</span> defaultState <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	name<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;jacky&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>	age: <span style=color:#d20f39>0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span><span style=color:#8839ef>const</span> reducer <span style=color:#04a5e5;font-weight:700>=</span> (state: <span style=color:#d20f39>UserType</span>, action: <span style=color:#d20f39>ActionType</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>	<span style=color:#8839ef>switch</span> (action.<span style=color:#8839ef>type</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>		<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>			state.name <span style=color:#04a5e5;font-weight:700>=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>			<span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>		<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>			state.age <span style=color:#04a5e5;font-weight:700>+=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>			<span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>		<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			state.age <span style=color:#04a5e5;font-weight:700>-=</span> action.payload
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>			<span style=color:#8839ef>break</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>		<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;RESET&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>			<span style=color:#8839ef>return</span> initAction(defaultState)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		<span style=color:#8839ef>default</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>			<span style=color:#8839ef>return</span> state
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span><span style=color:#8839ef>const</span> initAction <span style=color:#04a5e5;font-weight:700>=</span> (initState: <span style=color:#d20f39>UserType</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>	<span style=color:#8839ef>return</span> { ...initState, age: <span style=color:#d20f39>Math.round</span>(<span style=color:#04a5e5>Math</span>.abs(initState.age)) <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#fe640b>18</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span><span style=color:#9ca0b0;font-style:italic>// 需要将UserContext导出提供给组件页面通过`useContext`进行调用
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> UserContext <span style=color:#04a5e5;font-weight:700>=</span> React.createContext&lt;<span style=color:#8839ef>UserContextType</span>&gt;({} <span style=color:#8839ef>as</span> UserContextType)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span><span style=color:#9ca0b0;font-style:italic>// 导出到App页面包裹父组件，向下传递数据
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> UserContextWrapper: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>React.PropsWithChildren</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> ({ children }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>	<span style=color:#8839ef>const</span> [state, dispatch] <span style=color:#04a5e5;font-weight:700>=</span> useImmerReducer(reducer, defaultState, initAction)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>UserContext.Provider</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{{ user: <span style=color:#d20f39>state</span>, dispatch }}&gt;{children}&lt;/<span style=color:#8839ef>UserContext.Provider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>}
</span></span></code></pre></div><p>上述代码，使用<code>context</code>封装<code>reducer</code>，将<code>useImmerReducer</code>返回的<code>state</code>和<code>dispatch</code>，添加到<code>UserContext.Provider</code>中，向子组件传递。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useContext } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { UserContext } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;./Store&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> { user, dispatch } <span style=color:#04a5e5;font-weight:700>=</span> useContext(UserContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> handleUpdateUser <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;UPDATE_NAME&#39;</span>, payload<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;sim&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;useReducer&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {user.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {user.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleUpdateUser}&gt;Change name&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>Son1</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>			&lt;<span style=color:#8839ef>Son2</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son1: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	<span style=color:#8839ef>const</span> { user, dispatch } <span style=color:#04a5e5;font-weight:700>=</span> useContext(UserContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>	<span style=color:#8839ef>const</span> handleAddAge <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>		dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;INCREAMENT&#39;</span>, payload: <span style=color:#d20f39>2</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Son1&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {user.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {user.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>			&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleAddAge}&gt;Add age&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son2: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>	<span style=color:#8839ef>const</span> { user, dispatch } <span style=color:#04a5e5;font-weight:700>=</span> useContext(UserContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>	<span style=color:#8839ef>const</span> handleSubAge <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;DECREAMENT&#39;</span>, payload: <span style=color:#d20f39>2</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Son2&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Name<span style=color:#04a5e5;font-weight:700>:</span> {user.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Age<span style=color:#04a5e5;font-weight:700>:</span> {user.age}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>			&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{handleSubAge}&gt;Sub age&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>			&lt;<span style=color:#8839ef>GrandSon</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> GrandSon: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>	<span style=color:#8839ef>const</span> { dispatch } <span style=color:#04a5e5;font-weight:700>=</span> useContext(UserContext)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Grand Son&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>			&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> dispatch({ <span style=color:#8839ef>type</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;RESET&#39;</span> })}&gt;Reset&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>}
</span></span></code></pre></div><p>上述代码，通过优化封装<code>useReducer</code>，使得代码变得更加简洁，每次调用都只需要使用<code>useContext</code>调用<code>UserContext</code>来获取<code>user</code>和<code>dispatch</code>就可以使用了。完成了数据和业务之间的解耦。</p><h3 id=usememo和memo>useMemo和memo<a class=anchorjs-link href=#usememo%e5%92%8cmemo></a></h3><h4 id=memo函数>memo函数<a class=anchorjs-link href=#memo%e5%87%bd%e6%95%b0></a></h4><p>当父组件被重新渲染的时候，也会触发子组件的重新渲染，这样就多出了一些无异议的性能开销。如果子组件的状态没有发生变化，则子组件是没必要被重新渲染的。</p><p>在React中可以使用<code>memo()</code>函数来解决，从而达到提高效率的目的。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Father Component&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Father Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Flag<span style=color:#04a5e5;font-weight:700>:</span> {<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(<span style=color:#04a5e5;font-weight:700>!</span>flag)}&gt;Change Flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>Son</span> <span style=color:#1e66f5>num</span><span style=color:#04a5e5;font-weight:700>=</span>{count} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son: <span style=color:#d20f39>React.FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ num: <span style=color:#d20f39>number</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> React.memo(({ num }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	console.log(<span style=color:#40a02b>&#39;子组件渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Son Component&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Son Count<span style=color:#04a5e5;font-weight:700>:</span> {num}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>})x
</span></span></code></pre></div><p>上述代码中，子组件使用<code>React.memo()</code>函数进行了包裹，只有当传递的<code>num</code>变化时，才会打印函数组件的内容，当点击父组件<code>Change Flag</code>的按钮则不会造成<code>Son</code>组件的重新渲染。如果取消子组件<code>Son</code>外的<code>React.memo</code>则点击<code>Change Flag</code>也会让<code>Son</code>重新渲染。</p><h4 id=usememo>useMemo<a class=anchorjs-link href=#usememo></a></h4><p>问题引入，示例代码：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> msg <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		console.log(<span style=color:#40a02b>&#39;触发了msg的重新计算~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		<span style=color:#8839ef>return</span> flag <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;七龙珠&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;阿拉蕾&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Father Component&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Father Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Flag<span style=color:#04a5e5;font-weight:700>:</span> {<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(<span style=color:#04a5e5;font-weight:700>!</span>flag)}&gt;Change Flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;book<span style=color:#04a5e5;font-weight:700>:</span> {msg()}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>}
</span></span></code></pre></div><p>上述代码中，无论点击<code>Increament</code>还是<code>Change Flag</code>按钮，都会造成<code>msg</code>函数的重新渲染。为什么？</p><p>因为函数组件中每次有状态的变化都会重新执行函数，就会造成在函数组件中的所有内容被重新执行，所以也会让<code>msg</code>函数重新执行。</p><p>然而这并不是我们所期望的，<code>count</code>的变化与<code>msg</code>并无关系，我们不需要在<code>count</code>变化时执行<code>msg</code>。这时就需要使用<code>useMemo</code>，根据指定依赖项对函数执行。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> memorizedValue <span style=color:#04a5e5;font-weight:700>=</span> useMemo(cb, deps)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#8839ef>const</span> memoValue <span style=color:#04a5e5;font-weight:700>=</span> useMemo(()<span style=color:#04a5e5;font-weight:700>=&gt;</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>  <span style=color:#8839ef>return</span> <span style=color:#d20f39>计算得到的值</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>}, [deps]) <span style=color:#9ca0b0;font-style:italic>// 监听依赖项的变化
</span></span></span></code></pre></div><ul><li><code>cb</code>：函数，用户处理计算的逻辑，必须使用<code>return</code>返回计算结果</li><li><code>deps</code>：数组，执行函数的依赖项数组，只要依赖项发生变化，都会触发<code>cb</code>函数的重新执行。<ul><li>不传数组，每次重新渲染函数组件都会执行计算</li><li>空数组，只会在首次渲染时执行一次</li><li>有依赖项，对应的依赖项发生变化时重新执行cb</li></ul></li></ul><h5 id=使用usememo解决上述问题>使用useMemo解决上述问题<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8usememo%e8%a7%a3%e5%86%b3%e4%b8%8a%e8%bf%b0%e9%97%ae%e9%a2%98></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useMemo } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Father: <span style=color:#d20f39>React.FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#8839ef>const</span> [count, setCount] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> [flag, setFlag] <span style=color:#04a5e5;font-weight:700>=</span> React.useState(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> msg <span style=color:#04a5e5;font-weight:700>=</span> useMemo(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		console.log(<span style=color:#40a02b>&#39;触发了msg的重新计算~&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		<span style=color:#8839ef>return</span> flag <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;七龙珠&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;阿拉蕾&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}, [flag])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Father Component&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Father Count<span style=color:#04a5e5;font-weight:700>:</span> {count}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setCount(count <span style=color:#04a5e5;font-weight:700>+</span> <span style=color:#fe640b>1</span>)}&gt;Increament&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Flag<span style=color:#04a5e5;font-weight:700>:</span> {<span style=color:#04a5e5>String</span>(flag)}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>				&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setFlag(<span style=color:#04a5e5;font-weight:700>!</span>flag)}&gt;Change Flag&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;book<span style=color:#04a5e5;font-weight:700>:</span> {msg}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>			{<span style=color:#9ca0b0;font-style:italic>/* &lt;Son num={count} /&gt; */</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Son: <span style=color:#d20f39>React.FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ num: <span style=color:#d20f39>number</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> React.memo(({ num }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>	console.log(<span style=color:#40a02b>&#39;子组件渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Son Component&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;Son Count<span style=color:#04a5e5;font-weight:700>:</span> {num}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>})
</span></span></code></pre></div><p>上述代码，使用<code>useMemo</code>对<code>msg</code>函数进行了包裹，并且添加了依赖项<code>flag</code>，只有当<code>flag</code>变化时才会执行<code>msg</code>。注意：在调用时，不需要写<code>msg()</code>直接进行调用，只需要写成<code>msg</code>，<code>useMemo</code>返回的是一个计算好的值而不是一个函数了。</p><h3 id=usecallback>useCallback<a class=anchorjs-link href=#usecallback></a></h3><p><code>useMemo</code>能够缓存某个变量值。而<code>useCallback</code>则用来对组件内的函数进行缓存，返回的是缓存的函数。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> memoCallback <span style=color:#04a5e5;font-weight:700>=</span> useCallback(cb, deps)
</span></span></code></pre></div><p><code>useCallback</code>会返回一个<code>memorized</code>回调函数供组件使用，从而防止每次重新渲染时反复创建相同的函数，能够结束内存开销。</p><ul><li><code>cb</code>：函数，用于处理业务逻辑，<code>cb</code>就是需要被缓存的函数</li><li><code>deps</code>：依赖项数组，当依赖项变化his才会重新执行<code>cb</code>函数<ul><li>如果省略<code>deps</code>，则每次重新渲染都会重新创建相同的函数</li><li>如果<code>deps</code>则会在组件第一次初始化时创建该函数，后续则不再重复创建。</li><li>如果<code>deps</code>有依赖项时，则会根据依赖项的变化，创建执行<code>cb</code>函数。</li></ul></li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> <span style=color:#8839ef>set</span> <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Set()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> BaseCallback <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#8839ef>const</span> handleKeyword <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>set</span>.add(handleKeyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	console.log(<span style=color:#40a02b>&#39;set size: &#39;</span>, <span style=color:#8839ef>set</span>.size)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>p</span>&gt;Keyword<span style=color:#04a5e5;font-weight:700>:</span> {keyword}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> BaseCallback
</span></span></code></pre></div><p>上述代码，未使用<code>useCallback</code>。每次在输入框中输入字符，就会触发函数组件的重新渲染，可以看到<code>set size</code>在不断增加，说明每次重新渲染都会重复创建<code>handleKeyword</code>函数。</p><p>使用<code>useCallback</code>包裹<code>handleKeyword</code>函数</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useCallback } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> <span style=color:#8839ef>set</span> <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Set()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> BaseCallback <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#8839ef>const</span> handleKeyword <span style=color:#04a5e5;font-weight:700>=</span> useCallback((e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>set</span>.add(handleKeyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	console.log(<span style=color:#40a02b>&#39;set size: &#39;</span>, <span style=color:#8839ef>set</span>.size)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>p</span>&gt;Keyword<span style=color:#04a5e5;font-weight:700>:</span> {keyword}&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> BaseCallback
</span></span></code></pre></div><p>上述代码，<code>handleKeyword</code>使用<code>useCallback</code>进行了包裹，所以只会在函数组件初始化时创建一次，后续在输入框中输入字符，可以看到<code>set size</code>只有一条，并执行了多次，说明包裹后的<code>handleKeyword</code>函数，只创建了一次，并执行了多次。而没有创建多次，执行一次的情况。</p><h4 id=使用memo-usecallback对组件进行优化>使用memo, useCallback对组件进行优化<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8memo-usecallback%e5%af%b9%e7%bb%84%e4%bb%b6%e8%bf%9b%e8%a1%8c%e4%bc%98%e5%8c%96></a></h4><p>示例：</p><p>使用<code>SearchInput</code>组件获取数字关键字，通过数字关键字，发起请求，获取返回结果在<code>SearchResult</code>中进行显示。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useEffect } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> SearchInputProps <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	onChange<span style=color:#04a5e5;font-weight:700>:</span> (e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>type</span> ListType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	userId: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	id: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	title: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	completed: <span style=color:#d20f39>boolean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>}[]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>const</span> handleKeyword <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			&lt;<span style=color:#8839ef>SearchInput</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			&lt;<span style=color:#8839ef>SearchResult</span> <span style=color:#1e66f5>keyword</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> SearchInput: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>SearchInputProps</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> ({ onChange }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>	console.log(<span style=color:#40a02b>&#39;搜索框渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;number&#39;</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{onChange} <span style=color:#1e66f5>placeholder</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;请输入数字&#39;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> SearchResult: <span style=color:#d20f39>React.FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ keyword: <span style=color:#d20f39>string</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> ({ keyword }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>	<span style=color:#8839ef>const</span> [list, setList] <span style=color:#04a5e5;font-weight:700>=</span> useState&lt;<span style=color:#8839ef>ListType</span>&gt;([])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>keyword) <span style=color:#8839ef>return</span> setList([])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>		fetch(<span style=color:#40a02b>&#39;https://jsonplaceholder.typicode.com/todos?userId=&#39;</span> <span style=color:#04a5e5;font-weight:700>+</span> keyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>			.then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> res.json())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			.then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> setList(res))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>	}, [keyword])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search Result&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>				{list.map(item <span style=color:#04a5e5;font-weight:700>=&gt;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>					&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{item.id} <span style=color:#1e66f5>style</span><span style=color:#04a5e5;font-weight:700>=</span>{{ backgroundColor: <span style=color:#d20f39>item.completed</span> <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;skyblue&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;white&#39;</span> }}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>						{item.title}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>					&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>				))}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Search
</span></span></code></pre></div><p>上述代码，通常情况下每次输入数字，都会造成<code>keyword</code>的状态变化，让<code>Search</code>组件进行重新渲染，同时会造成子组件<code>SearchInput</code>的重新渲染。同时传入到子组件<code>SearchInput</code>中的<code>onChange</code>，每次都会重复创建多次，造成传入的<code>props</code>中的<code>onChange</code>引用地址变化。</p><p>优化：</p><ol><li>使用<code>React.memo</code>对<code>SearchInput</code>进行包裹，避免子组件因为父组件重新渲染造成不必要的重新渲染。</li><li>使用<code>useCallback</code>对<code>handleKeyword</code>进行包裹，避免重复创建多次该函数，从而引起<code>onChnage</code>的状态变化造成的重新渲染</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useEffect, useCallback, memo } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> SearchInputProps <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	onChange<span style=color:#04a5e5;font-weight:700>:</span> (e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>type</span> ListType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	userId: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	id: <span style=color:#d20f39>number</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	title: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	completed: <span style=color:#d20f39>boolean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>}[]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>const</span> handleKeyword <span style=color:#04a5e5;font-weight:700>=</span> useCallback((e: <span style=color:#d20f39>React.ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	}, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			&lt;<span style=color:#8839ef>SearchInput</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			&lt;<span style=color:#8839ef>SearchResult</span> <span style=color:#1e66f5>keyword</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> SearchInput: <span style=color:#d20f39>React.FC</span>&lt;<span style=color:#8839ef>SearchInputProps</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> memo(({ onChange }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>	console.log(<span style=color:#40a02b>&#39;搜索框渲染了&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;number&#39;</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{onChange} <span style=color:#1e66f5>placeholder</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;请输入数字&#39;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> SearchResult: <span style=color:#d20f39>React.FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ keyword: <span style=color:#d20f39>string</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> ({ keyword }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>	<span style=color:#8839ef>const</span> [list, setList] <span style=color:#04a5e5;font-weight:700>=</span> useState&lt;<span style=color:#8839ef>ListType</span>&gt;([])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>keyword) <span style=color:#8839ef>return</span> setList([])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>		fetch(<span style=color:#40a02b>&#39;https://jsonplaceholder.typicode.com/todos?userId=&#39;</span> <span style=color:#04a5e5;font-weight:700>+</span> keyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>			.then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> res.json())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			.then(res <span style=color:#04a5e5;font-weight:700>=&gt;</span> setList(res))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>	}, [keyword])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search Result&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>			&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>				{list.map(item <span style=color:#04a5e5;font-weight:700>=&gt;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>					&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{item.id} <span style=color:#1e66f5>style</span><span style=color:#04a5e5;font-weight:700>=</span>{{ backgroundColor: <span style=color:#d20f39>item.completed</span> <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#40a02b>&#39;skyblue&#39;</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;white&#39;</span> }}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>						{item.title}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>					&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>				))}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Search
</span></span></code></pre></div><blockquote><p>注意:</p><ul><li>React中子组件使用不会根据业务进行实际的变化，则可以使用<code>memo</code>进行包裹，避免父组件的重新渲染造成不必要的重新渲染</li><li>父组件中的函数，如果需要传递给子组件，需要使用<code>useCallback</code>进行包裹，避免重复创建多次</li></ul></blockquote><h3 id=usetransiton>useTransiton<a class=anchorjs-link href=#usetransiton></a></h3><p><code>useTransition</code>可以将一个更新转为低优先级更新渲染，使其可以被打断、不阻塞UI对用户操作的响应，能提高用户体验。常用于视图切换时的用户体验。</p><p>补充：React中操作通常会优先组件更新渲染，然后在执行用户操作，当一个渲染耗时的组件加载时，UI就会被阻塞，造成页面响应卡顿。</p><p>示例：</p><p><code>Tabs</code>是一个标签页组件，显示三个标签，当标签<code>About</code>对应的标签内容组件，需要加载很多内容时，当切换到<code>About</code>标签时就会造成页面卡顿。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { FC, PropsWithChildren, useState } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> cx <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;clsx&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Tabs: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> [activeTab, setActiveTab] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;home&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>const</span> handleClickTab <span style=color:#04a5e5;font-weight:700>=</span> (tabName: <span style=color:#d20f39>string</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		setActiveTab(tabName)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Tabs&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col gap-2 w-[480px] mx-auto&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full h-10 flex justify-center items-center gap-2 border-b border-gray-200&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;home&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;home&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>						Home
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;about&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;about&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>						About
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;contact&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;contact&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>						Contact
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>				&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>					{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;home&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>HomeTab</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>					{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;about&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>AboutTab</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>					{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;contact&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> &lt;<span style=color:#8839ef>ContactTab</span> /&gt;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> TabButton: <span style=color:#d20f39>FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	PropsWithChildren <span style=color:#04a5e5;font-weight:700>&amp;</span> { onClick<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> } <span style=color:#04a5e5;font-weight:700>&amp;</span> { isActive: <span style=color:#d20f39>boolean</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span><span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>		&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{cx(<span style=color:#40a02b>&#39;btn&#39;</span>, { active: <span style=color:#d20f39>props.isActive</span> })} <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{props.onClick}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			{props.children}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>		&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> HomeTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>div</span>&gt;Home&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> AboutTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>	<span style=color:#8839ef>const</span> items <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Array</span>(<span style=color:#fe640b>100000</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>		.fill(<span style=color:#40a02b>&#39;about content&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>		.map((item, i) <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>p</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{i}&gt;{item}&lt;/<span style=color:#8839ef>p</span>&gt;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>div</span>&gt;{items}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> ContactTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>div</span>&gt;Contact&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span></code></pre></div><p>上述代码，因为<code>AboutTab</code>中需要加载内容过多，在切换到<code>About</code>标签时，造成了切换卡顿。这时就需要使用<code>useTransition</code>来对标签进行优化。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> [isPending, startTransition] <span style=color:#04a5e5;font-weight:700>=</span> useTransition()
</span></span></code></pre></div><ul><li>调用<code>useTranstion</code>时不需要传递任何参数</li><li><code>isPending</code>：布尔值，表示是否在处理的<code>transtion</code>，可以通过此返回值显示加载提示。</li><li><code>startTransition</code>：函数，调用此函数可以把状态更新标记为低优先级，不阻塞UI对用户操作的响应。</li></ul><p>根据<code>useTransition</code>的特性，对上述代码进行优化</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { FC, PropsWithChildren, useState, useTransition } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> cx <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;clsx&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Tabs: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> [activeTab, setActiveTab] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;home&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>const</span> [isPending, startTransition] <span style=color:#04a5e5;font-weight:700>=</span> useTransition()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> handleClickTab <span style=color:#04a5e5;font-weight:700>=</span> (tabName: <span style=color:#d20f39>string</span>) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		<span style=color:#9ca0b0;font-style:italic>// setActiveTab(tabName)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>		startTransition(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setActiveTab(tabName))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>const</span> renderTab <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		<span style=color:#8839ef>if</span> (isPending) <span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>p</span>&gt;Loading...&lt;/<span style=color:#8839ef>p</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>		<span style=color:#8839ef>switch</span> (activeTab) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;home&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>				<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>HomeTab</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;about&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>				<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>AboutTab</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			<span style=color:#8839ef>case</span> <span style=color:#40a02b>&#39;contact&#39;</span><span style=color:#04a5e5;font-weight:700>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>				<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>ContactTab</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Tabs&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex flex-col gap-2 w-[480px] mx-auto&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>				&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full h-10 flex justify-center items-center gap-2 border-b border-gray-200&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;home&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;home&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>						Home
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;about&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;about&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>						About
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>					&lt;<span style=color:#8839ef>TabButton</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{() <span style=color:#04a5e5;font-weight:700>=&gt;</span> handleClickTab(<span style=color:#40a02b>&#39;contact&#39;</span>)} <span style=color:#1e66f5>isActive</span><span style=color:#04a5e5;font-weight:700>=</span>{activeTab <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;contact&#39;</span>}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>						Contact
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>					&lt;/<span style=color:#8839ef>TabButton</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>				&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>				&lt;<span style=color:#8839ef>div</span>&gt;{renderTab()}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> TabButton: <span style=color:#d20f39>FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>	PropsWithChildren <span style=color:#04a5e5;font-weight:700>&amp;</span> { onClick<span style=color:#04a5e5;font-weight:700>:</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span> } <span style=color:#04a5e5;font-weight:700>&amp;</span> { isActive: <span style=color:#d20f39>boolean</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span><span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> props <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>		&lt;<span style=color:#8839ef>button</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{cx(<span style=color:#40a02b>&#39;btn&#39;</span>, { active: <span style=color:#d20f39>props.isActive</span> })} <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{props.onClick}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>			{props.children}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>		&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> HomeTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>div</span>&gt;Home&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> AboutTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>	<span style=color:#8839ef>const</span> items <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Array</span>(<span style=color:#fe640b>100000</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>		.fill(<span style=color:#40a02b>&#39;about content&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>		.map((item, i) <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>p</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{i}&gt;{item}&lt;/<span style=color:#8839ef>p</span>&gt;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>div</span>&gt;{items}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> ContactTab: <span style=color:#d20f39>FC</span> <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>div</span>&gt;Contact&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span></code></pre></div><p>上述代码，优化后，通过切换到<code>About</code>标签页，会优先显示处理中的<code>Loading</code>，不再阻塞UI操作。</p><h4 id=注意事项-2>注意事项：<a class=anchorjs-link href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9-2></a></h4><ul><li>传递给<code>startTransition</code>的函数必须是同步的，不能是异步的。因为React会立即执行此函数，并在其执行期间发生的所有状态标更新标记为<code>transition</code>。如果在其执行期间，尝试稍后执行状态更新，这些状态更新不会被标记为<code>transition</code>。</li><li>标记为<code>transition</code>的状态更新可以被其他状态更新打断。</li><li><code>transition</code>更新不能用于控制文本输入。</li></ul><h3 id=usedeferredvalue>useDeferredValue<a class=anchorjs-link href=#usedeferredvalue></a></h3><p>当通过文本输入关键字，通过关键字渲染组件内容时，使用<code>useTransition</code>会因为<code>useTransition</code>可以被打断的特性，造成在高频输入的文本不连贯，导致中间输入状态丢失的问题。</p><p>这时需要使用<code>useDeferredValue</code>，通过提供一个延迟版本的<code>state</code>，根据其返回的延迟<code>state</code>推迟更新UI中的某一部分，从而达到优化的目的。</p><p>语法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> [state, setState] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic>// 根据state得到延迟的state
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> deferredState <span style=color:#04a5e5;font-weight:700>=</span> useDeferredValue(state)
</span></span></code></pre></div><ul><li><code>useDeferredValue</code>的返回值为一个延迟版本的状态</li><li>在组件首次渲染期间，返回值与传入的值相同</li><li>在组件更新期间，React将首先使用旧值重新渲染UI结构，这能够跳过某些复杂组件的重新渲染，从而提高渲染效率。随后，React将使用新值更新<code>deferredValue</code>，并在后台使用新值重新渲染一个低优先级的更新。这也意味着，如果在后台使用新值更新时<code>value</code>再次被改变，将打断更新。</li></ul><p>示例：</p><p>使用<code>useTransition</code>包裹后，数据输入不连贯，中间内容丢失</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC, ChangeEvent, useTransition } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> SearchInputType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	onChange<span style=color:#04a5e5;font-weight:700>:</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	value: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>const</span> [, startTransition] <span style=color:#04a5e5;font-weight:700>=</span> useTransition()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>const</span> handleChange <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>		startTransition(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> setKeyword(e.target.value))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>SearchInput</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>SearchResult</span> <span style=color:#1e66f5>query</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>const</span> SearchInput: <span style=color:#d20f39>FC</span>&lt;<span style=color:#8839ef>SearchInputType</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> ({ onChange, value }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{onChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{value} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#8839ef>const</span> SearchResult: <span style=color:#d20f39>FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ query: <span style=color:#d20f39>string</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> ({ query }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>const</span> items <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Array</span>(<span style=color:#fe640b>8888</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		.fill(query)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>		.map((item, i) <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>p</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{i}&gt;{item}&lt;/<span style=color:#8839ef>p</span>&gt;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>	<span style=color:#8839ef>return</span> &lt;&gt;{items}&lt;/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span></code></pre></div><p>使用<code>useDeferredValue</code>对<code>keyword</code>进行延迟更新</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC, ChangeEvent, useDeferredValue } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>type</span> SearchInputType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	onChange<span style=color:#04a5e5;font-weight:700>:</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	value: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>const</span> deferredKeyword <span style=color:#04a5e5;font-weight:700>=</span> useDeferredValue(keyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>const</span> handleChange <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>SearchInput</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>SearchResult</span> <span style=color:#1e66f5>query</span><span style=color:#04a5e5;font-weight:700>=</span>{deferredKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>const</span> SearchInput: <span style=color:#d20f39>FC</span>&lt;<span style=color:#8839ef>SearchInputType</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> ({ onChange, value }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{onChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{value} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#8839ef>const</span> SearchResult: <span style=color:#d20f39>FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ query: <span style=color:#d20f39>string</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> ({ query }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>const</span> items <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Array</span>(<span style=color:#fe640b>8888</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		.fill(query)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>		.map((item, i) <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>p</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{i}&gt;{item}&lt;/<span style=color:#8839ef>p</span>&gt;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>	<span style=color:#8839ef>return</span> &lt;&gt;{items}&lt;/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span></code></pre></div><p>上述代码，使用<code>useDeferredValue</code>对输入的内容进行延迟更新，在输入内容后，可以感觉到显示的结果相比输入的内容有一定的延迟。效果有点类似<code>防抖节流</code>效果。</p><h4 id=表示内容过时优化>表示内容过时优化<a class=anchorjs-link href=#%e8%a1%a8%e7%a4%ba%e5%86%85%e5%ae%b9%e8%bf%87%e6%97%b6%e4%bc%98%e5%8c%96></a></h4><p>当<code>keyword</code>的值频繁更新时，<code>deferredKeyword</code>的值会明显滞后，此时在页面上看到的列表数据并不是最新的，为了防止用户困惑，提高交互体验，可以在过时的内容上添加透明度，表示当前看到的内容已过时。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useState, FC, ChangeEvent, useDeferredValue } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> cx <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;clsx&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>type</span> SearchInputType <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	onChange<span style=color:#04a5e5;font-weight:700>:</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> <span style=color:#8839ef>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	value: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>const</span> deferredKeyword <span style=color:#04a5e5;font-weight:700>=</span> useDeferredValue(keyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>const</span> handleChange <span style=color:#04a5e5;font-weight:700>=</span> (e: <span style=color:#d20f39>ChangeEvent</span>&lt;<span style=color:#8839ef>HTMLInputElement</span>&gt;) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		setKeyword(e.target.value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>		&lt;<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			&lt;<span style=color:#8839ef>h1</span>&gt;Search&lt;/<span style=color:#8839ef>h1</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			&lt;<span style=color:#8839ef>SearchInput</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{handleChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{keyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			&lt;<span style=color:#8839ef>hr</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>      {<span style=color:#9ca0b0;font-style:italic>/* 通过对deferredKeyword与keyword是否一致来进行判断，如果一致则表示延迟更新内容和输入的内容一样，不使用透明度，反之不一致则使用透明度表示内容已过时，不是最新的 */</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{cx(<span style=color:#40a02b>&#39;transition-opacity&#39;</span>, { <span style=color:#40a02b>&#39;opacity-50&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> deferredKeyword <span style=color:#04a5e5;font-weight:700>!==</span> keyword })}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>				&lt;<span style=color:#8839ef>SearchResult</span> <span style=color:#1e66f5>query</span><span style=color:#04a5e5;font-weight:700>=</span>{deferredKeyword} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>		&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#8839ef>const</span> SearchInput: <span style=color:#d20f39>FC</span>&lt;<span style=color:#8839ef>SearchInputType</span>&gt; <span style=color:#04a5e5;font-weight:700>=</span> ({ onChange, value }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span> <span style=color:#1e66f5>onChange</span><span style=color:#04a5e5;font-weight:700>=</span>{onChange} <span style=color:#1e66f5>value</span><span style=color:#04a5e5;font-weight:700>=</span>{value} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span><span style=color:#8839ef>const</span> SearchResult: <span style=color:#d20f39>FC</span><span style=color:#04a5e5;font-weight:700>&lt;</span>{ query: <span style=color:#d20f39>string</span> }<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=</span> ({ query }) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>	<span style=color:#8839ef>const</span> items <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>Array</span>(<span style=color:#fe640b>8888</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>		.fill(query)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>		.map((item, i) <span style=color:#04a5e5;font-weight:700>=&gt;</span> &lt;<span style=color:#8839ef>p</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{i}&gt;{item}&lt;/<span style=color:#8839ef>p</span>&gt;)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>	<span style=color:#8839ef>return</span> &lt;&gt;{items}&lt;/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>}
</span></span></code></pre></div><h4 id=usedeferredvalue与防抖和节流的区别>useDeferredValue与防抖和节流的区别<a class=anchorjs-link href=#usedeferredvalue%e4%b8%8e%e9%98%b2%e6%8a%96%e5%92%8c%e8%8a%82%e6%b5%81%e7%9a%84%e5%8c%ba%e5%88%ab></a></h4><ul><li>防抖是指在用户停止输入一段时间之后再更新列表。</li><li>节流是指每隔一段时间更新列表。</li></ul><p>二者在本质上都是通过控制输入或间隔时间来<strong>延迟更新渲染</strong>。</p><p><code>useDeferredValue</code>不需要选择任何固定延迟时间，因为他会通过React适应用户的设备，根据设备信息响应渲染情况。</p><p><code>useDeferredValue</code>执行的<strong>延迟重新渲染是可中断的</strong>。如果在进行一个列表的重新渲染过程中，用户进行了另外的键盘输入，React会中断重新渲染，优先处理键盘输入，然后在进行后续的重新渲染。而防抖和节流只是延迟渲染，本质还是阻塞的，仅仅是将渲染阻塞键盘输入的时间推迟了。</p><p>如果优化的<strong>不是在渲染期间发生</strong>的，防抖和节流仍然非常有用。</p><p>如果在优化<strong>中涉及重新渲染和用户输入操作</strong>，<code>useDeferredValue</code>会更好。</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/zustand/ data-toggle=tooltip data-placement=top title=Zustand>Previous<br><span>Zustand</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>