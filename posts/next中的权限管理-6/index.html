<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Next中的权限管理(六) | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="终于来到本系列的最后一篇了，pocketbase是类似于strapi的无头CMS(HeadLess)系统，和firebase、supabase也有些类似，只是本地和线上、功能上的区别。
pocketbase相比strapi是更轻快、简单的那种。使用的GO开发，使用sqlite作为数据库，服务端只有一个文件。很适合做些博客、小项目、企业展示站点。
HeadLess这类系统的好处是提供了完整的权限、通用模型系统，可以快速完成站点的搭建，通过系统提供的API能快速实现CURD的功能。"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Next中的权限管理(六)"><meta name=twitter:description content="终于来到本系列的最后一篇了，pocketbase是类似于strapi的无头CMS(HeadLess)系统，和firebase、supabase也有些类似，只是本地和线上、功能上的区别。
pocketbase相比strapi是更轻快、简单的那种。使用的GO开发，使用sqlite作为数据库，服务端只有一个文件。很适合做些博客、小项目、企业展示站点。
HeadLess这类系统的好处是提供了完整的权限、通用模型系统，可以快速完成站点的搭建，通过系统提供的API能快速实现CURD的功能。"><meta property="og:url" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-6/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="Next中的权限管理(六)"><meta property="og:description" content="终于来到本系列的最后一篇了，pocketbase是类似于strapi的无头CMS(HeadLess)系统，和firebase、supabase也有些类似，只是本地和线上、功能上的区别。
pocketbase相比strapi是更轻快、简单的那种。使用的GO开发，使用sqlite作为数据库，服务端只有一个文件。很适合做些博客、小项目、企业展示站点。
HeadLess这类系统的好处是提供了完整的权限、通用模型系统，可以快速完成站点的搭建，通过系统提供的API能快速实现CURD的功能。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-08T10:22:25+08:00"><meta property="article:modified_time" content="2024-08-08T10:22:25+08:00"><meta property="article:tag" content="React"><meta property="article:tag" content="Nextjs"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-5/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-4/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-3/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-2/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-1/"><meta property="og:see_also" content="http://localhost/posts/nextjs%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%B8%89/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Next中的权限管理(六)</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2024-08-08</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=React>React</a>
<a href=/tags/nextjs/ title=Nextjs>Nextjs</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>终于来到本系列的最后一篇了，<code>pocketbase</code>是类似于<code>strapi</code>的无头CMS(<code>HeadLess</code>)系统，和<code>firebase</code>、<code>supabase</code>也有些类似，只是本地和线上、功能上的区别。</p><p><code>pocketbase</code>相比<code>strapi</code>是更轻快、简单的那种。使用的<code>GO</code>开发，使用<code>sqlite</code>作为数据库，服务端只有一个文件。很适合做些博客、小项目、企业展示站点。</p><p><code>HeadLess</code>这类系统的好处是提供了完整的权限、通用模型系统，可以快速完成站点的搭建，通过系统提供的<code>API</code>能快速实现<code>CURD</code>的功能。</p><p>这篇文章主要说下，<code>Next.js</code>如何与<code>pocketbase</code>结合使用。因为<code>pocketbase</code>是个比较完善的系统，所以在权限控制上会比<code>auth.js</code>、<code>clerk</code>这类单独的权限系统限制比较多。后面会再具体说明。</p><h3 id=项目六pocketbase实现task项目的权限管理>项目六：pocketbase实现Task项目的权限管理<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%85%adpocketbase%e5%ae%9e%e7%8e%b0task%e9%a1%b9%e7%9b%ae%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86></a></h3><h4 id=项目初始化>项目初始化<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%88%9d%e5%a7%8b%e5%8c%96></a></h4><p>因为不需要使用到<code>orm</code>，只需要在原来基础上添加<code>pocketbase</code>删除<code>prisma</code>相关的包即可。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic># 使用pnpm，初始化Next.js项目</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>pnpm create next-app@latest next-pocketbase-demo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic># 安装shadcn-ui作为UI库</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>pnpm dlx shadcn-ui@latest init
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>pnpm dlx shadcn-ui@latest add alert avatar button card dialog input separator sonner
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span><span style=color:#9ca0b0;font-style:italic># 安装其他第三方库</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">9</span><span>pnpm add zod zustand pocketbase
</span></span></code></pre></div><h4 id=项目准备>项目准备<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87></a></h4><p>主要是<code>pocketbase</code>这边的配置：</p><ul><li>在<code>pocketbase</code>项目目录运行<code>./pocketbase serve</code>将项目跑起来，在提示的地址中选择<code>Admin UI</code>的链接。</li><li>创建初始管理员，修改管理员的配置，在<code>Edit collection</code>中选择<code>option</code>设置密码长度为6</li><li>创建<code>tasks</code>模型，并添加对应字段<code>content</code>、<code>isCompleted</code>，注意需要添加一个<code>author</code>字段，并关联<code>users</code>模型，关联类型选择<code>signle</code>。</li><li>需要配置下<code>tasks</code>模型的功能的权限，在<code>Edit collection</code>中选择<code>API Rules</code>，为了简单起见，可以把这里的<code>admins only</code>都取消了。</li><li>最后在<code>users</code>模型中编辑下，添加<code>tasks</code>的关联字段，选择<code>tasks</code>模型，关联类型<code>Multiple</code>。</li></ul><h4 id=pocketbase配置>Pocketbase配置<a class=anchorjs-link href=#pocketbase%e9%85%8d%e7%bd%ae></a></h4><h5 id=env>env<a class=anchorjs-link href=#env></a></h5><p>这边的配置很简单，主要是设置链接<code>pocketbase</code>的地址和<code>cookie key</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#dc8a78>NEXT_PUBLIC_POCKET_BASE_URL</span><span style=color:#04a5e5;font-weight:700>=</span>http://localhost:8090
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#dc8a78>NEXT_PUBLIC_COOKIES_KEY</span><span style=color:#04a5e5;font-weight:700>=</span>Sim@next-pocketbase-demo
</span></span></code></pre></div><p>注意：这里<code>pocketbase</code>的连接地址要写成<code>NEXT_PUBLIC_xxxx</code>这种形式，否则有些地方会连接异常。</p><h5 id=pocketbase连接>Pocketbase连接<a class=anchorjs-link href=#pocketbase%e8%bf%9e%e6%8e%a5></a></h5><p>因为<code>pocketbase</code>提供了两套连接方案，一套是常规<code>API</code>的方式，还有一种是框架自带的，应该最后也是转成了<code>API</code>的方式，我们都是用<code>action</code>的方式请求数据，所以选择框架自带的这种，可以注意查看系统里<code>API Preview</code>里的说明。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/lib/db.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { ReadonlyRequestCookies } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/dist/server/web/spec-extension/adapters/request-cookies&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> PocketBase <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;pocketbase&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> { POCKET_BASE_URL, COOKIE_KEY } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/constants&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>class</span> DatabaseClient {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	client: <span style=color:#d20f39>PocketBase</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>constructor</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>		<span style=color:#8839ef>this</span>.client <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> PocketBase(POCKET_BASE_URL)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	<span style=color:#8839ef>async</span> login(email: <span style=color:#d20f39>string</span>, password: <span style=color:#d20f39>string</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			<span style=color:#8839ef>const</span> result <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> <span style=color:#8839ef>this</span>.client.collection(<span style=color:#40a02b>&#39;users&#39;</span>).authWithPassword(email, password)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>result<span style=color:#04a5e5;font-weight:700>?</span>.token) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>				<span style=color:#8839ef>throw</span> <span style=color:#8839ef>new</span> <span style=color:#04a5e5>Error</span>(<span style=color:#40a02b>&#39;Invalid email or password&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			<span style=color:#8839ef>return</span> result
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>		} <span style=color:#8839ef>catch</span> (err) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			console.error(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>			<span style=color:#8839ef>throw</span> <span style=color:#8839ef>new</span> <span style=color:#04a5e5>Error</span>(<span style=color:#40a02b>&#39;Invalid email or password&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>async</span> register(username: <span style=color:#d20f39>string</span>, email: <span style=color:#d20f39>string</span>, password: <span style=color:#d20f39>string</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>			<span style=color:#8839ef>const</span> result <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> <span style=color:#8839ef>this</span>.client.collection(<span style=color:#40a02b>&#39;users&#39;</span>).create({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>				username,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>				email,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>				password,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>				passwordConfirm: <span style=color:#d20f39>password</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>			<span style=color:#8839ef>return</span> result
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>		} <span style=color:#8839ef>catch</span> (err) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>			console.error(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>	<span style=color:#8839ef>async</span> getAuth(cookieStore: <span style=color:#d20f39>ReadonlyRequestCookies</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>		<span style=color:#8839ef>const</span> cookie <span style=color:#04a5e5;font-weight:700>=</span> cookieStore.<span style=color:#8839ef>get</span>(COOKIE_KEY)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>cookie) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>			<span style=color:#8839ef>return</span> <span style=color:#fe640b>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>		<span style=color:#8839ef>this</span>.client.authStore.loadFromCookie(cookie<span style=color:#04a5e5;font-weight:700>?</span>.value <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>		<span style=color:#8839ef>return</span> <span style=color:#8839ef>this</span>.client.authStore.isValid <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#fe640b>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>	<span style=color:#8839ef>async</span> getUser(cookieStore: <span style=color:#d20f39>ReadonlyRequestCookies</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>		<span style=color:#8839ef>const</span> cookie <span style=color:#04a5e5;font-weight:700>=</span> cookieStore.<span style=color:#8839ef>get</span>(COOKIE_KEY)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>cookie) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>			<span style=color:#8839ef>return</span> <span style=color:#fe640b>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>		<span style=color:#8839ef>this</span>.client.authStore.loadFromCookie(cookie<span style=color:#04a5e5;font-weight:700>?</span>.value <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>		<span style=color:#8839ef>return</span> <span style=color:#8839ef>this</span>.client.authStore.model
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> pb <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> DatabaseClient()
</span></span></code></pre></div><p>上述代码中，使用类封装了四个方法，分别是注册<code>register</code>、登录<code>login</code>、获取是否有权限<code>getAuth</code>、获取登录用户<code>getUser</code>。可以看到<code>pocketbase</code>主要还是使用<code>cookie</code>来保存登录信息。势必也会有闪烁的问题，所以后面也需要做个<code>auth-user-provider</code>，同时保存<code>authUser</code>信息。</p><h5 id=provider>Provider<a class=anchorjs-link href=#provider></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/components/providers/auth-user-provider.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#40a02b>&#39;use client&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { useEffect, useState } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> { useAuth } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/hooks/use-auth&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>import</span> { Loader } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/common/loader&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>import</span> { IUser } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/types&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>interface</span> AuthUserProviderProps {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	children: <span style=color:#d20f39>React.ReactNode</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	authUser: <span style=color:#d20f39>IUser</span> <span style=color:#04a5e5;font-weight:700>|</span> <span style=color:#fe640b>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> AuthUserProvider <span style=color:#04a5e5;font-weight:700>=</span> ({ children, authUser }<span style=color:#04a5e5;font-weight:700>:</span> AuthUserProviderProps) <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>const</span> [loading, setLoading] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	<span style=color:#8839ef>const</span> setAuthUser <span style=color:#04a5e5;font-weight:700>=</span> useAuth(state <span style=color:#04a5e5;font-weight:700>=&gt;</span> state.setAuthUser)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	useEffect(() <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		<span style=color:#8839ef>if</span> (authUser) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			setAuthUser(authUser)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>			setLoading(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>		} <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>			setAuthUser(<span style=color:#fe640b>null</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>			setLoading(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	}, [authUser, setAuthUser])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	<span style=color:#8839ef>if</span> (loading) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>			&lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex items-center gap-x-2 p-2&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>				&lt;<span style=color:#8839ef>Loader</span> <span style=color:#1e66f5>text</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;Task Loading...&#39;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>			&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>		)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	<span style=color:#8839ef>return</span> &lt;&gt;{children}&lt;/&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>}
</span></span></code></pre></div><p>可以看到这里<code>provider</code>也需要从父级传入对应的<code>auth</code>信息。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-tsx data-lang=tsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/layout.tsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> <span style=color:#8839ef>type</span> { Metadata } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { Inter } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/font/google&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> <span style=color:#40a02b>&#39;./globals.css&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>import</span> { authUser } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/actions/auth&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>import</span> { AuthUserProvider } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/providers/auth-user-provider&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>import</span> { userMapper } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/utils&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>import</span> { Toaster } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;sonner&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#8839ef>import</span> { ModalProvider } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/components/providers/modal-provider&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#8839ef>const</span> inter <span style=color:#04a5e5;font-weight:700>=</span> Inter({ subsets<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;latin&#39;</span>] })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> metadata: <span style=color:#d20f39>Metadata</span> <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	title<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Create Next App&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	description<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Generated by create next app&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> <span style=color:#8839ef>async</span> <span style=color:#d20f39>function</span> RootLayout({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	children
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}<span style=color:#04a5e5;font-weight:700>:</span> Readonly<span style=color:#04a5e5;font-weight:700>&lt;</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>	children: <span style=color:#d20f39>React.ReactNode</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>}<span style=color:#04a5e5;font-weight:700>&gt;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	<span style=color:#8839ef>const</span> getAuthUser <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> authUser()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>	<span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>		&lt;<span style=color:#8839ef>html</span> <span style=color:#1e66f5>lang</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;en&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>			&lt;<span style=color:#8839ef>body</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span>{inter.className}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>				&lt;<span style=color:#8839ef>AuthUserProvider</span> <span style=color:#1e66f5>authUser</span><span style=color:#04a5e5;font-weight:700>=</span>{userMapper(getAuthUser)}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>					{children}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>					&lt;<span style=color:#8839ef>Toaster</span> <span style=color:#1e66f5>position</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;top-center&#39;</span> <span style=color:#1e66f5>richColors</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>					&lt;<span style=color:#8839ef>ModalProvider</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>				&lt;/<span style=color:#8839ef>AuthUserProvider</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>			&lt;/<span style=color:#8839ef>body</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>		&lt;/<span style=color:#8839ef>html</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>	)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>}
</span></span></code></pre></div><p>这里使用<code>action</code>包装过的<code>authUser()</code>方法，这里不使用<code>action</code>包裹的方法容易有问题，主要在<code>action</code>有标识<code>use server</code>函数只能在服务端使用。</p><h5 id=actions>Actions<a class=anchorjs-link href=#actions></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/actions/auth.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#40a02b>&#39;use server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { cookies } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/headers&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { RecordModel } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;pocketbase&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> { z } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;zod&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>import</span> { pb } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/db&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>import</span> { ActionResponse } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/action-response&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>import</span> { registerSchema, loginSchema } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/schemas&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#8839ef>import</span> { IResponse, IResponseBase, IUser } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/types&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#8839ef>import</span> { COOKIE_KEY } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/constants&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#8839ef>import</span> { userMapper } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/utils&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> registerAction <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	values: <span style=color:#d20f39>z.infer</span>&lt;<span style=color:#8839ef>typeof</span> <span style=color:#1e66f5>registerSchema</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>)<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponse</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>IUser</span> <span style=color:#d20f39>|</span> <span style=color:#1e66f5>null</span>&gt;<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	<span style=color:#8839ef>const</span> validatedFields <span style=color:#04a5e5;font-weight:700>=</span> registerSchema.safeParse(values)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>validatedFields.success) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Invalid input data&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>	<span style=color:#8839ef>const</span> { username, email, password } <span style=color:#04a5e5;font-weight:700>=</span> validatedFields.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>		<span style=color:#8839ef>const</span> res <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.register(username, email, password)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>		<span style=color:#8839ef>if</span> (res<span style=color:#04a5e5;font-weight:700>?</span>.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>400</span> <span style=color:#04a5e5;font-weight:700>||</span> res<span style=color:#04a5e5;font-weight:700>?</span>.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>403</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>			<span style=color:#8839ef>return</span> ActionResponse.badRequest(res<span style=color:#04a5e5;font-weight:700>?</span>.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>		<span style=color:#8839ef>return</span> ActionResponse.ok({ data: <span style=color:#d20f39>userMapper</span>(res<span style=color:#04a5e5;font-weight:700>!</span>), message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;User registered successfully&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>		console.log(<span style=color:#40a02b>&#39;Error while registering user&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error while registering user&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> loginAction <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (values: <span style=color:#d20f39>z.infer</span>&lt;<span style=color:#8839ef>typeof</span> <span style=color:#1e66f5>loginSchema</span>&gt;)<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>	<span style=color:#8839ef>const</span> validatedFields <span style=color:#04a5e5;font-weight:700>=</span> loginSchema.safeParse(values)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>validatedFields.success) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Invalid input data&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>	<span style=color:#8839ef>const</span> { email, password } <span style=color:#04a5e5;font-weight:700>=</span> validatedFields.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>		<span style=color:#8839ef>const</span> res <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.login(email, password)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>		<span style=color:#8839ef>const</span> { record, token } <span style=color:#04a5e5;font-weight:700>=</span> res
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>		record.token <span style=color:#04a5e5;font-weight:700>=</span> token
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>		<span style=color:#8839ef>if</span> (COOKIE_KEY) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>			cookies().<span style=color:#8839ef>set</span>(COOKIE_KEY<span style=color:#04a5e5;font-weight:700>!</span>, pb.client.authStore.exportToCookie(), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>				httpOnly: <span style=color:#d20f39>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>				secure: <span style=color:#d20f39>process.env.NODE_ENV</span> <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;production&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>				maxAge: <span style=color:#d20f39>60</span> <span style=color:#04a5e5;font-weight:700>*</span> <span style=color:#fe640b>60</span> <span style=color:#04a5e5;font-weight:700>*</span> <span style=color:#fe640b>24</span> <span style=color:#04a5e5;font-weight:700>*</span> <span style=color:#fe640b>7</span>, <span style=color:#9ca0b0;font-style:italic>// One week
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span><span style=color:#9ca0b0;font-style:italic></span>				path<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;/&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>		<span style=color:#8839ef>return</span> ActionResponse.noContent(<span style=color:#40a02b>&#39;User logged in successfully&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>		console.log(<span style=color:#40a02b>&#39;Error while logging in user&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error while logging in user&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> logoutAction <span style=color:#04a5e5;font-weight:700>=</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>	pb.client.authStore.clear()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>	cookies().<span style=color:#8839ef>delete</span>(COOKIE_KEY<span style=color:#04a5e5;font-weight:700>!</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> authUser <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>	<span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> pb.getUser(cookies())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">75</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> getAuth <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">76</span><span>	<span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> pb.getAuth(cookies())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">77</span><span>}
</span></span></code></pre></div><p>这里不得不说<code>pocketbase</code>这里的一些问题，返回的类型很奇特也就算了，返回的结构都不是统一的，这块可以看<code>API Preview</code>中的说明。<code>200</code>时直接返回内容，<code>400</code>又是<code>code + message + data</code>。在<code>task</code>中还有<code>403</code>、<code>404</code>返回的内容都有些许差别。所以这块使用<code>ts</code>就需要多考虑下类型，其他的还好写了那么多个差不多的<code>action</code>了，应该没啥挑战。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#9ca0b0;font-style:italic>// src/actions/task.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#40a02b>&#39;use server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span><span style=color:#8839ef>import</span> { revalidatePath } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/cache&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span><span style=color:#8839ef>import</span> { RecordModel } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;pocketbase&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span><span style=color:#8839ef>import</span> { pb } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/db&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span><span style=color:#8839ef>import</span> { IResponse, ICreatreTask, IResponseBase } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/types&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span><span style=color:#8839ef>import</span> { ActionResponse } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/action-response&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span><span style=color:#8839ef>import</span> { getAuth, authUser } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/actions/auth&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> getTasks <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (authorId: <span style=color:#d20f39>string</span>)<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponse</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>RecordModel</span><span style=color:#d20f39>[]</span>&gt;<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span>		<span style=color:#8839ef>const</span> tasks <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).getFullList({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>			sort<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;-created&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span>			filter<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>`author = &#34;</span><span style=color:#40a02b>${</span>authorId<span style=color:#40a02b>}</span><span style=color:#40a02b>&#34;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span>		<span style=color:#8839ef>return</span> ActionResponse.ok({ data: <span style=color:#d20f39>tasks</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Tasks retrieved successfully&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>		console.log(<span style=color:#40a02b>&#39;Error getting tasks&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error getting tasks&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> createTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (task: <span style=color:#d20f39>ICreatreTask</span>)<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponse</span><span style=color:#d20f39>&lt;</span><span style=color:#1e66f5>RecordModel</span>&gt;<span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span>	<span style=color:#8839ef>const</span> getAuthUser <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> authUser()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span>	<span style=color:#8839ef>const</span> isAuth <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>isAuth <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#04a5e5;font-weight:700>!</span>getAuthUser) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>		<span style=color:#8839ef>return</span> ActionResponse.unauthorized()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span>		<span style=color:#8839ef>const</span> newTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).create({ ...task, author: <span style=color:#d20f39>getAuthUser.id</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span>		<span style=color:#8839ef>if</span> (newTask.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>400</span> <span style=color:#04a5e5;font-weight:700>||</span> newTask.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>403</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>			<span style=color:#8839ef>return</span> ActionResponse.badRequest(newTask.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>		revalidatePath(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;layout&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>		<span style=color:#8839ef>return</span> ActionResponse.ok({ data: <span style=color:#d20f39>newTask</span>, message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;Task created successfully&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>		console.log(<span style=color:#40a02b>&#39;Error creating task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error creating task&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> updateTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>	id,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span>	isCompleted
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>}<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>	id: <span style=color:#d20f39>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>	isCompleted: <span style=color:#d20f39>boolean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span>})<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span>	<span style=color:#8839ef>const</span> getAuthUser <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> authUser()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>	<span style=color:#8839ef>const</span> isAuth <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>isAuth <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#04a5e5;font-weight:700>!</span>getAuthUser) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>		<span style=color:#8839ef>return</span> ActionResponse.unauthorized()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>		<span style=color:#8839ef>const</span> existingTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).getOne(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>existingTask) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>			<span style=color:#8839ef>return</span> ActionResponse.notFound(<span style=color:#40a02b>&#39;Task not found&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>		<span style=color:#8839ef>const</span> task <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).update(id, { isCompleted })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>		<span style=color:#8839ef>if</span> (task.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>400</span> <span style=color:#04a5e5;font-weight:700>||</span> task.code <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>403</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>			<span style=color:#8839ef>return</span> ActionResponse.badRequest(task.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span>		revalidatePath(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;layout&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>		<span style=color:#8839ef>return</span> ActionResponse.noContent(<span style=color:#40a02b>&#39;Task updated successfully&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>		console.log(<span style=color:#40a02b>&#39;Error updating task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error updating task&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> deleteTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (id: <span style=color:#d20f39>string</span>)<span style=color:#04a5e5;font-weight:700>:</span> Promise&lt;<span style=color:#8839ef>IResponseBase</span>&gt; <span style=color:#04a5e5;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>	<span style=color:#8839ef>const</span> getAuthUser <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> authUser()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>	<span style=color:#8839ef>const</span> isAuth <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>isAuth <span style=color:#04a5e5;font-weight:700>||</span> <span style=color:#04a5e5;font-weight:700>!</span>getAuthUser) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span>		<span style=color:#8839ef>return</span> ActionResponse.unauthorized()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>	<span style=color:#8839ef>try</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>		<span style=color:#8839ef>const</span> existingTask <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).getOne(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>		<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>existingTask) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>			<span style=color:#8839ef>return</span> ActionResponse.notFound(<span style=color:#40a02b>&#39;Task not found&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span>		<span style=color:#8839ef>await</span> pb.client.collection(<span style=color:#40a02b>&#39;tasks&#39;</span>).<span style=color:#8839ef>delete</span>(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span>		<span style=color:#8839ef>return</span> ActionResponse.noContent(<span style=color:#40a02b>&#39;Task deleted successfully&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span>	} <span style=color:#8839ef>catch</span> (error) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>		console.log(<span style=color:#40a02b>&#39;Error deleting task&#39;</span>, error)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span>		<span style=color:#8839ef>return</span> ActionResponse.badRequest(<span style=color:#40a02b>&#39;Error deleting task&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>}
</span></span></code></pre></div><h5 id=middleware>Middleware<a class=anchorjs-link href=#middleware></a></h5><p>先像之前一样写个<code>auth-routes.ts</code></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// src/lib/auth-routes.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> publicRoutes <span style=color:#04a5e5;font-weight:700>=</span> [<span style=color:#40a02b>&#39;&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> authRoutes <span style=color:#04a5e5;font-weight:700>=</span> [<span style=color:#40a02b>&#39;/login&#39;</span>, <span style=color:#40a02b>&#39;/register&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> apiAuthPrefix <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;/api/auth&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> DEFAULT_LOGIN_REDIRECT <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;/&#39;</span>
</span></span></code></pre></div><p>然后和之前一样在<code>middleware</code>中使用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/middleware.ts
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> { NextRequest, NextResponse } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;next/server&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { pb } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/db&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { publicRoutes, apiAuthPrefix, authRoutes, DEFAULT_LOGIN_REDIRECT } <span style=color:#8839ef>from</span> <span style=color:#40a02b>&#39;@/lib/auth-routes&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>async</span> <span style=color:#d20f39>function</span> middleware(req: <span style=color:#d20f39>NextRequest</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> { nextUrl } <span style=color:#04a5e5;font-weight:700>=</span> req
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#8839ef>const</span> isLoggedIn <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> pb.getAuth(req.cookies <span style=color:#8839ef>as</span> <span style=color:#d20f39>any</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>const</span> isPublicRoute <span style=color:#04a5e5;font-weight:700>=</span> publicRoutes.length <span style=color:#04a5e5;font-weight:700>&gt;</span> <span style=color:#fe640b>0</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> publicRoutes.includes(nextUrl.pathname)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>	<span style=color:#8839ef>const</span> isAuthRoute <span style=color:#04a5e5;font-weight:700>=</span> authRoutes.includes(nextUrl.pathname)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	<span style=color:#8839ef>const</span> isApiAuthRoute <span style=color:#04a5e5;font-weight:700>=</span> nextUrl.pathname.startsWith(apiAuthPrefix)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	<span style=color:#8839ef>if</span> (isApiAuthRoute) <span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	<span style=color:#8839ef>if</span> (isAuthRoute) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>		<span style=color:#8839ef>if</span> (isLoggedIn) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			<span style=color:#8839ef>return</span> Response.redirect(<span style=color:#8839ef>new</span> URL(DEFAULT_LOGIN_REDIRECT, nextUrl))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>		<span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>	<span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>isLoggedIn <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> <span style=color:#04a5e5;font-weight:700>!</span>isPublicRoute) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>		<span style=color:#8839ef>return</span> NextResponse.redirect(<span style=color:#8839ef>new</span> URL(<span style=color:#40a02b>&#39;/login&#39;</span>, nextUrl))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>	<span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> config <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>	matcher<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;/((?!.*\\..*|_next).*)&#39;</span>, <span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#40a02b>&#39;/(api|trpc)(.*)&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>}
</span></span></code></pre></div><p>因为只需要判断下是否登录了，所以直接使用了<code>pb</code>里的<code>getAuth</code>。这里比<code>lucia</code>好点，不会出现<code>edge runtime</code>的问题。</p><h4 id=pocketbase在服务端和客户端的方法>Pocketbase在服务端和客户端的方法<a class=anchorjs-link href=#pocketbase%e5%9c%a8%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%92%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e7%9a%84%e6%96%b9%e6%b3%95></a></h4><p>客户端方法：这里仅可以使用<code>useAuh</code>，之前我们在<code>provider</code>中获取的<code>authUser</code>信息，传递给了<code>useAuth</code>。</p><p>服务端方法：这里其实也只有一个，就是在<code>db.ts</code>中封装的<code>getAuth</code>和<code>getUser</code>，但是我们在<code>action</code>中又包装了一次。也可以使用<code>action</code>中的<code>authUser</code>、<code>getAuth</code></p><h4 id=总结>总结<a class=anchorjs-link href=#%e6%80%bb%e7%bb%93></a></h4><p>优点：</p><ul><li><code>pocketbase</code>代表这一类<code>handless cms</code>，这类系统或SAAS系统都有自己的 一套完善的方法、API和存储方式。<code>strapi</code>好像还可以支持<code>graphql</code>等多数据请求方式。</li><li>使可以更快的将项目启动起来，仅需要根据系统情况来搭建业务。在权限方面可以从系统后台做一些细致的限制。在<code>pocketbase</code>里的<code>API Rules</code>可以使用使用更细致的规则，可以查看官方说明： <a href=https://pocketbase.io/docs/api-rules-and-filters/ target=_blank>API rules and filters</a></li><li>官方的文档很简单，但示例比较少。</li></ul><p>缺点：</p><ul><li>需要去适应系统制定的各种规则，没有之前那些单独的权限框架那么自由，可以通过代码控制，需要到系统中配置对应的权限规则，有些麻烦了。</li><li>对<code>next.js</code>的<code>Pages Router</code>支持不是太好</li></ul><p>总结：</p><p>使用<code>pocketbase</code>这类系统可以快速、轻便的实现一些简单的项目，适用范围有限。</p><h3 id=最后>最后<a class=anchorjs-link href=#%e6%9c%80%e5%90%8e></a></h3><p>通过6个项目的对比，我们可以做一个整体的总结</p><ul><li>相对大的项目可以使用<code>next-auth.js</code>，如果能接受一些不确定性，可以试试<code>auth.js</code></li><li>对于快速启动项目，能接受将用户数据放在第三方的平台上，可以使用<code>clerk</code></li><li>对于小项目，不接受用户数据放到第三方平台上，可以尝试<code>pocketbase</code>或者<code>strapi</code>之类的<code>headless cms</code>。</li><li>对于小项目，也不想搞一个什么系统的那么麻烦的，那就试试<code>iron-session</code></li></ul><p>每个权限系统都各有长短，贴近业务需求的才是最好的。项目仅使用了各个框架系统的最基本的功能，不算深入的说明，只想横向对比下各个框架基本优劣、繁杂程度。</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-5/ data-toggle=tooltip data-placement=top title=Next中的权限管理(五)>Previous<br><span>Next中的权限管理(五)</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>