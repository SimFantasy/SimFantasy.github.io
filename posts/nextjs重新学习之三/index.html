<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>NextJS重新学习之三 | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="这个是一个用户身份验证的示例。
NextJs提供了一个身份验证的库next auth，使用这个库可以很轻松的做身份验证。
示例使用Github的用户身份登录。
由于版本问题，跟视频里说的一些内容有出入。根据官方文档来做了调整，代码做了很多优化，写起来更少了。"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="NextJS重新学习之三"><meta name=twitter:description content="这个是一个用户身份验证的示例。
NextJs提供了一个身份验证的库next auth，使用这个库可以很轻松的做身份验证。
示例使用Github的用户身份登录。
由于版本问题，跟视频里说的一些内容有出入。根据官方文档来做了调整，代码做了很多优化，写起来更少了。"><meta property="og:url" content="http://localhost/posts/nextjs%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%B8%89/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="NextJS重新学习之三"><meta property="og:description" content="这个是一个用户身份验证的示例。
NextJs提供了一个身份验证的库next auth，使用这个库可以很轻松的做身份验证。
示例使用Github的用户身份登录。
由于版本问题，跟视频里说的一些内容有出入。根据官方文档来做了调整，代码做了很多优化，写起来更少了。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-01T00:45:09+00:00"><meta property="article:modified_time" content="2022-10-01T00:45:09+00:00"><meta property="article:tag" content="React"><meta property="article:tag" content="Nextjs"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-6/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-5/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-4/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-3/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-2/"><meta property="og:see_also" content="http://localhost/posts/next%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-1/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>NextJS重新学习之三</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2022-10-01</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=React>React</a>
<a href=/tags/nextjs/ title=Nextjs>Nextjs</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>这个是一个用户身份验证的示例。</p><p>NextJs提供了一个身份验证的库<code>next auth</code>，使用这个库可以很轻松的做身份验证。</p><p>示例使用Github的用户身份登录。</p><p>由于版本问题，跟视频里说的一些内容有出入。根据官方文档来做了调整，代码做了很多优化，写起来更少了。</p><p>‍</p><h3 id=安装>安装<a class=anchorjs-link href=#%e5%ae%89%e8%a3%85></a></h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add next<span style=color:#04a5e5;font-weight:700>-</span>auth
</span></span></code></pre></div><p>‍</p><h3 id=获取谷歌授权>获取谷歌授权<a class=anchorjs-link href=#%e8%8e%b7%e5%8f%96%e8%b0%b7%e6%ad%8c%e6%8e%88%e6%9d%83></a></h3><p>获取Github用户身份权限，相当于在github给第三方授权。</p><ol><li>点击右上角的头像，进入<code>settings</code>。</li><li>在左侧菜单最下面找到<code>Developer settings</code>。</li><li>然后在二级菜单中找到<code>OAuth Apps</code>。</li><li>然后点击新建一个<code>OAuth Application</code></li><li>填写<code>Application name</code>，应用的名称（NextAuth）</li><li>填写<code>Homepage URL</code>，我们是本地环境，所以填写<code>http://localhost:3000</code>。</li><li><code>Authorization callback URL</code>也可以写<code>http://localhost:3000</code>。</li><li>然后点击<code>register application</code>按钮，进行保存。</li><li>然后在列表中点击<code>NextAuth</code>这个应用名称，进入详情。</li><li>拿到<code>Client ID</code>和<code>Client secrets</code>这两个的值。</li></ol><p>‍</p><h3 id=添加api>添加API<a class=anchorjs-link href=#%e6%b7%bb%e5%8a%a0api></a></h3><p>在<code>pages/api</code>下添加一个文件夹<code>auth</code>，然后在目录下新建一个<code>[...nextauth].js</code>文件。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// pages/api/auth/[...nextauth].js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> NextAuth from <span style=color:#40a02b>&#39;next-auth&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> GithubProvider from <span style=color:#40a02b>&#39;next-auth/providers/github&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> authOptions <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  providers<span style=color:#04a5e5;font-weight:700>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    GithubProvider({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      clientId<span style=color:#04a5e5;font-weight:700>:</span> process.env.GITHUB_ID,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>      clientSecret<span style=color:#04a5e5;font-weight:700>:</span> process.env.GITHUB_SECRET
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  ]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> NextAuth(authOptions)
</span></span></code></pre></div><p><code>clientId</code>将用来填写从<code>Github</code>上获取的<code>Client ID</code>，<code>clientSecret</code>的值是冲<code>Github</code>​上获取的<code>Client secrets</code>。</p><p>这两个内容我们写到本地环境变量（env.local）中。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>GITHUB_ID<span style=color:#04a5e5;font-weight:700>=********************</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>GITHUB_SECRET<span style=color:#04a5e5;font-weight:700>=****************************************</span>
</span></span></code></pre></div><p>‍</p><h3 id=配置sessionprovider>配置<code>SessionProvider</code><a class=anchorjs-link href=#%e9%85%8d%e7%bd%aesessionprovider></a></h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// pages/_app.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { SessionProvider } from <span style=color:#40a02b>&#34;next-auth/react&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> <span style=color:#d20f39>function</span> App({Component, pageProps<span style=color:#04a5e5;font-weight:700>:</span> { session, ...pageProps }}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>SessionProvider session<span style=color:#04a5e5;font-weight:700>=</span>{session}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>Component {...pageProps} <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/SessionProvider&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>}
</span></span></code></pre></div><p>至此，关于身份验证的准备工作已经完成，开始用用吧。</p><p>‍</p><h3 id=获取github用户信息>获取Github用户信息<a class=anchorjs-link href=#%e8%8e%b7%e5%8f%96github%e7%94%a8%e6%88%b7%e4%bf%a1%e6%81%af></a></h3><p>做了个头部文件，增加了导航，然后通过<code>useSession</code>和<code>getSession</code>进行身份获取，以及是否获取到身份信息，对数据进行守卫。</p><p>以下仅在代码中进行说明。</p><p>‍</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// components/navbar.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { Flex } from <span style=color:#40a02b>&#39;@chakra-ui/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> Link from <span style=color:#40a02b>&#39;next/link&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> { signIn, signOut, useSession } from <span style=color:#40a02b>&#39;next-auth/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>const</span> handleSignIn <span style=color:#04a5e5;font-weight:700>=</span> e =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  e.preventDefault()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  signIn() <span style=color:#9ca0b0;font-style:italic>// next auth提供的登录方法，会跳转到 /pages/api/auth/signin
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#8839ef>const</span> handleSignOut <span style=color:#04a5e5;font-weight:700>=</span> e =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  e.preventDefault()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  signOut() <span style=color:#9ca0b0;font-style:italic>// next auth提供的登出方法，会跳转到 /pages/api/auth/signout
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#8839ef>const</span> Navbar <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>const</span> { data, status } <span style=color:#04a5e5;font-weight:700>=</span> useSession()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    &lt;<span style=color:#8839ef>Flex</span> <span style=color:#1e66f5>justify</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;space-between&#39;</span> <span style=color:#1e66f5>align</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;center&#39;</span> <span style=color:#1e66f5>px</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;5&#39;</span> <span style=color:#1e66f5>h</span><span style=color:#04a5e5;font-weight:700>=</span>{<span style=color:#fe640b>12</span>} <span style=color:#1e66f5>bgColor</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;blue.500&#39;</span> <span style=color:#1e66f5>color</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;#fff&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-brand&#39;</span>&gt;NEXT AUTH&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      &lt;<span style=color:#8839ef>Navs</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>        &lt;<span style=color:#8839ef>Link</span> <span style=color:#1e66f5>href</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;/&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>          &lt;<span style=color:#8839ef>a</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-link-item&#39;</span>&gt;首页&lt;/<span style=color:#8839ef>a</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>        &lt;/<span style=color:#8839ef>Link</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>        {status <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;authenticated&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>          &lt;<span style=color:#8839ef>Link</span> <span style=color:#1e66f5>href</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;/dashboard&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>            &lt;<span style=color:#8839ef>a</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-link-item&#39;</span>&gt;控制面板&lt;/<span style=color:#8839ef>a</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>          &lt;/<span style=color:#8839ef>Link</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>        )}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>        &lt;<span style=color:#8839ef>Link</span> <span style=color:#1e66f5>href</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;/blog&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>          &lt;<span style=color:#8839ef>a</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-link-item&#39;</span>&gt;博客&lt;/<span style=color:#8839ef>a</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>        &lt;/<span style=color:#8839ef>Link</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>        {status <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;unauthenticated&#39;</span> <span style=color:#04a5e5;font-weight:700>?</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>          &lt;<span style=color:#8839ef>Link</span> <span style=color:#1e66f5>href</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;/api/auth/signin&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>            &lt;<span style=color:#8839ef>a</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-link-item&#39;</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{e =&gt; handleSignIn(e)}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>              登录
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>            &lt;/<span style=color:#8839ef>a</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>          &lt;/<span style=color:#8839ef>Link</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>        ) <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>null</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>        {status <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;authenticated&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>          <span style=color:#04a5e5;font-weight:700>?</span> data <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>              &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;user-block&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>                &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;user-avatar&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>                  &lt;<span style=color:#8839ef>img</span> <span style=color:#1e66f5>src</span><span style=color:#04a5e5;font-weight:700>=</span>{data.user.image} /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>                &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>                &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;user-info&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>                  &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;user-name&#39;</span>&gt;{data.user.name}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>                  &lt;<span style=color:#8839ef>div</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;user-mail&#39;</span>&gt;{data.user.email}&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>                &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>              &lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>            )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>          <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>null</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>        {status <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;authenticated&#39;</span> <span style=color:#04a5e5;font-weight:700>?</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>          &lt;<span style=color:#8839ef>Link</span> <span style=color:#1e66f5>href</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;/api/auth/signout&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>            &lt;<span style=color:#8839ef>a</span> <span style=color:#1e66f5>className</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;nav-link-item&#39;</span> <span style=color:#1e66f5>onClick</span><span style=color:#04a5e5;font-weight:700>=</span>{e =&gt; handleSignOut(e)}&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>              登出
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>            &lt;/<span style=color:#8839ef>a</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>          &lt;/<span style=color:#8839ef>Link</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>        ) <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>null</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>      &lt;/<span style=color:#8839ef>Navs</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>    &lt;/<span style=color:#8839ef>Flex</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Navbar
</span></span></code></pre></div><p>说明：</p><ol><li><p><code>useSession()</code>返回两个值的对象：<code>data</code>和<code>status</code>。</p></li><li><p><code>data</code>根据情况会返回三个值：</p><ol><li>当未获取会话返回<code>undefined</code>。</li><li>未能检索到会话返回<code>null</code>。</li><li>成功则返回<code>session</code>。<code>session</code>就是<code>github</code>返回的用户信息。</li></ol></li><li><p><code>status</code>根据上述三种情况的会话，返回<code>loading</code>、<code>authenticated</code>、<code>unauthenticated</code>。表示登录中、已登录、未登录。</p></li><li><p>上面的代码，通过<code>status</code>的值进行判断，在导航上显示哪些在未登录，哪些内容在已登录。</p></li></ol><p>‍</p><h3 id=权限守护>权限守护<a class=anchorjs-link href=#%e6%9d%83%e9%99%90%e5%ae%88%e6%8a%a4></a></h3><p>因为共享了登录状态，所以可以在所有页面通过<code>useSession</code>获取到用户信息。通过<code>getSession</code>做权限守护。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React, { useState, useEffect } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { Box } from <span style=color:#40a02b>&#39;@chakra-ui/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { useSession, getSession, signIn } from <span style=color:#40a02b>&#39;next-auth/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> Dashboard <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> { data } <span style=color:#04a5e5;font-weight:700>=</span> useSession()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> [loading, setLoading] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#9ca0b0;font-style:italic>// 权限守护
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#8839ef>const</span> sectPage <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#8839ef>const</span> session <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getSession()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    <span style=color:#9ca0b0;font-style:italic>// 如果没有获取到session，则跳转到登录
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>    <span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>session) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      signIn()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      <span style=color:#9ca0b0;font-style:italic>// 如果获取到session则结束loading
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>      setLoading(<span style=color:#fe640b>false</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  useEffect(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    sectPage()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  <span style=color:#8839ef>if</span> (loading) <span style=color:#04a5e5;font-weight:700>&lt;</span>div<span style=color:#04a5e5;font-weight:700>&gt;</span>登录中...<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  <span style=color:#9ca0b0;font-style:italic>// 如果有data，则显示data中的用户名称。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#8839ef>return</span> <span style=color:#04a5e5;font-weight:700>&lt;</span>Box p<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;4&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>Dashboard {data <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> <span style=color:#40a02b>`欢迎您：</span><span style=color:#40a02b>${</span>data.user.name<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/Box&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Dashboard
</span></span></code></pre></div><p>下面的代码也是权限守护，如果未登录则跳转到登录，如果登录了，则显示对应的数据。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> React from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { Box, Text } from <span style=color:#40a02b>&#39;@chakra-ui/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { getSession } from <span style=color:#40a02b>&#39;next-auth/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> Blog <span style=color:#04a5e5;font-weight:700>=</span> ({ data, isLogin, session }) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  console.log(<span style=color:#40a02b>&#39;isLogin&#39;</span>, isLogin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  console.log(<span style=color:#40a02b>&#39;session&#39;</span>, session)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>isLogin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>    <span style=color:#8839ef>return</span> &lt;<span style=color:#8839ef>div</span>&gt;无权查看&lt;/<span style=color:#8839ef>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    &lt;<span style=color:#8839ef>Box</span> <span style=color:#1e66f5>m</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;20px auto&#39;</span> <span style=color:#1e66f5>p</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;0 20px&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      {data<span style=color:#04a5e5;font-weight:700>?</span>.map(post =&gt; (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>        &lt;<span style=color:#8839ef>Text</span> <span style=color:#1e66f5>key</span><span style=color:#04a5e5;font-weight:700>=</span>{post.id} <span style=color:#1e66f5>align</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;left&#39;</span> <span style=color:#1e66f5>fontSize</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;md&#39;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>          {post.title}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>        &lt;/<span style=color:#8839ef>Text</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      ))}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    &lt;/<span style=color:#8839ef>Box</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Blog
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>async</span> <span style=color:#d20f39>function</span> getServerSideProps(context) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  <span style=color:#8839ef>const</span> session <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getSession(context)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  <span style=color:#8839ef>const</span> response <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> fetch(<span style=color:#40a02b>`https://jsonplaceholder.typicode.com/posts`</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  <span style=color:#8839ef>const</span> data <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> response.json()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#9ca0b0;font-style:italic>// 权限守护，未登录返回登录，已登录可以返回数据。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#9ca0b0;font-style:italic></span>  <span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>session) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      redirect<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>        destination<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>`/api/auth/signin?callbackUrl=http://localhost:3000/blog`</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>        permanent<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>false</span> <span style=color:#9ca0b0;font-style:italic>// false不是永久重定向，临时的。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span><span style=color:#9ca0b0;font-style:italic></span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  <span style=color:#8839ef>return</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>    props<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>      isLogin<span style=color:#04a5e5;font-weight:700>:</span> session <span style=color:#04a5e5;font-weight:700>?</span> <span style=color:#fe640b>true</span> <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>false</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>      data<span style=color:#04a5e5;font-weight:700>:</span> session <span style=color:#04a5e5;font-weight:700>?</span> data <span style=color:#04a5e5;font-weight:700>:</span> []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>}
</span></span></code></pre></div><p>‍</p><h3 id=api路由守护>API路由守护<a class=anchorjs-link href=#api%e8%b7%af%e7%94%b1%e5%ae%88%e6%8a%a4></a></h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// pages/api/text-session.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { getSession } from <span style=color:#40a02b>&#39;next-auth/react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> handler <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> (req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  <span style=color:#8839ef>const</span> session <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> getSession({ req })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>if</span> (<span style=color:#04a5e5;font-weight:700>!</span>session) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>    <span style=color:#8839ef>return</span> res.status(<span style=color:#fe640b>401</span>).json({ error<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;unauthenticated user&#39;</span> }) <span style=color:#9ca0b0;font-style:italic>// 如果没有session返回错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>  } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#8839ef>return</span> res.status(<span style=color:#fe640b>200</span>).json({ message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;success&#39;</span>, session }) <span style=color:#9ca0b0;font-style:italic>// 如果有session返回用户信息
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> handler
</span></span></code></pre></div><p>‍</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/nextjs%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8C/ data-toggle=tooltip data-placement=top title=NextJS重新学习之二>Previous<br><span>NextJS重新学习之二</span></a></li><li class=next><a href=/posts/strapi-graphql-%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%AE%B0/ data-toggle=tooltip data-placement=top title="Strapi + Graphql 使用小记">Next<br><span>Strapi + Graphql 使用小记</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>