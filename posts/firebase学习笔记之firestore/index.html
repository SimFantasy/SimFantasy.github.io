<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Firebase学习笔记之Firestore | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="Firebase是Google的一个线上数据服务，提供在线的数据库和权限、资源存储等。这次一起来学习一下。
教程可以参考 The Net Ninja 大神的Firebase 9 Tutorial
因为Firebase的内容太多，我们分了两个部分。这个部分是数据的CURD。
‍"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Firebase学习笔记之Firestore"><meta name=twitter:description content="Firebase是Google的一个线上数据服务，提供在线的数据库和权限、资源存储等。这次一起来学习一下。
教程可以参考 The Net Ninja 大神的Firebase 9 Tutorial
因为Firebase的内容太多，我们分了两个部分。这个部分是数据的CURD。
‍"><meta property="og:url" content="http://localhost/posts/firebase%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bfirestore/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="Firebase学习笔记之Firestore"><meta property="og:description" content="Firebase是Google的一个线上数据服务，提供在线的数据库和权限、资源存储等。这次一起来学习一下。
教程可以参考 The Net Ninja 大神的Firebase 9 Tutorial
因为Firebase的内容太多，我们分了两个部分。这个部分是数据的CURD。
‍"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-10T16:32:52+00:00"><meta property="article:modified_time" content="2022-11-10T16:32:52+00:00"><meta property="article:tag" content="React"><meta property="article:tag" content="Firebase"><meta property="og:see_also" content="http://localhost/posts/react-hooks/"><meta property="og:see_also" content="http://localhost/posts/zustand/"><meta property="og:see_also" content="http://localhost/posts/react-hook-form/"><meta property="og:see_also" content="http://localhost/posts/react%E7%8A%B6%E6%80%81%E6%A8%AA%E8%AF%84/"><meta property="og:see_also" content="http://localhost/posts/react-route-6-4%E5%8A%9F%E8%83%BD/"><meta property="og:see_also" content="http://localhost/posts/chakraui-%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F%E5%88%87%E6%8D%A2/"><meta property="og:see_also" content="http://localhost/posts/firebase%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bauth%E5%92%8Cstorage/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Firebase学习笔记之Firestore</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2022-11-10</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=React>React</a>
<a href=/tags/firebase/ title=Firebase>Firebase</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p><code>Firebase</code>是<code>Google</code>的一个线上数据服务，提供在线的数据库和权限、资源存储等。这次一起来学习一下。</p><p>教程可以参考 The Net Ninja 大神的<a href="https://www.youtube.com/playlist?list=PL4cUxeGkcC9jERUGvbudErNCeSZHWUVlb" target=_blank>Firebase 9 Tutorial</a></p><p>因为<code>Firebase</code>的内容太多，我们分了两个部分。这个部分是数据的<code>CURD</code>。</p><p>‍</p><h3 id=添加firebase项目>添加Firebase项目<a class=anchorjs-link href=#%e6%b7%bb%e5%8a%a0firebase%e9%a1%b9%e7%9b%ae></a></h3><p>因为是个在线的服务，所以现需要去谷歌<code>Firebase</code>官网去添加项目。以下为添加项目步骤：</p><ol><li>进入官网<code>https://firebase.google.com</code>。</li><li>登录后，在首页点击<code>开始使用</code>或者右上角的<code>控制台</code>，进入控制面板页面。</li></ol><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/0577266b4540a9fe614ac02cb2cab757/image.png data-action=zoom alt title=Firebase首页 class=lazyload></a><figcaption class=image-caption>Firebase首页</figcaption></figure></p><ol start=3><li>在控制面板点击添加项目。</li></ol><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/650bf5772876dda4b14ab24c521700ca/image.png data-action=zoom alt title=添加项目 class=lazyload></a><figcaption class=image-caption>添加项目</figcaption></figure></p><ol start=4><li>然后创建项目名称，点击确定。</li><li>然后会提示是否需要添加谷歌分析，选择关闭，点击创建项目。</li><li>项目创建完成后，点击继续按钮，进入项目控制面板。</li><li>选择项目的类型，我们使用的是<code>web应用</code>。</li></ol><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/e799a3842c540ec3fc409796c467e8a4/image.png data-action=zoom alt title=选择web应用 class=lazyload></a><figcaption class=image-caption>选择web应用</figcaption></figure>​</p><ol start=8><li>点击网页应用后，开始注册应用，填写网页应用名称。</li><li>点击注册应用按钮。会生成项目的<code>SDK</code>。</li></ol><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/759074adeda7c3b6ce63d7f009c9940c/image.png data-action=zoom alt title=生成SDK class=lazyload></a><figcaption class=image-caption>生成SDK</figcaption></figure>​</p><ol start=10><li>按照要求，在项目中安装<code>Firebase</code>的包，复制配置内容到项目，并且开始使用它提供的<code>config</code>内容。</li><li>点击继续前往控制台按钮，在网页应用项目的首页，可以看到这个项目中的应用。点击按钮，可以查看这个网页应用项目中的所有应用，点击我们刚创建的项目后的图标。可以进入项目的配置管理。</li></ol><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/42a9528c96d7ce10fac6c19e29732a95/image.png data-action=zoom alt title=选择应用 class=lazyload></a><figcaption class=image-caption>选择应用</figcaption></figure></p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/3570d1e8e545d1f42cda9a5d630bc0f4/image.png data-action=zoom alt title=进入应用配置 class=lazyload></a><figcaption class=image-caption>进入应用配置</figcaption></figure></p><ol start=12><li>在项目设置页面中，常规选项卡下，我们可以看到之前系统生成到<code>SDK</code>。至此项目添加完毕。</li></ol><p>‍</p><h3 id=项目中配置firebase>项目中配置Firebase<a class=anchorjs-link href=#%e9%a1%b9%e7%9b%ae%e4%b8%ad%e9%85%8d%e7%bd%aefirebase></a></h3><ol><li><p>安装<code>Firebase</code>的包。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add firebase
</span></span></code></pre></div></li><li><p>在项目根目录下添加一个<code>firebase-config.js</code>的配置文件。为了个更好的保护<code>config</code>中的内容，不会被滥用，我们将<code>config</code>的内容添加到<code>.env</code>文件中。然后再添加过来。</p><p><code>vite</code>的导入和<code>webpack</code>的<code>.env</code>配置方式不一样。</p><ol><li><code>vite</code>的添加到<code>.env</code>文件中需要使用<code>VITE_</code>开头，在项目中使用<code>import.meta.env.VITE_</code>​引用。</li><li><code>webpack</code>的添加到<code>.env</code>文件中需要使用<code>REACT_APP_</code>开头，在项目使用<code>process.env.REACT_APP_</code>引用。</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// firebase-config.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { initializeApp } from <span style=color:#40a02b>&#39;firebase/app&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> firebaseConfig <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  apiKey<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_APP_KEY,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  authDomain<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_AUTH_DOMAIN,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  projectId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_PROJECT_ID,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  storageBucket<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_STORAGE_BUCKET,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  messagingSenderId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_MESSAGING_SENDER_ID,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  appId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_APP_ID
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#9ca0b0;font-style:italic>// 初始化Firebase
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> app <span style=color:#04a5e5;font-weight:700>=</span> initializeApp(firebaseConfig)
</span></span></code></pre></div></li></ol><p>‍</p><h3 id=连接firestore>连接Firestore<a class=anchorjs-link href=#%e8%bf%9e%e6%8e%a5firestore></a></h3><p>在<code>firebase-config.js</code>文件中导入<code>getFiresotre</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// firebase-config.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { initializeApp } from <span style=color:#40a02b>&#39;firebase/app&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { getFirestore } from <span style=color:#40a02b>&#39;firebase/firestore&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>const</span> firebaseConfig <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  apiKey<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_APP_KEY,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  authDomain<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_AUTH_DOMAIN,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  projectId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_PROJECT_ID,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  storageBucket<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_STORAGE_BUCKET,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  messagingSenderId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_MESSAGING_SENDER_ID,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  appId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>import</span>.meta.env.VITE_APP_ID
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic>// 初始化Firebase
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> app <span style=color:#04a5e5;font-weight:700>=</span> initializeApp(firebaseConfig)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#9ca0b0;font-style:italic>// 初始化Firestore服务
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> db <span style=color:#04a5e5;font-weight:700>=</span> getFirestore(app)
</span></span></code></pre></div><p>至此，基础配置我们已经处理完成。下面就开始业务方面的操作。</p><p><code>Firebase</code>的<code>Firestore</code>，其实是<code>Firebase</code>中<code>Cloud Firestore</code>中的业务。我们通过两个阶段来完成一个简单的<code>CURD</code>示例。为了更好的使用我们将与<code>Firestore</code>交互的都放到<code>store</code>中，方便数据的在各个模块间进行调用。</p><p>‍</p><h3 id=基础版>基础版<a class=anchorjs-link href=#%e5%9f%ba%e7%a1%80%e7%89%88></a></h3><p>如果只需要简单的数据交互，从<code>Firestore</code>中添加、更新、删除、获取所有数据、获取单个数据。我们就不需要使用到<code>store</code>了。</p><p>示例为一个书籍列表增删改查，我们先来看下怎么从<code>Firebase</code>中设置数据结构。</p><p>‍</p><h4 id=设置firestore数据结构>设置Firestore数据结构<a class=anchorjs-link href=#%e8%ae%be%e7%bd%aefirestore%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84></a></h4><p>创建完下面，我们在项目面板的页面找到<code>Cloud Firestore</code>的板块。点击进入。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/f2418be91f1c4fb74fe3dfde4946f422/image.png data-action=zoom alt class=lazyload></a></figure></p><p>‍</p><p>进入后，我们到了<code>Cloud Firestore</code>的管理页面，但是目前尚无内容，所以点击 创建数据库按钮，就可以开始设置我们需要的数据内容了。另外在左侧的菜单栏中会记录已经使用的模块。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/9c3c1d256006d158db7fa889b3f41447/image.png data-action=zoom alt class=lazyload></a></figure></p><p>‍</p><p>点击 创建数据库 后，会弹出创建数据库引导。 选择数据库模式，我们选择以测试数据开始。方便后面数据连接使用。点击下一步。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/304ca3e5b809d0cec3119b2055def0fb/image.png data-action=zoom alt class=lazyload></a></figure></p><p>‍</p><p>来到数据位置，我们可以选择亚洲的数据服务，随便选择一个即可。然后点击启用，就配置好了数据库。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/3128a424ab912a1c47341dfe09fd83ff/image.png data-action=zoom alt class=lazyload></a></figure>​</p><p>‍</p><p>稍等一会，待系统完成数据预配置。就自动进入到数据管理界面。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/2eb62d2bbaf0c984b1bb9e0ed293bc53/image.png data-action=zoom alt class=lazyload></a></figure>​</p><p>这里 点击 开始收集，这里可以理解为 <code>Firestore</code> 是一个数据库的表，但是他这里称为集合。数据库中所有的表的数据，都称为文档。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/c919f49953bc1b3c7785b6b9370c6b85/image.png data-action=zoom alt class=lazyload></a></figure></p><p>我们输入 <code>books</code>，点击下一步，就会让我们来创创建集合中的文档。我们直接创建一个文档内容，作为初始数据。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/b0fcf5f96a3fd7385990a93fadf4a129/image.png data-action=zoom alt class=lazyload></a></figure></p><p>‍</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/a001136b76a3987876a2061f9294a4fd/image.png data-action=zoom alt class=lazyload></a></figure></p><p>‍</p><p>点击 保存 后，就可以在管理界面看到集合及其下级的文档了。这个数据结构很清晰。</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/50b0779d639d2c23b0b8221c2f23d137/image.png data-action=zoom alt class=lazyload></a></figure></p><p>以上就是在<code>Firestore</code>创建基本数据结构的流程。下面我开始业务的编码。</p><p>‍</p><h4 id=firestore数据交互>Firestore数据交互<a class=anchorjs-link href=#firestore%e6%95%b0%e6%8d%ae%e4%ba%a4%e4%ba%92></a></h4><p>我们创建一个<code>services</code>的目录，并添加<code>books.service.js</code>的文件，作为处理<code>Firestore</code>业务的文件。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/services/books.service.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic>// 连接Firestore的数据服务
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> { db } from <span style=color:#40a02b>&#39;../../firebase-config&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#9ca0b0;font-style:italic>// Firestore提供的数据方法
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> { collection, getDocs, getDoc, addDoc, updateDoc, deleteDoc, doc } from <span style=color:#40a02b>&#39;firebase/firestore&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>const</span> bookCollectionRef <span style=color:#04a5e5;font-weight:700>=</span> collection(db, <span style=color:#40a02b>&#39;books&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#8839ef>const</span> booksAction <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#9ca0b0;font-style:italic>// 添加书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>  addBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> newBook =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> addDoc(bookCollectionRef, newBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  <span style=color:#9ca0b0;font-style:italic>// 更新书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>  updateBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> (id, updateBook) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> updateDoc(docBook, updateBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  <span style=color:#9ca0b0;font-style:italic>// 删除书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#9ca0b0;font-style:italic></span>  deleteBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> deleteDoc(docBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  <span style=color:#9ca0b0;font-style:italic>// 获取所有书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#9ca0b0;font-style:italic></span>  getAllBooks<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>    <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> getDocs(bookCollectionRef)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  <span style=color:#9ca0b0;font-style:italic>// 获取单本书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span><span style=color:#9ca0b0;font-style:italic></span>  getBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>    <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> getDoc(docBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> booksAction
</span></span></code></pre></div><p>我们先来看看Firestore提供的几个数据操作的方法。</p><p><strong><code>collection()</code></strong>：获取引用指定路径的集合实例。通过这个方法，可以获取到我们在<code>Firestore</code>中集合的位置。我们将位置指向<code>books</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> bookCollectionRef <span style=color:#04a5e5;font-weight:700>=</span> collection(db, <span style=color:#40a02b>&#39;books&#39;</span>)
</span></span></code></pre></div><p><strong><code>doc()</code></strong>：获取引用指定路径的文档实例。通过这个方法，可以获取到我们在<code>Firestore</code>中文档的位置。因为文档创建默认使用的是<code>id</code>作为索引，所以最后一个参数为id。后面我们也可以通过<code>setDoc</code>来创建集合中文档的索引。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span></code></pre></div><p><strong><code>getDocs()</code></strong>：执行集合所有文档的查询。传入集合的位置，就可以返回所有集合。</p><p>参数：</p><p><code>query</code>需要查询哪个集合<code>bookCollectionRef</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>getAllBooks<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> getDocs(bookCollectionRef)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>},
</span></span></code></pre></div><p><strong><code>getDoc()</code></strong>：执行文档的查询。传入文档的索引即可。</p><p>参数：</p><p><code>reference</code>，需要查询哪个文档<code>docBook</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>getBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> getDoc(docBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>}
</span></span></code></pre></div><p><strong><code>addDoc()</code></strong>：使用指定的数据添加新文档，并自动分配文档<code>id</code>。</p><p>参数：</p><p><code>reference</code>，需要添加到哪个集合<code>bookCollectionRef</code>。</p><p><code>data</code>，添加的文档数据<code>newBook</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>addBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> newBook =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> addDoc(bookCollectionRef, newBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>}
</span></span></code></pre></div><p><strong><code>updateDoc()</code></strong>：更新文档中指定的字段，如果文档不存在将更新失败。</p><p>参数：</p><p><code>reference</code>，指定需要更新的文档<code>docBook</code>。</p><p><code>data</code>，需要更新的文档字段数据<code>updateBook</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>updateBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> (id, updateBook) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> updateDoc(docBook, updateBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>}
</span></span></code></pre></div><p><strong><code>deleteDoc()</code></strong>：删除指定的文档。</p><p>参数：</p><p><code>reference</code>：需要删除的文档<code>docBook</code>。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>deleteBook<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  <span style=color:#8839ef>const</span> docBook <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  <span style=color:#8839ef>return</span> <span style=color:#8839ef>await</span> deleteDoc(docBook)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>}
</span></span></code></pre></div><p>‍</p><p>以上为<code>Firestore</code>的数据操作。接下来一起看下怎么在界面中使用这些数据操作的方法。</p><p>界面效果：</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/37f4e5861d51fb131954a7c49fbbab86/image.png data-action=zoom alt class=lazyload></a></figure>​</p><p>‍</p><h4 id=界面数据交互>界面数据交互<a class=anchorjs-link href=#%e7%95%8c%e9%9d%a2%e6%95%b0%e6%8d%ae%e4%ba%a4%e4%ba%92></a></h4><p>界面分为三个部分，<code>Add</code>、<code>List</code>、<code>index</code>​。</p><h5 id=booklist>BookList<a class=anchorjs-link href=#booklist></a></h5><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/BookList/index.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useState } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> List from <span style=color:#40a02b>&#39;@/pages/List/List&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> Add from <span style=color:#40a02b>&#39;@/pages/List/Add&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> BookList <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> [id, setId] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;max-w-5xl mx-auto&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>Add bookId<span style=color:#04a5e5;font-weight:700>=</span>{id} <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>List setBookId<span style=color:#04a5e5;font-weight:700>=</span>{setId} <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> BookList
</span></span></code></pre></div><p>因为没有使用<code>store</code>作为数据传递，就只能在<code>Add</code>组件和<code>List</code>组件的公共页面来传递<code>id</code>。通过<code>List</code>组件传递的<code>id</code>，在<code>Add</code>组件中查询修改的文档索引。</p><p>‍</p><h5 id=add>Add<a class=anchorjs-link href=#add></a></h5><p>因为使用了<code>tailwindcss</code>来写样式所以<code>html</code>模板的结构会有些乱。可以参考界面效果。</p><p>这个组件主要实现三个功能：</p><ol><li>获取需要添加的数据。</li><li>通过从<code>List</code>组件中传递过来的<code>id</code>，来查询对应的文档。并设置到对应的表单项上。</li><li>对添加的数据进行保存判断，如果没有获取到传递的id，就是添加新数据，如果有获取到传递过来的<code>id</code>就是更新数据。</li></ol><p>注意事项：</p><ol><li>需要对传递过来的<code>id</code>进行判断，通过<code>useEffect</code>方法的触发条件来产生副作用，将通过<code>id</code>查询到的文档数据填入到表单中。</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/BookList/Add.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useState, useEffect } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> bookAction from <span style=color:#40a02b>&#39;@/services/books.service&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>const</span> Add <span style=color:#04a5e5;font-weight:700>=</span> props =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#8839ef>const</span> [title, setTitle] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> [author, setAuthor] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>const</span> [errorMessage, setErrorMessage] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  <span style=color:#8839ef>const</span> handleSubmit <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    <span style=color:#8839ef>if</span> (title.trim() <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#04a5e5;font-weight:700>||</span> author.trim() <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      setErrorMessage(<span style=color:#40a02b>&#39;请输入书名或作者&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      <span style=color:#8839ef>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    <span style=color:#8839ef>const</span> book <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      title,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>      author
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    <span style=color:#8839ef>if</span> (props.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>undefined</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> props.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      <span style=color:#8839ef>await</span> bookAction.updateBook(props.bookId, book)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>      <span style=color:#8839ef>await</span> bookAction.addBook(book)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>    setTitle(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>    setAuthor(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  <span style=color:#8839ef>const</span> handleGetBook <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>    <span style=color:#8839ef>const</span> abook <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> bookAction.getBook(props.bookId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    console.log(abook.data())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>    setTitle(abook.data().title)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>    setAuthor(abook.data().author)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  useEffect(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>    <span style=color:#8839ef>if</span> (props.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>undefined</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> props.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>      console.log(props.bookId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>      handleGetBook()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>  }, [props.bookId])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full flex justify-between items-center my-10&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>      {errorMessage <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#04a5e5;font-weight:700>?</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;alert alert-error max-w-xl rounded-md absolute top-10 right-10&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>div<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>span className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text-white text-sm&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>{errorMessage}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/span&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>      ) <span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>null</span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full flex justify-start items-center&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>label htmlFor<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;title&#39;</span> className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-14 h-10 flex justify-start items-center&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>          书名
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/label&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>          type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>          name<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;title&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>          className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;input input-bordered w-full max-w-xs input-sm rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>          value<span style=color:#04a5e5;font-weight:700>=</span>{title}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>          onChange<span style=color:#04a5e5;font-weight:700>=</span>{e =&gt; setTitle(e.target.value)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>        <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full flex justify-start items-center ml-4&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>label htmlFor<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;author&#39;</span> className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-14 h-10 flex justify-start items-center&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>          作者
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/label&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>          type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span>          name<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;author&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>          className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;input input-bordered w-full max-w-xs input-sm rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span>          value<span style=color:#04a5e5;font-weight:700>=</span>{author}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">74</span><span>          onChange<span style=color:#04a5e5;font-weight:700>=</span>{e =&gt; setAuthor(e.target.value)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">75</span><span>        <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">76</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">77</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full flex justify-start items-center ml-4&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">78</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>button className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-sm rounded-md font-normal&#39;</span> type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;submit&#39;</span> onClick<span style=color:#04a5e5;font-weight:700>=</span>{handleSubmit}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">79</span><span>          保存
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">80</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">81</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">82</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">83</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">84</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">85</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">86</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Add
</span></span></code></pre></div><p>‍</p><h5 id=list>List<a class=anchorjs-link href=#list></a></h5><p><code>List</code>组件主要实现三个功能。</p><ol><li>获取<code>Firestore</code>中的数据，并展示。</li><li>通过数据的id进行文档的删除。</li><li>通过数据的id，传递给<code>Add</code>组件，执行文档的获取，以便进行修改更新该文档的数据。</li></ol><p>注意事项：</p><ol><li>集合数据的获取，有两种方式，一种是在<code>Firestore</code>数据交互时，获取到数据，通过<code>forEach</code>遍历出来，后面的示例中，将使用这个方式。还有一种是现在的方式，在界面交互时，通过<code>map</code>的方式讲数据遍历出来。</li><li><code>Firestore</code>的数据在获取后，头需要通过<code>data()</code>方法展示出啦。</li><li>返回的集合数据，需要注意数据结构，<code>id</code>是放在文档数据之外的。没有和文档数据放在一起。</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/BookList/List.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useEffect, useState } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> booksAction from <span style=color:#40a02b>&#39;@/services/books.service&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { doc } from <span style=color:#40a02b>&#39;firebase/firestore&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> List <span style=color:#04a5e5;font-weight:700>=</span> props =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> [books, setBooks] <span style=color:#04a5e5;font-weight:700>=</span> useState([])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> getBooks <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    <span style=color:#8839ef>const</span> data <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> booksAction.getAllBooks()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    setBooks(data.docs.map(doc =&gt; ({ ...doc.data(), id<span style=color:#04a5e5;font-weight:700>:</span> doc.id })))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  useEffect(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    getBooks()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>const</span> handleDeleteBook <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    <span style=color:#8839ef>await</span> booksAction.deleteBook(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    getBooks()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;border rounded-lg&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>table className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;table w-full&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>thead<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>tr<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>ID<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>书名<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>作者<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>操作<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tr&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/thead&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>tbody<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>            {books<span style=color:#04a5e5;font-weight:700>?</span>.map(book =&gt; (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>tr key<span style=color:#04a5e5;font-weight:700>=</span>{book.id}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.id}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.title}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.author}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>                  <span style=color:#04a5e5;font-weight:700>&lt;</span>button
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>                    className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-sm mr-4 font-normal rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>                    onClick<span style=color:#04a5e5;font-weight:700>=</span>{() =&gt; props.setBookId(book.id)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>                  <span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>                    修改
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>                  <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>                  <span style=color:#04a5e5;font-weight:700>&lt;</span>button
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>                    className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-error btn-sm text-white font-normal rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>                    onClick<span style=color:#04a5e5;font-weight:700>=</span>{() =&gt; handleDeleteBook(book.id)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>                  <span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>                    删除
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>                  <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tr&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>            ))}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tbody&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/table&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> List
</span></span></code></pre></div><p>‍</p><p>通过这个简单的示例，可以看到使用<code>Firebase</code>提供的方法，实现<code>CURD</code>还是很简单的。</p><p>但我们也可以发现几个问题：</p><ol><li>列表的数据没有按添加顺序排序，默认是通过<code>id</code>​进行排序的，但是他的<code>id</code>并不是顺序数字，只是一个唯一的字符串，不存在排序顺序条件。</li><li>数据更新以后需要刷新才能看到更新的数据。当然也可以通过调用查询方法再更新后再查一次。但修改、删除也都需要调用此方法，很麻烦。<code>Firestore</code>​有更好的方法。</li></ol><p>‍</p><h3 id=升级版>升级版<a class=anchorjs-link href=#%e5%8d%87%e7%ba%a7%e7%89%88></a></h3><p>升级版，我们将通过<code>onSnapshop</code>、<code>query</code>、<code>where</code>、<code>orderBy</code>、<code>serverTimestamp</code>​方法来实现自动更新列表，按添加时间进行排序，按作者查询书籍的功能。</p><p>‍</p><p>界面效果：</p><p><figure><a class=paragraph-image><img data-src=https://p.sda1.dev/8/5f7a6d167b8ee6cad604383fee5bfcc6/image.png data-action=zoom alt class=lazyload></a></figure>​</p><p>‍</p><h4 id=firestore数据交互-1>Firestore数据交互<a class=anchorjs-link href=#firestore%e6%95%b0%e6%8d%ae%e4%ba%a4%e4%ba%92-1></a></h4><p>升级版中我们使用<code>valtio</code>这个简单的状态库作为store。所以我们在src下新建一个store的目录，下面添加<code>books.store.js</code>文件。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/store/books.store.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { proxy } from <span style=color:#40a02b>&#39;valtio&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { db } from <span style=color:#40a02b>&#39;firebaseConfig&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  collection,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  getDoc,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  addDoc,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  updateDoc,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  deleteDoc,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  doc,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  onSnapshot,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  query,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  where,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  orderBy,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  serverTimestamp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>} from <span style=color:#40a02b>&#39;firebase/firestore&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> bookStore <span style=color:#04a5e5;font-weight:700>=</span> proxy({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  books<span style=color:#04a5e5;font-weight:700>:</span> [], <span style=color:#9ca0b0;font-style:italic>// 所有书籍
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#9ca0b0;font-style:italic></span>  bookId<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#9ca0b0;font-style:italic>// 需要查询的单本数据id
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span><span style=color:#9ca0b0;font-style:italic></span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#8839ef>const</span> docRef <span style=color:#04a5e5;font-weight:700>=</span> collection(db, <span style=color:#40a02b>&#39;books&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> bookAction <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  getBooks<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> keyword =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>    <span style=color:#8839ef>if</span> (keyword <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#04a5e5;font-weight:700>||</span> keyword <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>undefined</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>      <span style=color:#8839ef>const</span> q <span style=color:#04a5e5;font-weight:700>=</span> query(docRef, orderBy(<span style=color:#40a02b>&#39;createAt&#39;</span>, <span style=color:#40a02b>&#39;desc&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>      <span style=color:#8839ef>await</span> onSnapshot(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>        q,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>        snapshot =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>          <span style=color:#d20f39>let</span> books <span style=color:#04a5e5;font-weight:700>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>          snapshot.docs.forEach(book =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>            books.push({ id<span style=color:#04a5e5;font-weight:700>:</span> book.id, ...book.data() })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>          })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>          bookStore.books <span style=color:#04a5e5;font-weight:700>=</span> books
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>        },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>        error =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>          console.log(error.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>      )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>    } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>      <span style=color:#8839ef>const</span> q <span style=color:#04a5e5;font-weight:700>=</span> query(docRef, where(<span style=color:#40a02b>&#39;author&#39;</span>, <span style=color:#40a02b>&#39;==&#39;</span>, keyword), orderBy(<span style=color:#40a02b>&#39;createAt&#39;</span>, <span style=color:#40a02b>&#39;desc&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>      <span style=color:#8839ef>await</span> onSnapshot(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>        q,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>        snapshot =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>          <span style=color:#d20f39>let</span> books <span style=color:#04a5e5;font-weight:700>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>          snapshot.docs.forEach(book =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>            books.push({ id<span style=color:#04a5e5;font-weight:700>:</span> book.id, ...book.data() })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>          })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>          bookStore.books <span style=color:#04a5e5;font-weight:700>=</span> books
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>        },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>        error =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>          console.log(error.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>      )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>  getBook<span style=color:#04a5e5;font-weight:700>:</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>    <span style=color:#8839ef>const</span> bookRef <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>    <span style=color:#8839ef>return</span> getDoc(bookRef)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>  updateBook<span style=color:#04a5e5;font-weight:700>:</span> (id, book) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>    <span style=color:#8839ef>const</span> bookRef <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>    <span style=color:#8839ef>return</span> updateDoc(bookRef, book)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>  deleteBook<span style=color:#04a5e5;font-weight:700>:</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>    <span style=color:#8839ef>const</span> bookRef <span style=color:#04a5e5;font-weight:700>=</span> doc(db, <span style=color:#40a02b>&#39;books&#39;</span>, id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>    <span style=color:#8839ef>return</span> deleteDoc(bookRef)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>  addBook<span style=color:#04a5e5;font-weight:700>:</span> book =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span>    <span style=color:#8839ef>return</span> addDoc(docRef, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">74</span><span>      ...book,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">75</span><span>      createAt<span style=color:#04a5e5;font-weight:700>:</span> serverTimestamp()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">76</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">77</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">78</span><span>  setBookId<span style=color:#04a5e5;font-weight:700>:</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">79</span><span>    bookStore.bookId <span style=color:#04a5e5;font-weight:700>=</span> id
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">80</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">81</span><span>}
</span></span></code></pre></div><p>这里我们单独看下新增的几个方法。</p><p><strong><code>query()</code></strong>：创建一个不可变的查询实例。就是一个查询方法，两个参数，一个查询的集合是什么，使用<code>collection</code>，一个是查询的范围，可以使用<code>where</code>、<code>orderBy</code>等。<code>query</code>可以与<code>onSnapshop</code>搭配使用。</p><p>参数：</p><p><code>query</code>，查询的集合<code>docRef</code>。</p><p><code>queryConstraint</code>，查询的约束条件<code>where</code>和<code>orderBy</code>​。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> q <span style=color:#04a5e5;font-weight:700>=</span> query(docRef, where(<span style=color:#40a02b>&#39;author&#39;</span>, <span style=color:#40a02b>&#39;==&#39;</span>, keyword), orderBy(<span style=color:#40a02b>&#39;createAt&#39;</span>, <span style=color:#40a02b>&#39;desc&#39;</span>))
</span></span></code></pre></div><p><strong><code>where()</code></strong>：创建一个查询约束，强制文档必须包含指定的字段，并且该值应满足所有约束。说人话，配合<code>query</code>使用的查询条件。</p><p>参数：</p><p><code>fieldPath</code>，查询的字段。</p><p><code>opStr</code>，查询运算符，包括：<code>&lt;</code>、<code>&lt;=</code>、<code>==</code>、<code>></code>、<code>>=</code>、<code>!=</code>、<code>array-contains</code>、<code>array-contains-any</code>、<code>in</code>、<code>not-in</code>。具体需要去看下<a href=https://firebase.google.com/docs/firestore/query-data/queries target=_blank>Firestore的文档</a>，这里不展开说明。</p><p><code>value</code>，值，满足条件（约束）的值。</p><p>说明：</p><p><code>where('author', '==', keyword)</code>从这个示例就可以理解为，当<code>author</code>这个字段满足等于<code>==</code>传入的<code>keyword</code>​的这个参数时，约束就得以满足。</p><p>‍</p><p><strong><code>orderBy()</code></strong>：创建一个查询约束，该约束指定字段对查询结果进行排序，可以选择按降序<code>desc</code>或升序<code>asc</code>。</p><p>参数：</p><p><code>fieldPath</code>，排序的字段。</p><p><code>directionStr</code>，排序的方向，默认为升序。</p><p>说明：</p><p><code>orderBy('createAt', 'desc')</code>可以理解为，按创建时间降序排序。</p><p>‍</p><p><strong><code>onSnapshot()</code></strong>：附加事件侦听器，简单来说就是对事件进行订阅，当侦听的对象事件变化时，就提供对应的回调。示例中我们对获取数据进行侦听，当获取的数据增加、被删除、被查询他都返回对应的回调。</p><p>参数：</p><p><code>query</code>，就是上面我们说的查询约束。</p><p><code>options</code>，可以传递给<code>onSnapshot()</code>的选项对象，要控制在结果中包含哪些类型的更改。这个我们基本没用，官方也没有具体的解释说明。</p><p><code>observer</code>，观察对象的回调，包括：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>export</span> declare <span style=color:#d20f39>function</span> onSnapshot<span style=color:#04a5e5;font-weight:700>&lt;</span>T<span style=color:#04a5e5;font-weight:700>&gt;</span>(query<span style=color:#04a5e5;font-weight:700>:</span> Query<span style=color:#04a5e5;font-weight:700>&lt;</span>T<span style=color:#04a5e5;font-weight:700>&gt;</span>, options<span style=color:#04a5e5;font-weight:700>:</span> SnapshotListenOptions, observer<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>    next<span style=color:#04a5e5;font-weight:700>?:</span> (snapshot<span style=color:#04a5e5;font-weight:700>:</span> QuerySnapshot<span style=color:#04a5e5;font-weight:700>&lt;</span>T<span style=color:#04a5e5;font-weight:700>&gt;</span>) =&gt; <span style=color:#8839ef>void</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>    error<span style=color:#04a5e5;font-weight:700>?:</span> (error<span style=color:#04a5e5;font-weight:700>:</span> FirestoreError) =&gt; <span style=color:#8839ef>void</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>    complete<span style=color:#04a5e5;font-weight:700>?:</span> () =&gt; <span style=color:#8839ef>void</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>})<span style=color:#04a5e5;font-weight:700>:</span> Unsubscribe;
</span></span></code></pre></div><p>可以通过调用调用时返回的函数来取消侦听器。</p><p>‍</p><p>我们来一起看下较之前基础版变化比较大的这个获取书籍的方法。</p><p>这个方法，通过传入的keyword来进行判断，如果没有关键字，则直接按查询条件<code>query(docRef, orderBy('createAt', 'desc'))</code>按创建时间降序排序，从<code>books</code>中进行数据查询，获取所有结果。</p><p>如果有关键字，就按查询条件<code>query(docRef, where('author', '==', keyword), orderBy('createAt', 'desc'))</code>，找到符合关键字<code>keyword</code>的<code>author</code>字段中匹配的内容。然后按创建时间倒序排序，从<code>books</code>集合中查询出所有结果。</p><p>这里使用了forEach方法，在获取到侦听的查询结果只有，就将数据放到一个数组中传递给store中的books值。通过获取store中的books值就可以拿到所有书籍。</p><p>另外这里有个坑，一定要在有排序的查询中，返回一个错误消息，因为首次查询Firestore会通过错误返回一个排序的地址，需要让你点击过去，在Firestore中进行排序索引，如果没有这个错误消息，就会一直报错提示。建立字段索引后，就可以按照索引进行排序。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> docRef <span style=color:#04a5e5;font-weight:700>=</span> collection(db, <span style=color:#40a02b>&#39;books&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>getBooks<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#8839ef>async</span> keyword =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  <span style=color:#8839ef>if</span> (keyword <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;&#39;</span> <span style=color:#04a5e5;font-weight:700>||</span> keyword <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#fe640b>undefined</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>    <span style=color:#8839ef>const</span> q <span style=color:#04a5e5;font-weight:700>=</span> query(docRef, orderBy(<span style=color:#40a02b>&#39;createAt&#39;</span>, <span style=color:#40a02b>&#39;desc&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    <span style=color:#8839ef>await</span> onSnapshot(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>      q,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>      snapshot =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>        <span style=color:#d20f39>let</span> books <span style=color:#04a5e5;font-weight:700>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>        snapshot.docs.forEach(book =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>          books.push({ id<span style=color:#04a5e5;font-weight:700>:</span> book.id, ...book.data() })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>        })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>        bookStore.books <span style=color:#04a5e5;font-weight:700>=</span> books
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>      error =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>        console.log(error.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>    )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>    <span style=color:#8839ef>const</span> q <span style=color:#04a5e5;font-weight:700>=</span> query(docRef, where(<span style=color:#40a02b>&#39;author&#39;</span>, <span style=color:#40a02b>&#39;==&#39;</span>, keyword), orderBy(<span style=color:#40a02b>&#39;createAt&#39;</span>, <span style=color:#40a02b>&#39;desc&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    <span style=color:#8839ef>await</span> onSnapshot(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      q,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>      snapshot =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>        <span style=color:#d20f39>let</span> books <span style=color:#04a5e5;font-weight:700>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>        snapshot.docs.forEach(book =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>          books.push({ id<span style=color:#04a5e5;font-weight:700>:</span> book.id, ...book.data() })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>        })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>        bookStore.books <span style=color:#04a5e5;font-weight:700>=</span> books
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>      },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>      error =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>        console.log(error.message)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>    )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>}
</span></span></code></pre></div><p>以上与<code>Firestore</code>的数据交互基本完成，我们来一起看下界面数据交互。</p><p>‍</p><h4 id=界面数据交互-1>界面数据交互<a class=anchorjs-link href=#%e7%95%8c%e9%9d%a2%e6%95%b0%e6%8d%ae%e4%ba%a4%e4%ba%92-1></a></h4><p>界面这里因为多了查询，所以在原来的基础上增加了一个<code>Search.jsx</code>查询组件。</p><p>‍</p><h5 id=realtimelist>RealTimeList<a class=anchorjs-link href=#realtimelist></a></h5><p>这里可以看到界面更加简洁，没有了基础版的<code>id</code>传递。因为我们用<code>store</code>传递数据。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/RealTimeList/index.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> AddBook from <span style=color:#40a02b>&#39;./Add&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> List from <span style=color:#40a02b>&#39;./List&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>import</span> Search from <span style=color:#40a02b>&#39;./Search&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#8839ef>const</span> BookList <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;max-w-5xl mx-auto&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>AddBook <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>Search <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>List <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> BookList
</span></span></code></pre></div><p>‍</p><h5 id=add-1>Add<a class=anchorjs-link href=#add-1></a></h5><p>这里有几个改变</p><ol><li>使用<code>useRef</code>来获取<code>title</code>和<code>author</code>的内容，比<code>useState</code>简单很多。</li><li>另外并不需要通过父组件传递<code>id</code>，直接从<code>store</code>中获取，列表中需要查询的<code>id</code>，并赋值给表单项。</li></ol><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/RealTimeList/Add.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useRef, useEffect } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { useSnapshot } from <span style=color:#40a02b>&#39;valtio&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { bookStore, bookAction } from <span style=color:#40a02b>&#39;@/store/books.store&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> Add <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> snap <span style=color:#04a5e5;font-weight:700>=</span> useSnapshot(bookStore)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>const</span> titleRef <span style=color:#04a5e5;font-weight:700>=</span> useRef()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> authorRef <span style=color:#04a5e5;font-weight:700>=</span> useRef()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  <span style=color:#8839ef>const</span> handleSubmit <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    <span style=color:#8839ef>const</span> title <span style=color:#04a5e5;font-weight:700>=</span> titleRef.current.value
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    <span style=color:#8839ef>const</span> author <span style=color:#04a5e5;font-weight:700>=</span> authorRef.current.value
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    <span style=color:#8839ef>const</span> book <span style=color:#04a5e5;font-weight:700>=</span> { title, author }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    <span style=color:#8839ef>if</span> (snap.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>undefined</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> snap.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      <span style=color:#8839ef>await</span> bookAction.updateBook(snap.bookId, book)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    } <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>      <span style=color:#8839ef>await</span> bookAction.addBook(book)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>    titleRef.current.value <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>    authorRef.current.value <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    console.log(<span style=color:#40a02b>&#39;add book success&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  <span style=color:#8839ef>const</span> handleGetBook <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    <span style=color:#8839ef>const</span> book <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> bookAction.getBook(snap.bookId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>    titleRef.current.value <span style=color:#04a5e5;font-weight:700>=</span> book.data().title
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>    authorRef.current.value <span style=color:#04a5e5;font-weight:700>=</span> book.data().author
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>  useEffect(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>    <span style=color:#8839ef>if</span> (snap.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#fe640b>undefined</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> snap.bookId <span style=color:#04a5e5;font-weight:700>!==</span> <span style=color:#40a02b>&#39;&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>      handleGetBook(snap.bookId)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  }, [snap.bookId])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;w-full grid grid-cols-3 gap-4 my-10 pb-10 border-b&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-start items-center&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>label htmlFor<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;title&#39;</span> className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-start items-center mr-5&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>          书名
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/label&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>          type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>          name<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;title&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>          className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex-1 input input-bordered w-full max-w-xs input-sm rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>          ref<span style=color:#04a5e5;font-weight:700>=</span>{titleRef}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>        <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-start items-center mr-5&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>label htmlFor<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;author&#39;</span> className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;h-10 flex justify-start items-center mr-5&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>          作者
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/label&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span>          type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">59</span><span>          name<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;author&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">60</span><span>          className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex-1 input input-bordered w-full max-w-xs input-sm rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">61</span><span>          ref<span style=color:#04a5e5;font-weight:700>=</span>{authorRef}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">62</span><span>        <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">63</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">64</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;flex justify-start items-center&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">65</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>button className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-sm rounded-md font-normal&#39;</span> type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;submit&#39;</span> onClick<span style=color:#04a5e5;font-weight:700>=</span>{handleSubmit}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">66</span><span>          保存
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">67</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">68</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">69</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">70</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">71</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">72</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">73</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Add
</span></span></code></pre></div><p>‍</p><h5 id=search>Search<a class=anchorjs-link href=#search></a></h5><p>这个是升级版新增的组件，功能也很简单，就是获取到搜索中的<code>keyword</code>内容传给<code>store</code>。列表在根据传入的<code>keyword</code>，响应相应的查询内容。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/RealTimeList/Search.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useState } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { useSnapshot } from <span style=color:#40a02b>&#39;valtio&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { bookAction, bookStore } from <span style=color:#40a02b>&#39;@/store/books.store&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> Search <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> snap <span style=color:#04a5e5;font-weight:700>=</span> useSnapshot(bookStore)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#8839ef>const</span> [keyword, setKeyword] <span style=color:#04a5e5;font-weight:700>=</span> useState(<span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  <span style=color:#8839ef>const</span> handleSearch <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    bookAction.getBooks(keyword)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;form-control my-5 pb-5 border-b&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;input-group&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>            type<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;text&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>            placeholder<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;Search…&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>            className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;input input-bordered input-sm&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>            value<span style=color:#04a5e5;font-weight:700>=</span>{keyword}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>            onChange<span style=color:#04a5e5;font-weight:700>=</span>{e =&gt; setKeyword(e.target.value)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>          <span style=color:#04a5e5;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>button className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-square btn-sm text-sm font-normal w-16&#39;</span> onClick<span style=color:#04a5e5;font-weight:700>=</span>{handleSearch}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>            搜索
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> Search
</span></span></code></pre></div><p>‍</p><h5 id=list-1>List<a class=anchorjs-link href=#list-1></a></h5><p>这里的数据获取变成了从<code>store</code>中获取，其他的都没变化。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/pages/RealTimeList/List.jsx
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> React, { useEffect, useState } from <span style=color:#40a02b>&#39;react&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>import</span> { useSnapshot } from <span style=color:#40a02b>&#39;valtio&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>import</span> { bookStore, bookAction } from <span style=color:#40a02b>&#39;@/store/books.store&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#8839ef>const</span> List <span style=color:#04a5e5;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  <span style=color:#8839ef>const</span> snap <span style=color:#04a5e5;font-weight:700>=</span> useSnapshot(bookStore)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  useEffect(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    bookAction.getBooks()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  }, [])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#8839ef>const</span> handleDeleteBook <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>async</span> id =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>    <span style=color:#8839ef>await</span> bookAction.deleteBook(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>    console.log(<span style=color:#40a02b>&#39;delete book success&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  <span style=color:#8839ef>return</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span>div className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;overflow-x-auto border rounded-lg&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span>table className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;table table-compact w-full&#39;</span><span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>thead<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span>tr<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>ID<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>书名<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>作者<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>th<span style=color:#04a5e5;font-weight:700>&gt;</span>操作<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/th&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>          <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tr&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/thead&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span>tbody<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>          {snap.books<span style=color:#04a5e5;font-weight:700>?</span>.map(book =&gt; (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span>tr key<span style=color:#04a5e5;font-weight:700>=</span>{book.id}<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.id}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.title}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>{book.author}<span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span>td<span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>button
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>                  className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-sm mr-4 font-normal rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>                  onClick<span style=color:#04a5e5;font-weight:700>=</span>{() =&gt; bookAction.setBookId(book.id)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span>                <span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>                  修改
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span>button
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>                  className<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#39;btn btn-error btn-sm text-white font-normal rounded-md&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>                  onClick<span style=color:#04a5e5;font-weight:700>=</span>{() =&gt; handleDeleteBook(book.id)}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>                <span style=color:#04a5e5;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>                  删除
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>                <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/button&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>              <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/td&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>            <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tr&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">51</span><span>          ))}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">52</span><span>        <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/tbody&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">53</span><span>      <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/table&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">54</span><span>    <span style=color:#04a5e5;font-weight:700>&lt;</span><span style=color:#d20f39>/div&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">55</span><span>  )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">56</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">57</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">58</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> List
</span></span></code></pre></div><p>‍</p><p>至此就基本完成了本次Firebase中Firestore的基础学习。官方的文档非常难以阅读。</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E5%B8%B8%E7%94%A8api/ data-toggle=tooltip data-placement=top title=网易云音乐常用API>Previous<br><span>网易云音乐常用API</span></a></li><li class=next><a href=/posts/firebase%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bauth%E5%92%8Cstorage/ data-toggle=tooltip data-placement=top title=Firebase学习笔记之Auth和storage>Next<br><span>Firebase学习笔记之Auth和storage</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>