<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Query Key Factory - React Query 的 QueryKey 查询管理工具 | SimFantasy</title><meta name=author content="Simz"><meta name=description content="在使用react-query做了几个项目以后，就感觉react-query中的查询和请求状态管理非常方便。但逐渐发现对react-query的使用需求在逐步发生变化：

基本需求就是对异步数据获取的状态进行管理。
获取到数据，react-query对数据进行缓存后，需要对缓存数据进行管理。
当需要进行数据交互通过useMutation获取到新的数据时，就需要通过之前查询数据的useQuery的queryKey修改缓存数据，通过query client中的setQueryData来修改缓存，或者使用invalidateQueries来使对应查询的queryKey让缓存失效来重新获取数据，最终就变成对queryKey的管理。
"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Query Key Factory - React Query 的 QueryKey  查询管理工具"><meta name=twitter:description content="在使用react-query做了几个项目以后，就感觉react-query中的查询和请求状态管理非常方便。但逐渐发现对react-query的使用需求在逐步发生变化：

基本需求就是对异步数据获取的状态进行管理。
获取到数据，react-query对数据进行缓存后，需要对缓存数据进行管理。
当需要进行数据交互通过useMutation获取到新的数据时，就需要通过之前查询数据的useQuery的queryKey修改缓存数据，通过query client中的setQueryData来修改缓存，或者使用invalidateQueries来使对应查询的queryKey让缓存失效来重新获取数据，最终就变成对queryKey的管理。
"><meta property="og:title" content="Query Key Factory - React Query 的 QueryKey  查询管理工具"><meta property="og:description" content="在使用react-query做了几个项目以后，就感觉react-query中的查询和请求状态管理非常方便。但逐渐发现对react-query的使用需求在逐步发生变化：

基本需求就是对异步数据获取的状态进行管理。
获取到数据，react-query对数据进行缓存后，需要对缓存数据进行管理。
当需要进行数据交互通过useMutation获取到新的数据时，就需要通过之前查询数据的useQuery的queryKey修改缓存数据，通过query client中的setQueryData来修改缓存，或者使用invalidateQueries来使对应查询的queryKey让缓存失效来重新获取数据，最终就变成对queryKey的管理。
"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost/posts/react-query-key-factory/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-18T17:47:04+00:00"><meta property="article:modified_time" content="2023-05-18T17:47:04+00:00"><meta property="og:see_also" content="http://localhost/posts/react-query%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=http://localhost>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Query Key Factory - React Query 的 QueryKey 查询管理工具</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2023-05-18</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/react/ title=react>react</a>
<a href=/tags/react-query/ title=react-query>react-query</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>在使用<code>react-query</code>做了几个项目以后，就感觉<code>react-query</code>中的查询和请求状态管理非常方便。但逐渐发现对<code>react-query</code>的使用需求在逐步发生变化：</p><ol><li>基本需求就是对异步数据获取的状态进行管理。</li><li>获取到数据，<code>react-query</code>对数据进行缓存后，需要对缓存数据进行管理。</li><li>当需要进行数据交互通过<code>useMutation</code>获取到新的数据时，就需要通过之前查询数据的<code>useQuery</code>的<code>queryKey</code>修改缓存数据，通过<code>query client</code>中的<code>setQueryData</code>来修改缓存，或者使用<code>invalidateQueries</code>来使对应查询的<code>queryKey</code>让缓存失效来重新获取数据，最终就变成对<code>queryKey</code>的管理。</li></ol><p>最近在做的<code>real world</code>练手项目中就碰到很多这种交互产生的问题，项目类似于<code>Medium</code>的一个多人博客，可以查看、发布文章、收藏文章、关注博主、对文章发布评论等，使用<code>react-query</code>来做API请求是非常简单的，但是在列表中点击收藏文章按钮，来收藏文章，在文章详情点击收藏按钮来收藏文章、关注博主。在文章详情中，对文章进行评论，这样就会产生大量的交互操作，需要在发起新的请求后修改之前的查询数据缓存或使之前的缓存失效，让新的数据生效。</p><p>这样我在第一个版本中，使用了一个<code>valtio</code>的<code>store</code>对当前请求的<code>queryKey</code>进行管理，如果在加载到当前页面有请求发生，则会通过<code>setKey</code>将当前请求的<code>queryKey</code>放到<code>store</code>中，如果当前页面有交互发生，需要使用<code>invalidateQueries</code>来使当前页面的缓存失效，就可以在<code>useMutation</code>时，通过<code>getKey</code>来获取当前请求的<code>queryKey</code>，从而来更新数据。</p><p>这样能在一定层面上解决<code>queryKey</code>的问题，但也存在几个问题：</p><ol><li>写法上就很繁琐，每次<code>useMutation</code>都需要先从<code>store</code>中获取下<code>key</code>。</li><li>从<code>store</code>中获取的<code>key</code>也是有局限性的。无法使用多个<code>invalidateQueries</code>来让多个位置的请求缓存失效，仅限当前页面。如果是在列表1中收藏的文章，列表2中的相同文章的收藏按钮不一定更新了这个状态，跟<code>react-query</code>的缓存时效和机制有关。</li></ol><p>基于上面的问题到<code>react-query</code>的官方找了下，看下又没有类似的解决办法，果然官方有推荐两个类似的包<code>Query Key Factory</code>和<code>React Query Kit</code>。<code>React Query Kit</code>比较偏向对<code>queryKey</code>和<code>queryFn</code>做集中管理，还有中文版的说明，应该是国人开发的，但跟我的需求关联不大，后面项目在好好研究下吧。<code>Query Key Factory</code>更加能满足我对<code>queryKey</code>的管理需求，所以采用了<code>Query Key Factory</code>。</p><h3 id=query-key-factory的安装和使用说明>Query Key Factory的安装和使用说明<a class=anchorjs-link href=#query-key-factory%e7%9a%84%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8%e8%af%b4%e6%98%8e></a></h3><p><code>Query Key Factory</code>包的功能说明：</p><ol><li>@tanstack/query 的类型安全查询密钥管理，具有自动完成功能。</li><li>专注于编写和使查询无效而无需记住的麻烦</li><li>您如何为特定查询设置密钥！ 这个库会处理剩下的事情。</li></ol><p>安装：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add @lukemorales/query-key-factory
</span></span></code></pre></div><p>以我做的<code>real world</code>第2个版本内容结合官方的例子来做使用说明：</p><h4 id=定义querykeyqueryfn>定义queryKey、queryFn<a class=anchorjs-link href=#%e5%ae%9a%e4%b9%89querykeyqueryfn></a></h4><ol><li><p>对<code>queryKey</code>的定义，官方给了两种方式：</p><ol><li><p>使用<code>createQueryKeyStore</code>将所有的<code>queryKey</code>都放到一起来定义。官方示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { createQueryKeyStore } from <span style=color:#40a02b>&#34;@lukemorales/query-key-factory&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> queries <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeyStore({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  users<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    <span style=color:#9ca0b0;font-style:italic>// 不定义queryKey和queryFn，会自动产生一个queryKey:[&#39;users&#39;, &#39;all&#39;]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic></span>    all<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>null</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    detail<span style=color:#04a5e5;font-weight:700>:</span> (userId<span style=color:#04a5e5;font-weight:700>:</span> string) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>      queryKey<span style=color:#04a5e5;font-weight:700>:</span> [userId],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>      queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.getUser(userId),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>    }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  todos<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    detail<span style=color:#04a5e5;font-weight:700>:</span> (todoId<span style=color:#04a5e5;font-weight:700>:</span> string) =&gt; [todoId],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    list<span style=color:#04a5e5;font-weight:700>:</span> (filters<span style=color:#04a5e5;font-weight:700>:</span> TodoFilters) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>      queryKey<span style=color:#04a5e5;font-weight:700>:</span> [{ filters }],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>      queryFn<span style=color:#04a5e5;font-weight:700>:</span> (ctx) =&gt; api.getTodos({ filters, page<span style=color:#04a5e5;font-weight:700>:</span> ctx.pageParam }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>      contextQueries<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>        search<span style=color:#04a5e5;font-weight:700>:</span> (query<span style=color:#04a5e5;font-weight:700>:</span> string, limit <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>15</span>) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>          queryKey<span style=color:#04a5e5;font-weight:700>:</span> [query, limit],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>          queryFn<span style=color:#04a5e5;font-weight:700>:</span> (ctx) =&gt; api.getSearchTodos({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>            page<span style=color:#04a5e5;font-weight:700>:</span> ctx.pageParam,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>            filters,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>            limit,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>            query,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>          }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>        }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>      },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>    }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>});
</span></span></code></pre></div></li><li><p>使用<code>createQueryKeys</code>，<code> mergeQueryKeys</code>组合，通过<code>createQueryKeys</code>来定义每个模块的<code>queryKey</code>，然后通过<code>mergeQueryKeys</code>来合并。我主要使用的这种方式。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { createQueryKeys, mergeQueryKeys } from <span style=color:#40a02b>&#39;@lukemorales/query-key-factory&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> api from <span style=color:#40a02b>&#39;@/service/apis&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> users <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;users&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  view<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;user&#39;</span>],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.User.view()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> profile <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;profile&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  view<span style=color:#04a5e5;font-weight:700>:</span> username =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [username],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Profile.view(username)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> articles <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;articles&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  all<span style=color:#04a5e5;font-weight:700>:</span> (limit, offset, author <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>, favorited <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>, tag <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>null</span>) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [offset, author, favorited, tag],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Article.all(limit, offset, author, favorited, tag)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  feed<span style=color:#04a5e5;font-weight:700>:</span> (limit, offset) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [offset],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Article.feed(limit, offset)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  view<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [slug],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Article.view(slug)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> comments <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;comments&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>  all<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [slug],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Comment.all(slug)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> tags <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;tags&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>  all<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;tags&#39;</span>],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Default.tags()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> querykeys <span style=color:#04a5e5;font-weight:700>=</span> mergeQueryKeys(users, profile, articles, comments, tags)
</span></span></code></pre></div><p>通过<code>createQueryKeys</code>来定义每个模块的<code>queryKey</code>和<code>queryFn</code>。当然官方的示例也给了只定义<code>queryKey</code>在<code>useQuery</code>在使用<code>queryFn</code>的示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> todos <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;todos&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  detail<span style=color:#04a5e5;font-weight:700>:</span> (todoId<span style=color:#04a5e5;font-weight:700>:</span> string) =&gt; [todoId],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>  list<span style=color:#04a5e5;font-weight:700>:</span> (filters<span style=color:#04a5e5;font-weight:700>:</span> TodoFilters) =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [{ filters }],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>  }),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>});
</span></span></code></pre></div><p>使用可以见后面的官方使用说明</p></li></ol></li></ol><h4 id=使用定义好的querykey和queryfn>使用定义好的queryKey和queryFn<a class=anchorjs-link href=#%e4%bd%bf%e7%94%a8%e5%ae%9a%e4%b9%89%e5%a5%bd%e7%9a%84querykey%e5%92%8cqueryfn></a></h4><p>官方的示例很凌乱，在<code>createQueryKeys</code>时定义的内容不一致，相同的 <code>todo detail</code>有不同的定义，我研究了半天，整理如下：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { queries } from <span style=color:#40a02b>&#39;../queries&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic>// 在createQueryKeys中没有定义queryKey、queryFn,但会产生一个默认的queryKey [`users`, &#39;all&#39;]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic>// 可以在useQuery在来定义queryFn
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#d20f39>function</span> useUsers() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#8839ef>return</span> useQuery({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>    ...queries.users.all,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.getUsers(),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic>// 使用在createQueryKeys中定义的queryKey、queryFn，直接传递参数即可，会自动生成queryKey、queryFn
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// queryKey: [&#39;users&#39;, &#39;detail&#39;, userId]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#d20f39>function</span> useUserDetail(id<span style=color:#04a5e5;font-weight:700>:</span> string) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  <span style=color:#8839ef>return</span> useQuery(queries.users.detail(id));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>};
</span></span></code></pre></div><p>因为只需要对useQuery进行QueryKey的设置，我这边的代码如下：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>import</span> { useQuery } from <span style=color:#40a02b>&#39;@tanstack/react-query&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>import</span> { querykeys } from <span style=color:#40a02b>&#39;@/service/queryKeys&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>import</span> { useParams } from <span style=color:#40a02b>&#39;react-router-dom&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#8839ef>const</span> User <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  useUser<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; useQuery(querykeys.users.view())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>const</span> Profile <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  useProfile<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    <span style=color:#8839ef>const</span> { username } <span style=color:#04a5e5;font-weight:700>=</span> useParams()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    <span style=color:#8839ef>return</span> useQuery(querykeys.profile.view(username))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#8839ef>const</span> Article <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  useArticles<span style=color:#04a5e5;font-weight:700>:</span> (limit, offset, author, favorited, tag) =&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>    useQuery(querykeys.articles.all(limit, offset, author, favorited, tag)),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  useArticlesFeed<span style=color:#04a5e5;font-weight:700>:</span> (limit, offset) =&gt; useQuery(querykeys.articles.feed(limit, offset)),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>  useArticle<span style=color:#04a5e5;font-weight:700>:</span> (slug, options) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>    <span style=color:#8839ef>return</span> useQuery(querykeys.articles.view(slug), options)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#8839ef>const</span> Comment <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  useComments<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; useQuery(querykeys.comments.all(slug))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#8839ef>const</span> Tag <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  useTags<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; useQuery(querykeys.tags.all())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>  User,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>  Profile,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>  Article,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>  Comment,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>  Tag
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>}
</span></span></code></pre></div><p>使用之前定义好的queryKey、queryFn就很简单了。下面放到一起看起来就很清晰。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// queryKey.jsx 定义queryKey、queryFn
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> users <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;users&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  view<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [<span style=color:#40a02b>&#39;user&#39;</span>],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.User.view()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>const</span> profile <span style=color:#04a5e5;font-weight:700>=</span> createQueryKeys(<span style=color:#40a02b>&#39;profile&#39;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>  view<span style=color:#04a5e5;font-weight:700>:</span> username =&gt; ({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>    queryKey<span style=color:#04a5e5;font-weight:700>:</span> [username],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>    queryFn<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Profile.view(username)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic>// queries.jsx 使用queryKey.jsx中定义好的queryKey、queryFn
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> User <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  useUser<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; useQuery(querykeys.users.view())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#9ca0b0;font-style:italic>// 如果还有需要查询路径参数的还可以使用react-router-dom
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> Profile <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>  useProfile<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>    <span style=color:#8839ef>const</span> { username } <span style=color:#04a5e5;font-weight:700>=</span> useParams()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>    <span style=color:#8839ef>return</span> useQuery(querykeys.profile.view(username))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>}
</span></span></code></pre></div><p>这样就可以统一对<code>react-query</code>的<code>queryKey</code>、<code>queryFn</code>来进行管理使用了。</p><h4 id=如何在usemutation中使用querykey>如何在useMutation中使用queryKey<a class=anchorjs-link href=#%e5%a6%82%e4%bd%95%e5%9c%a8usemutation%e4%b8%ad%e4%bd%bf%e7%94%a8querykey></a></h4><p>使用<code>querykeys.users.view._def</code>中这个方法可以直接使对应的<code>queryKey</code>失效，也不需要传递什么参数。多个模块的查询失效实现也很简单，见下方示例。</p><p>或者使用<code>users.detail({ status: 'completed' }).queryKey</code>这种传参数的方式来获取<code>queryKey</code>，再进行<code>queryClient.invalidateQueries</code>操作。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-jsx data-lang=jsx><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#8839ef>import</span> { useMutation, useQueryClient } from <span style=color:#40a02b>&#39;@tanstack/react-query&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span><span style=color:#8839ef>import</span> { querykeys } from <span style=color:#40a02b>&#39;@/service/queryKeys&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span><span style=color:#8839ef>import</span> api from <span style=color:#40a02b>&#39;@/service/apis&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span><span style=color:#8839ef>import</span> { useAuth } from <span style=color:#40a02b>&#39;@/hooks&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span><span style=color:#8839ef>const</span> User <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span>  useLogin<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span>    <span style=color:#8839ef>const</span> { login } <span style=color:#04a5e5;font-weight:700>=</span> useAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span>    <span style=color:#8839ef>return</span> useMutation(api.User.login, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> data =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span>        login(data)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>  useRegister<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span>    <span style=color:#8839ef>const</span> { login } <span style=color:#04a5e5;font-weight:700>=</span> useAuth()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span>    <span style=color:#8839ef>return</span> useMutation(api.User.register, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> data =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span>        login(data)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>  useUserUpdate<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span>    <span style=color:#8839ef>return</span> useMutation(api.User.update, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span>        queryClient.invalidateQueries(querykeys.users.view._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span><span style=color:#8839ef>const</span> Profile <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span>  useFollow<span style=color:#04a5e5;font-weight:700>:</span> (following, username) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span>    <span style=color:#8839ef>return</span> useMutation(following <span style=color:#04a5e5;font-weight:700>?</span> () =&gt; api.Profile.unfollow(username) <span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Profile.follow(username), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>        queryClient.invalidateQueries(querykeys.profile.view._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span>        queryClient.invalidateQueries(querykeys.articles.view._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span><span style=color:#8839ef>const</span> Article <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>  useArticleCreate<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>    <span style=color:#8839ef>return</span> useMutation(api.Article.create, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>        queryClient.invalidateQueries(querykeys.articles.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>        queryClient.invalidateQueries(querykeys.articles.feed._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>  useArticleUpdate<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>    <span style=color:#8839ef>return</span> useMutation(article =&gt; api.Article.update(slug, article), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span>        queryClient.invalidateQueries(querykeys.articles.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>        queryClient.invalidateQueries(querykeys.articles.feed._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>  useArticleDelete<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>    <span style=color:#8839ef>return</span> useMutation(api.Article.<span style=color:#8839ef>delete</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>        queryClient.invalidateQueries(querykeys.articles.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>        queryClient.invalidateQueries(querykeys.articles.feed._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span><span style=color:#8839ef>const</span> Comment <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>  useCommentCreate<span style=color:#04a5e5;font-weight:700>:</span> slug =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span>    <span style=color:#8839ef>return</span> useMutation(body =&gt; api.Comment.create(slug, body), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>        queryClient.invalidateQueries(querykeys.comments.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>  useCommentDelete<span style=color:#04a5e5;font-weight:700>:</span> (slug, id) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span>    <span style=color:#8839ef>return</span> useMutation(() =&gt; api.Comment.<span style=color:#8839ef>delete</span>(slug, id), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>        queryClient.invalidateQueries(querykeys.comments.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span><span style=color:#8839ef>const</span> Favorite <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>  useFavorite<span style=color:#04a5e5;font-weight:700>:</span> (slug, favorited) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span>    <span style=color:#8839ef>const</span> queryClient <span style=color:#04a5e5;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span>    <span style=color:#8839ef>return</span> useMutation(favorited <span style=color:#04a5e5;font-weight:700>?</span> () =&gt; api.Favorite.unfavorite(slug) <span style=color:#04a5e5;font-weight:700>:</span> () =&gt; api.Favorite.favorite(slug), {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>      onSuccess<span style=color:#04a5e5;font-weight:700>:</span> () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span>        queryClient.invalidateQueries(querykeys.articles.all._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>        queryClient.invalidateQueries(querykeys.articles.feed._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>        queryClient.invalidateQueries(querykeys.articles.view._def)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">102</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">103</span><span>    })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">104</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">105</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">106</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">107</span><span><span style=color:#8839ef>export</span> <span style=color:#8839ef>default</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">108</span><span>  User,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">109</span><span>  Profile,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">110</span><span>  Article,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">111</span><span>  Comment,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">112</span><span>  Favorite
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">113</span><span>}
</span></span></code></pre></div><p><code>Query Key Factory</code>还有一些其他的方法，没有细究了，需求满足了。</p><h3 id=query-key-factory-的问题>Query Key Factory 的问题<a class=anchorjs-link href=#query-key-factory-%e7%9a%84%e9%97%ae%e9%a2%98></a></h3><ol><li><p>问题：在<code>createMutationKeys</code>中创建带有参数的突变，和<code>queryKey</code>一起使用时会<code>undefine</code>，这个bug目前还没解决。<a href=https://github.com/lukemorales/query-key-factory/issues/55 target=_blank>New createMutationKeys doesn&rsquo;t work for mutations with arguments · Issue #55 · lukemorales/query-key-factory (github.com)</a></p><p>解决办法：所以我在项目中没有使用<code>createMutationKeys</code>来创建<code>mutationKey</code>和<code>mutationFn</code>。因为<code>useMutation</code>不需要<code>key</code>，使用<code>createMutationKeys</code>只是做个统一管理，可以等后面这个库成熟点了再来看看。</p></li><li><p>问题：使用<code>createQueryKeys</code>创建的<code>queryFn</code>不能使用<code>enabled</code>，这个应该不会去解决了。<a href=https://github.com/lukemorales/query-key-factory/issues/61 target=_blank>why does <code>enabled</code> not work within the query-key-factory? · Issue #61 · lukemorales/query-key-factory (github.com)</a></p><p>解决办法：这里可以只在<code>createQueryKeys</code>中需要使用<code>enabled</code>的模块中只声明<code>queryKey</code>，<code>queryFn</code>可以放到<code>useQuery</code>中。或者不使用<code>createQueryKeys</code>中的<code>queryKey</code>，单独来写<code>useQuery</code>来规避这个问题。</p></li></ol><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/%E5%A6%82%E4%BD%95%E5%9C%A8%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91%E4%B8%8A%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAgithub-ssh/ data-toggle=tooltip data-placement=top title="如何在一台电脑上配置多个Github SSH">Previous<br><span>如何在一台电脑上配置多个Github SSH</span></a></li><li class=next><a href=/posts/typescript-%E5%9F%BA%E7%A1%80/ data-toggle=tooltip data-placement=top title="TypeScript 基础">Next<br><span>TypeScript 基础</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>api</a>
<a href=/tags/auth0/>auth0</a>
<a href=/tags/chakraui/>chakraui</a>
<a href=/tags/css/>css</a>
<a href=/tags/electron/>electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>elementui</a>
<a href=/tags/elint/>elint</a>
<a href=/tags/eslint/>eslint</a>
<a href=/tags/express/>express</a>
<a href=/tags/firebase/>firebase</a>
<a href=/tags/formik/>formik</a>
<a href=/tags/git/>git</a>
<a href=/tags/graphql/>graphQL</a>
<a href=/tags/hexo/>hexo</a>
<a href=/tags/icon/>icon</a>
<a href=/tags/javascript/>javascript</a>
<a href=/tags/nextjs/>nextjs</a>
<a href=/tags/node/>node</a>
<a href=/tags/pinia/>pinia</a>
<a href=/tags/prettier/>prettier</a>
<a href=/tags/react/>react</a>
<a href=/tags/react-query/>react-query</a>
<a href=/tags/react-router/>react-router</a>
<a href=/tags/redux-toolkit/>redux-toolkit</a>
<a href=/tags/strapi/>strapi</a>
<a href=/tags/styled-components/>styled-components</a>
<a href=/tags/typescript/>typescript</a>
<a href=/tags/valtio/>valtio</a>
<a href=/tags/vite/>vite</a>
<a href=/tags/vscode/>vscode</a>
<a href=/tags/vue/>vue</a>
<a href=/tags/vuex/>vuex</a>
<a href=/tags/zustand/>zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2023<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin=anonymous></script>
<script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script>
<script src=/js/simple-jekyll-search.min.js></script>
<script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script>
<script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script>
<script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>