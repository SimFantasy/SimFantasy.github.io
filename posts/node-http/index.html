<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Node 06 Http 服务 | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="什么是web服务器当应用程序（客户端）需要某一个资源时，可以向一个台服务器，通过Http请求获取到这个资源；提供资源的这个服务器，就是一个Web服务器；"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Node 06 Http 服务"><meta name=twitter:description content="什么是web服务器当应用程序（客户端）需要某一个资源时，可以向一个台服务器，通过Http请求获取到这个资源；提供资源的这个服务器，就是一个Web服务器；"><meta property="og:url" content="http://localhost/posts/node-http/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="Node 06 Http 服务"><meta property="og:description" content="什么是web服务器当应用程序（客户端）需要某一个资源时，可以向一个台服务器，通过Http请求获取到这个资源；提供资源的这个服务器，就是一个Web服务器；"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-08T23:12:47+08:00"><meta property="article:modified_time" content="2023-10-08T23:12:47+08:00"><meta property="article:tag" content="Node"><meta property="og:see_also" content="http://localhost/posts/node-egg/"><meta property="og:see_also" content="http://localhost/posts/node-mongoose/"><meta property="og:see_also" content="http://localhost/posts/node-mongodb/"><meta property="og:see_also" content="http://localhost/posts/node-log/"><meta property="og:see_also" content="http://localhost/posts/node-validator/"><meta property="og:see_also" content="http://localhost/posts/node-prisma/"><meta property="og:see_also" content="http://localhost/posts/node-sequelize/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Node 06 Http 服务</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2023-10-08</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/node/ title=Node>Node</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h3 id=什么是web服务器>什么是web服务器<a class=anchorjs-link href=#%e4%bb%80%e4%b9%88%e6%98%afweb%e6%9c%8d%e5%8a%a1%e5%99%a8></a></h3><p>当应用程序（客户端）需要某一个资源时，可以向一个台服务器，通过Http请求获取到这个资源；提供资源的这个服务器，就是一个Web服务器；</p><h3 id=node如何实现web服务器>Node如何实现web服务器<a class=anchorjs-link href=#node%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0web%e6%9c%8d%e5%8a%a1%e5%99%a8></a></h3><p><code>node</code>可以通过<code>http</code>模块主要用来创建<code>http</code>服务，通过<code>http.createSvever</code>返回的对象创建一个<code>web</code>服务器。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>  res.end(<span style=color:#40a02b>&#39;hello world&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>  console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">9</span><span>})
</span></span></code></pre></div><p>上面我们已经看到，创建Server时会传入一个回调函数，这个回调函数在被调用时会传入两个参数：</p><ul><li><p><code>req</code>：<code>request</code>请求对象，包含请求相关的信息；</p></li><li><p><code>res</code>：<code>response</code>响应对象，包含我们要发送给客户端的信息；</p></li></ul><p><strong>Server</strong>通过<code>listen</code>方法来开启服务器，并且在某一个主机和端口上监听网络请求。当通过 <code>ip:port</code>的方式发送到监听的Web服务器上时，可以对其进行相关的处理；</p><p><strong>listen</strong>函数有三个参数：</p><ul><li>端口<code>port</code>: 可以不传, 系统会默认分配端, 后续项目中我们会写入到环境变量中；</li><li>主机<code>host</code>: 通常可以传入<code>localhost</code>、<code>ip</code>地址<code>127.0.0.1</code>、或者<code>ip</code>地址<code>0.0.0.0</code>，默认是<code>0.0.0.0</code>；</li><li>回调函数：服务器启动成功时的回调函数</li></ul><p>创建服务器对象，通过 <code>createServer</code> 来完成的，<code>http.createServer</code>会返回服务器的对象，底层其实使用直接 <code>new Server</code> 对象。也可以自己来创建这个对象。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> http.Server((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>	res.end(<span style=color:#40a02b>&#39;hello world&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">9</span><span>})
</span></span></code></pre></div><h4 id=httpcreateserveroptions-requestlistener><code>http.createServer([options][, requestListener])</code><a class=anchorjs-link href=#httpcreateserveroptions-requestlistener></a></h4><ul><li><code>options &lt;Object></code><ul><li><code>connectionsCheckingInterval: 以毫秒为单位设置间隔值，以检查不完整请求中的请求和标头超时。 默认值： 30000。</code></li><li><code>headersTimeout: 设置从客户端接收完整 HTTP 标头的超时值，以毫秒为单位。 有关详细信息，请参阅 </code>server.headersTimeout<code>。 默认值： 60000。</code></li><li><code>insecureHTTPParser &lt;boolean> 使用不安全的 HTTP 解析器，当为 true时接受无效的 HTTP 标头。 应避免使用不安全的解析器。 默认值： false</code>。</li><li><code>IncomingMessage &lt;http.IncomingMessage> 指定要使用的 IncomingMessage 类。 用于扩展原始的 IncomingMessage。 默认值： IncomingMessage</code>。</li><li><code>keepAlive &lt;boolean></code> 如果设置为 <code>true</code>，则它会在收到新的传入连接后立即在套接字上启用保持活动功能，类似于在 <code>[socket.setKeepAlive([enable][, initialDelay])][socket.setKeepAlive(enable, initialDelay)]</code> 中所做的事情。 默认值： <code>false</code>。</li><li><code>keepAliveInitialDelay &lt;number> </code>如果设置为正数，则它会设置在空闲套接字上发送第一个保持活跃探测之前的初始延迟。 默认值： 0。</li><li><code>requestTimeout</code>: 设置从客户端接收整个请求的超时值（以毫秒为单位）。 有关详细信息，请参阅 <code>server.requestTimeout</code>。 默认值： 300000。</li><li><code>joinDuplicateHeaders &lt;boolean></code> 它使用 , 连接请求中多个标头的字段行值，而不是丢弃重复项。 有关详细信息，请参阅 <code>message.headers</code>。 默认值： <code>false</code>。</li><li><code>ServerResponse &lt;http.ServerResponse></code> 指定要使用的<code>ServerResponse</code> 类。 用于扩展原始的 <code>ServerResponse</code>。 默认值： <code>ServerResponse</code>。</li><li><code>uniqueHeaders &lt;Array></code> 只应发送一次的响应标头列表。 如果标头的值是数组，则子项将使用 ; 连接。</li></ul></li><li><code>requestListener &lt;Function></code></li><li><code>返回： &lt;http.Server></code></li></ul><p>返回 <code>http.Server</code> 的新实例。</p><p><code>requestListener</code> 是自动添加到 <code>'request'</code> 事件的函数。</p><h3 id=request>Request<a class=anchorjs-link href=#request></a></h3><p>在向服务器发送请求时，会携带很多信息，比如：</p><ul><li>本次请求的<code>URL</code>，服务器需要根据不同的<code>URL</code>进行不同的处理；</li><li>本次请求的请求方式，比如<code>GET</code>、<code>POST</code>请求传入的参数和处理的方式是不同的；</li><li>本次请求的<code>headers</code>中也会携带一些信息，比如客户端信息、接受数据的格式、支持的编码格式等；</li></ul><p>这些信息，<code>Node</code>会封装到一个<code>request</code>的对象中，可以直接来处理这个<code>request</code>对象：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	console.log(req.url)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	console.log(req.method)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	console.log(req.headers)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	res.end(<span style=color:#40a02b>&#39;hello world&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>})
</span></span></code></pre></div><h3 id=url>URL<a class=anchorjs-link href=#url></a></h3><p>客户端在发送请求时，会请求不同的数据，那么会传入不同的请求地址：</p><p>比如：<code>http://localhost:3300/posts</code></p><p>比如： <code>http://localhost:3300/users</code></p><p>服务器端需要根据不同的请求地址，作出不同的响应：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#8839ef>const</span> url <span style=color:#04a5e5;font-weight:700>=</span> req.url
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>if</span> (url <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		res.end(<span style=color:#40a02b>&#39;Hello World&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	} <span style=color:#8839ef>else</span> <span style=color:#8839ef>if</span> (url <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/post&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		res.end(<span style=color:#40a02b>&#39;posts&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	} <span style=color:#8839ef>else</span> <span style=color:#8839ef>if</span> (url <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/user&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		res.end(<span style=color:#40a02b>&#39;users&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	} <span style=color:#8839ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		res.end(<span style=color:#40a02b>&#39;404 Not Found&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>})
</span></span></code></pre></div><h4 id=url的参数解析>URL的参数解析<a class=anchorjs-link href=#url%e7%9a%84%e5%8f%82%e6%95%b0%e8%a7%a3%e6%9e%90></a></h4><p>如果发送的地址中还携带一些额外的参数呢？</p><p>比如：<code>http://localhost:3300/posts?cat=news&amp;limit=10&amp;offset=0</code></p><p>由于版本原因，有两种方式可以获取到URL对应的参数，以下版本使用的<code>url.parse</code>为旧版<code>URL API</code>，仍然可以使用。使用上较为简单。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#d20f39>@hostname= http://localhost
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#d20f39>@port= 3300
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#d20f39>@host= {{hostname}}:{{port}}
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#d20f39>@contentType = application/json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#d20f39>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span><span style=color:#d20f39>GET {{host}}/post?cat=news&amp;limit=10&amp;offset=0
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>const</span> url <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;url&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>const</span> { query, pathname } <span style=color:#04a5e5;font-weight:700>=</span> url.parse(req.url, <span style=color:#fe640b>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>if</span> (pathname <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/post&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> req.method <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;GET&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		console.log(<span style=color:#40a02b>&#39;cat:&#39;</span>, query.cat) <span style=color:#9ca0b0;font-style:italic>// cat: news
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;limit:&#39;</span>, query.limit) <span style=color:#9ca0b0;font-style:italic>// limit: 10
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;offset:&#39;</span>, query.offset) <span style=color:#9ca0b0;font-style:italic>// offset: 0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;pathname:&#39;</span>, pathname) <span style=color:#9ca0b0;font-style:italic>// pathname: /post
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		res.end(<span style=color:#40a02b>&#39;post success&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>})
</span></span></code></pre></div><p>当<code>url.parse(req.url, true)</code>中第二个参数设置为<code>true</code>时，则可以直接将参数转为对象。不需要通过<code>querystring</code>来做多余的参数解析转为对象。</p><p>新版本为<code>WHATWG URL API</code>，使用类的方式获取<code>URL</code>参数，提供了些操作方法，但稍显麻烦。也许这就是之前的<code>URL API</code>弃用后又在后面的版本中恢复改为旧版的原因吧。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>const</span> { URL } <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;url&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> baseURL <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;http://localhost:3300&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>const</span> url <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> URL(req.url, baseURL)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	<span style=color:#8839ef>const</span> { searchParams, pathname } <span style=color:#04a5e5;font-weight:700>=</span> url
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	<span style=color:#8839ef>if</span> (pathname <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/post&#39;</span> <span style=color:#04a5e5;font-weight:700>&amp;&amp;</span> req.method <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;GET&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		console.log(<span style=color:#40a02b>&#39;searchParams:&#39;</span>, searchParams) <span style=color:#9ca0b0;font-style:italic>// URLSearchParams: { &#39;cat&#39; =&gt; &#39;news&#39;, &#39;limit&#39; =&gt; &#39;10&#39;, &#39;offset&#39; =&gt; &#39;0&#39; }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;cat:&#39;</span>, searchParams.get(<span style=color:#40a02b>&#39;cat&#39;</span>)) <span style=color:#9ca0b0;font-style:italic>// cat: news
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;limit:&#39;</span>, searchParams.get(<span style=color:#40a02b>&#39;limit&#39;</span>)) <span style=color:#9ca0b0;font-style:italic>// limit: 10
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;offset:&#39;</span>, searchParams.get(<span style=color:#40a02b>&#39;offset&#39;</span>)) <span style=color:#9ca0b0;font-style:italic>// offset: 0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;pathname:&#39;</span>, pathname) <span style=color:#9ca0b0;font-style:italic>// pathname: /post
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>		console.log(<span style=color:#40a02b>&#39;req.url&#39;</span>, req.url) <span style=color:#9ca0b0;font-style:italic>// req.url /post?cat=news&amp;limit=10&amp;offset=0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>		res.end(<span style=color:#40a02b>&#39;post success&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	console.log(<span style=color:#40a02b>`Server is running at </span><span style=color:#40a02b>${</span>baseURL<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>})
</span></span></code></pre></div><p>此处的<code>new URL(req.url, baseURL)</code>中需要传入两个参数，得到的<code>pathname</code>和<code>baseurl</code>。</p><p>另外在url中解构出来的<code>searchParams</code>，提供了多种方法操作<code>url params</code>，除了<code>get()</code>，还有<code>set()</code>、<code>delete()</code>、<code>append()</code>。官方解释中，<code>searchParams</code>是<code>URLSearchParams</code>的实例，而<code>URLSearchParams</code>。</p><p><code>URLSearchParams API</code> 提供对 <code>URL</code> 查询的读写访问。 <code>URLSearchParams</code> 类也可以与以下四个构造函数之一单独使用。 <code>URLSearchParams</code> 类也在全局对象上可用。</p><p><code>WHATWG URLSearchParams</code> 接口和 <code>querystring</code> 模块具有相似的用途，但 <code>querystring</code> 模块的用途更通用，因为它允许自定义的分隔符（<code>&</code> 和 <code>=</code>）。 换句话说，此 API 纯粹是为网址查询字符串而设计。</p><p>官方示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> myURL <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> URL(<span style=color:#40a02b>&#39;https://example.org/?abc=123&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>console.log(myURL.searchParams.get(<span style=color:#40a02b>&#39;abc&#39;</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#9ca0b0;font-style:italic>// Prints 123
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>myURL.searchParams.append(<span style=color:#40a02b>&#39;abc&#39;</span>, <span style=color:#40a02b>&#39;xyz&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>console.log(myURL.href);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic>// Prints https://example.org/?abc=123&amp;abc=xyz
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>myURL.searchParams.<span style=color:#8839ef>delete</span>(<span style=color:#40a02b>&#39;abc&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>myURL.searchParams.set(<span style=color:#40a02b>&#39;a&#39;</span>, <span style=color:#40a02b>&#39;b&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>console.log(myURL.href);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// Prints https://example.org/?a=b
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#8839ef>const</span> newSearchParams <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> URLSearchParams(myURL.searchParams);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic>// The above is equivalent to
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic>// const newSearchParams = new URLSearchParams(myURL.search);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>newSearchParams.append(<span style=color:#40a02b>&#39;a&#39;</span>, <span style=color:#40a02b>&#39;c&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>console.log(myURL.href);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span><span style=color:#9ca0b0;font-style:italic>// Prints https://example.org/?a=b
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span><span style=color:#9ca0b0;font-style:italic></span>console.log(newSearchParams.toString());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span><span style=color:#9ca0b0;font-style:italic>// Prints a=b&amp;a=c
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#9ca0b0;font-style:italic>// newSearchParams.toString() is implicitly called
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#9ca0b0;font-style:italic></span>myURL.search <span style=color:#04a5e5;font-weight:700>=</span> newSearchParams;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>console.log(myURL.href);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#9ca0b0;font-style:italic>// Prints https://example.org/?a=b&amp;a=c
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#9ca0b0;font-style:italic></span>newSearchParams.<span style=color:#8839ef>delete</span>(<span style=color:#40a02b>&#39;a&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>console.log(myURL.href);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span><span style=color:#9ca0b0;font-style:italic>// Prints https://example.org/?a=b&amp;a=c
</span></span></span></code></pre></div><h4 id=官方对两个版本的api做的说明>官方对两个版本的API做的说明：<a class=anchorjs-link href=#%e5%ae%98%e6%96%b9%e5%af%b9%e4%b8%a4%e4%b8%aa%e7%89%88%e6%9c%ac%e7%9a%84api%e5%81%9a%e7%9a%84%e8%af%b4%e6%98%8e></a></h4><p>网址字符串是包含多个有意义组件的结构化字符串。 解析时，将返回包含每个组件的属性的网址对象。</p><p><code>node:url</code> 模块提供了两个用于处理 <code>URL</code> 的 <code>API</code>： 一个特定于 <code>Node.js</code> 的旧版 <code>API</code>，以及一个实现 <code>Web</code> 浏览器使用的相同 <code>WHATWG URL</code> 标准 的较新 <code>API</code>。</p><p>下面提供了 <code>WHATWG</code> 和<code>旧版 API</code> 之间的比较。 在网址 <code>https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash</code> 上方显示的是由旧版 <code>url.parse()</code> 返回的对象的属性。 下方则是 <code>WHATWG URL</code> 对象的属性。</p><p><code>WHATWG</code> 网址的 <code>origin</code> 属性包括 <code>protocol</code> 和 <code>host</code>，但不包括 <code>username</code> 或 <code>password</code>。</p><p><mark>也就是说在URL中不包含username和password的情况下，我们可使用旧版的API</mark></p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#d20f39>┌────────────────────────────────────────────────────────────────────────────────────────────────┐</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#d20f39>│</span>                                              href                                              <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#d20f39>├──────────┬──┬─────────────────────┬────────────────────────┬───────────────────────────┬───────┤</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#d20f39>│</span> protocol <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>        auth         <span style=color:#d20f39>│</span>          host          <span style=color:#d20f39>│</span>           path            <span style=color:#d20f39>│</span> hash  <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>                     <span style=color:#d20f39>├─────────────────┬──────┼──────────┬────────────────┤</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>                     <span style=color:#d20f39>│</span>    hostname     <span style=color:#d20f39>│</span> port <span style=color:#d20f39>│</span> pathname <span style=color:#d20f39>│</span>     search     <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>                     <span style=color:#d20f39>│</span>                 <span style=color:#d20f39>│</span>      <span style=color:#d20f39>│</span>          <span style=color:#d20f39>├─┬──────────────┤</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>                     <span style=color:#d20f39>│</span>                 <span style=color:#d20f39>│</span>      <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span> <span style=color:#d20f39>│</span>    query     <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#40a02b>&#34;  https:   //    user   :   pass   @ sub.example.com : 8080   /p/a/t/h  ?  query=string   #hash &#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>    hostname     <span style=color:#d20f39>│</span> port <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>                <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>          <span style=color:#d20f39>├─────────────────┴──────┤</span>          <span style=color:#d20f39>│</span>                <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#d20f39>│</span> protocol <span style=color:#d20f39>│</span>  <span style=color:#d20f39>│</span> username <span style=color:#d20f39>│</span> password <span style=color:#d20f39>│</span>          host          <span style=color:#d20f39>│</span>          <span style=color:#d20f39>│</span>                <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#d20f39>├──────────┴──┼──────────┴──────────┼────────────────────────┤</span>          <span style=color:#d20f39>│</span>                <span style=color:#d20f39>│</span>       <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#d20f39>│</span>   origin    <span style=color:#d20f39>│</span>                     <span style=color:#d20f39>│</span>         origin         <span style=color:#d20f39>│</span> pathname <span style=color:#d20f39>│</span>     search     <span style=color:#d20f39>│</span> hash  <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#d20f39>├─────────────┴─────────────────────┴────────────────────────┴──────────┴────────────────┴───────┤</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#d20f39>│</span>                                              href                                              <span style=color:#d20f39>│</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#d20f39>└────────────────────────────────────────────────────────────────────────────────────────────────┘</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>(All spaces <span style=color:#8839ef>in</span> the <span style=color:#40a02b>&#34;&#34;</span> line should be ignored. They are purely <span style=color:#8839ef>for</span> formatting.)
</span></span></code></pre></div><p>使用 <code>WHATWG API</code> 解析网址字符串：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> myURL <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> URL(<span style=color:#40a02b>&#39;https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash&#39;</span>);
</span></span></code></pre></div><p>使用<code>旧版 API</code> 解析 <code>URL</code> 字符串：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>import</span> url from <span style=color:#40a02b>&#39;node:url&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#8839ef>const</span> myURL <span style=color:#04a5e5;font-weight:700>=</span> url.parse(<span style=color:#40a02b>&#39;https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash&#39;</span>);
</span></span></code></pre></div><h3 id=method>Method<a class=anchorjs-link href=#method></a></h3><p>在<code>Restful</code>规范（设计风格）中，我们对于数据的增删改查应该通过不同的请求方式：</p><ul><li><code>GET</code>：查询数据；</li><li><code>POST</code>：新建数据；</li><li><code>PATCH</code>：更新数据；</li><li><code>DELETE</code>：删除数据；</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#d20f39>@hostname= http://localhost
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#d20f39>@port= 3300
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#d20f39>@host= {{hostname}}:{{port}}
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#d20f39>@contentType = application/json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#d20f39>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#d20f39>POST {{host}}/login
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#d20f39>Content-Type: {{contentType}}
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#d20f39>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#d20f39>{
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#d20f39>  &#34;username&#34;: &#34;admin&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#d20f39>  &#34;password&#34;: &#34;123456&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#d20f39>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	<span style=color:#9ca0b0;font-style:italic>// 设置接收数据的编码格式
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#9ca0b0;font-style:italic></span>	req.setEncoding(<span style=color:#40a02b>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	req.on(<span style=color:#40a02b>&#39;data&#39;</span>, chunk =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		<span style=color:#8839ef>const</span> { username, password } <span style=color:#04a5e5;font-weight:700>=</span> JSON.parse(chunk)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>		console.log(<span style=color:#40a02b>&#39;username:&#39;</span>, username) <span style=color:#9ca0b0;font-style:italic>// username: admin
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>		console.log(<span style=color:#40a02b>&#39;password&#39;</span>, password) <span style=color:#9ca0b0;font-style:italic>// password 123456
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span><span style=color:#9ca0b0;font-style:italic></span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>	req.on(<span style=color:#40a02b>&#39;end&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>		res.end(<span style=color:#40a02b>&#39;ok&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>})
</span></span></code></pre></div><h3 id=headers属性>Headers属性<a class=anchorjs-link href=#headers%e5%b1%9e%e6%80%a7></a></h3><p>在request对象的header中也包含很多有用的信息，客户端会默认传递过来一些信息：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>  <span style=color:#40a02b>&#39;user-agent&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;vscode-restclient&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  <span style=color:#40a02b>&#39;user-agent&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;PostmanRuntime/10.15&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>  accept<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;*/*&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  <span style=color:#40a02b>&#39;accept-encoding&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;gzip, deflate&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>  host<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;localhost:3300&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  <span style=color:#40a02b>&#39;accept-encoding&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;gzip, deflate, br&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  connection<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;keep-alive&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>  <span style=color:#40a02b>&#39;content-length&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;48&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>}
</span></span></code></pre></div><ul><li><p><code>content-type</code>是这次请求携带的数据的类型：</p><ul><li><p><code>application/json</code>表示是一个<code>json</code>类型；</p></li><li><p><code>text/plain</code>表示是文本类型；</p></li><li><p><code>application/xml</code>表示是<code>xml</code>类型；</p></li><li><p><code>multipart/form-data</code>表示是上传文件；</p></li></ul></li><li><p><code>content-length</code>：文件的大小和长度</p></li><li><p><code>keep-alive</code>：</p><ul><li><code>http</code>是基于<code>TCP</code>协议的，但是通常在进行一次请求和响应结束后会立刻中断；</li><li>在<code>http1.0</code>中，如果想要继续保持连接：<ul><li>浏览器需要在请求头中添加 <code>connection: keep-alive</code>；</li><li>服务器需要在响应头中添加 <code>connection:keey-alive</code>；</li><li>当客户端再次放请求时，就会使用同一个连接，直接一方中断连接；</li></ul></li><li>在<code>http1.1</code>中，所有连接默认是 <code>connection: keep-alive</code>的；<ul><li>不同的<code>Web</code>服务器会有不同的保持 <code>keep-alive</code>的时间；</li><li><code>Node</code>中默认是<code>5s</code>中；</li></ul></li></ul></li><li><p><code>accept-encoding</code>：告知服务器，客户端支持的文件压缩格式，比如<code>js</code>文件可以使用<code>gzip</code>编码，对应 <code>.gz</code>文件；</p></li><li><p><code>accept</code>：告知服务器，客户端可接受文件的格式类型；</p></li><li><p><code>user-agent</code>：客户端相关的信息；</p></li></ul><h3 id=response>Response<a class=anchorjs-link href=#response></a></h3><p>希望给客户端响应的结果数据，可以通过两种方式：</p><ul><li><code>Write方法</code>：这种方式是直接写出数据，但是并没有关闭流；</li><li><code>end方法</code>：这种方式是写出最后的数据，并且写出后会关闭流；</li></ul><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	res.write(<span style=color:#40a02b>&#39;hello world&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	res.write(<span style=color:#40a02b>&#39;hello nodejs&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	res.end(<span style=color:#40a02b>&#39;ok&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// hello worldhello nodejsok
</span></span></span></code></pre></div><p><mark>如果没有调用 <code>end</code>和<code>close</code>，客户端将会一直等待结果</mark>：所以客户端在发送网络请求时，都会设置超时时间。</p><h3 id=http状态码>Http状态码<a class=anchorjs-link href=#http%e7%8a%b6%e6%80%81%e7%a0%81></a></h3><p><code>Http状态码</code>（<code>Http Status Code</code>）是用来表示Http响应状态的数字代码：</p><ul><li><p><code>Http</code>状态码非常多，可以根据不同的情况，给客户端返回不同的状态码；</p></li><li><p>常见的状态码是下面这些</p><table><thead><tr><th>状态代码</th><th>状态描述</th><th>说明</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>客户端请求成功</td></tr><tr><td>400</td><td>Bad Request</td><td>客户端请求错误</td></tr><tr><td>401</td><td>Unauthorized</td><td>请求未授权，必须和<code>WWW-Authenticate</code>报头域一起使用</td></tr><tr><td>403</td><td>Forbidden</td><td>服务器收到请求，但拒绝服务</td></tr><tr><td>404</td><td>Not Found</td><td>请求的资源不存在</td></tr><tr><td>500</td><td>Internal Server Error</td><td>服务器发生不可预期的错误，无法完成客户端请求</td></tr><tr><td>503</td><td>Service Unavailable</td><td>服务器当前不能处理客户端请求，在一段时间后可能会恢复正常。</td></tr></tbody></table></li><li><p>设置状态码常见的方式：</p><ul><li><code>res.statusCode = 400</code></li><li><code>res.writeHead(200)</code></li></ul></li></ul><h3 id=响应头文件>响应头文件<a class=anchorjs-link href=#%e5%93%8d%e5%ba%94%e5%a4%b4%e6%96%87%e4%bb%b6></a></h3><p>返回头部信息，主要有两种方式：</p><ul><li><p><code>res.setHeader</code>：一次写入一个头部信息；</p></li><li><p><code>res.writeHead</code>：同时写入<code>header</code>和<code>status</code>；</p></li></ul><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	res.setHeader(<span style=color:#40a02b>&#39;Set-Cookie&#39;</span>, <span style=color:#40a02b>&#39;username=sim; path=/; domain=localhost; httpOnly&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	res.writeHead(<span style=color:#fe640b>200</span>, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>		<span style=color:#40a02b>&#39;Content-Type&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;text/plain;charset=utf-8&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	res.end(<span style=color:#40a02b>&#39;ok&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>})
</span></span></code></pre></div><h3 id=http-request>Http Request<a class=anchorjs-link href=#http-request></a></h3><p><code>axios</code>库可以在浏览器中使用，也可以在<code>Node</code>中使用：</p><ul><li><p>在浏览器中，<code>axios</code>使用的是封装<code>xhr</code>；</p></li><li><p>在<code>Node</code>中，使用的是<code>http</code>内置模块；</p></li></ul><p>示例：</p><p>示例使用<code>es</code>方式导入<code>axios</code>库</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#9ca0b0;font-style:italic>// axios-get.mjs
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>import</span> axios from <span style=color:#40a02b>&#39;axios&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#8839ef>const</span> url <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;https://jsonplaceholder.typicode.com/todos/1&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>axios.get(url).then(response =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>	<span style=color:#8839ef>const</span> todo <span style=color:#04a5e5;font-weight:700>=</span> response.data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>	console.log(<span style=color:#40a02b>&#39;data:&#39;</span>, todo)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">9</span><span>})
</span></span></code></pre></div><p>也可以使用<code>node</code>的<code>http</code>模块来发起请求</p><p>服务端：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	res.setHeader(<span style=color:#40a02b>&#39;Content-Type&#39;</span>, <span style=color:#40a02b>&#39;application/json;charset=utf-8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#8839ef>const</span> userinfo <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;zhangsan&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		age<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>20</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	res.end(JSON.stringify(userinfo))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3300&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>})
</span></span></code></pre></div><ul><li>使用<code>http</code>发起<code>get</code>请求</li></ul><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>http.get(<span style=color:#40a02b>&#39;http://localhost:3300/post?cat=js&amp;limit=10&amp;offset=0&#39;</span>, res =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>	res.on(<span style=color:#40a02b>&#39;data&#39;</span>, chunk =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>		console.log(<span style=color:#40a02b>&#39;chunk:&#39;</span>, chunk.toString())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>})
</span></span></code></pre></div><ul><li>发起<code>post</code>请求</li></ul><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> req <span style=color:#04a5e5;font-weight:700>=</span> http.request(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>		method<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>		hostname<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;localhost&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		port<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>3300</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	res =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>		res.on(<span style=color:#40a02b>&#39;data&#39;</span>, chunk =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>			console.log(<span style=color:#40a02b>&#39;chunk:&#39;</span>, chunk.toString())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>			console.log(<span style=color:#40a02b>&#39;data:&#39;</span>, JSON.parse(chunk.toString()))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>req.end()
</span></span></code></pre></div><h3 id=文件上传>文件上传<a class=anchorjs-link href=#%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0></a></h3><p>文件上传时会将文件分多个<code>buffer</code>传入到服务端，如果传入的数据中还包括其他字段，则需要将其他字段内容以及上传时formdata本身携带的字符内容去除才能得到正确的文件内容。</p><p>错误的做法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>const</span> fs <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;fs&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	<span style=color:#8839ef>if</span> (req.url <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/upload&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>		<span style=color:#8839ef>if</span> (req.method <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>			<span style=color:#8839ef>const</span> file <span style=color:#04a5e5;font-weight:700>=</span> fs.createWriteStream(<span style=color:#40a02b>&#39;foo.png&#39;</span>, { flags<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;a+&#39;</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>			<span style=color:#d20f39>let</span> body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>			req.on(<span style=color:#40a02b>&#39;data&#39;</span>, chunk =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>				body <span style=color:#04a5e5;font-weight:700>+=</span> chunk
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>				file.write(chunk)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			req.on(<span style=color:#40a02b>&#39;end&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>				res.end(<span style=color:#40a02b>&#39;ok&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>	console.log(<span style=color:#40a02b>&#39;Server running at http://localhost:3000/&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>})
</span></span></code></pre></div><p>此时写入的<code>foo.png</code>图片成功，但无法打开。</p><p>正确做法：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> http <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;http&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#8839ef>const</span> fs <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;fs&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> qs <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;querystring&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#9ca0b0;font-style:italic>// 正确做法
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> server <span style=color:#04a5e5;font-weight:700>=</span> http.createServer((req, res) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>	<span style=color:#8839ef>if</span> (req.url <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;/upload&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>		<span style=color:#8839ef>if</span> (req.method <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>			req.setEncoding(<span style=color:#40a02b>&#39;binary&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>			<span style=color:#d20f39>let</span> body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>			<span style=color:#d20f39>let</span> curSize <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#fe640b>0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>			<span style=color:#9ca0b0;font-style:italic>// 截取图片部分的二进制数据
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>			<span style=color:#8839ef>const</span> boundary <span style=color:#04a5e5;font-weight:700>=</span> req.headers[<span style=color:#40a02b>&#39;content-type&#39;</span>].split(<span style=color:#40a02b>&#39;;&#39;</span>)[<span style=color:#fe640b>1</span>].split(<span style=color:#40a02b>&#39;=&#39;</span>)[<span style=color:#fe640b>1</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>			<span style=color:#9ca0b0;font-style:italic>// 监听data事件，每次取一部分数据
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic></span>			req.on(<span style=color:#40a02b>&#39;data&#39;</span>, chunk =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>				curSize <span style=color:#04a5e5;font-weight:700>+=</span> chunk.length
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>				res.write(<span style=color:#40a02b>`文件上传进度：</span><span style=color:#40a02b>${</span>(curSize <span style=color:#04a5e5;font-weight:700>/</span> fileSize) <span style=color:#04a5e5;font-weight:700>*</span> <span style=color:#fe640b>100</span><span style=color:#40a02b>}</span><span style=color:#40a02b>%\n`</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>				body <span style=color:#04a5e5;font-weight:700>+=</span> chunk
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>			req.on(<span style=color:#40a02b>&#39;end&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>				<span style=color:#9ca0b0;font-style:italic>// console.log(body)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic></span>				<span style=color:#9ca0b0;font-style:italic>// 处理body
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#9ca0b0;font-style:italic></span>				<span style=color:#9ca0b0;font-style:italic>// 1.获取image/png的位置
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span><span style=color:#9ca0b0;font-style:italic></span>				<span style=color:#8839ef>const</span> payload <span style=color:#04a5e5;font-weight:700>=</span> qs.parse(body, <span style=color:#40a02b>&#39;\r\n&#39;</span>, <span style=color:#40a02b>&#39;: &#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>				<span style=color:#8839ef>const</span> type <span style=color:#04a5e5;font-weight:700>=</span> payload[<span style=color:#40a02b>&#39;Content-Type&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>				<span style=color:#9ca0b0;font-style:italic>// 2.开始在image/png的位置进行截取
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#9ca0b0;font-style:italic></span>				<span style=color:#8839ef>const</span> typeIndex <span style=color:#04a5e5;font-weight:700>=</span> body.indexOf(type)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>				<span style=color:#8839ef>const</span> typeLength <span style=color:#04a5e5;font-weight:700>=</span> type.length
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>				<span style=color:#d20f39>let</span> imageData <span style=color:#04a5e5;font-weight:700>=</span> body.substring(typeIndex <span style=color:#04a5e5;font-weight:700>+</span> typeLength)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>				<span style=color:#9ca0b0;font-style:italic>// 3.将中间的两个空格去掉
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span><span style=color:#9ca0b0;font-style:italic></span>				imageData <span style=color:#04a5e5;font-weight:700>=</span> imageData.replace(<span style=color:#179299>/^\s\s*/</span>, <span style=color:#40a02b>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>				<span style=color:#9ca0b0;font-style:italic>// 4.将最后的boundary去掉
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span><span style=color:#9ca0b0;font-style:italic></span>				imageData <span style=color:#04a5e5;font-weight:700>=</span> imageData.substring(<span style=color:#fe640b>0</span>, imageData.indexOf(<span style=color:#40a02b>`--</span><span style=color:#40a02b>${</span>boundary<span style=color:#40a02b>}</span><span style=color:#40a02b>--`</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">38</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">39</span><span>				<span style=color:#9ca0b0;font-style:italic>// 5.用fs写入文件
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">40</span><span><span style=color:#9ca0b0;font-style:italic></span>				fs.writeFile(<span style=color:#40a02b>&#39;foo.png&#39;</span>, imageData, <span style=color:#40a02b>&#39;binary&#39;</span>, err =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">41</span><span>					res.end(<span style=color:#40a02b>&#39;ok&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">42</span><span>				})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">43</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">44</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">45</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">46</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">47</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">48</span><span>server.listen(<span style=color:#fe640b>3300</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">49</span><span>	console.log(<span style=color:#40a02b>&#39;Server running at http://localhost:3300/&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">50</span><span>})
</span></span></code></pre></div><p>处理起来非常复杂，需要通过多次截取和去除对应的字符来得到上传图片的内容，所以上传一般使用express和koa中的包来进行处理。</p><p>浏览器端使用axios来上传图片，服务端来接收。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>&lt;<span style=color:#8839ef>html</span> <span style=color:#1e66f5>lang</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>	&lt;<span style=color:#8839ef>head</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>		&lt;<span style=color:#8839ef>meta</span> <span style=color:#1e66f5>charset</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;UTF-8&#34;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>		&lt;<span style=color:#8839ef>meta</span> <span style=color:#1e66f5>http-equiv</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;X-UA-Compatible&#34;</span> <span style=color:#1e66f5>content</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;IE=edge&#34;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>		&lt;<span style=color:#8839ef>meta</span> <span style=color:#1e66f5>name</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;viewport&#34;</span> <span style=color:#1e66f5>content</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>		&lt;<span style=color:#8839ef>title</span>&gt;Document&lt;/<span style=color:#8839ef>title</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>	&lt;/<span style=color:#8839ef>head</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	&lt;<span style=color:#8839ef>body</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>		&lt;<span style=color:#8839ef>input</span> <span style=color:#1e66f5>type</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;file&#34;</span> <span style=color:#1e66f5>name</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;file&#34;</span> <span style=color:#1e66f5>id</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;photo&#34;</span> /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		&lt;<span style=color:#8839ef>button</span>&gt;upload&lt;/<span style=color:#8839ef>button</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		&lt;<span style=color:#8839ef>script</span> <span style=color:#1e66f5>src</span><span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;https://unpkg.com/axios/dist/axios.min.js&#34;</span>&gt;&lt;/<span style=color:#8839ef>script</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>		&lt;<span style=color:#8839ef>script</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>			<span style=color:#8839ef>const</span> photo <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;#photo&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>			<span style=color:#8839ef>const</span> button <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#04a5e5>document</span>.querySelector(<span style=color:#40a02b>&#39;button&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>			button.addEventListener(<span style=color:#40a02b>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>				<span style=color:#8839ef>const</span> formData <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> FormData()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>				formData.append(<span style=color:#40a02b>&#39;file&#39;</span>, photo.files[<span style=color:#fe640b>0</span>])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>				axios
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>					.post(<span style=color:#40a02b>&#39;http://localhost:3300/upload&#39;</span>, formData, {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>						headers<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>							<span style=color:#40a02b>&#39;Content-Type&#39;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;multipart/form-data&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>						}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>					})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>					.then(res =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>						console.log(res)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>					})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>					.<span style=color:#8839ef>catch</span>(err =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>						console.log(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>					})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">34</span><span>			})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">35</span><span>		&lt;/<span style=color:#8839ef>script</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">36</span><span>	&lt;/<span style=color:#8839ef>body</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">37</span><span>&lt;/<span style=color:#8839ef>html</span>&gt;
</span></span></code></pre></div><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/node-stream/ data-toggle=tooltip data-placement=top title="Node 05 Stream 流">Previous<br><span>Node 05 Stream 流</span></a></li><li class=next><a href=/posts/node-express/ data-toggle=tooltip data-placement=top title="Node 07 Express 框架">Next<br><span>Node 07 Express 框架</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>