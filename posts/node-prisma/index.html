<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Node 11 ORM Prisma | SimFantasy</title>
<meta name=author content="Simz"><meta name=description content="Prisma 是一个开源的数据库工具链项目，不仅仅是一个简单的 ORM 工具。它支持的数据库有 PostgreSQL、MySQL、MongoDB、SQL Server和SQLite，示例使用 Koa2 + MySQL 进行说明。"><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Node 11 ORM Prisma"><meta name=twitter:description content="Prisma 是一个开源的数据库工具链项目，不仅仅是一个简单的 ORM 工具。它支持的数据库有 PostgreSQL、MySQL、MongoDB、SQL Server和SQLite，示例使用 Koa2 + MySQL 进行说明。"><meta property="og:url" content="http://localhost/posts/node-prisma/"><meta property="og:site_name" content="SimFantasy"><meta property="og:title" content="Node 11 ORM Prisma"><meta property="og:description" content="Prisma 是一个开源的数据库工具链项目，不仅仅是一个简单的 ORM 工具。它支持的数据库有 PostgreSQL、MySQL、MongoDB、SQL Server和SQLite，示例使用 Koa2 + MySQL 进行说明。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-08T23:30:42+08:00"><meta property="article:modified_time" content="2023-10-08T23:30:42+08:00"><meta property="article:tag" content="Node"><meta property="article:tag" content="Prisma"><meta property="og:see_also" content="http://localhost/posts/node-egg/"><meta property="og:see_also" content="http://localhost/posts/node-mongoose/"><meta property="og:see_also" content="http://localhost/posts/node-mongodb/"><meta property="og:see_also" content="http://localhost/posts/node-log/"><meta property="og:see_also" content="http://localhost/posts/node-validator/"><meta property="og:see_also" content="http://localhost/posts/node-sequelize/"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=123"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=123"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=123"><link rel=manifest href=/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=http://localhost/>SimFantasy</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/archive/ title=Archive>Archive</a></li><li><a href=/series/ title=Note>Note</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Node 11 ORM Prisma</h1><h2 class=subheading></h2><span class=meta><div class=meta-item><i class="far fa-user-circle"></i> Simz</div><div class=meta-item><i class="far fa-calendar"></i> 2023-10-08</div><div class=meta-item><i class="fa fa-tag"></i>
<a href=/tags/node/ title=Node>Node</a>
<a href=/tags/prisma/ title=Prisma>Prisma</a></div></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p><code>Prisma</code> 是一个开源的数据库工具链项目，不仅仅是一个简单的 <code>ORM</code> 工具。它支持的数据库有 <code>PostgreSQL</code>、<code>MySQL</code>、<code>MongoDB</code>、<code>SQL Server</code>和<code>SQLite</code>，示例使用 <code>Koa2 + MySQL</code> 进行说明。</p><p>基本使用步骤：</p><ol><li>安装依赖</li><li>初始化<code>Prisma</code></li><li>设计<code>Prisma Schema</code>（数据库信息和模型）</li><li>同步到数据库</li><li>生成<code>Prisma Client</code></li><li>使用<code>Prisma Client</code> 完成 <code>CURD</code>数据操作</li></ol><h3 id=初始化环境>初始化环境<a class=anchorjs-link href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e7%8e%af%e5%a2%83></a></h3><p>使用<code>koa</code>来搭建一个简单的<code>web服务</code>。创建项目并安装依赖：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>mkdir koa-prisma-demo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#04a5e5>cd</span> koa-prisma-demo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>pnpm init
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>pnpm add koa @koa/router koa-bodyparser
</span></span></code></pre></div><p>在来创建项目所需的基础文件，因为涉及到数据关联，所以准备用户和文章两个模块，放到对应的路由文件。</p><p>入口文件：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/main.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> Koa <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;koa&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> bodyParser <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;koa-bodyparser&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> loadRouter <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;./router&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span><span style=color:#9ca0b0;font-style:italic>// 创建一个Koa app 实例
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> app <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Koa()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic>// 解析请求体
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>app.use(bodyParser())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// 加载路由
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>loadRouter(app)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span><span style=color:#9ca0b0;font-style:italic>// 监听端口
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span><span style=color:#9ca0b0;font-style:italic></span>app.listen(<span style=color:#fe640b>3000</span>, () =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>	console.log(<span style=color:#40a02b>&#39;Server is running at http://localhost:3000&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>})
</span></span></code></pre></div><p>路由入口文件，通过遍历自动加载<code>router</code>目录下所有路由文件</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/router/index.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> fs <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;fs&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#9ca0b0;font-style:italic>// 加载路由函数
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#d20f39>function</span> loadRouter(app) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取当前文件夹下的所有文件
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> files <span style=color:#04a5e5;font-weight:700>=</span> fs.readdirSync(__dirname)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	<span style=color:#9ca0b0;font-style:italic>// 遍历所有路由文件，加载路由
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>for</span> (<span style=color:#8839ef>const</span> file <span style=color:#8839ef>of</span> files) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>		<span style=color:#8839ef>if</span> (file <span style=color:#04a5e5;font-weight:700>===</span> <span style=color:#40a02b>&#39;index.js&#39;</span>) <span style=color:#8839ef>continue</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>		<span style=color:#8839ef>const</span> router <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>`./</span><span style=color:#40a02b>${</span>file<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>		app.use(router.routes())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>		app.use(router.allowedMethods())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>module.exports <span style=color:#04a5e5;font-weight:700>=</span> loadRouter
</span></span></code></pre></div><p>用户路由</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// src/router/user.js
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span><span style=color:#8839ef>const</span> Router <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;@koa/router&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span><span style=color:#8839ef>const</span> userRouter <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Router({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>	prefix<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;/users&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic>// 查询用户列表
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.get(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;用户列表&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic>// 查询用户详情
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.get(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`用户</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>的详情`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic>// 创建用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.post(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;创建用户&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic>// 更新用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.patch(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`更新用户</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#9ca0b0;font-style:italic>// 删除用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.<span style=color:#8839ef>delete</span>(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`删除用户</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>module.exports <span style=color:#04a5e5;font-weight:700>=</span> userRouter
</span></span></code></pre></div><p>文章路由</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#8839ef>const</span> Router <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;@koa/router&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span><span style=color:#8839ef>const</span> postRouter <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Router({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>	prefix<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;/posts&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span><span style=color:#9ca0b0;font-style:italic>// 查询文章列表
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span><span style=color:#9ca0b0;font-style:italic></span>postRouter.get(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;文章列表&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span><span style=color:#9ca0b0;font-style:italic>// 查询文章详情
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span><span style=color:#9ca0b0;font-style:italic></span>postRouter.get(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`文章</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>的详情`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span><span style=color:#9ca0b0;font-style:italic>// 创建文章
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span><span style=color:#9ca0b0;font-style:italic></span>postRouter.post(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#39;创建文章&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span><span style=color:#9ca0b0;font-style:italic>// 更新文章
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span><span style=color:#9ca0b0;font-style:italic></span>postRouter.patch(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`更新文章</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span><span style=color:#9ca0b0;font-style:italic>// 删除文章
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span><span style=color:#9ca0b0;font-style:italic></span>postRouter.<span style=color:#8839ef>delete</span>(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>`删除文章</span><span style=color:#40a02b>${</span>ctx.params.id<span style=color:#40a02b>}</span><span style=color:#40a02b>`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>module.exports <span style=color:#04a5e5;font-weight:700>=</span> postRouter
</span></span></code></pre></div><p>以上代码定义了两个基本模块的<code>REST API</code>，在<code>package.js</code>文件中在<code>scripts</code>中添加</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#40a02b>&#34;scripts&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>		<span style=color:#40a02b>&#34;dev&#34;</span><span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#34;nodemon ./src/main.js&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>}
</span></span></code></pre></div><p>帮我们使用<code>nodemon</code>来启动服务。初始化<code>web</code>项目的基础搭建基本完成。</p><h3 id=prisma-cli>Prisma Cli<a class=anchorjs-link href=#prisma-cli></a></h3><h4 id=安装prisma依赖>安装<code>Prisma</code>依赖<a class=anchorjs-link href=#%e5%ae%89%e8%a3%85prisma%e4%be%9d%e8%b5%96></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add prisma -D
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>pnpm add @prisma/client
</span></span></code></pre></div><p>安装的第一个 <code>prisma</code>，它是一个 <code>CLI 命令</code>，主要通过它来调用 <code>Prisma</code> 的各种功能，包括数据库迁移，创建<code>Prisma Client</code> 等等。</p><p>然后执行，如下命令可以查看<code>Prisma</code>使用说明</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpx prisma -h
</span></span></code></pre></div><p>可以看到给出了七个命令和命令的使用说明。</p><table><thead><tr><th>命令</th><th>说明</th><th>使用</th></tr></thead><tbody><tr><td><code>init</code></td><td>在应用中初始化<code>Prisma</code></td><td><code>prisma init</code></td></tr><tr><td><code>generate</code></td><td>生成<code>Prisma Client</code></td><td><code>prisma generate</code></td></tr><tr><td><code>db</code></td><td>管理数据库的模式和生命周期</td><td><code>prisma db pull</code></td></tr><tr><td><code>migrate</code></td><td>迁移数据库</td><td><code>prisma migrate dev</code></td></tr><tr><td><code>studio</code></td><td>启用web端的工作台来管理数据</td><td><code>prisma studio</code></td></tr><tr><td><code>validate</code></td><td>检查<code>Prisma</code>的<code>schema</code>文件语法是否正确</td><td><code>prisma validate</code></td></tr><tr><td><code>format</code></td><td>格式化<code>Prisma</code>的<code>schema</code>文件，默认<code>prisma/schema.prisma</code></td><td><code>prisma format</code></td></tr></tbody></table><p>然后执行，如下命令可以查看初始化的使用说明，主要可以看到<code>prisma</code>给我们的一些示例。例如在项目中如果使用<code>mysql</code>数据库的命令模板。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span>pnpx prisma init -h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>Examples
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>Set up a new Prisma project with PostgreSQL <span style=color:#04a5e5;font-weight:700>(</span>default<span style=color:#04a5e5;font-weight:700>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>  $ prisma init
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>Set up a new Prisma project and specify MySQL as the datasource provider to use
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  $ prisma init --datasource-provider mysql
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>Set up a new Prisma project and specify the url that will be used
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>  $ prisma init --url mysql://user:password@localhost:3306/mydb
</span></span></code></pre></div><p>执行 这个命令</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpx prisma init --datasource-provider mysql
</span></span></code></pre></div><p><code>Prisma</code>会在根目录下创建一个<code>.env</code>文件和一个<code>prisma</code>目录，下面创建了一个<code>schema.prisma</code>文件。</p><ul><li><p><code>schema.prisma</code>文件中则是默认的数据源连接声明和数据连接。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>generator client {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>  provider <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#34;prisma-client-js&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span>datasource db {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>  provider <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#34;mysql&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>  url      <span style=color:#04a5e5;font-weight:700>=</span> env(<span style=color:#40a02b>&#34;DATABASE_URL&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>}
</span></span></code></pre></div></li><li><p><code>.env</code>文件中默认是<code>mysql</code>的连接配置信息。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>DATABASE_URL<span style=color:#04a5e5;font-weight:700>=</span><span style=color:#40a02b>&#34;mysql://johndoe:randompassword@localhost:3306/mydb&#34;</span>
</span></span></code></pre></div></li></ul><p><strong>注意：</strong></p><p>修改了<code>prisma.prisma</code>这个文件中的内容，需要使用<code>pnpx prisma generate</code>来更新下<code>Prisma Client</code>缓存，生成新的<code>PrismaClient</code>，因为所有查询都是<code>PrismaClient</code>的实例，但是为了更好的使用查询<code>PrismaClient</code>有缓存，所以每次修改<code>prisma.prisma</code>文件后，除了要使用<code>pnpx prisma db push</code>更新数据库的调整，一些外键关联的调整最好也要执行下这条命令。</p><ul><li><p>如果发现更新模型字段后，使用<code>pnpx prisma db push</code>和<code>pnpx prisma generate</code>仍出现500错误时，可以尝试使用</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpx prisma db push --force-reset
</span></span></code></pre></div><p><code>--force-reset</code>：重置数据库，然后更新模型 - 如果由于无法执行的迁移而需要从头开始，这个命令就非常有用。</p></li><li><p>如果在发现仍无法解决500错误，可以删除<code>PrismaClient</code>所在目录后执行<code>pnpx prisma generate</code>。</p></li><li><p>或者直接删除<code>node_modules</code>文件夹，然后在重新安装依赖，再执行<code>pnpx prisma db push</code>，此时会从新生成<code>PrismaClient</code>。</p></li></ul><h4 id=连接url>连接URL<a class=anchorjs-link href=#%e8%bf%9e%e6%8e%a5url></a></h4><p><figure><a class=paragraph-image><img data-src=https://www.prisma.io/docs/static/a3179ecce1bf20faddeb7f8c02fb2251/663f3/mysql-connection-string.png data-action=zoom alt="Structure of the MySQL connection URL" class=lazyload></a></figure></p><p>基础URL和路基说明：</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>mysql<span style=color:#04a5e5;font-weight:700>:</span><span style=color:#9ca0b0;font-style:italic>//USER:PASSWORD@HOST:PORT/DATABASE
</span></span></span></code></pre></div><p>至此<code>Prisma</code>安装基本完成。</p><h3 id=定义模型>定义模型<a class=anchorjs-link href=#%e5%ae%9a%e4%b9%89%e6%a8%a1%e5%9e%8b></a></h3><p>作为一个 <code>ORM</code> 工具，自然需要定义模型。<code>Prisma</code> 的模型主要有以下作用：</p><ul><li>构成了应用领域的 实体</li><li>映射到数据库的表（关系型数据库，例如 <code>PostgreSQL</code>或 集合 <code>MongoDB</code>）</li><li>构成 <code>Prisma Client API</code> 中查询的基础</li><li>在使用 <code>TypeScript</code> 时，<code>Prisma Client</code> 为模型及其变体提供类型定义，保证数据库访问的类型安全</li></ul><p>在<code>schema.prisma</code>文件中继续定义模型</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 1</span><span><span style=color:#9ca0b0;font-style:italic>// prisma/schema.prisma
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 2</span><span><span style=color:#9ca0b0;font-style:italic></span>generator client {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 3</span><span>  provider <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#34;prisma-client-js&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 6</span><span>datasource db {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 7</span><span>  provider <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#40a02b>&#34;mysql&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 8</span><span>  url      <span style=color:#04a5e5;font-weight:700>=</span> env(<span style=color:#40a02b>&#34;DATABASE_URL&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">11</span><span>model User {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">12</span><span>  id        Int      <span style=color:#d20f39>@</span>id
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">13</span><span>  username  <span style=color:#04a5e5>String</span>   <span style=color:#d20f39>@</span>unique
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">14</span><span>  email     <span style=color:#04a5e5>String</span>   <span style=color:#d20f39>@</span>unique
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">15</span><span>  password  <span style=color:#04a5e5>String</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">16</span><span>  bio       <span style=color:#04a5e5>String</span><span style=color:#04a5e5;font-weight:700>?</span>  <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(<span style=color:#40a02b>&#34;&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">17</span><span>  image     <span style=color:#04a5e5>String</span><span style=color:#04a5e5;font-weight:700>?</span>  <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(<span style=color:#40a02b>&#34;&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">18</span><span>  createdAt DateTime <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(now()) <span style=color:#d20f39>@</span>map(<span style=color:#40a02b>&#34;created_at&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">19</span><span>  updatedAt DateTime <span style=color:#d20f39>@</span>updatedAt <span style=color:#d20f39>@</span>map(<span style=color:#40a02b>&#34;updated_at&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">21</span><span>  <span style=color:#d20f39>@@</span>map(<span style=color:#40a02b>&#34;users&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">24</span><span>model Post {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">25</span><span>  id          Int      <span style=color:#d20f39>@</span>id
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">26</span><span>  title       <span style=color:#04a5e5>String</span>   <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(<span style=color:#40a02b>&#34;&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">27</span><span>  description <span style=color:#04a5e5>String</span>   <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(<span style=color:#40a02b>&#34;&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">28</span><span>  body        <span style=color:#04a5e5>String</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">29</span><span>  createdAt   DateTime <span style=color:#d20f39>@</span><span style=color:#8839ef>default</span>(now()) <span style=color:#d20f39>@</span>map(<span style=color:#40a02b>&#34;created_at&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">30</span><span>  updatedAt   DateTime <span style=color:#d20f39>@</span>updatedAt <span style=color:#d20f39>@</span>map(<span style=color:#40a02b>&#34;updated_at&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">32</span><span>  <span style=color:#d20f39>@@</span>map(<span style=color:#40a02b>&#34;posts&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">33</span><span>}
</span></span></code></pre></div><ul><li>模型的名字默认就是创建的数据表的名字，这里是大写的 <code>User</code>，那么数据表名也就是大写的 <code>User</code>，可以使用 <code>@@map("users")</code> 来设置映射的表名 。</li><li>每个模型的记录都是唯一可识别的，使用 <code>@id</code> 声明对应的主键即可</li><li>字段的类似，如： <code>Int</code>、<code>String</code>，<code>Prisma</code>会自动转为数据库对应的类型。</li><li><code>@unique</code>是唯一值约束，表示生成的<code>username</code>、<code>email</code>字段的值不能重复</li><li><code>@map()</code>可以修改映射的字段名称。</li><li><code>@default(“”)</code>表示默认值为空</li></ul><h4 id=同步数据>同步数据<a class=anchorjs-link href=#%e5%90%8c%e6%ad%a5%e6%95%b0%e6%8d%ae></a></h4><p>添加完模型可以使用下面的命令，将数据模型推送到数据库生成对应的表和字段。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpx prisma db push
</span></span></code></pre></div><h4 id=查看数据>查看数据<a class=anchorjs-link href=#%e6%9f%a5%e7%9c%8b%e6%95%b0%e6%8d%ae></a></h4><p><code>Prisma</code>自带了一个web数据库管理工具，输入下面的命令即可启动</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpx prisma studio
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span>// Prisma Studio is up on http://localhost:5555
</span></span></code></pre></div><p>默认在 <code>http://localhost:5555</code> 启动了一个web服务</p><h3 id=数据库连接与数据操作>数据库连接与数据操作<a class=anchorjs-link href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e4%b8%8e%e6%95%b0%e6%8d%ae%e6%93%8d%e4%bd%9c></a></h3><p><code>Prisma</code>与数据连接通常使用<code>Prisma Client</code>，<code>Prisma Client</code> 是一个自动生成的类型安全查询构造器，可根据你的数据进行定制。<code>Prisma Client</code> 是一个跟据你的数据库 <code>schema</code> 自动生成的定制化数据库客户端 <code>client</code>。</p><h4 id=安装>安装<a class=anchorjs-link href=#%e5%ae%89%e8%a3%85></a></h4><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span>pnpm add @prisma/client
</span></span></code></pre></div><p>执行此命令还将运行 <code>prisma generate</code> 命令，该命令 将 <code>Prisma Client</code> 生成到 <code>node_modules/.prisma/client</code> 目录。</p><p>通常情况下可以使用 <code>Prisma Client</code> 向数据库发送查询。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> { PrismaClient } <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;@prisma/client&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#8839ef>const</span> prisma <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> PrismaClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span><span style=color:#9ca0b0;font-style:italic>// 在应用程序中使用 `prisma` 读取和写入数据库中的数据
</span></span></span></code></pre></div><h4 id=prismaclient实例数量很重要><code>PrismaClient</code>实例数量很重要<a class=anchorjs-link href=#prismaclient%e5%ae%9e%e4%be%8b%e6%95%b0%e9%87%8f%e5%be%88%e9%87%8d%e8%a6%81></a></h4><p>通常情况下一个项目只需要创建一个<code>PrismaClient</code>实例，因为每个 <code>PrismaClient</code> 实例会维护一个连接池，意味着大量数据库连接会 耗尽数据库连接数限制。这适用于所有数据库连接器 (<code>database connector</code>)。</p><p>所以常用的做法是创建一个<code>db</code>文件将<code>prisma</code>实例导出，在需要的地方进行引用。</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">1</span><span><span style=color:#8839ef>const</span> { PrismaClient } <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;@prisma/client&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">2</span><span><span style=color:#8839ef>const</span> prisma <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> PrismaClient()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">4</span><span><span style=color:#9ca0b0;font-style:italic>// 数据库连接
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">5</span><span><span style=color:#9ca0b0;font-style:italic></span>prisma.$connect()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">6</span><span>	.then(() =&gt; console.log(<span style=color:#40a02b>&#39;mysql connect success ~&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">7</span><span>	.<span style=color:#8839ef>catch</span>(err =&gt; console.log(<span style=color:#40a02b>&#39;mysql connect failed:&#39;</span>, err))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">9</span><span>module.exports <span style=color:#04a5e5;font-weight:700>=</span> db
</span></span></code></pre></div><h3 id=curd操作的api>CURD操作的API<a class=anchorjs-link href=#curd%e6%93%8d%e4%bd%9c%e7%9a%84api></a></h3><h4 id=findmany>findMany<a class=anchorjs-link href=#findmany></a></h4><p><code>findMany</code> 接受一个查询选项，并返回一个列表。</p><h5 id=选项>选项<a class=anchorjs-link href=#%e9%80%89%e9%a1%b9></a></h5><table><thead><tr><th>名称</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>where</code></td><td>否</td><td>将所有模型字段包装在一个类型中，以便可以按任何属性过滤列表。</td></tr><tr><td><code>orderBy</code></td><td>否</td><td>允许您按任何属性对返回的列表进行排序。</td></tr><tr><td><code>skip</code></td><td>否</td><td>指定应跳过列表中返回的对象的数量。</td></tr><tr><td><code>cursor</code></td><td>否</td><td>指定列表开始的位置（该值通常指定一个 id 或其他唯一值）。</td></tr><tr><td><code>take</code></td><td>否</td><td>指定在列表中应该返回多少个对象（从列表的<strong>开头</strong>（正值）或<strong>结尾</strong>（负值）获取，或者从 <code>cursor</code> 位置（如果使用）。</td></tr><tr><td><code>select</code></td><td>否</td><td>指定要包含的属性 在返回的对象上。</td></tr><tr><td><code>include</code></td><td>否</td><td>指定急切加载哪些关系 在返回的对象上。</td></tr><tr><td><code>distinct</code></td><td>否</td><td>允许您按特定的字段来过滤掉重复的行。 - 例如仅返回不同标题的“帖子”。</td></tr></tbody></table><h4 id=findunique>findUnique<a class=anchorjs-link href=#findunique></a></h4><p><code>findUnique</code> 查询 使用唯一条件来获取单个数据库记录：</p><ul><li>按 <em>ID</em></li><li>按 <em>唯一</em>(<em>unique</em>) 属性</li></ul><h5 id=选项-1>选项<a class=anchorjs-link href=#%e9%80%89%e9%a1%b9-1></a></h5><table><thead><tr><th>名称</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>where</code></td><td>是</td><td>包含模型的所有唯一字段，以便可以选择各个记录。</td></tr><tr><td><code>select</code></td><td>否</td><td>指定返回的对象要包含的属性。</td></tr><tr><td><code>include</code></td><td>否</td><td>指定返回的对象要加载的关系。</td></tr><tr><td><code>rejectOnNotFound</code></td><td>否</td><td>如果为 <code>true</code>, 抛出一个 <code>NotFoundError: No User found error</code>. 你也可以 配置开启全局 <code>rejectOnNotFound</code>。</td></tr></tbody></table><h4 id=create>create<a class=anchorjs-link href=#create></a></h4><p><code>create</code> 创建一条新的数据库记录。</p><h5 id=选项-2>选项<a class=anchorjs-link href=#%e9%80%89%e9%a1%b9-2></a></h5><table><thead><tr><th>名称</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>data</code></td><td>是</td><td>将所有模型字段包装在一个类型中，以便在创建新记录时提供它们。它还包括允许您执行（事务性）嵌套插入的关系字段。在数据模型中标记为可选或具有默认值的字段是可选的。</td></tr><tr><td><code>select</code></td><td>否</td><td>指定要包含的属性 在返回的对象上。</td></tr><tr><td><code>include</code></td><td>否</td><td>指定返回的对象要加载的关系。</td></tr></tbody></table><h4 id=update>update<a class=anchorjs-link href=#update></a></h4><p><code>update</code> 更新现有的数据库记录。</p><h5 id=选项-3>选项<a class=anchorjs-link href=#%e9%80%89%e9%a1%b9-3></a></h5><table><thead><tr><th>名称</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>data</code></td><td>是</td><td>包装模型的所有字段，以便在更新现有记录时可以提供它们。在数据模型中标记为可选或具有默认值的字段是可选的。</td></tr><tr><td><code>where</code></td><td>是</td><td>包装模型的所有 <code>unique</code> 字段，以便可以选择单个记录。</td></tr><tr><td><code>select</code></td><td>否</td><td>指定要包含的属性 在返回的对象上。</td></tr><tr><td><code>include</code></td><td>否</td><td>指定返回的对象要加载的关系。</td></tr></tbody></table><h4 id=delete>delete<a class=anchorjs-link href=#delete></a></h4><p><code>delete</code> 删除现有的数据库记录。您可以删除记录:</p><ul><li>按 <em>ID</em></li><li>按一个 <em>unique</em> 属性</li></ul><h5 id=选项-4>选项<a class=anchorjs-link href=#%e9%80%89%e9%a1%b9-4></a></h5><table><thead><tr><th>名称</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td><code>where</code></td><td>是</td><td>包装模型的所有 <code>unique</code> 字段，以便可以选择单个记录。</td></tr><tr><td><code>select</code></td><td>否</td><td>指定要包含的属性 在返回的对象上。</td></tr><tr><td><code>include</code></td><td>否</td><td>指定返回的对象要加载的关系。</td></tr></tbody></table><p>其他模型查询<code>Model queries</code>见 <a href=https://prisma.yoga/reference/api-reference/prisma-client-reference#%E6%A8%A1%E5%9E%8B%E6%9F%A5%E8%AF%A2-model-queries target=_blank>文档</a></p><p>示例</p><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  1</span><span><span style=color:#8839ef>const</span> Router <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;@koa/router&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  2</span><span><span style=color:#8839ef>const</span> db <span style=color:#04a5e5;font-weight:700>=</span> require(<span style=color:#40a02b>&#39;../config/db&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  4</span><span><span style=color:#8839ef>const</span> userRouter <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>new</span> Router({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  5</span><span>	prefix<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;/users&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  6</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  8</span><span><span style=color:#8839ef>const</span> userInfo <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">  9</span><span>	id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 10</span><span>	username<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 11</span><span>	email<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 12</span><span>	bio<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 13</span><span>	image<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 14</span><span>	createdAt<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 15</span><span>	updatedAt<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 16</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 18</span><span><span style=color:#9ca0b0;font-style:italic>// 查询用户列表
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 19</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.get(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 20</span><span>	<span style=color:#9ca0b0;font-style:italic>// 查询用户列表
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 21</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> users <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.User.findMany({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 22</span><span>		select<span style=color:#04a5e5;font-weight:700>:</span> userInfo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 23</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 25</span><span>	<span style=color:#9ca0b0;font-style:italic>// 返回响应
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 26</span><span><span style=color:#9ca0b0;font-style:italic></span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 27</span><span>		code<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>200</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 28</span><span>		message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;查询用户列表成功&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 29</span><span>		data<span style=color:#04a5e5;font-weight:700>:</span> users
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 30</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 31</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 33</span><span><span style=color:#9ca0b0;font-style:italic>// 查询用户详情
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 34</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.get(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 35</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取用户id
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 36</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> { id } <span style=color:#04a5e5;font-weight:700>=</span> ctx.params
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 38</span><span>	<span style=color:#9ca0b0;font-style:italic>// 查询用户详情
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 39</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.User.findUnique({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 40</span><span>		where<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 41</span><span>			id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5>Number</span>(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 42</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 43</span><span>		select<span style=color:#04a5e5;font-weight:700>:</span> userInfo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 44</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 46</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 47</span><span>		code<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>200</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 48</span><span>		message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;查询用户详情成功&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 49</span><span>		data<span style=color:#04a5e5;font-weight:700>:</span> user
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 50</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 51</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 53</span><span><span style=color:#9ca0b0;font-style:italic>// 创建用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 54</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.post(<span style=color:#40a02b>&#39;/&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 55</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取请求体中的参数
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 56</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> ctx.request.body
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 57</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 58</span><span>	<span style=color:#9ca0b0;font-style:italic>// 创建用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 59</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> data <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.User.create({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 60</span><span>		data<span style=color:#04a5e5;font-weight:700>:</span> user,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 61</span><span>		select<span style=color:#04a5e5;font-weight:700>:</span> userInfo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 62</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 63</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 64</span><span>	<span style=color:#9ca0b0;font-style:italic>// 返回响应
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 65</span><span><span style=color:#9ca0b0;font-style:italic></span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 66</span><span>		code<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>200</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 67</span><span>		message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;创建用户成功&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 68</span><span>		data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 69</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 70</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 71</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 72</span><span><span style=color:#9ca0b0;font-style:italic>// 更新用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 73</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.patch(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 74</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取用户id
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 75</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> { id } <span style=color:#04a5e5;font-weight:700>=</span> ctx.params
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 76</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 77</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取请求体中的参数
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 78</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> ctx.request.body
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 79</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 80</span><span>	<span style=color:#9ca0b0;font-style:italic>// 更新用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 81</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> data <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.User.update({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 82</span><span>		where<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 83</span><span>			id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5>Number</span>(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 84</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 85</span><span>		data<span style=color:#04a5e5;font-weight:700>:</span> user,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 86</span><span>		select<span style=color:#04a5e5;font-weight:700>:</span> userInfo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 87</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 88</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 89</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 90</span><span>		code<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>200</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 91</span><span>		message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;更新用户成功&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 92</span><span>		data
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 93</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 94</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 96</span><span><span style=color:#9ca0b0;font-style:italic>// 删除用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 97</span><span><span style=color:#9ca0b0;font-style:italic></span>userRouter.<span style=color:#8839ef>delete</span>(<span style=color:#40a02b>&#39;/:id&#39;</span>, <span style=color:#8839ef>async</span> (ctx, next) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 98</span><span>	<span style=color:#9ca0b0;font-style:italic>// 获取用户id
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1"> 99</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> { id } <span style=color:#04a5e5;font-weight:700>=</span> ctx.params
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">100</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">101</span><span>	<span style=color:#9ca0b0;font-style:italic>// 删除用户
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">102</span><span><span style=color:#9ca0b0;font-style:italic></span>	<span style=color:#8839ef>const</span> user <span style=color:#04a5e5;font-weight:700>=</span> <span style=color:#8839ef>await</span> db.User.<span style=color:#8839ef>delete</span>({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">103</span><span>		where<span style=color:#04a5e5;font-weight:700>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">104</span><span>			id<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#04a5e5>Number</span>(id)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">105</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">106</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">107</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">108</span><span>	ctx.body <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">109</span><span>		code<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#fe640b>200</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">110</span><span>		message<span style=color:#04a5e5;font-weight:700>:</span> <span style=color:#40a02b>&#39;删除用户成功&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">111</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">112</span><span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">113</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#8c8fa1">114</span><span>module.exports <span style=color:#04a5e5;font-weight:700>=</span> userRouter
</span></span></code></pre></div><h3 id=问题和注意事项>问题和注意事项<a class=anchorjs-link href=#%e9%97%ae%e9%a2%98%e5%92%8c%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9></a></h3><ul><li><p>多对多查询获取关联数据，会发现获取到的内容会多一层关联第三方表的数据，这里需要对返回的数据进行加工，在返回给客户端。[官方解决办法](<a href=https://prisma.yoga/support/help-articles/working-with-many-to-many-relations target=_blank>多对多关系的建模和查询 - Prisma 中文文档</a>)</p></li><li><p>注意不能同时使用<code>select</code>和<code>include</code>，如果使用了<code>select</code>，可以直接把需要外键关联的数据获取到，只需要使用正确的模型字段即可。使用<code>select</code>可以直接把<code>include</code>的外键关联模型数据获取到，也没必要再去使用<code>include</code>了，另外，<code>select</code>可以嵌套<code>select</code>筛选字段。 <a href=https://prisma.yoga/concepts/components/prisma-client/relation-queries#%E9%80%89%E6%8B%A9%E7%89%B9%E5%AE%9A%E7%9A%84%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5 target=_blank>官方解释</a></p></li></ul><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/node-sequelize/ data-toggle=tooltip data-placement=top title="Node 10 ORM Sequelize">Previous<br><span>Node 10 ORM Sequelize</span></a></li><li class=next><a href=/posts/node-validator/ data-toggle=tooltip data-placement=top title="Node 12 数据验证">Next<br><span>Node 12 数据验证</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/api/>Api</a>
<a href=/tags/auth0/>Auth0</a>
<a href=/tags/chakraui/>Chakraui</a>
<a href=/tags/css/>Css</a>
<a href=/tags/egg/>Egg</a>
<a href=/tags/electron/>Electron</a>
<a href=/tags/elementplus/>ElementPlus</a>
<a href=/tags/elementui/>Elementui</a>
<a href=/tags/elint/>Elint</a>
<a href=/tags/eslint/>Eslint</a>
<a href=/tags/express/>Express</a>
<a href=/tags/firebase/>Firebase</a>
<a href=/tags/formik/>Formik</a>
<a href=/tags/git/>Git</a>
<a href=/tags/graphql/>GraphQL</a>
<a href=/tags/hexo/>Hexo</a>
<a href=/tags/hooks/>Hooks</a>
<a href=/tags/icon/>Icon</a>
<a href=/tags/javascript/>Javascript</a>
<a href=/tags/koa/>Koa</a>
<a href=/tags/mongoddb/>Mongoddb</a>
<a href=/tags/nextjs/>Nextjs</a>
<a href=/tags/node/>Node</a>
<a href=/tags/pinia/>Pinia</a>
<a href=/tags/prettier/>Prettier</a>
<a href=/tags/prisma/>Prisma</a>
<a href=/tags/react/>React</a>
<a href=/tags/react-query/>React-Query</a>
<a href=/tags/react-router/>React-Router</a>
<a href=/tags/redux-toolkit/>Redux-Toolkit</a>
<a href=/tags/sequelize/>Sequelize</a>
<a href=/tags/strapi/>Strapi</a>
<a href=/tags/styled-components/>Styled-Components</a>
<a href=/tags/typescript/>Typescript</a>
<a href=/tags/valtio/>Valtio</a>
<a href=/tags/vite/>Vite</a>
<a href=/tags/vscode/>Vscode</a>
<a href=/tags/vue/>Vue</a>
<a href=/tags/vuex/>Vuex</a>
<a href=/tags/zustand/>Zustand</a>
<a href=/tags/%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/>避坑指南</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"></ul><p class="copyright text-muted">Copyright &copy; SimFantasy 2024<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")})</script><script type=text/javascript src=/js/jquery.nav.min.ade6bde8f9fcc6a4b40852cb892e9f5912340ab8fe1305149d917fdd16fffd8d.js></script><script>$(document).ready(function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=/zoomjs/zoom.min.js></script></body></html>