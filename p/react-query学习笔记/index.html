<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="è®°å½• Tanstack React Query å­¦ä¹ ç¬”è®°"><title>React Queryå­¦ä¹ ç¬”è®°</title><link rel=canonical href=https://simfantasy.github.io/p/react-query%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><link rel=stylesheet href=/scss/style.min.15af732bdfb6b3a04618c895059fde65ecca91674c62b3cecca8e9f1bab3dcae.css><meta property="og:title" content="React Queryå­¦ä¹ ç¬”è®°"><meta property="og:description" content="è®°å½• Tanstack React Query å­¦ä¹ ç¬”è®°"><meta property="og:url" content="https://simfantasy.github.io/p/react-query%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="Sim Fantasy"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="react"><meta property="article:tag" content="react-query"><meta property="article:published_time" content="2022-10-21T14:43:34+00:00"><meta property="article:modified_time" content="2022-10-21T14:43:34+00:00"><meta name=twitter:title content="React Queryå­¦ä¹ ç¬”è®°"><meta name=twitter:description content="è®°å½• Tanstack React Query å­¦ä¹ ç¬”è®°"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu6bdaa3e6937b3886ba6ff7f222cf163b_17656_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ€</span></figure><div class=site-meta><h1 class=site-name><a href=/>Sim Fantasy</a></h1><h2 class=site-description>Stay hungry, stay foolish ~</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-topbar><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2></div><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#å®‰è£…é…ç½®>å®‰è£…&é…ç½®</a></li><li><a href=#è·å–æ•°æ®>è·å–æ•°æ®</a><ol><li><a href=#ä¹‹å‰çš„åšæ³•>ä¹‹å‰çš„åšæ³•</a></li><li><a href=#ä½¿ç”¨-reactquery-çš„åšæ³•>ä½¿ç”¨ ReactQuery çš„åšæ³•</a></li></ol></li><li><a href=#è·å–è¯·æ±‚æ—¶çš„é”™è¯¯>è·å–è¯·æ±‚æ—¶çš„é”™è¯¯</a><ol><li><a href=#ä¹‹å‰çš„åšæ³•-1>ä¹‹å‰çš„åšæ³•</a></li><li><a href=#reactquery-çš„åšæ³•>ReactQuery çš„åšæ³•</a></li></ol></li><li><a href=#å¼€å‘å·¥å…·-devtools>å¼€å‘å·¥å…· DevTools</a></li><li><a href=#ç¼“å­˜>ç¼“å­˜</a></li><li><a href=#é™ˆæ—§æ—¶é—´>é™ˆæ—§æ—¶é—´</a></li><li><a href=#è·å–æ•°æ®-1>è·å–æ•°æ®</a></li><li><a href=#é€šè¿‡äº‹ä»¶çš„æ–¹å¼è·å–æ•°æ®>é€šè¿‡äº‹ä»¶çš„æ–¹å¼è·å–æ•°æ®</a></li><li><a href=#æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒå‡½æ•°>æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒå‡½æ•°</a></li><li><a href=#è½¬æ¢æˆ–ç­›é€‰æŸ¥è¯¢æ•°æ®>è½¬æ¢æˆ–ç­›é€‰æŸ¥è¯¢æ•°æ®</a></li><li><a href=#é€šè¿‡å‚æ•°æŸ¥è¯¢>é€šè¿‡å‚æ•°æŸ¥è¯¢</a></li><li><a href=#å¹¶è¡ŒæŸ¥è¯¢>å¹¶è¡ŒæŸ¥è¯¢</a></li><li><a href=#ä»å±æŸ¥è¯¢>ä»å±æŸ¥è¯¢</a></li><li><a href=#åˆå§‹åŒ–æŸ¥è¯¢æ•°æ®>åˆå§‹åŒ–æŸ¥è¯¢æ•°æ®</a></li><li><a href=#åˆ†é¡µ>åˆ†é¡µ</a></li><li><a href=#æ— é™åˆ†é¡µ>æ— é™åˆ†é¡µ</a><ol><li><a href=#ç‚¹å‡»åŠ è½½>ç‚¹å‡»åŠ è½½</a></li><li><a href=#æ»šåŠ¨åº•éƒ¨è‡ªåŠ¨åŠ è½½>æ»šåŠ¨åº•éƒ¨è‡ªåŠ¨åŠ è½½</a></li></ol></li><li><a href=#ä¿®æ”¹-mutations>ä¿®æ”¹ Mutations</a><ol><li><a href=#ç®€å•æ·»åŠ >ç®€å•æ·»åŠ </a></li><li><a href=#ç™»å½•ç¤ºä¾‹>ç™»å½•ç¤ºä¾‹</a></li></ol></li><li><a href=#ä¸»åŠ¨æŸ¥è¯¢å¤±æ•ˆ>ä¸»åŠ¨æŸ¥è¯¢å¤±æ•ˆ</a></li><li><a href=#æ›´æ–°ç¼“å­˜æ•°æ®>æ›´æ–°ç¼“å­˜æ•°æ®</a></li><li><a href=#ä¹è§‚æ›´æ–°>ä¹è§‚æ›´æ–°</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/react-query%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>React Queryå­¦ä¹ ç¬”è®°</a></h2><h3 class=article-subtitle>è®°å½• Tanstack React Query å­¦ä¹ ç¬”è®°</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2022/10/21</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>17 minute read</time></div><div class=article-category><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-category" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4h6v6H4z"/><path d="M14 4h6v6h-6z"/><path d="M4 14h6v6H4z"/><path d="M17 17m-3 0a3 3 0 106 0 3 3 0 10-6 0"/></svg>Categories:<div class=article-category-group><a href=/categories/react/>React</a>
<a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>å­¦ä¹ ç¬”è®°</a></div></div></footer></div></header><section class=article-content><p>ç»ˆäºäºŒåˆ·äº† Codevolution å¤§ä½¬çš„è¿™ä¸ªç³»åˆ—ï¼Œæ„Ÿè§‰æ¯”ç¬¬ä¸€æ¬¡ç¡®å®æ˜¯æœ‰äº†æ›´å¤šçš„ç†è§£ã€‚é…åˆä¹‹å‰çš„<code>foromik</code>ä½¿ç”¨æ æ æ»´~</p><p>æ•™ç¨‹åœ°å€ï¼š<a class=link href="https://www.youtube.com/playlist?list=PLC3y8-rFHvwjTELCrPrcZlo6blLBUspd2" target=_blank rel=noopener>React Query Tutorial for Beginners</a></p><p>ReactQuery å®˜æ–¹åœ°å€ï¼š<a class=link href=https://tanstack.com/ target=_blank rel=noopener>ReactQuery</a></p><p>éƒ¨åˆ†ä¸­æ–‡æ–‡æ¡£åœ°å€ï¼š<a class=link href=https://cangsdarm.github.io/react-query-web-i18n/ target=_blank rel=noopener>Tanstact Query ä¸­æ–‡æ–‡æ¡£</a></p><p><strong>React Query æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>æ˜¯ç”¨äºåœ¨ React åº”ç”¨ä¸­è·å–æ•°æ®çš„åº“(library)</p><p>â€</p><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ React Queryï¼Ÿ</strong></p><ol><li><p>ç”±äº React æ˜¯ä¸€ä¸ª UI åº“ï¼Œæ²¡æœ‰ç‰¹å®šçš„æ•°æ®è·å–æ¨¡å¼ã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨<code>useEffect</code>è¿™ä¸ªé’©å­å‡½æ•°è·å–æ•°æ®ï¼Œä½¿ç”¨<code>useState</code>æ¥ç»´æŠ¤ç»„ä»¶çŠ¶æ€ï¼Œå¦‚æ•°æ®çš„åŠ è½½ï¼ˆloadingï¼‰ã€é”™è¯¯ï¼ˆerrorï¼‰ã€ç»“æœæ•°æ®ï¼ˆdataï¼‰ç­‰ç­‰ã€‚</p></li><li><p>å¦‚æœæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½éœ€è¦æ•°æ®çŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çŠ¶æ€åº“ç®¡ç†æ¯”å¦‚<code>Redux</code>ã€<code>Mobx</code>ã€‚</p></li><li><p>ä½†å¤§å¤šæ•°çŠ¶æ€ç®¡ç†åº“éƒ½é€‚ç”¨äºå¤„ç†å®¢æˆ·ç«¯çŠ¶æ€ï¼Œæ¯”å¦‚ä¸»é¢˜çš„å¼€å…³ç­‰ã€‚</p></li><li><p>çŠ¶æ€åº“ä¸é€‚åˆå¤„ç†å¼‚æ­¥æˆ–æœåŠ¡å™¨çŠ¶æ€ï¼Œæ¯”å¦‚ Redux ä¸­çš„å¼‚æ­¥å¤„ç†éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹çš„<code>thunk</code>å’Œ<code>saga</code>æ‰èƒ½å¤„ç†å¼‚æ­¥çš„çŠ¶æ€ã€‚</p></li></ol><p>è€Œä½¿ç”¨ ReactQuery å¯ä»¥æ›´å¥½çš„ç®¡ç†å¼‚æ­¥æ•°æ®åŠ è½½çš„çŠ¶æ€ã€é”™è¯¯ã€ç»“æœæ•°æ®ç­‰ã€‚ç±»ä¼¼çš„ Redux ä¸ºäº†æ›´å¥½çš„å¤„ç†å¼‚æ­¥æ•°æ®è¯·æ±‚ï¼Œåœ¨é™¤äº†ç®€åŒ–æ¨¡æ¿ä»£ç çš„ ReduxToolkit åï¼Œåˆæ•´äº†ä¸ª RTK Queryï¼Œå°±æ˜¯æ¥å¯¹æ ‡ ReactQuery çš„ã€‚ä½†è¿˜æ˜¯å¾ˆå¤šä¸å¦‚ ReactQueryã€‚</p><p>â€</p><p>ä»¥ä¸‹ä¸ºå‡ ä¸ªè¯·æ±‚çŠ¶æ€åº“çš„å¯¹æ¯”ã€‚</p><p><a class=link href=https://cangsdarm.github.io/react-query-web-i18n/getstarted/comparison target=_blank rel=noopener>æ¯”è¾ƒ | React Query vs SWR vs Apollo vs RTK Query vs React Router</a></p><p>â€</p><h3 id=å®‰è£…é…ç½®>å®‰è£…&é…ç½®</h3><p>ReactQuery çš„ v4 ä»¥ä¸Šç‰ˆæœ¬å’Œä¹‹å‰çš„ç‰ˆæœ¬å®‰è£…æœ‰äº›ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬éƒ½æŒ‰ v4 ç‰ˆæœ¬çš„æ¥ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>pnpm</span> <span class=nx>add</span> <span class=err>@</span><span class=nx>tanstack</span><span class=o>/</span><span class=nx>react</span><span class=o>-</span><span class=nx>query</span>
</span></span></code></pre></td></tr></table></div></div><p>å®‰è£…å®Œæˆåæˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œé…ç½®ï¼Œé€šè¿‡ QueryClientProvider å°†æŸ¥è¯¢åˆ°çš„çŠ¶æ€é€šè¿‡ Provider ä¼ é€’ç»™å…¶ä»–é¡µé¢ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// app.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BrowserRouter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QueryClientProvider</span><span class=p>,</span> <span class=nx>QueryClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>RootRoute</span> <span class=nx>from</span> <span class=s1>&#39;@/router&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>RootStyle</span> <span class=nx>from</span> <span class=s1>&#39;@/styles/base.style&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Layout</span> <span class=nx>from</span> <span class=s1>&#39;@/components/Layout&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>App</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>QueryClientProvider</span> <span class=nx>client</span><span class=o>=</span><span class=p>{</span><span class=nx>queryClient</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>BrowserRouter</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>RootStyle</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>Layout</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>RootRoute</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/Layout&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/BrowserRouter&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/QueryClientProvider&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span>
</span></span></code></pre></td></tr></table></div></div><p><code>const queryClient = new QueryClient()</code>è¿™é‡Œå¯ä»¥è®¾ç½® ReactQuery çš„ä¸€äº›é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬ç¨åä¼šæåˆ°ã€‚</p><p>â€</p><h3 id=è·å–æ•°æ®>è·å–æ•°æ®</h3><p>é…ç½®å®Œæˆå°±å¯ä»¥ä½¿ç”¨ ReactQuery äº†ã€‚æˆ‘ä»¬å…ˆå¯¹æ¯”ä¸‹ä¹‹å‰å¦‚ä½•è·å–æ•°æ®ã€‚</p><h4 id=ä¹‹å‰çš„åšæ³•>ä¹‹å‰çš„åšæ³•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/SuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span> <span class=nx>setIsLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>data</span><span class=p>,</span> <span class=nx>setData</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>setData</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>SuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>SuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h4 id=ä½¿ç”¨-reactquery-çš„åšæ³•>ä½¿ç”¨ ReactQuery çš„åšæ³•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetcher</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p>è‚‰çœ¼å¯è§çš„ä»£ç å‡å°‘äº†ï¼Œå¤æ‚åº¦ä¹Ÿä½äº†ï¼ŒReactQuery é€šè¿‡ fetcher è¿™ä¸ªè¯·æ±‚å‡½æ•°å°±ç›´æ¥è¿”å›äº†æ•°æ®å’ŒåŠ è½½çŠ¶æ€ï¼Œä½†æ˜¯ä»–ç»™çš„è¿œè¿œä¸æ­¢è¿™äº›ã€‚æˆ‘ä»¬åé¢ä¼šæœ‰æ›´å¤šäº†è§£ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„<code>useQuery</code>åé¢çš„æ‹¬å·ä¸­æœ€å°‘éœ€è¦ä¸¤ä¸ªå‚æ•°</p><ol><li><p>ç¬¬ä¸€ä¸ªæ˜¯æŸ¥è¯¢é”®ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä»¥å‰çš„ç‰ˆæœ¬åªéœ€è¦ä¸€ä¸ªå¯ä»¥åºåˆ—åŒ–çš„å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œä½† v4 ç‰ˆæœ¬åå¿…é¡»æ”¾åˆ°æ•°ç»„ä¸­ã€‚</p></li><li><p>ç¬¬äºŒä¸ªæ˜¯è¯·æ±‚å‡½æ•°ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é…ç½®åˆ°è¿™ä¸ª<code>useQuery</code>çš„æ–¹æ³•å¤–é¢ç»Ÿä¸€ç®¡ç†ã€‚</p></li></ol><p><code>useQuery</code>å¯ä»¥è¿”å›ç»™æˆ‘ä»¬è·å–æ•°æ®çš„ä¸­é—´åŠ è½½çŠ¶æ€<code>isLoading</code>å’ŒåŠ è½½ä¹‹åçš„æ•°æ®<code>data</code></p><p>â€</p><h3 id=è·å–è¯·æ±‚æ—¶çš„é”™è¯¯>è·å–è¯·æ±‚æ—¶çš„é”™è¯¯</h3><p>å°†è¯·æ±‚åœ°å€å†™é”™ï¼Œè¾¾åˆ°å‡ºé”™çš„æ•ˆæœã€‚</p><p>â€</p><h4 id=ä¹‹å‰çš„åšæ³•-1>ä¹‹å‰çš„åšæ³•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/SuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span> <span class=nx>setIsLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>error</span><span class=p>,</span> <span class=nx>setError</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>data</span><span class=p>,</span> <span class=nx>setData</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>setData</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>setError</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span><span class=err>ï¼š</span> <span class=p>{</span><span class=nx>error</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>SuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>SuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h4 id=reactquery-çš„åšæ³•>ReactQuery çš„åšæ³•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetcher</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p><code>isError</code>æ˜¯è·å–æ•°æ®å‡ºé”™çš„çŠ¶æ€ï¼Œ<code>error</code>å¯ä»¥è·å–å‡ºé”™åè¿”å›åœ°çš„é”™è¯¯æ¶ˆæ¯<code>message</code></p><p>å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼ŒReactQuery é»˜è®¤è¿˜æ˜¯ä¼šå»è¯·æ±‚ä¸‰æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯é”™è¯¯æ‰ä¼šè¿”å›é”™è¯¯æ¶ˆæ¯ã€‚</p><p>â€</p><h3 id=å¼€å‘å·¥å…·-devtools>å¼€å‘å·¥å…· DevTools</h3><p>å®‰è£…</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>pnpm</span> <span class=nx>add</span> <span class=err>@</span><span class=nx>tanstack</span><span class=o>/</span><span class=nx>react</span><span class=o>-</span><span class=nx>query</span><span class=o>-</span><span class=nx>devtools</span>
</span></span></code></pre></td></tr></table></div></div><p>é…ç½®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BrowserRouter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QueryClientProvider</span><span class=p>,</span> <span class=nx>QueryClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ReactQueryDevtools</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query-devtools&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>RootRoute</span> <span class=nx>from</span> <span class=s1>&#39;@/router&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>RootStyle</span> <span class=nx>from</span> <span class=s1>&#39;@/styles/base.style&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Layout</span> <span class=nx>from</span> <span class=s1>&#39;@/components/Layout&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>App</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>QueryClientProvider</span> <span class=nx>client</span><span class=o>=</span><span class=p>{</span><span class=nx>queryClient</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>BrowserRouter</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>RootStyle</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>ReactQueryDevtools</span> <span class=nx>initialIsOpen</span><span class=o>=</span><span class=p>{</span><span class=kc>false</span><span class=p>}</span> <span class=nx>position</span><span class=o>=</span><span class=s1>&#39;bottom-right&#39;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>Layout</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>RootRoute</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/Layout&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/BrowserRouter&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/QueryClientProvider&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span>
</span></span></code></pre></td></tr></table></div></div><p>å‚æ•°è¯´æ˜ï¼š</p><p><code>initialIsOpen</code>ï¼šæ˜¯å¦å¼€å¯è°ƒè¯•å·¥å…·ï¼Œé»˜è®¤æ˜¯å¼€å¯ï¼Œä¸ºäº†ä¸å½±å“æˆ‘ä»¬è¿™é‡Œè®¾ç½®å…³é—­ã€‚</p><p><code>position</code>ï¼šè°ƒè¯•å·¥å…·çš„æ˜¾ç¤ºä½ç½®ï¼Œé»˜è®¤ä¸ºå·¦ä¸‹ï¼Œè®¾ç½®åˆ°å³ä¸‹ï¼Œæ‰æ˜¯æˆ‘ä»¬æ¯”è¾ƒä¹ æƒ¯çš„åœ°æ–¹ã€‚</p><p>â€</p><p>ç‚¹å‡»å³ä¸‹è§’çš„å›¾æ ‡å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¼€å‘å·¥å…·çš„æ ·å­äº†ã€‚</p><p>å·¦ä¾§çš„<code>rqsuperhero</code>å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>ReactQuery</code>çš„æŸ¥è¯¢é”®ã€‚ç‚¹å‡»å¯ä»¥çœ‹åˆ°å³ä¾§ç›¸å…³çš„ä¸€äº›æ•°æ®æƒ…å†µã€‚</p><p>æœ€ä¸Šé¢æœ‰ä¸€æ’æŒ‰é’®ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>æ–°é²œçš„fresh</code>ã€<code>æ­£åœ¨è·å–çš„fetching</code>ã€<code>æš‚åœçš„paused</code>ã€<code>é™ˆæ—§çš„stale</code>ã€<code>é—²ç½®çš„inactive</code>ã€‚è¿™å‡ ä¸ªçŠ¶æ€å°±æ˜¯<code>ReactQuery</code>å¯¹æ•°æ®è¯·æ±‚å’Œå“åº”çš„çŠ¶æ€å¤„ç†ï¼Œåé¢åœ¨<code>ReactQuery</code>é…ç½®ä¸­ä¼šæåˆ°è¿™äº›ã€‚</p><p><img src=https://p.sda1.dev/7/19ce14f1c4cc4ca7c11351055b26ffab/image.png loading=lazy>â€‹</p><p><code>ReactQuery DevTools</code>ç”¨çš„ä¸å¤šï¼Œä»…åšä»‹ç»ã€‚</p><p>â€</p><h3 id=ç¼“å­˜>ç¼“å­˜</h3><p>ReactQuery é»˜è®¤ç¼“å­˜æ—¶é—´ä¸º 5 åˆ†é’Ÿã€‚å½“ ReactQuery é¦–æ¬¡è·å–åˆ°æ•°æ®åå°±ä¼šé€šè¿‡æŸ¥è¯¢é”®å¯¹æ•°æ®è¿›è¡Œç¼“å­˜ã€‚</p><ol><li><p>å½“æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReactQuery æ¯æ¬¡è·å–æ•°æ®ä¼šä¸ç¼“å­˜ä¸­çš„æ•°æ®å¯¹æ¯”ï¼Œå¦‚æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä»ç¼“å­˜ä¸­è¿”å›æ•°æ®ã€‚</p></li><li><p>å¦‚æœå‘ç”Ÿå˜åŒ–åˆ™ä¼šåœ¨åå°å¯¹å˜åŒ–çš„æ•°æ®ç¼“å­˜è¿›è¡Œæ›´æ–°ã€‚æ‰€ä»¥å·²ç»æ›´æ–°çš„æ•°æ®ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºå¯¹åº”çš„åŠ è½½çŠ¶æ€ã€‚</p></li><li><p>å½“æ•°æ®ç¼“å­˜æ—¶é—´è¿‡åï¼Œå†æ¬¡æŸ¥è¯¢æ•°æ®æ—¶åˆ™ä¼šå‘ç”Ÿæ•°æ®è¯·æ±‚ï¼Œè€Œä¸ä¼šåœ¨ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ useQuery ä¸­é…ç½®è¯¥æ¬¡è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ã€‚</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>cacheTime</span><span class=o>:</span> <span class=mi>5000</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>æŸ¥è¯¢ç¼“å­˜çš„å¥½å¤„å°±æ˜¯å‡å°‘å¯¹ä¸ä¸€å®šç»å¸¸æ›´æ–°çš„æ•°æ®çš„ç½‘ç»œè¯·æ±‚æ•°é‡ã€‚</li></ol><p>â€</p><h3 id=é™ˆæ—§æ—¶é—´>é™ˆæ—§æ—¶é—´</h3><p>å¦‚æœç”¨æˆ·å¯¹çœ‹åˆ°è¿‡æ—¶çš„æ•°æ®ä¹Ÿæ²¡å½±å“ï¼Œä½¿ç”¨ç¼“å­˜æ˜¾ç¤ºæŸ¥è¯¢ç»“æœï¼Œè€Œä¸éœ€è¦åœ¨åå°é‡æ–°è·å–æ•°æ®ã€‚ä½†æ˜¯å¯¹æ›´æ–°é¢‘ç¹çš„æ•°æ®ï¼Œæˆ‘éœ€è¦å®æ—¶è·å–å˜åŒ–æƒ…å†µï¼Œç¼“å­˜åˆ™ä¼šå½±å“æˆ‘ä»¬ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®é™ˆæ—§æ—¶é—´ï¼Œè®©æ•°æ®å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæ–°é²œï¼Œä½†è¿‡æœŸåï¼Œæ•°æ®å°±å˜æˆé™ˆæ—§çš„æ•°æ®ï¼Œéœ€è¦é‡æ–°å‘èµ·è¯·æ±‚è·å–ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>staleTime</span><span class=o>:</span> <span class=mi>30000</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®<code>staleTime</code>é™ˆæ—§æ—¶é—´ï¼Œ30 ç§’åæ•°æ®å°±ä¼šå˜ä¸ºé™ˆæ—§æ•°æ®ï¼Œå¦‚æœå†æŸ¥çœ‹æ•°æ®æˆ–è€…æœ‰<code>ReactQuery</code>çš„æ›´æ–°äº‹ä»¶è§¦å‘ï¼Œåˆ™ä¼šå‘èµ·è¯·æ±‚æ›´æ–°ç¼“å­˜ã€‚<code>ReactQuery</code>â€‹ æœ‰å¾ˆå¤šäº‹ä»¶æ¥è§¦å‘æ›´æ–°ï¼Œæ¯”å¦‚æµè§ˆå™¨é¡µé¢å¤±å»ç„¦ç‚¹åå†æ¬¡è·å–åˆ°ç„¦ç‚¹ï¼Œä¼šè§¦å‘æ›´æ–°ç­‰ç­‰ï¼Œåé¢ä¼šä»‹ç»åˆ°ã€‚</p></li><li><p>å¦‚æœæˆ‘ä»¬è®¾ç½®<code>staleTime: 0</code>åˆ™ä¼šæ¯æ¬¡æŸ¥çœ‹æ•°æ®æˆ–è§¦å‘æ›´æ–°äº‹ä»¶æ—¶æ•°æ®å°±ä¼šæ›´æ–°ã€‚</p></li></ol><p>â€</p><h3 id=è·å–æ•°æ®-1>è·å–æ•°æ®</h3><p>ReactQuery ç»™äº†å‡ ä¸ªè§¦å‘è·å–æ•°æ®çš„é…ç½®ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ã€‚</p><p>å½“æŒ‚è½½æ—¶è·å–æ•°æ®ï¼Œ<code>refetchOnMount</code>ï¼š</p><ol><li><p>è®¾ç½®ä¸º trueï¼Œå¦‚æœæ•°æ®è¿‡æ—¶ï¼Œåˆ™åœ¨åŠ è½½ç»„ä»¶æ—¶ è·å–æ•°æ®ã€‚true æ˜¯é»˜è®¤å€¼ã€‚</p></li><li><p>è®¾ç½®ä¸º falseï¼Œå°†ç¦ç”¨ç»„ä»¶åŠ è½½è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸º alwaysï¼Œåˆ™å°†å§‹ç»ˆåœ¨åŠ è½½ç»„ä»¶æ—¶è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸ºå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°æ‰§è¡Œçš„è·å–ç»“æœå¾—åˆ°ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºè®¾ç½®çš„å€¼<code>(query) => boolean</code>ã€‚</p></li></ol><p>å½“æµè§ˆå™¨çª—å£è·å–åˆ°ç„¦ç‚¹æ—¶è·å–æ•°æ®ï¼Œ<code>refetchOnWindowFocus</code>ï¼š</p><ol><li><p>è®¾ç½®ä¸º trueï¼Œå¦‚æœæ•°æ®è¿‡æ—¶ï¼Œåˆ™åœ¨æµè§ˆå™¨çª—å£è·å–åˆ°ç„¦ç‚¹æ—¶è·å–æ•°æ®ï¼Œtrue æ˜¯é»˜è®¤å€¼ã€‚</p></li><li><p>è®¾ç½®ä¸º falseï¼Œåˆ™åœ¨æµè§ˆå™¨çª—å£è·å–åˆ°ç„¦ç‚¹æ—¶ï¼Œä¸ä¼šè·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸º alwaysï¼Œåˆ™å§‹ç»ˆåœ¨æµè§ˆå™¨çª—å£è·å–åˆ°ç„¦ç‚¹æ—¶è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸ºå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°æ‰§è¡Œçš„è·å–ç»“æœå¾—åˆ°ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºè®¾ç½®çš„å€¼<code>(query) => boolean</code>ã€‚</p></li></ol><p>åœ¨æ—¶é—´é—´éš”å†…è¿ç»­è·å–æ•°æ®ï¼Œ<code>refetchInterval</code>ï¼š</p><ol><li><p>è®¾ç½®ä¸ºæ•°å­—ï¼Œåˆ™ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œåœ¨è¯¥æ—¶é—´èŒƒå›´å†…è¿ç»­è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸ºå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°çš„æ‰§è¡Œç»“æœå¾—åˆ°ä¸€ä¸ªæ•°å€¼ä½œä¸ºè·å–æ•°æ®çš„æ—¶é—´èŒƒå›´<code>(data, query) => number | false</code>ã€‚</p></li><li><p>é»˜è®¤å€¼ä¸º false</p></li></ol><p>åœ¨åå°è¿ç»­è·å–æ•°æ®çš„æ—¶é—´é—´éš”ï¼Œ<code>refetchIntervalInBackground</code>ï¼š</p><ol><li><p>è®¾ç½®ä¸º trueï¼Œåˆ™åœ¨æµè§ˆå™¨æ ‡ç­¾é¡µæˆ–çª—å£å¤„äºåå°æ—¶è·å–æ•°æ®ã€‚</p></li><li><p>é»˜è®¤å€¼ä¸º false</p></li></ol><p>å½“é‡æ–°è¿æ¥æ—¶è·å–æ•°æ®ï¼Œ<code>refetchOnReconnect</code>ï¼š</p><ol><li><p>è®¾ç½®ä¸º trueï¼Œå¦‚æœæ•°æ®è¿‡æ—¶ï¼Œåˆ™åœ¨é‡æ–°è¿æ¥æ—¶è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸º falseï¼Œåˆ™ä¸ä¼šåœ¨é‡æ–°è¿æ¥æ—¶è·å–æ•°æ®ã€‚</p></li><li><p>è®¾ç½®ä¸ºå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°æ‰§è¡Œçš„è·å–ç»“æœå¾—åˆ°ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºè®¾ç½®çš„å€¼<code>(query) => boolean</code>ã€‚</p></li><li><p>é»˜è®¤å€¼ä¸º networkOnlineï¼ˆtrue)</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>staleTime</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>refetchOnMount</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>refetchOnWindowFocus</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>refetchInterval</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>refetchIntervalInBackground</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>refetchOnReconnect</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=é€šè¿‡äº‹ä»¶çš„æ–¹å¼è·å–æ•°æ®>é€šè¿‡äº‹ä»¶çš„æ–¹å¼è·å–æ•°æ®</h3><ol><li><p>é¦–å…ˆéœ€è¦å°†é€šè¿‡æŒ‚è½½ç»„ä»¶ã€æµè§ˆå™¨è·å–ç„¦ç‚¹ç­‰å°±è·å–æ•°æ®çš„æ–¹å¼ç¦ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®<code>enabled: false</code>å°†ç¦æ­¢æŸ¥è¯¢è¡Œä¸ºè‡ªåŠ¨è¿è¡Œã€‚</p></li><li><p>ç„¶åé€šè¿‡ä»<code>useQuery</code>ä¸­è§£æå‡ºæ¥çš„<code>refetch</code>æ–¹æ³•è·å–æ•°æ®ã€‚</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span><span class=p>,</span> <span class=nx>refetch</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=p>[</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=nx>fetcher</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>enabled</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span> <span class=o>||</span> <span class=nx>isFetching</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>refetch</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>Fetch</span> <span class=nx>Super</span> <span class=nx>Hero</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>))}</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒå‡½æ•°>æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒå‡½æ•°</h3><p>ReactQuery çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­å¯ä»¥é…ç½®å½“è·å–æ•°æ®æˆåŠŸæˆ–å¤±è´¥æ—¶çš„å›è°ƒå‡½æ•°ã€‚æœ‰äº›æ•°æ®åœ¨è·å–æˆåŠŸåæˆ‘ä»¬éœ€è¦å­˜åˆ° store ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span><span class=p>,</span> <span class=nx>refetch</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=p>[</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=nx>fetcher</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>onSuccess</span><span class=o>:</span> <span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;è·å–æ•°æ®æˆåŠŸ&#39;</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>onError</span><span class=o>:</span> <span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;è·å–æ•°æ®å¤±è´¥&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=è½¬æ¢æˆ–ç­›é€‰æŸ¥è¯¢æ•°æ®>è½¬æ¢æˆ–ç­›é€‰æŸ¥è¯¢æ•°æ®</h3><p>å¯ä»¥ä½¿ç”¨<code>select</code>æ–¹æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œè¿”å›æˆ‘ä»¬éœ€è¦è¿”å›çš„ç»“æœã€‚</p><p>æ¯”å¦‚ï¼šåœ¨ç¤ºä¾‹ä¸­åŠ å…¥äº†å¥³æ€§è¶…çº§è‹±é›„ã€‚æˆ‘ä»¬å¯ä»¥ç­›é€‰è¶…çº§è‹±é›„çš„æ€§åˆ«ï¼Œå°†å¥³è¶…çº§è‹±é›„æŸ¥è¯¢å‡ºæ¥ã€‚ç„¶ååªè¿”å›å¥³è¶…çº§è‹±é›„çš„åå­—ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span><span class=p>,</span> <span class=nx>refetch</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=p>[</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=nx>fetcher</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>select</span><span class=o>:</span> <span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kr>const</span> <span class=nx>femaleHero</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=nx>hero</span><span class=p>.</span><span class=nx>gender</span> <span class=o>===</span> <span class=s1>&#39;female&#39;</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>femaleHero</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>hero</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>hero</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>))}</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=é€šè¿‡å‚æ•°æŸ¥è¯¢>é€šè¿‡å‚æ•°æŸ¥è¯¢</h3><p>æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯æŸ¥çœ‹è¯¦æƒ…äº†ã€‚</p><p>è·¯ç”±åŠ ä¸Šè¯¦æƒ…çš„é…ç½®ï¼Œé€šè¿‡<code>heroId</code>æ¥æŸ¥è¯¢</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/router/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>routes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>element</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>Navigate</span> <span class=nx>to</span><span class=o>=</span><span class=s1>&#39;/home&#39;</span> <span class=o>/&gt;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/home&#39;</span><span class=p>,</span> <span class=nx>element</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>Home</span> <span class=o>/&gt;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/sh&#39;</span><span class=p>,</span> <span class=nx>element</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>SuperHero</span> <span class=o>/&gt;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/rqsh&#39;</span><span class=p>,</span> <span class=nx>element</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>RQSuperHero</span> <span class=o>/&gt;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span> <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/rqsh/:heroId&#39;</span><span class=p>,</span> <span class=nx>element</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>RQSuperHeroPersonal</span> <span class=o>/&gt;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨åˆ—è¡¨é¡µåŠ ä¸Šé“¾æ¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Link</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetcher</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isFetching</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetcher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span> <span class=o>||</span> <span class=nx>isFetching</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>Link</span> <span class=nx>to</span><span class=o>=</span><span class=p>{</span><span class=sb>`/rqsh/</span><span class=si>${</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/Link&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨<code>pages</code>ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ª<code>RQSuperHeroPersonal</code>æ–‡ä»¶ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHeroPersonal/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useParams</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQSuperHeroPersonal</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>heroId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useParams</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetcher</span> <span class=o>=</span> <span class=nx>heroId</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=sb>`http://localhost:4000/superheros/</span><span class=si>${</span><span class=nx>heroId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;rqsuperheropersonal&#39;</span><span class=p>,</span> <span class=nx>heroId</span><span class=p>],</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nx>fetcher</span><span class=p>(</span><span class=nx>heroId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>id</span><span class=p>}.</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>gender</span><span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQSuperHeroPersonal</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨å‚æ•°æŸ¥è¯¢æ—¶éœ€è¦æ³¨æ„ï¼Œéœ€è¦å°†å‚æ•°<strong>æ”¾å…¥æŸ¥è¯¢é”®çš„æ•°ç»„ä¸­</strong>ã€‚å¹¶ä¸”ï¼ŒæŸ¥è¯¢å‡½æ•°éœ€è¦å†™æˆ<strong>ç®­å¤´å‡½æ•°å½¢å¼ç”¨äºä¼ é€’å‚æ•°</strong>ã€‚</p><p>â€</p><h3 id=å¹¶è¡ŒæŸ¥è¯¢>å¹¶è¡ŒæŸ¥è¯¢</h3><p>å¦‚æœé¡µé¢ä¸Šæœ‰å¤šç»„æ•°æ®éœ€è¦å¹¶è¡ŒåŒæ—¶æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨<code>useQueries</code>æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>æˆ‘ä»¬åœ¨ç¤ºä¾‹çš„<code>db.json</code>ä¸­åŠ å…¥<code>DC Super Hero</code>ã€‚è¿™æ ·å°±æœ‰ä¸¤ç»„è¶…çº§è‹±é›„éœ€è¦ä¸€èµ·æ¥æŸ¥è¯¢ã€‚</p><p>æ–°å»ºä¸€ä¸ª<code>RQSuperHeroLeague</code>çš„é¡µé¢ã€‚é…ç½®å¥½è·¯ç”±ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHeroLeague/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Link</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQueries</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SuperHeroLeague</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetchMarvalHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/superheros&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetchDcHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/dcsuperheros&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=nx>useQueries</span><span class=p>({</span>
</span></span><span class=line><span class=cl>		<span class=nx>queries</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span> <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;marvalsuperhero&#39;</span><span class=p>],</span> <span class=nx>queryFn</span><span class=o>:</span> <span class=nx>fetchMarvalHero</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span> <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;dcsuperhero&#39;</span><span class=p>],</span> <span class=nx>queryFn</span><span class=o>:</span> <span class=nx>fetchDcHero</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>Super</span> <span class=nx>Hero</span> <span class=nx>League</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>results</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>league</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>ul</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>index</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>{</span><span class=nx>league</span><span class=p>.</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>								<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}.</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>))}</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>))}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>SuperHeroLeague</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ç§å¹¶è¡ŒæŸ¥è¯¢ï¼Œä¼šæŠŠæŸ¥è¯¢çš„ç»“æœæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œåœ¨è·å–æ•°æ®æ—¶ä¼šåŒæ—¶å‘èµ·æŸ¥è¯¢ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå°†ä¸¤ç»„æŸ¥è¯¢ç»“æœä½œä¸ºä¸¤ä¸ªå¯¹è±¡æ”¾åˆ°æ•°ç»„ä¸­ï¼Œ<code>useQuery</code>çš„è¿”å›ç»“æœå’Œå›è°ƒæ–¹æ³•ä¹Ÿåˆ†åˆ«æ”¾åˆ°å¯¹è±¡ä¸­äº†ã€‚</p><p>è¿™ç§å¹¶è¡Œçš„æ“ä½œï¼Œæœ‰ç‚¹ä¸å¥½å–å‡º<code>isLoading</code>ç­‰æ•°æ®çŠ¶æ€ã€‚</p><p>â€</p><h3 id=ä»å±æŸ¥è¯¢>ä»å±æŸ¥è¯¢</h3><p>åœ¨ API æŸ¥è¯¢ä¸­ï¼Œç»å¸¸ä¼šæœ‰é€šè¿‡ä¸€ä¸ªå…³è” ID æŸ¥è¯¢ç›¸å…³çš„å†…å®¹ã€‚æ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªå­¦ç”Ÿçš„é‚®ç®±ï¼ŒæŸ¥è¯¢å­¦ç”Ÿå­¦ä¹ çš„è¯¾ç¨‹ï¼Œæˆ‘ä»¬å°†ä»¥æ­¤ä¸ºç¤ºä¾‹ã€‚</p><p>å…ˆæ·»åŠ ç”¨æˆ·ä¿¡æ¯å’Œå…³è”è¯¾ç¨‹ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>db.json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;p1@example.com&#34;</span><span class=p>,</span> <span class=nt>&#34;channelId&#34;</span><span class=p>:</span> <span class=s2>&#34;c1&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;p2@example.com&#34;</span><span class=p>,</span> <span class=nt>&#34;channelId&#34;</span><span class=p>:</span> <span class=s2>&#34;c2&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;p3@example.com&#34;</span><span class=p>,</span> <span class=nt>&#34;channelId&#34;</span><span class=p>:</span> <span class=s2>&#34;c3&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;channels&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;c1&#34;</span><span class=p>,</span> <span class=nt>&#34;courses&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Html&#34;</span><span class=p>,</span> <span class=s2>&#34;Css&#34;</span><span class=p>,</span> <span class=s2>&#34;Javascript&#34;</span><span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;c2&#34;</span><span class=p>,</span> <span class=nt>&#34;courses&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Node&#34;</span><span class=p>,</span> <span class=s2>&#34;Expess&#34;</span><span class=p>,</span> <span class=s2>&#34;Koa&#34;</span><span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;c3&#34;</span><span class=p>,</span> <span class=nt>&#34;courses&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;React&#34;</span><span class=p>,</span> <span class=s2>&#34;Vue&#34;</span><span class=p>,</span> <span class=s2>&#34;Angular&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><p>ç„¶åæ·»åŠ å¯¹åº”çš„è·¯ç”±ï¼Œæ·»åŠ é¡µé¢<code>Users</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/Users/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>getUserEmail</span> <span class=o>=</span> <span class=nx>email</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=sb>`http://localhost:4000/users/</span><span class=si>${</span><span class=nx>email</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>getCourses</span> <span class=o>=</span> <span class=nx>channelId</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=sb>`http://localhost:4000/channels/</span><span class=si>${</span><span class=nx>channelId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Users</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>email</span><span class=p>,</span> <span class=nx>setEmail</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;p1@example.com&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>user</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=nx>email</span><span class=p>],</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>getUserEmail</span><span class=p>(</span><span class=nx>email</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>channelId</span> <span class=o>=</span> <span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>channelId</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>courses</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;courses&#39;</span><span class=p>,</span> <span class=nx>channelId</span><span class=p>],</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>getCourses</span><span class=p>(</span><span class=nx>channelId</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>enabled</span><span class=o>:</span> <span class=o>!!</span><span class=nx>channelId</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nx>User</span><span class=o>:</span><span class=p>{</span><span class=s1>&#39; &#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>select</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>email</span><span class=p>}</span> <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>setEmail</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=s1>&#39;p1@example.com&#39;</span><span class=o>&gt;</span><span class=nx>p1</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=s1>&#39;p2@example.com&#39;</span><span class=o>&gt;</span><span class=nx>p2</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>option</span> <span class=nx>value</span><span class=o>=</span><span class=s1>&#39;p3@example.com&#39;</span><span class=o>&gt;</span><span class=nx>p3</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/select&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nx>Courses</span><span class=o>:</span><span class=p>{</span><span class=s1>&#39; &#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>courses</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>courses</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>course</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>span</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>index</span><span class=p>}</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>marginRight</span><span class=o>:</span> <span class=s1>&#39;10px&#39;</span> <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>{</span><span class=nx>course</span><span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/span&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>))}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>Users</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>å…ˆå°†ç”¨æˆ·çš„<code>email</code>ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚æ‰€ä»¥å°†å‡ ä¸ªç”¨æˆ·ä¿¡æ¯åšäº†ä¸€ä¸ªå—æ§çš„<code>select</code>â€‹ ä¸‹æ‹‰æ¡†ã€‚å¯ä»¥é€‰æ‹©ç”¨æˆ·ï¼Œé€šè¿‡ç”¨æˆ·åŒ¹é…å¯¹åº”çš„<code>email</code>ã€‚</p></li><li><p>é€šè¿‡å°†<code>email</code>â€‹ çš„å€¼ï¼Œä¼ å…¥åˆ°ç¬¬ä¸€ä¸ªæŸ¥è¯¢çš„<code>useQuery</code>ä¸­ï¼ŒæŠŠå‚æ•°ä¼ å…¥<code>getUserEmail</code>ï¼Œè·å–åˆ°å¯¹åº”å¯¹å­¦ç”Ÿ<code>channelId</code>ã€‚</p></li><li><p>ç„¶åå†å°†<code>channelId</code>ä¼ å…¥åˆ°ç¬¬äºŒä¸ªæŸ¥è¯¢<code>useQuery</code>ä¸­ï¼ŒæŠŠå‚æ•°ä¼ å…¥<code>getCourses</code>ï¼Œè·å–åˆ°å­¦ç”Ÿå¯¹åº”çš„è¯¾ç¨‹ä¿¡æ¯ã€‚é€šè¿‡é…ç½®<code>enabled: !!channelId</code>ï¼Œè¾¾åˆ°ä¾èµ–æŸ¥è¯¢ï¼Œåªè¦<code>channelId</code>æœ‰å€¼æ‰ä¼šæ›´æ–°ã€‚</p></li></ol><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡åŒ¹é…<code>user</code>çš„é‚®ç®±æ¥æŸ¥è¯¢å¯¹åº”çš„è¯¾ç¨‹ã€‚éœ€è¦æ³¨æ„<code>map</code>çš„è·¯å¾„å±‚çº§ã€‚</p><p>â€</p><p>â€</p><h3 id=åˆå§‹åŒ–æŸ¥è¯¢æ•°æ®>åˆå§‹åŒ–æŸ¥è¯¢æ•°æ®</h3><p>ä¸»è¦ç”¨äºå½“ç½‘ç»œè¾ƒæ…¢æ—¶ï¼Œé€šè¿‡æŸ¥è¯¢ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¼˜å…ˆå±•ç¤ºç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºé•¿æ—¶é—´çš„ loading æ¥å½±å“æŸ¥è¯¢ä½“éªŒã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQSuperHeroPersonal/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useParams</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span><span class=p>,</span> <span class=nx>QueryClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQSuperHeroPersonal</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>heroId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useParams</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>fetcher</span> <span class=o>=</span> <span class=nx>heroId</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=sb>`http://localhost:4000/superheros/</span><span class=si>${</span><span class=nx>heroId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=s1>&#39;rqsuperheropersonal&#39;</span><span class=p>,</span> <span class=nx>heroId</span><span class=p>],</span>
</span></span><span class=line><span class=cl>		<span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>fetcher</span><span class=p>(</span><span class=nx>heroId</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>initialData</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=kr>const</span> <span class=nx>hero</span> <span class=o>=</span> <span class=nx>queryClient</span>
</span></span><span class=line><span class=cl>					<span class=p>.</span><span class=nx>getQueriesData</span><span class=p>([</span><span class=s1>&#39;rqsuperhero&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>					<span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>hreo</span> <span class=p>=&gt;</span> <span class=nx>hero</span><span class=p>.</span><span class=nx>id</span> <span class=o>===</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>heroId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=p>(</span><span class=nx>hero</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>hero</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=kc>undefined</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>id</span><span class=p>}.</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>gender</span><span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQSuperHeroPersonal</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>éœ€è¦å…ˆå¼•å…¥<code>QueryClient</code>ï¼Œåœ¨å½“å‰<code>useQuery</code>ä¸­é…ç½®<code>initialData</code>ï¼Œè®©å½“å‰é¡µé¢çš„æŸ¥è¯¢å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ QueryClient é…ç½®ã€‚</p></li><li><p>ç„¶åé€šè¿‡åŒ¹é…ç¼“å­˜ä¸­çš„<code>hero</code>çš„<code>id</code>æ˜¯å¦ä¸æŸ¥è¯¢å‚æ•°ä¸­çš„<code>heroId</code>ï¼Œå°†æ•°æ®åŒ¹é…ç»™<code>data</code>â€‹ã€‚</p></li></ol><p>â€</p><h3 id=åˆ†é¡µ>åˆ†é¡µ</h3><p>åˆ†é¡µéœ€è¦é€šè¿‡ ReactQuery ä¼ é€’ä¸¤ä¸ªå‚æ•°ç»™åˆ°è¯·æ±‚å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®çš„<code>pageSize</code>ï¼Œä¸€ä¸ªæ˜¯å½“å‰é¡µç <code>pageNumber</code>ã€‚</p><p><code>json-server</code>â€‹ çš„ä¸¤ä¸ªåˆ†é¡µå‚æ•°æ˜¯<code>_limit</code>å’Œ<code>_page</code>ï¼Œåˆ†åˆ«å¯¹åº”è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>ä½¿ç”¨<code>useState</code>åšè¿™ä¸¤ä¸ªå‚æ•°å¯¹çŠ¶æ€ç®¡ç†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQDCSuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fetchHero</span> <span class=o>=</span> <span class=p>(</span><span class=nx>limit</span><span class=p>,</span> <span class=nx>pageNumber</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nx>axios</span><span class=p>({</span>
</span></span><span class=line><span class=cl>		<span class=nx>url</span><span class=o>:</span> <span class=sb>`http://localhost:4000/dcsuperheros`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>params</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>_limit</span><span class=o>:</span> <span class=nx>limit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>_page</span><span class=o>:</span> <span class=nx>pageNumber</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQDCSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>pagination</span><span class=p>,</span> <span class=nx>setPagination</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>		<span class=nx>pageSize</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>pageNumber</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isFetching</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=s1>&#39;dcheros&#39;</span><span class=p>,</span> <span class=nx>pagination</span><span class=p>.</span><span class=nx>pageSize</span><span class=p>,</span> <span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span><span class=p>],</span>
</span></span><span class=line><span class=cl>		<span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>fetchHero</span><span class=p>(</span><span class=nx>pagination</span><span class=p>.</span><span class=nx>pageSize</span><span class=p>,</span> <span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>keepPreviousData</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>))}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>					<span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setPagination</span><span class=p>({</span> <span class=p>...</span><span class=nx>pagination</span><span class=p>,</span> <span class=nx>pageNumber</span><span class=o>:</span> <span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span> <span class=o>-</span> <span class=mi>1</span> <span class=p>})}</span>
</span></span><span class=line><span class=cl>					<span class=nx>disabled</span><span class=o>=</span><span class=p>{</span><span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span> <span class=o>===</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>isFetching</span> <span class=o>?</span> <span class=s1>&#39;ç¿»é¡µä¸­...&#39;</span> <span class=o>:</span> <span class=s1>&#39;ä¸Šä¸€é¡µ&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>					<span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setPagination</span><span class=p>({</span> <span class=p>...</span><span class=nx>pagination</span><span class=p>,</span> <span class=nx>pageNumber</span><span class=o>:</span> <span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>})}</span>
</span></span><span class=line><span class=cl>					<span class=nx>disabled</span><span class=o>=</span><span class=p>{</span><span class=nx>pagination</span><span class=p>.</span><span class=nx>pageNumber</span> <span class=o>===</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>{</span><span class=nx>isFetching</span> <span class=o>?</span> <span class=s1>&#39;ç¿»é¡µä¸­...&#39;</span> <span class=o>:</span> <span class=s1>&#39;ä¸‹ä¸€é¡µ&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQDCSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ReactQuery</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°é…ç½®<code>keepPreviousData: true</code>ï¼Œå¯ä»¥è®©ä¹‹å‰æµè§ˆçš„é¡µé¢ç¼“å­˜ï¼Œåé€€æ—¶ä¼šé€šè¿‡ç¼“å­˜å±•ç¤ºï¼Œæé«˜æµè§ˆä½“éªŒã€‚</p><p>â€</p><h3 id=æ— é™åˆ†é¡µ>æ— é™åˆ†é¡µ</h3><h4 id=ç‚¹å‡»åŠ è½½>ç‚¹å‡»åŠ è½½</h4><p>è¿™ä¸ªä¼šç”¨åˆ°ä¸€ä¸ªæ–°çš„æ–¹æ³•<code>useInfiniteQuery</code>ï¼Œä½¿ç”¨å’Œ useQuery ç±»ä¼¼ï¼Œä½†æœ‰äº›è®¸ä¸åŒã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQDCInfiniteSuperHero/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useInfiniteQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fetchHero</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>pageParam</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>})</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nx>axios</span><span class=p>({</span>
</span></span><span class=line><span class=cl>		<span class=nx>url</span><span class=o>:</span> <span class=sb>`http://localhost:4000/dcsuperheros`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>params</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>_limit</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>_page</span><span class=o>:</span> <span class=nx>pageParam</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQDCInfiniteSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>fetchNextPage</span><span class=p>,</span> <span class=nx>isFetchingNextPage</span><span class=p>,</span> <span class=nx>hasNextPage</span> <span class=p>}</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>		<span class=nx>useInfiniteQuery</span><span class=p>([</span><span class=s1>&#39;infinitedcsuperhero&#39;</span><span class=p>],</span> <span class=nx>fetchHero</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>getNextPageParam</span><span class=o>:</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>,</span> <span class=nx>pages</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=p>(</span><span class=nx>pages</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=nx>pages</span><span class=p>.</span><span class=nx>length</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=kc>undefined</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>RQSuperHero</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>pages</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>page</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nx>page</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}.</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=p>)}</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span><span class=nx>isFetchingNextPage</span> <span class=o>?</span> <span class=s1>&#39;åŠ è½½ä¸­...&#39;</span> <span class=o>:</span> <span class=kc>null</span><span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>button</span> <span class=nx>disabled</span><span class=o>=</span><span class=p>{</span><span class=o>!</span><span class=nx>hasNextPage</span><span class=p>}</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>fetchNextPage</span><span class=p>()}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nx>åŠ è½½æ›´å¤š</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQDCInfiniteSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸‰ä¸ªå‚æ•°é‡Œçš„<code>getNextPageParam</code>è¿™ä¸ªæ–¹æ³•ã€‚</p><ol><li><p>å½“æ”¶åˆ°æŸ¥è¯¢åˆ°çš„æ–°æ•°æ®æ—¶ï¼Œæ­¤å‡½æ•°å°†æ¥å—æ— é™åˆ†é¡µæ•°æ®åˆ—è¡¨çš„æœ€åä¸€é¡µçš„æ•°æ®<code>lastPage</code>å’Œæ‰€æœ‰é¡µé¢çš„æ•°æ®<code>allPages</code>ã€‚</p></li><li><p>ç„¶åè¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå˜é‡<code>pageParam</code>ï¼Œè¿™ä¸ªå˜é‡ä½œä¸ºæœ€åä¸€é¡µçš„å‚æ•°ä¼ é€’ä¸ªæŸ¥è¯¢å‡½æ•°ã€‚</p></li><li><p>è¿”å›<code>undefined</code>ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä¸‹ä¸€é¡µå¯ç”¨ã€‚</p></li></ol><p>â€</p><p>æ‰€ä»¥å½“<code>getNextPageParam</code>è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­ï¼Œæ˜¯å¦è¾¾åˆ°æœ€åä¸€é¡µäº†ï¼Œæ¥åšé€’å¢è®¡ç®—ã€‚ç„¶åé€šè¿‡è¿”å›å€¼<code>pageParam</code>ï¼Œå°†ç¿»é¡µå˜é‡ä¼ é€’ç»™<code>fetchHero</code>è¿™ä¸ªè¯·æ±‚æ–¹æ³•ï¼Œè¿›è¡Œæ•°æ®ç¿»é¡µï¼ŒåŠ è½½åˆ°<code>allPage</code>ï¼Œè¿”å›ç»™é¡µé¢ã€‚</p><blockquote><p>è¿™é‡Œçš„å‘ï¼šä¸€å®šè¦ç”¨ ReactQuery ç»™çš„è¿™ä¸ª<code>pageParam</code>è¿”å›å‚æ•°ä½œä¸ºç¿»é¡µçš„å‚æ•°å¹¶ä¸”ç»™å®šåˆå§‹å€¼ã€‚</p></blockquote><p>â€</p><p>æ‰€ä»¥æ•´ä¸ªæµç¨‹æ˜¯é€šè¿‡<code>useInfiniteQuery</code>ä¸­è¿”å›çš„<code>fetchNextPage</code>æ–¹æ³•æ¥è§¦å‘ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸­çš„<code>getNextPageParam</code>ï¼Œè¿”å›ä¸€ä¸ª<code>pageParam</code>ç»™åˆ°è¯·æ±‚å‡½æ•°è·å–ä¸‹ä¸€é¡µçš„è¯·æ±‚ã€‚è¿”å›åˆ°<code>pages</code>ä¸­ï¼Œé€šè¿‡è¿”å›çš„<code>data.pages</code>å°±å¯ä»¥è·å–åˆ°æ‰€æœ‰åŠ è½½çš„æ•°æ®ã€‚</p><p>â€</p><p>ä¸Šé¢è¿™ç§åˆ¤æ–­æ–¹æ³•æ¯”è¾ƒå±€é™ï¼Œä¸€èˆ¬æ­£å¼çš„ API ä¼šè¿”å›æ•°æ®æ€»æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¡ç®—å‡ºæœ€åä¸€é¡µæ˜¯å¤šå°‘ã€‚æ‰€ä»¥é€šå¸¸ä¼šé€šè¿‡åˆ¤æ–­<code>lastPage</code>æ˜¯å¦æ˜¯æœ€åä¸€é¡µæ¥åšè¿”å›ã€‚ä»¥ä¸‹ä¸ºå¸¸ç”¨åšæ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>getNextPageParam</span><span class=o>:</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>,</span> <span class=nx>allPages</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>.</span><span class=nx>page</span> <span class=o>&lt;</span> <span class=nx>lastPage</span><span class=p>.</span><span class=nx>total_pages</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>lastPage</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>undefined</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åéœ€è¦æ³¨æ„è¿”å›çš„æ•°æ®ï¼Œæ˜¯æ”¾åˆ°<code>data</code>çš„<code>pages</code>é‡Œï¼Œ<code>pages</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡ŒåŒ…å«æ¯é¡µçš„æ•°æ®ï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥åœ¨<code>pages</code>åš<code>map</code>åï¼Œè¿˜éœ€è¦åœ¨ä¸‹çº§åšä¸ª<code>map</code>è·å–æ¯é¡µçš„æ•°æ®ã€‚è¿™é‡Œç›¸å½“äºä½¿ç”¨äº†<code>reduce</code>åšäº†ä¸€ä¸ªç´¯åŠ ã€‚æœ‰æ–°çš„åˆ†é¡µå°±<code>push</code>åˆ°æ•°ç»„ä¸­ã€‚åé¢æˆ‘ä»¬è¿˜ä¼šä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œæ¥å¢å¼ºè¿™ä¸ªä½“éªŒï¼Œæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨å°±è‡ªåŠ¨åŠ è½½ã€‚</p><p>â€</p><h4 id=æ»šåŠ¨åº•éƒ¨è‡ªåŠ¨åŠ è½½>æ»šåŠ¨åº•éƒ¨è‡ªåŠ¨åŠ è½½</h4><p>è¿™é‡Œä½¿ç”¨äº†<a class=link href=https://swapi.dev/ target=_blank rel=noopener>SWAPI</a>çš„æ•°æ®ï¼Œå¦åˆ™æ²¡æœ‰é‚£ä¹ˆå¤šæ•°æ®åŠ è½½ã€‚</p><p>è‡ªåŠ¨åŠ è½½ä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶ <a class=link href=https://github.com/ankeetmaini/react-infinite-scroll-component target=_blank rel=noopener>react-infinite-scroll-component</a>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/SWInfinitePeople/index.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useInfiniteQuery</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>InfiniteScroll</span> <span class=nx>from</span> <span class=s1>&#39;react-infinite-scroll-component&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fetchPeople</span> <span class=o>=</span> <span class=nx>url</span> <span class=p>=&gt;</span> <span class=nx>axios</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SWInfinitePeople</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>initialUrl</span> <span class=o>=</span> <span class=s1>&#39;https://swapi.dev/api/people/?page=1&#39;</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>fetchNextPage</span><span class=p>,</span> <span class=nx>hasNextPage</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useInfiniteQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=s1>&#39;swip&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>		<span class=p>({</span> <span class=nx>pageParam</span> <span class=o>=</span> <span class=nx>initialUrl</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=nx>fetchPeople</span><span class=p>(</span><span class=nx>pageParam</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>getNextPageParam</span><span class=o>:</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>,</span> <span class=nx>_allPages</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=nx>lastPage</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>next</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=kc>undefined</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>å‡ºé”™äº†</span> <span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>dataLength</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>pages</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>page</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>page</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>results</span><span class=p>.</span><span class=nx>length</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h4</span><span class=o>&gt;</span><span class=nx>The</span> <span class=nx>Star</span> <span class=nx>Wars</span><span class=o>&lt;</span><span class=err>/h4&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>InfiniteScroll</span>
</span></span><span class=line><span class=cl>				<span class=nx>dataLength</span><span class=o>=</span><span class=p>{</span><span class=nx>dataLength</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>next</span><span class=o>=</span><span class=p>{</span><span class=nx>fetchNextPage</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>hasMore</span><span class=o>=</span><span class=p>{</span><span class=nx>hasNextPage</span> <span class=o>||</span> <span class=kc>false</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>loader</span><span class=o>=</span><span class=p>{</span><span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>åŠ è½½ä¸­</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;}</span>
</span></span><span class=line><span class=cl>				<span class=nx>endMessage</span><span class=o>=</span><span class=p>{</span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>åˆ°åº•äº†</span><span class=o>&lt;</span><span class=err>/p&gt;}</span>
</span></span><span class=line><span class=cl>			<span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>pages</span><span class=o>?</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>page</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>					<span class=nx>page</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>results</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>people</span> <span class=p>=&gt;</span> <span class=o>&lt;</span><span class=nx>PeopleCard</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>people</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=p>{...</span><span class=nx>people</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=p>)}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/InfiniteScroll&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PeopleCard</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>mass</span><span class=p>,</span> <span class=nx>skin_color</span><span class=p>,</span> <span class=nx>hair_color</span><span class=p>,</span> <span class=nx>height</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>marginBottom</span><span class=o>:</span> <span class=s1>&#39;16px&#39;</span><span class=p>,</span> <span class=nx>padding</span><span class=o>:</span> <span class=s1>&#39;0 24px 16px 24px&#39;</span><span class=p>,</span> <span class=nx>border</span><span class=o>:</span> <span class=s1>&#39;1px solid #ddd&#39;</span> <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>mass</span><span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>Hiehgt</span><span class=o>:</span> <span class=p>{</span><span class=nx>height</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>SkinColor</span><span class=o>:</span> <span class=p>{</span><span class=nx>skin_color</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>HairColor</span><span class=o>:</span> <span class=p>{</span><span class=nx>hair_color</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>SWInfinitePeople</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>å› ä¸º SWAPI è¿”å›çš„çš„æ•°æ®ç»“æœä¸­æœ‰ä¸‹ä¸€é¡µ<code>next</code>å’Œä¸Šä¸€é¡µ<code>previous</code>çš„å®Œæ•´è·¯å¾„ï¼Œæ‰€ä»¥å°±ç›´æ¥æ‹¿åˆ°è¿™ä¸ªè·¯å¾„ä¼ ç»™è¯·æ±‚å‡½æ•°<code>fetchPeople</code>â€‹ã€‚</p></li><li><p>å› ä¸º<code>useInfiniteQuery</code>çš„<code>pageParam</code>éœ€è¦ä¸€ä¸ªåˆå§‹å€¼ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªå¸¸é‡ä¸º<code>initialUrl</code>ï¼Œæ”¾å…¥ç¬¬ä¸€é¡µçš„<code>URL</code>â€‹ã€‚</p></li><li><p>ç„¶åå†<code>getNextPageParams</code>ä¸­é€šè¿‡<code>lastPage</code>æ¥è·å–ä¸‹ä¸€é¡µã€‚ä¼ ç»™<code>pageParam</code>ã€‚</p></li><li><p>å°†å•æ¡æ•°æ®æå–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªç»„ä»¶<code>PeopleCard</code>æ¥æ¸²æŸ“ã€‚å°†å€¼ä¼ ç»™ç»„ä»¶å°±å¯ä»¥äº†ã€‚</p></li><li><p><code>InfiniteScroll</code>è¿™é‡Œéœ€è¦ä¼ å…¥å‡ ä¸ªå‚æ•°ï¼Œå‰ä¸‰ä¸ªåŸºæœ¬æ˜¯å¿…å¡«å‚æ•°ã€‚</p><ul><li><p><code>dataLength</code>ï¼šæ•°æ®çš„é•¿åº¦ï¼Œæˆ‘ä»¬é€šè¿‡ reduce æ¥è®¡ç®—ä¸‹ pages é‡Œé¢çš„ data ä¸‹ resultes çš„æ•°æ®é•¿åº¦ä¹‹å’Œï¼Œå°±æ˜¯æ¯æ¬¡åŠ è½½çš„æ•°æ®é•¿åº¦ã€‚</p></li><li><p><code>next</code>ï¼šåˆ°è¾¾åº•éƒ¨åè°ƒç”¨çš„å‡½æ•°ã€‚ä½¿ç”¨<code>useInfiniteQuery</code>è¿”å›çš„<code>fetchNextPage</code>å°±å¯ä»¥äº†ã€‚</p></li><li><p><code>hasMore</code>ï¼šæ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®ï¼Œé€šè¿‡<code>useInfiniteQuery</code>è¿”å›çš„<code>hasNextPage</code>å°±å¯ä»¥äº†ï¼Œå¦‚æœè¿”å›<code>undefined</code>åˆ™æ˜¾ç¤º<code>false</code>â€‹ã€‚</p></li><li><p><code>loader</code>ï¼šæ˜¯åŠ è½½æ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚</p></li><li><p><code>endMessage</code>ï¼šæ˜¯åŠ è½½åˆ°æœ€åº•éƒ¨æ˜¾ç¤ºçš„å†…å®¹ã€‚</p></li></ul></li></ol><p>â€</p><h3 id=ä¿®æ”¹-mutations>ä¿®æ”¹ Mutations</h3><p><code>mutation</code>ä¸»è¦ç”¨äºåˆ›å»ºã€æ›´æ–°ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ã€‚ReactQuery ä¸­ä½¿ç”¨<code>useMutation</code>è¿™ä¸ªé’©å­å‡½æ•°ã€‚</p><p>â€</p><h4 id=ç®€å•æ·»åŠ >ç®€å•æ·»åŠ </h4><p>æˆ‘ä»¬æ·»åŠ ä¸€ç»„è¶…çº§è‹±é›„åˆ°åˆ—è¡¨ï¼Œå°†è·å–åˆ—è¡¨å’Œæ·»åŠ éƒ½æ”¾åˆ°ä¸€ä¸ª hooks é‡Œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/hooks/useSuperHero.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useQuery</span><span class=p>,</span> <span class=nx>useMutation</span><span class=p>,</span> <span class=nx>QueryClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fetchHero</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/dcsuperheros&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>addHero</span> <span class=o>=</span> <span class=kr>async</span> <span class=nx>hero</span> <span class=p>=&gt;</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;http://localhost:4000/dcsuperheros&#39;</span><span class=p>,</span> <span class=nx>hero</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useFetchSuperHero</span> <span class=o>=</span> <span class=p>(</span><span class=nx>onSuccess</span><span class=p>,</span> <span class=nx>onError</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>useQuery</span><span class=p>([</span><span class=s1>&#39;fetch/superheros&#39;</span><span class=p>],</span> <span class=nx>fetchHero</span><span class=p>,</span> <span class=p>{</span> <span class=nx>onSuccess</span><span class=p>,</span> <span class=nx>onError</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useAddSuperHero</span> <span class=o>=</span> <span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>useMutation</span><span class=p>(</span><span class=nx>addHero</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åæˆ‘ä»¬åœ¨åˆ°é¡µé¢å¼•ç”¨å¯¹åº”çš„æ–¹æ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/pages/RQAddSuperHero.jsx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useFetchSuperHero</span><span class=p>,</span> <span class=nx>useAddSuperHero</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/hooks/useSuperHero.js&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RQAddSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>name</span><span class=p>,</span> <span class=nx>setName</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>[</span><span class=nx>alterEgo</span><span class=p>,</span> <span class=nx>setAlterEgo</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>onSuccess</span> <span class=o>=</span> <span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>({</span> <span class=nx>data</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>onError</span> <span class=o>=</span> <span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>({</span> <span class=nx>error</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>refetch</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useFetchSuperHero</span><span class=p>(</span><span class=nx>onSuccess</span><span class=p>,</span> <span class=nx>onError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>mutate</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useAddSuperHero</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>handleSubmit</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kr>const</span> <span class=nx>hero</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>alterEgo</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>mutate</span><span class=p>(</span><span class=nx>hero</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>setName</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>setAlterEgo</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span><span class=nx>loading</span><span class=p>...</span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>RQAddSuperHero</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>input</span> <span class=nx>type</span><span class=o>=</span><span class=s1>&#39;text&#39;</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span> <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>setName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>input</span> <span class=nx>type</span><span class=o>=</span><span class=s1>&#39;text&#39;</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>alterEgo</span><span class=p>}</span> <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>setAlterEgo</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>handleSubmit</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>æ·»åŠ </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>refetch</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>åˆ·æ–°åˆ—è¡¨</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>hero</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>id</span><span class=p>}.</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>hero</span><span class=p>.</span><span class=nx>alterEgo</span><span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>))}</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RQAddSuperHero</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p><code>useMutation</code>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>mutate</code>æ–¹æ³•ï¼Œè¿™ä¸ªå°±æ˜¯ç”¨æ¥æ¥æ”¶æäº¤çš„æ•°æ®çš„æ–¹æ³•ã€‚</p></li><li><p><code>useMutation</code>åŒæ ·å¯ä»¥è¿”å›<code>data</code>ã€<code>isLoading</code>ã€<code>isError</code>ã€<code>error</code>ï¼Œä½†æ˜¯åœ¨ä¸<code>useQuery</code>åŒæ—¶ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„ä¿®æ”¹ä¸ºåˆ«åï¼Œä»¥å…å˜é‡åå†²çªã€‚</p></li><li><p><code>useMutation</code>çš„å›è°ƒ<code>onSuccess</code>å’Œ<code>onError</code>é€šå¸¸å¯ä»¥ç”¨äºæäº¤æ•°æ®æˆåŠŸä»¥åè·å–åˆ° API è¿”å›çš„æ•°æ®å¦‚ä½•æ“ä½œã€‚ç¨åæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•åœ¨ç™»å½•æ—¶ä½¿ç”¨ã€‚</p></li></ol><p>â€</p><blockquote><p>è¿™é‡Œçš„å‘ï¼šåœ¨å°†<code>useQuery</code>å’Œ<code>useMutation</code>æ”¾åˆ°åŒä¸€ä¸ªé¡µé¢é‡Œä½¿ç”¨æ—¶ï¼Œä¼šæŠ¥ React Hooks çš„é”™è¯¯ï¼ŒæŒ‰ç…§æ•™ç¨‹æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ hooks åœ¨å¼•ç”¨æ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><p>â€</p><h4 id=ç™»å½•ç¤ºä¾‹>ç™»å½•ç¤ºä¾‹</h4><p>è¿™é‡Œæ¡ˆä¾‹ API ä½¿ç”¨çš„æ˜¯<code>RealWorld</code>çš„é¡¹ç›® APIï¼Œä½¿ç”¨äº†<code>formik</code>ä½œä¸ºè¡¨å•æ•°æ®æ¥æ”¶å’Œè¡¨å•æ•°æ®æ ¡éªŒï¼Œä½¿ç”¨<code>useMutation</code>æäº¤æ•°æ®åˆ° APIï¼Œæ‹¿åˆ° APi è¿”å›çš„ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨<code>onSuccess</code>åå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ storeï¼Œè·³è½¬åˆ°é¦–é¡µã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Link</span><span class=p>,</span> <span class=nx>useNavigate</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Formik</span><span class=p>,</span> <span class=nx>Form</span><span class=p>,</span> <span class=nx>Field</span><span class=p>,</span> <span class=nx>ErrorMessage</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;formik&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>Yup</span> <span class=nx>from</span> <span class=s1>&#39;yup&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useMutation</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>userApis</span> <span class=nx>from</span> <span class=s1>&#39;@/service/apis/user&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>userAction</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/store/user&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>LoginWrap</span><span class=p>,</span> <span class=nx>FormError</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./style&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Login</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>navigate</span> <span class=o>=</span> <span class=nx>useNavigate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>initialValues</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>validationSchema</span> <span class=o>=</span> <span class=nx>Yup</span><span class=p>.</span><span class=nx>object</span><span class=p>({</span>
</span></span><span class=line><span class=cl>		<span class=nx>email</span><span class=o>:</span> <span class=nx>Yup</span><span class=p>.</span><span class=nx>string</span><span class=p>().</span><span class=nx>email</span><span class=p>(</span><span class=s1>&#39;è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼&#39;</span><span class=p>).</span><span class=nx>required</span><span class=p>(</span><span class=s1>&#39;è¯·è¾“å…¥é‚®ç®±&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>password</span><span class=o>:</span> <span class=nx>Yup</span><span class=p>.</span><span class=nx>string</span><span class=p>().</span><span class=nx>required</span><span class=p>(</span><span class=s1>&#39;è¯·è¾“å…¥å¯†ç &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>onSubmit</span> <span class=o>=</span> <span class=nx>values</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>mutate</span><span class=p>(</span><span class=nx>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>isError</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>mutate</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useMutation</span><span class=p>([</span><span class=s1>&#39;user/login&#39;</span><span class=p>],</span> <span class=nx>userApis</span><span class=p>.</span><span class=nx>postLogin</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>onSuccess</span><span class=o>:</span> <span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>userAction</span><span class=p>.</span><span class=nx>login</span><span class=p>({</span>
</span></span><span class=line><span class=cl>				<span class=nx>token</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>user</span><span class=o>:</span> <span class=p>{</span> <span class=p>...</span><span class=nx>data</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>navigate</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>onError</span><span class=o>:</span> <span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>error</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>LoginWrap</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;page-container&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-block&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-sidebar&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-sidebar-text&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>Real</span> <span class=nx>World</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>							<span class=nx>ä¸ºäº†æ¶ˆé™¤å¼€å‘é¢†åŸŸçš„çŸ¥è¯†ä¸å¹³ç­‰</span><span class=err>ï¼Œ</span><span class=nx>å»ºç«‹äº†å¼€æ”¾å¼åä½œçš„é—®ç­”ç¤¾åŒº</span><span class=err>ã€‚</span><span class=nx>æ¬¢è¿ä½ åŠ å…¥å¹¶è´¡çŒ®è‡ªå·±çš„æ™ºæ…§</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-container&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-tips&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>							<span class=nx>è¿˜æ²¡æœ‰è´¦å·</span><span class=err>ï¼Œ</span><span class=nx>å»</span><span class=o>&lt;</span><span class=nx>Link</span> <span class=nx>to</span><span class=o>=</span><span class=s1>&#39;/register&#39;</span><span class=o>&gt;</span><span class=nx>æ³¨å†Œ</span><span class=o>&lt;</span><span class=err>/Link&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-text&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>ç™»å½•</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>small</span><span class=o>&gt;</span><span class=nx>Real</span> <span class=nx>World</span> <span class=nx>Login</span><span class=o>&lt;</span><span class=err>/small&gt;</span>
</span></span><span class=line><span class=cl>							<span class=p>{</span><span class=nx>isError</span> <span class=o>?</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=nx>ul</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;error-messages&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>									<span class=p>{</span><span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>error</span><span class=p>).</span><span class=nx>map</span><span class=p>(([</span><span class=nx>key</span><span class=p>,</span> <span class=nx>messages</span><span class=p>])</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>										<span class=nx>messages</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>message</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>											<span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span><span class=si>${</span><span class=nx>key</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>												<span class=p>{</span><span class=nx>key</span><span class=p>}</span> <span class=p>{</span><span class=nx>message</span><span class=p>}</span>
</span></span><span class=line><span class=cl>											<span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>										<span class=p>))</span>
</span></span><span class=line><span class=cl>									<span class=p>)}</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>							<span class=p>)</span> <span class=o>:</span> <span class=kc>null</span><span class=p>}</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=nx>Formik</span>
</span></span><span class=line><span class=cl>							<span class=nx>initialValues</span><span class=o>=</span><span class=p>{</span><span class=nx>initialValues</span><span class=p>}</span>
</span></span><span class=line><span class=cl>							<span class=nx>onSubmit</span><span class=o>=</span><span class=p>{</span><span class=nx>onSubmit</span><span class=p>}</span>
</span></span><span class=line><span class=cl>							<span class=nx>validationSchema</span><span class=o>=</span><span class=p>{</span><span class=nx>validationSchema</span><span class=p>}</span>
</span></span><span class=line><span class=cl>						<span class=o>&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>Form</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-item&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=nx>Field</span>
</span></span><span class=line><span class=cl>										<span class=nx>type</span><span class=o>=</span><span class=s1>&#39;text&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>name</span><span class=o>=</span><span class=s1>&#39;email&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-input&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>placeholder</span><span class=o>=</span><span class=s1>&#39;è¯·è¾“å…¥ç”µå­é‚®ç®±&#39;</span>
</span></span><span class=line><span class=cl>									<span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=nx>ErrorMessage</span> <span class=nx>name</span><span class=o>=</span><span class=s1>&#39;email&#39;</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>FormError</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-item&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=nx>Field</span>
</span></span><span class=line><span class=cl>										<span class=nx>type</span><span class=o>=</span><span class=s1>&#39;password&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>name</span><span class=o>=</span><span class=s1>&#39;password&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-input&#39;</span>
</span></span><span class=line><span class=cl>										<span class=nx>placeholder</span><span class=o>=</span><span class=s1>&#39;è¯·è¾“å…¥å¯†ç &#39;</span>
</span></span><span class=line><span class=cl>									<span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=nx>ErrorMessage</span> <span class=nx>name</span><span class=o>=</span><span class=s1>&#39;password&#39;</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>FormError</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-item&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=nx>button</span> <span class=nx>className</span><span class=o>=</span><span class=s1>&#39;log-form-btn&#39;</span> <span class=nx>type</span><span class=o>=</span><span class=s1>&#39;submit&#39;</span> <span class=nx>disabled</span><span class=o>=</span><span class=p>{</span><span class=nx>isLoading</span> <span class=o>&amp;&amp;</span> <span class=kc>true</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>										<span class=p>{</span><span class=nx>isLoading</span> <span class=o>?</span> <span class=s1>&#39;ç™»å½•ä¸­...&#39;</span> <span class=o>:</span> <span class=s1>&#39;ç™»å½•&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>									<span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>								<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=err>/Form&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=err>/Formik&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/LoginWrap&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>Login</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=ä¸»åŠ¨æŸ¥è¯¢å¤±æ•ˆ>ä¸»åŠ¨æŸ¥è¯¢å¤±æ•ˆ</h3><p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æŸ¥è¯¢åè¿˜éœ€è¦é€šè¿‡ç‚¹å‡»æŒ‰é’®ï¼Œé€šè¿‡<code>useQuery</code>çš„<code>refetch</code>â€‹ æ¥è§¦å‘åˆ—è¡¨åˆ·æ–°ã€‚</p><p>åœ¨ ReactQuery ä¸­å¯ä»¥ä½¿ç”¨<code>QueryClient</code>ä¸­çš„<code>invalidateQueries</code>æ–¹æ³•å¯ä»¥ä¸»åŠ¨æ ‡è®°æŸ¥è¯¢è¿‡æ—¶ï¼Œåœ¨é€šè¿‡<code>useQuery</code>æŸ¥è¯¢æ•°æ®ï¼Œè¿™æ—¶è¿™ä¼šå› ä¸ºæ•°æ®è¿‡æ—¶è€Œä¸»åŠ¨é‡æ–°è·å–æ•°æ®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// sec/hooks/useSuperHero.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useAddSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>useMutation</span><span class=p>(</span><span class=nx>addHero</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>onSuccess</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>queryClient</span><span class=p>.</span><span class=nx>invalidateQueries</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=æ›´æ–°ç¼“å­˜æ•°æ®>æ›´æ–°ç¼“å­˜æ•°æ®</h3><p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæäº¤è¶…çº§è‹±é›„çš„è¡¨å•åï¼Œä¼šå‘èµ·ä¸€ä¸ª 201 çš„ç½‘ç»œè¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ‰€æœ‰æ•°æ®çš„ 200 å“åº”ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>QueryClient</code>ä¸­çš„ setQueryData æ¥ç›´æ¥æ›´æ–°æŸ¥è¯¢çš„ç¼“å­˜æ•°æ®ï¼Œè€Œä¸å¿…æµªè´¹ç½‘ç»œå“åº”ï¼ŒèŠ‚çº¦èµ„æºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/hooks/useSuperHero.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useAddSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>useMutation</span><span class=p>(</span><span class=nx>addHero</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>onSuccess</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// queryClient.invalidateQueries([&#39;super-heros&#39;])
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>queryClient</span><span class=p>.</span><span class=nx>setQueryData</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>],</span> <span class=nx>oldQueryData</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=p>...</span><span class=nx>oldQueryData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>					<span class=nx>data</span><span class=o>:</span> <span class=p>[...</span><span class=nx>oldQueryData</span><span class=p>.</span><span class=nx>data</span><span class=p>,</span> <span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>]</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>â€</p><h3 id=ä¹è§‚æ›´æ–°>ä¹è§‚æ›´æ–°</h3><p>ä¹è§‚æ›´æ–°å…¶å®ä¹Ÿæ˜¯ç§è·å–æ•°æ®ä½“éªŒä¸Šçš„ä¼˜åŒ–ï¼Œå¦‚æœèƒ½è·å–æ•°æ®æˆåŠŸï¼Œå°±å±•ç¤ºæ–°è·å–çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰è·å–æ•°æ®æˆåŠŸï¼Œå°±å±•ç¤ºç¼“å­˜ä¸­çš„é™ˆæ—§æ•°æ®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// src/hooks/useSuperHero.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useAddSuperHero</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>useMutation</span><span class=p>(</span><span class=nx>addHero</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>onMutate</span><span class=o>:</span> <span class=kr>async</span> <span class=nx>newHero</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kr>await</span> <span class=nx>queryClient</span><span class=p>.</span><span class=nx>cancelQueries</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>			<span class=kr>const</span> <span class=nx>previousHeroData</span> <span class=o>=</span> <span class=nx>queryClient</span><span class=p>.</span><span class=nx>getQueryData</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>			<span class=nx>queryClient</span><span class=p>.</span><span class=nx>setQueryData</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>],</span> <span class=nx>oldQueryData</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=p>...</span><span class=nx>oldQueryData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>					<span class=nx>data</span><span class=o>:</span> <span class=p>[...</span><span class=nx>oldQueryData</span><span class=p>.</span><span class=nx>data</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>oldQueryData</span><span class=o>?</span><span class=p>.</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=p>...</span><span class=nx>newHero</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=p>{</span> <span class=nx>previousHeroData</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>onError</span><span class=o>:</span> <span class=p>(</span><span class=nx>_err</span><span class=p>,</span> <span class=nx>_newTodo</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>queryClient</span><span class=p>.</span><span class=nx>setQueryData</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>],</span> <span class=nx>context</span><span class=p>.</span><span class=nx>previousHeroData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>onSettled</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>queryClient</span><span class=p>.</span><span class=nx>invalidateQueries</span><span class=p>([</span><span class=s1>&#39;super-heros&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ä¹è§‚æ›´æ–°ï¼Œå°±éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li><p>å…ˆä½¿ç”¨<code>onMutate</code>åœ¨è·å–æ•°æ®<code>mutate</code>è°ƒç”¨æ—¶ä½¿ç”¨<code>cancelQueries</code>å–æ¶ˆç›¸å…³çš„æŸ¥è¯¢ã€‚ç„¶åé€šè¿‡<code>getQueryData</code>æ‹¿åˆ°ä¿å­˜ä¹‹å‰çŠ¶æ€çš„æ•°æ®å¿«ç…§ã€‚ç„¶åä½¿ç”¨<code>setQueryData</code>æ‰§è¡Œä¹è§‚æ›´æ–°ã€‚è¿”å›å…·æœ‰å…·æœ‰å¿«ç…§æ•°æ®çš„ä¸Šä¸‹æ–‡å¯¹è±¡<code>{ previousHeroData }</code>ã€‚</p></li><li><p>å¦‚æœä¿®æ”¹å¤±è´¥<code>onError</code>ï¼Œåˆ™ä½¿ç”¨<code>onMutate</code>è¿”å›çš„ä¸Šä¸‹æ–‡è¿›è¡Œå›æ»šã€‚</p></li><li><p>ä½¿ç”¨<code>onSettled</code>æ¥ä»£æ›¿<code>onSuccess</code>ï¼Œä»–è¡¨ç¤ºåœ¨é”™è¯¯æˆ–æˆåŠŸä¹‹åçš„æ“ä½œï¼Œé€šè¿‡ä¸»åŠ¨æŸ¥è¯¢å¤±è´¥é‡æ–°è·å–æ•°æ®ã€‚</p></li></ol><p>â€</p><h3 id=æ€»ç»“>æ€»ç»“</h3><p>ReactQuery åŸºæœ¬ä¸Šèƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†çš„æ•°æ®è·å–ã€æäº¤çš„éœ€æ±‚ï¼ŒåŒæ—¶ç®€åŒ–æ•°æ®è·å–çš„çŠ¶æ€ä»¥åŠç¼“å­˜çš„ç®¡ç†ã€‚ä¸Šè¿°å†…å®¹åŸºæœ¬æ»¡è¶³ä¸šåŠ¡çš„ç»å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œæ›´å¤šåŠŸèƒ½åœ¨é‡åˆ°äº†å†å»æŸ¥æŸ¥å®˜æ–¹æ–‡æ¡£ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/react/>react</a>
<a href=/tags/react-query/>react-query</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy; 2022 - 2023 SimFantasy</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>